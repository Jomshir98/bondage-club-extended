{"version":3,"file":"bcx.js","sources":["../src/resources.ts","../src/BCXContext.ts","../src/utilsClub.ts","../src/config.ts","../src/utils.ts","../src/patching.ts","../src/constants.ts","../src/modules/_BaseModule.ts","../node_modules/lodash-es/_listCacheClear.js","../node_modules/lodash-es/eq.js","../node_modules/lodash-es/_assocIndexOf.js","../node_modules/lodash-es/_listCacheDelete.js","../node_modules/lodash-es/_listCacheGet.js","../node_modules/lodash-es/_listCacheHas.js","../node_modules/lodash-es/_listCacheSet.js","../node_modules/lodash-es/_ListCache.js","../node_modules/lodash-es/_stackClear.js","../node_modules/lodash-es/_stackDelete.js","../node_modules/lodash-es/_stackGet.js","../node_modules/lodash-es/_stackHas.js","../node_modules/lodash-es/_freeGlobal.js","../node_modules/lodash-es/_root.js","../node_modules/lodash-es/_Symbol.js","../node_modules/lodash-es/_getRawTag.js","../node_modules/lodash-es/_objectToString.js","../node_modules/lodash-es/_baseGetTag.js","../node_modules/lodash-es/isObject.js","../node_modules/lodash-es/isFunction.js","../node_modules/lodash-es/_coreJsData.js","../node_modules/lodash-es/_isMasked.js","../node_modules/lodash-es/_toSource.js","../node_modules/lodash-es/_baseIsNative.js","../node_modules/lodash-es/_getValue.js","../node_modules/lodash-es/_getNative.js","../node_modules/lodash-es/_Map.js","../node_modules/lodash-es/_nativeCreate.js","../node_modules/lodash-es/_hashClear.js","../node_modules/lodash-es/_hashDelete.js","../node_modules/lodash-es/_hashGet.js","../node_modules/lodash-es/_hashHas.js","../node_modules/lodash-es/_hashSet.js","../node_modules/lodash-es/_Hash.js","../node_modules/lodash-es/_mapCacheClear.js","../node_modules/lodash-es/_isKeyable.js","../node_modules/lodash-es/_getMapData.js","../node_modules/lodash-es/_mapCacheDelete.js","../node_modules/lodash-es/_mapCacheGet.js","../node_modules/lodash-es/_mapCacheHas.js","../node_modules/lodash-es/_mapCacheSet.js","../node_modules/lodash-es/_MapCache.js","../node_modules/lodash-es/_stackSet.js","../node_modules/lodash-es/_Stack.js","../node_modules/lodash-es/_arrayEach.js","../node_modules/lodash-es/_defineProperty.js","../node_modules/lodash-es/_baseAssignValue.js","../node_modules/lodash-es/_assignValue.js","../node_modules/lodash-es/_copyObject.js","../node_modules/lodash-es/_baseTimes.js","../node_modules/lodash-es/isObjectLike.js","../node_modules/lodash-es/_baseIsArguments.js","../node_modules/lodash-es/isArguments.js","../node_modules/lodash-es/isArray.js","../node_modules/lodash-es/stubFalse.js","../node_modules/lodash-es/isBuffer.js","../node_modules/lodash-es/_isIndex.js","../node_modules/lodash-es/isLength.js","../node_modules/lodash-es/_baseIsTypedArray.js","../node_modules/lodash-es/_baseUnary.js","../node_modules/lodash-es/_nodeUtil.js","../node_modules/lodash-es/isTypedArray.js","../node_modules/lodash-es/_arrayLikeKeys.js","../node_modules/lodash-es/_isPrototype.js","../node_modules/lodash-es/_overArg.js","../node_modules/lodash-es/_nativeKeys.js","../node_modules/lodash-es/_baseKeys.js","../node_modules/lodash-es/isArrayLike.js","../node_modules/lodash-es/keys.js","../node_modules/lodash-es/_baseAssign.js","../node_modules/lodash-es/_nativeKeysIn.js","../node_modules/lodash-es/_baseKeysIn.js","../node_modules/lodash-es/keysIn.js","../node_modules/lodash-es/_baseAssignIn.js","../node_modules/lodash-es/_cloneBuffer.js","../node_modules/lodash-es/_copyArray.js","../node_modules/lodash-es/_arrayFilter.js","../node_modules/lodash-es/stubArray.js","../node_modules/lodash-es/_getSymbols.js","../node_modules/lodash-es/_copySymbols.js","../node_modules/lodash-es/_arrayPush.js","../node_modules/lodash-es/_getPrototype.js","../node_modules/lodash-es/_getSymbolsIn.js","../node_modules/lodash-es/_copySymbolsIn.js","../node_modules/lodash-es/_baseGetAllKeys.js","../node_modules/lodash-es/_getAllKeys.js","../node_modules/lodash-es/_getAllKeysIn.js","../node_modules/lodash-es/_DataView.js","../node_modules/lodash-es/_Promise.js","../node_modules/lodash-es/_Set.js","../node_modules/lodash-es/_WeakMap.js","../node_modules/lodash-es/_getTag.js","../node_modules/lodash-es/_initCloneArray.js","../node_modules/lodash-es/_Uint8Array.js","../node_modules/lodash-es/_cloneArrayBuffer.js","../node_modules/lodash-es/_cloneDataView.js","../node_modules/lodash-es/_cloneRegExp.js","../node_modules/lodash-es/_cloneSymbol.js","../node_modules/lodash-es/_cloneTypedArray.js","../node_modules/lodash-es/_initCloneByTag.js","../node_modules/lodash-es/_baseCreate.js","../node_modules/lodash-es/_initCloneObject.js","../node_modules/lodash-es/_baseIsMap.js","../node_modules/lodash-es/isMap.js","../node_modules/lodash-es/_baseIsSet.js","../node_modules/lodash-es/isSet.js","../node_modules/lodash-es/_baseClone.js","../node_modules/lodash-es/cloneDeep.js","../src/helpTexts.ts","../src/gui/subscreen.ts","../src/gui/authority_dialogMin.ts","../src/gui/authority_dialogSelf.ts","../src/gui/authority_permissions.ts","../src/gui/member_select.ts","../src/gui/authority_roles.ts","../src/gui/global_dialogClearData.ts","../src/gui/global_moduleToggling.ts","../src/gui/global.ts","../node_modules/lodash-es/_setCacheAdd.js","../node_modules/lodash-es/_setCacheHas.js","../node_modules/lodash-es/_SetCache.js","../node_modules/lodash-es/_arraySome.js","../node_modules/lodash-es/_cacheHas.js","../node_modules/lodash-es/_equalArrays.js","../node_modules/lodash-es/_mapToArray.js","../node_modules/lodash-es/_setToArray.js","../node_modules/lodash-es/_equalByTag.js","../node_modules/lodash-es/_equalObjects.js","../node_modules/lodash-es/_baseIsEqualDeep.js","../node_modules/lodash-es/_baseIsEqual.js","../node_modules/lodash-es/isEqual.js","../src/rules/bc_alter.ts","../src/modules/miscPatches.ts","../src/rules/bc_blocks.ts","../src/rules/bc_settings.ts","../src/rules/relation_control.ts","../src/modules/speech.ts","../src/rules/speech_control.ts","../src/rules/other.ts","../src/modules/conditions.ts","../src/modules/rules.ts","../src/modules/commands.ts","../src/modules/cursesConstants.ts","../src/modules/log.ts","../src/gui/log_config.ts","../src/gui/log.ts","../src/gui/misc.ts","../src/modules/curses.ts","../src/gui/conditions_edit_base.ts","../src/gui/conditions_edit_curses.ts","../src/gui/conditions_global_base.ts","../src/gui/conditions_global_curses.ts","../src/gui/conditions_view_base.ts","../src/gui/curses_add.ts","../src/gui/conditions_view_curses.ts","../src/gui/conditions_edit_rules.ts","../src/gui/conditions_global_rules.ts","../src/gui/rules_viewDescription.ts","../src/gui/rules_add.ts","../src/gui/conditions_view_rules.ts","../src/gui/welcome.ts","../src/gui/tutorial.ts","../src/modules/versionCheck.ts","../src/gui/mainmenu.ts","../src/modules/gui.ts","../src/modules/chatroom.ts","../src/modules/storage.ts","../src/modules/authority.ts","../src/characters.ts","../src/modules/messaging.ts","../src/modules/presets.ts","../src/migration.ts","../src/moduleManager.ts","../src/errorReporting.ts","../src/main.ts","../src/modules/chatroomAdmin.ts","../node_modules/lodash-es/_baseIsMatch.js","../node_modules/lodash-es/_isStrictComparable.js","../node_modules/lodash-es/_getMatchData.js","../node_modules/lodash-es/_matchesStrictComparable.js","../node_modules/lodash-es/_baseMatches.js","../node_modules/lodash-es/isSymbol.js","../node_modules/lodash-es/_isKey.js","../node_modules/lodash-es/memoize.js","../node_modules/lodash-es/_memoizeCapped.js","../node_modules/lodash-es/_stringToPath.js","../node_modules/lodash-es/_arrayMap.js","../node_modules/lodash-es/_baseToString.js","../node_modules/lodash-es/toString.js","../node_modules/lodash-es/_castPath.js","../node_modules/lodash-es/_toKey.js","../node_modules/lodash-es/_baseGet.js","../node_modules/lodash-es/get.js","../node_modules/lodash-es/_baseHasIn.js","../node_modules/lodash-es/_hasPath.js","../node_modules/lodash-es/hasIn.js","../node_modules/lodash-es/_baseMatchesProperty.js","../node_modules/lodash-es/identity.js","../node_modules/lodash-es/_baseProperty.js","../node_modules/lodash-es/_basePropertyDeep.js","../node_modules/lodash-es/property.js","../node_modules/lodash-es/_baseIteratee.js","../node_modules/lodash-es/last.js","../node_modules/lodash-es/_baseSlice.js","../node_modules/lodash-es/_parent.js","../node_modules/lodash-es/_baseUnset.js","../node_modules/lodash-es/_basePullAt.js","../node_modules/lodash-es/remove.js","../src/modules/clubUtils.ts","../src/modules/wardrobe.ts","../src/modules/console.ts","../src/modules/custom.ts","../src/modules/dialog.ts","../src/modules/friends.ts","../src/index.ts","../src/modules.ts"],"sourcesContent":["export const icon_ExternalLink = `data:image/svg+xml;base64,\nPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgeG1sbnM9Imh0dHA6\nLy93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAg\nMCAyMCAyMCI+DQogIDx0aXRsZT4NCiAgICBleHRlcm5hbCBsaW5rDQogIDwvdGl0bGU+DQogIDxw\nYXRoIGQ9Ik0xNyAxN0gzVjNoNVYxSDNhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0\nYTIgMiAwIDAgMCAyLTJ2LTVoLTJ6Ii8+DQogIDxwYXRoIGQ9Ik0xOSAxaC04bDMuMjkgMy4yOS01\nLjczIDUuNzMgMS40MiAxLjQyIDUuNzMtNS43M0wxOSA5VjF6Ii8+DQo8L3N2Zz4NCg==\n`.replaceAll(\"\\n\", \"\");\n\n// SVG; dimensions: 50x50\nexport const icon_Typing_base = `m16.224 3.7453 18.537-0.00135c8.045 0.12979 14.142 7.9048 13.74 13.256v5c-0.07394 7.8789-4.2176 15.139-12.946 15.375l-13.663 0.17306-10.992 8.5772-0.13168-8.8861c-4.4316-3.095-9.4592-6.006-9.113-12.266l-0.15485-7.9735c-0.11565-6.8309 6.3297-13.251 14.724-13.255z`;\n\n// SVG; dimensions: 50x50\nexport const icon_Typing_dot = `m15.793 19.891a3.5336 3.5336 0 0 1-2.5515 4.2857 3.5336 3.5336 0 0 1-4.2954-2.5351 3.5336 3.5336 0 0 1 2.5186-4.3051 3.5336 3.5336 0 0 1 4.3147 2.5021`;\n\n// SVG; dimensions: 50x50\nexport const icon_Typing_star = `m11.902 16.017 0.16893 3.7841-3.5814-1.2839-0.64194 1.9934 3.6489 1.0136-2.3313 3.007 1.6893 1.2163 2.1285-3.1421 2.0948 3.1421 1.7231-1.2163-2.365-3.007 3.6489-1.0136-0.64194-1.9934-3.5814 1.2839 0.16893-3.7841z`;\n\nexport const icon_NewMessage = `data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAADpElEQVR42uyZP0grWRTGz+gk\nyhPEXYSQQmTAJoWCqJ2VqAgmYhBFtxELURHfW7ERbATTprEIJmAEWcbONBKf+KcRG7HQoGEW0ZhC\ngwmmEGIiZvy2eXlkvE40muhG5oMUmTn3nvO75947d85wAOgrqIi+iDQQDUQD0UA0EA3kPeLD4TA5\nnc7voihOSpL0BxHJhZIEQRDuOjs7F8fHx220sLDwg4hQyL/p6Wk7NTU1/ZvJiOO4Tw/0pRiqq6uD\nHM/zN8lk8k8iIqPRSKFQSJE/q9VKExMTVFJSQvF4nMkvAOI47sV5kDqcZrJN7wsAlZaWkizL5HK5\nSBRFha0gCBQMBunx8ZGIKEo8z9+kyNbW1uB0OhnikZERXF5e4qMVDocxOTnJZMRut2N/fz/92o0C\nZGdnBwCwu7sLk8mkaFxZWQmPx/NhEOvr66iqqlLEIAgCNjc3AQB+v18dZGtrSzEaY2NjTHZmZ2cR\nj8fzBnB/fw+bzcb4HRwcxNXV1W+7k5MTdZDt7W2mY5fLxXTa0dEBSZJyDnF+fg6r1cr4m5+fhyzL\nCtusQQDA5/PBYrEoOi8vL4fD4cDd3V1OsuB2u2EwGBQ+WltbcXBw8Gyb4+Pj7EEAIJFIwG63M6PV\n39+PUCj0ZohIJIKhoSGm37m5OcRiMdV2GTOSvkbUtLGxAaPRqHBaU1OTcRDUtLe3h9raWkVfFRUV\n8Hq9L7Z909R6qmAwiL6+PmYUbTZbxlF8KbsWiwWnp6eviiEnIKl5vbKywszrlpYW+Hw+1XaSJMFs\nNjNZcLvdWe2GDEhxcfGbQFLy+/1obm5WBMbzPBYXFxU7jSzLEEURZWVlCtuGhgYcHh5m7ffda+Q5\n3d7eYmZm5tm9//r6GtFoFKOjo8z9qakpRKPRN/nM2dR6Tl6vl3ka19fXo7GxkTklrK6uvstXXkEA\nIBAIYGBgQPWk2t3d/eoF/akgAJBMJrG0tAS9Xq+AcDgceHh4yImPvKwRNR0dHcFsNqOtrU31CZ0r\nED69iP2a94psVFdXRx6PhwCQTqfL7zt7roNnHPD8x1dRCvkTgwIk39nJK8iX+dCTnoVCzgj/qwpB\nREQXFxcUCAQokUgwVY+n1ZLU/6cZVbN/TeUl3Wem9jqdjs7OzpQXTSbTRaEX6AwGw2VRb2/vP4W+\nPrq6urb5np6euUgk8m15efmvWCxWQkSPBRI/p9fr5fb29p/Dw8N/c9rnaQ1EA9FANBANRAPRQP5/\n+m8A4sEE5SZccHcAAAAASUVORK5CYII=`.replaceAll(\"\\n\", \"\");\n\n// SVG; dimensions: 24x24\nexport const icon_star = `m12 .288l2.833 8.718h9.167l-7.417 5.389 2.833 8.718-7.416-5.388-7.417 5.388 2.833-8.718-7.416-5.389h9.167z`;\n\n// SVG; dimensions: 50x50\nexport const icon_heart = `m14.483 4.5372c-10.063 0.0305-12.109 8.5713-12.008 12.355 0.1628 6.5444 5.4929 11.067 10.223 15.516 4.7684 3.8893 8.5801 8.3608 12.383 12.838 3.8031-4.4771 7.614-8.9486 12.382-12.838 4.7298-4.4488 10.06-8.9712 10.223-15.516 0.10164-3.7842-1.9446-12.325-12.008-12.355-4.9198-0.28718-10.597 6.153-10.597 6.153-1.7777-1.9041-4.833-6.2892-10.598-6.153z`;\n\n// SVG; dimensions: 50x50\nexport const icon_BCX_cross = `m7.3532 5.3725 10.98 19.412-10.98 19.803h15.294l2.3528-5.4898c0.78426 1.8299 1.5685 3.6599 2.3528 5.4898h15.294l-10.98-19.803c3.6599-6.4706 7.3197-12.941 10.98-19.412h-15.294l-2.3528 5.4898-2.3528-5.4898z`;\n\nexport const icon_BCX = `data:image/png;base64,\n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\n`.replaceAll(\"\\n\", \"\");\n\nexport const icon_OwnerList = `data:image/png;base64,\n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\nxBaQJfz/AJiiFen2ESExAAAAAElFTkSuQmCC\n`.replaceAll(\"\\n\", \"\");\n\nexport const icon_rules = `data:image/png;base64,\n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`.replaceAll(\"\\n\", \"\");\n\nexport const icon_restrictions = `data:image/png;base64,\n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`.replaceAll(\"\\n\", \"\");\n","\nexport function BCX_setInterval(handler: () => void, timeout?: number): number {\n\t// eslint-disable-next-line no-restricted-globals\n\treturn setInterval(() => {\n\t\tconst ctx = debugContextStart(\"BCX internal interval\", { root: true, bcxArea: true });\n\t\thandler();\n\t\tctx.end();\n\t}, timeout);\n}\n\nexport function BCX_setTimeout(handler: () => void, timeout?: number): number {\n\t// eslint-disable-next-line no-restricted-globals\n\treturn setTimeout(() => {\n\t\tconst ctx = debugContextStart(\"BCX internal timeout\", { root: true, bcxArea: true });\n\t\thandler();\n\t\tctx.end();\n\t}, timeout);\n}\n\nexport interface DebugContextHandle {\n\tend(): void;\n}\n\ninterface DebugContext {\n\tname: string;\n\tbcxArea: boolean;\n\troot: boolean;\n\textraInfo?: () => string;\n}\n\nlet contextStack: DebugContext[] = [];\n\nexport function contextInBCXArea(): boolean {\n\tif (contextStack.length === 0)\n\t\treturn false;\n\treturn contextStack[contextStack.length - 1].bcxArea;\n}\n\nexport function debugContextStart(name: string, { root = false, bcxArea, extraInfo }: {\n\troot?: boolean,\n\tbcxArea?: boolean,\n\textraInfo?: () => string\n} = {}): DebugContextHandle {\n\n\tconst context: DebugContext = {\n\t\tname,\n\t\tbcxArea: bcxArea ?? contextInBCXArea(),\n\t\troot,\n\t\textraInfo\n\t};\n\n\tconst handle: DebugContextHandle = {\n\t\tend: () => {\n\t\t\tif (contextStack[contextStack.length - 1] === context) {\n\t\t\t\tcontextStack.pop();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst index = contextStack.indexOf(context);\n\t\t\tif (index < 0) {\n\t\t\t\tconsole.warn(`BCX: Debug context end while it is not on stack`, context, new Error());\n\t\t\t} else {\n\t\t\t\tconst toRemove = contextStack.length - index;\n\t\t\t\tconst removed = contextStack.splice(index, toRemove);\n\t\t\t\tconsole.warn(`BCX: Debug context end while not on top of the stack (depth ${toRemove})`, removed, new Error());\n\t\t\t}\n\t\t}\n\t};\n\n\tif (root && contextStack.length > 0) {\n\t\tconsole.warn(`BCX: Root context when we already have context`, contextStack, new Error());\n\t\tcontextStack = [];\n\t}\n\n\tcontextStack.push(context);\n\n\treturn handle;\n}\n\nexport function debugMakeContextReport(): string {\n\tlet res = `----- Current context (most recent first) -----\\n`;\n\tif (contextStack.length === 0) {\n\t\tres += `[None]\\n`;\n\t} else {\n\t\tfor (let i = contextStack.length - 1; i >= 0; i--) {\n\t\t\tconst ctx = contextStack[i];\n\t\t\tres += `> ${ctx.name}\\n`;\n\t\t\tif (ctx.extraInfo) {\n\t\t\t\tlet extra = \"\";\n\t\t\t\ttry {\n\t\t\t\t\textra = ctx.extraInfo();\n\t\t\t\t} catch (error) {\n\t\t\t\t\textra = \"Error processing extra info:\\n\" + (error instanceof Error ? error.stack : `${error}`);\n\t\t\t\t}\n\t\t\t\tres += extra.trim().replace(/\\n|^/g, m => `${m}| `) + \"\\n\";\n\t\t\t}\n\t\t}\n\t\tif (!contextStack[0].root) {\n\t\t\tres += `[unknown origin]\\n`;\n\t\t}\n\t}\n\n\treturn res;\n}\n","import { icon_Typing_star, icon_Typing_base, icon_Typing_dot } from \"./resources\";\nimport { BCX_setTimeout } from \"./BCXContext\";\n\nconst GROUP_NAME_OVERRIDES: Record<string, string> = {\n\t\"ItemNeckAccessories\": \"Collar Addon\",\n\t\"ItemNeckRestraints\": \"Collar Restraint\",\n\t\"ItemNipplesPiercings\": \"Nipple Piercing\",\n\t\"ItemHood\": \"Hood\",\n\t\"ItemMisc\": \"Miscellaneous\",\n\t\"ItemDevices\": \"Devices\",\n\t\"ItemHoodAddon\": \"Hood Addon\",\n\t\"ItemAddon\": \"General Addon\",\n\t\"ItemLegs\": \"Upper Leg\",\n\t\"ItemFeet\": \"Lower Leg\",\n\t\"ItemBoots\": \"Feet\",\n\t\"ItemMouth\": \"Mouth (1)\",\n\t\"ItemMouth2\": \"Mouth (2)\",\n\t\"ItemMouth3\": \"Mouth (3)\"\n};\n\nexport let allowMode: boolean = false;\nexport let developmentMode: boolean = false;\n\nexport function setAllowMode(allow: boolean): boolean {\n\tif (allow) {\n\t\tconsole.warn(\"Cheats enabled; please be careful not to break things\");\n\t} else {\n\t\tif (!setDevelopmentMode(false))\n\t\t\treturn false;\n\t\tconsole.info(\"Cheats disabled\");\n\t}\n\tallowMode = allow;\n\treturn true;\n}\n\nexport function setDevelopmentMode(devel: boolean): boolean {\n\tif (devel) {\n\t\tif (!setAllowMode(true)) {\n\t\t\tconsole.info(\"To use developer mode, cheats must be enabled first!\");\n\t\t\treturn false;\n\t\t}\n\t\t(window as any).BCX_Devel = true;\n\t\tAssetGroup.forEach(G => G.Description = G.Name);\n\t\tAsset.forEach(A => A.Description = A.Group.Name + \":\" + A.Name);\n\t\tBackgroundSelectionAll.forEach(B => {\n\t\t\tB.Description = B.Name;\n\t\t\tB.Low = B.Description.toLowerCase();\n\t\t});\n\t\tconsole.warn(\"Developer mode enabled\");\n\t} else {\n\t\tdelete (window as any).BCX_Devel;\n\t\tAssetLoadDescription(\"Female3DCG\");\n\t\tBackgroundSelectionAll.forEach(B => {\n\t\t\tB.Description = DialogFindPlayer(B.Name);\n\t\t\tB.Low = B.Description.toLowerCase();\n\t\t});\n\t\tconsole.info(\"Developer mode disabled\");\n\t}\n\tdevelopmentMode = devel;\n\treturn true;\n}\n\nexport let BCXSource: string | null = null;\nexport let BCXSourceExternal: boolean = false;\n\nexport function init_findBCXSource(): void {\n\tfor (const elem of Array.from(document.getElementsByTagName(\"script\"))) {\n\t\tconst match = /^(https:\\/\\/[^?/]+\\/([^?]+)?|http:\\/\\/localhost(?::[0-9]+)?\\/)bcx.js($|\\?)/i.exec(elem.src);\n\t\tif (match) {\n\t\t\tBCXSource = match[1];\n\t\t\treturn;\n\t\t}\n\t}\n\tconst externalSrc = (window as any).BCX_SOURCE as unknown;\n\tif (typeof externalSrc === \"string\") {\n\t\tBCXSourceExternal = true;\n\t\tconst match = /^(https:\\/\\/[^?/]+\\/(?:[^?]+?)?)(?:bcx.js)?(?:$|\\?)/i.exec(externalSrc);\n\t\tif (match) {\n\t\t\tBCXSource = match[1];\n\t\t\tconsole.log(\"BCX: External BCX_SOURCE supplied, using it\");\n\t\t\treturn;\n\t\t}\n\t\tconsole.warn(\"BCX: External BCX_SOURCE supplied, but malformed, ignoring\", externalSrc);\n\t}\n\tconst msg = \"BCX: Failed to find BCX's source! Some functions will not work properly. Are you using the official version?\";\n\tconsole.error(msg);\n\talert(msg);\n}\n\nexport function getVisibleGroupName(group: AssetGroup): string {\n\treturn developmentMode ? group.Name : (GROUP_NAME_OVERRIDES[group.Name] ?? group.Description);\n}\n\nexport function InfoBeep(msg: string, timer: number = 3000) {\n\tServerBeep = {\n\t\tTimer: CommonTime() + timer,\n\t\tMessage: msg\n\t};\n}\n\nexport function ChatRoomActionMessage(msg: string, target: null | number = null) {\n\tif (!msg) return;\n\tServerSend(\"ChatRoomChat\", {\n\t\tContent: \"Beep\",\n\t\tType: \"Action\",\n\t\tTarget: target,\n\t\tDictionary: [\n\t\t\t{ Tag: \"Beep\", Text: \"msg\" },\n\t\t\t{ Tag: \"Biep\", Text: \"msg\" },\n\t\t\t{ Tag: \"Sonner\", Text: \"msg\" },\n\t\t\t{ Tag: \"msg\", Text: msg }\n\t\t]\n\t});\n}\n\nexport function ChatRoomSendLocal(msg: string | Node, timeout?: number, sender?: number): HTMLDivElement | null {\n\t// Adds the message and scrolls down unless the user has scrolled up\n\tconst div = document.createElement(\"div\");\n\tdiv.setAttribute(\"class\", \"ChatMessage ChatMessageLocalMessage\");\n\tdiv.setAttribute(\"data-time\", ChatRoomCurrentTime());\n\tdiv.setAttribute('data-sender', `${sender ?? Player.MemberNumber ?? 0}`);\n\tdiv.style.background = \"#6e6eff54\";\n\tdiv.style.margin = \"0.15em 0\";\n\n\tif (typeof msg === 'string')\n\t\tdiv.innerText = msg;\n\telse\n\t\tdiv.appendChild(msg);\n\n\tif (timeout) BCX_setTimeout(() => div.remove(), timeout);\n\n\t// Returns the focus on the chat box\n\tconst Refocus = document.activeElement?.id === \"InputChat\";\n\tconst ShouldScrollDown = ElementIsScrolledToEnd(\"TextAreaChatLog\");\n\tconst ChatLog = document.getElementById(\"TextAreaChatLog\");\n\tif (ChatLog != null) {\n\t\tChatLog.appendChild(div);\n\t\tif (ShouldScrollDown) ElementScrollToEnd(\"TextAreaChatLog\");\n\t\tif (Refocus) ElementFocus(\"InputChat\");\n\t\treturn div;\n\t}\n\treturn null;\n}\n\nexport function isNModClient(): boolean {\n\treturn typeof (window as any).ChatRoomDrawFriendList === \"function\";\n}\n\nexport function detectOtherMods() {\n\tconst w = window as any;\n\treturn {\n\t\tNMod: isNModClient(),\n\t\tBondageClubTools: (window as any).BCX_BondageClubToolsPatch === true || ServerSocket.listeners(\"ChatRoomMessage\").some(i => i.toString().includes(\"window.postMessage\")),\n\t\tBCFriendList: ServerSocket.listeners(\"AccountQueryResult\").some(i => i.toString().includes(\"f_t_body.innerText\")),\n\t\tCurse: typeof w.CursedStarter === \"function\" ? (`${w.currentManifestVersion}` || true) : false,\n\t\tRPScript: typeof (Player as any)?.RPSScriptstatus === \"string\" ? (`${(Player as any)?.RPSScriptstatus}` || true) : false,\n\t\tMoaner: w.M_MOANER_scriptOn !== undefined ? (`${w.M_MOANER_scriptOn}` || true) : false,\n\t\tBcUtil: typeof w.StartBcUtil === \"function\",\n\t\tQuickAccessMenu: typeof w.OLDmenu === \"function\" && typeof w.NEWmenu === \"function\",\n\t\tImprovedStruggle: typeof w.OLDclick === \"function\" && typeof w.NEWclick === \"function\",\n\t\tBCE: w.BCE_VERSION !== undefined ? (w.BCE_VERSION ?? true) : false\n\t};\n}\n\ninterface DrawImageExOptions {\n\tCanvas?: CanvasRenderingContext2D;\n\tAlpha?: number;\n\tSourcePos?: [number, number, number, number];\n\tWidth?: number;\n\tHeight?: number;\n\tInvert?: boolean;\n\tMirror?: boolean;\n\tZoom?: number;\n}\n\n/**\n * Draws an image on canvas, applying all options\n * @param {string | HTMLImageElement | HTMLCanvasElement} Source - URL of image or image itself\n * @param {number} X - Position of the image on the X axis\n * @param {number} Y - Position of the image on the Y axis\n * @param {object} [options] - any extra options, optional\n * @param {CanvasRenderingContext2D} [options.Canvas] - Canvas on which to draw the image, defaults to `MainCanvas`\n * @param {number} [options.Alpha] - transparency between 0-1\n * @param {[number, number, number, number]} [options.SourcePos] - Area in original image to draw in format `[left, top, width, height]`\n * @param {number} [options.Width] - Width of the drawn image, defaults to width of original image\n * @param {number} [options.Height] - Height of the drawn image, defaults to height of original image\n * @param {boolean} [options.Invert=false] - If image should be flipped vertically\n * @param {boolean} [options.Mirror=false] - If image should be flipped horizontally\n * @param {number} [options.Zoom=1] - Zoom factor\n * @returns {boolean} - whether the image was complete or not\n */\nexport function DrawImageEx(\n\tSource: string | HTMLImageElement | HTMLCanvasElement,\n\tX: number,\n\tY: number,\n\t{\n\t\tCanvas = MainCanvas,\n\t\tAlpha = 1,\n\t\tSourcePos,\n\t\tWidth,\n\t\tHeight,\n\t\tInvert = false,\n\t\tMirror = false,\n\t\tZoom = 1\n\t}: DrawImageExOptions = {}\n) {\n\tif (typeof Source === \"string\") {\n\t\tSource = DrawGetImage(Source);\n\t\tif (!Source.complete) return false;\n\t\tif (!Source.naturalWidth) return true;\n\t}\n\n\tconst sizeChanged = Width != null || Height != null;\n\tif (Width == null) {\n\t\tWidth = SourcePos ? SourcePos[2] : Source.width;\n\t}\n\tif (Height == null) {\n\t\tHeight = SourcePos ? SourcePos[3] : Source.height;\n\t}\n\n\tCanvas.save();\n\n\tCanvas.globalCompositeOperation = \"source-over\";\n\tCanvas.globalAlpha = Alpha;\n\tCanvas.translate(X, Y);\n\n\tif (Zoom !== 1) {\n\t\tCanvas.scale(Zoom, Zoom);\n\t}\n\n\tif (Invert) {\n\t\tCanvas.transform(1, 0, 0, -1, 0, Height);\n\t}\n\n\tif (Mirror) {\n\t\tCanvas.transform(-1, 0, 0, 1, Width, 0);\n\t}\n\n\tif (SourcePos) {\n\t\tCanvas.drawImage(Source, SourcePos[0], SourcePos[1], SourcePos[2], SourcePos[3], 0, 0, Width, Height);\n\t} else if (sizeChanged) {\n\t\tCanvas.drawImage(Source, 0, 0, Width, Height);\n\t} else {\n\t\tCanvas.drawImage(Source, 0, 0);\n\t}\n\n\tCanvas.restore();\n\treturn true;\n}\n\nexport function DrawImageBCX(Name: string, X: number, Y: number, options?: DrawImageExOptions): boolean {\n\tif (!BCXSource) {\n\t\treturn true;\n\t}\n\treturn DrawImageEx(BCXSource + \"resources/\" + Name, X, Y, options);\n}\n\nexport function smartGetAsset(item: Item | Asset): Asset {\n\tconst asset = Asset.includes(item as Asset) ? item as Asset : (item as Item).Asset;\n\tif (!Asset.includes(asset)) {\n\t\tthrow new Error(\"Failed to convert item to asset\");\n\t}\n\treturn asset;\n}\n\nexport function smartGetAssetGroup(item: Item | Asset | AssetGroup): AssetGroup {\n\tconst group = AssetGroup.includes(item as AssetGroup) ? item as AssetGroup : Asset.includes(item as Asset) ? (item as Asset).Group : (item as Item).Asset.Group;\n\tif (!AssetGroup.includes(group)) {\n\t\tthrow new Error(\"Failed to convert item to group\");\n\t}\n\treturn group;\n}\n\nexport function isCloth(item: Item | Asset | AssetGroup, allowCosplay: boolean = false): boolean {\n\tconst group = smartGetAssetGroup(item);\n\treturn group.Category === \"Appearance\" && group.AllowNone && group.Clothing && (allowCosplay || !group.BodyCosplay);\n}\n\nexport function isBind(item: Item | Asset | AssetGroup): boolean {\n\tconst group = smartGetAssetGroup(item);\n\tif (group.Category !== \"Item\" || group.BodyCosplay) return false;\n\treturn ![\"ItemNeck\", \"ItemNeckAccessories\", \"ItemNeckRestraints\"].includes(group.Name);\n}\n\nexport function getCharacterName(memberNumber: number, defaultText: string): string;\nexport function getCharacterName(memberNumber: number, defaultText: string | null): string | null;\nexport function getCharacterName(memberNumber: number, defaultText: string | null = null): string | null {\n\tif (Player.MemberNumber === memberNumber) {\n\t\treturn Player.Name;\n\t}\n\tfor (const char of ChatRoomCharacter) {\n\t\tif (char.MemberNumber === memberNumber)\n\t\t\treturn char.Name;\n\t\tif (char.Ownership?.MemberNumber === memberNumber)\n\t\t\treturn char.Ownership.Name;\n\t\tif (Array.isArray(char.Lovership)) {\n\t\t\tfor (const lover of char.Lovership) {\n\t\t\t\tif (lover.MemberNumber === memberNumber)\n\t\t\t\t\treturn lover.Name;\n\t\t\t}\n\t\t}\n\t}\n\tconst friendName = Player.FriendNames?.get(memberNumber);\n\tif (friendName)\n\t\treturn friendName;\n\treturn defaultText;\n}\n\nexport function itemColorsEquals(color1: null | undefined | string | string[], color2: null | undefined | string | string[]): boolean {\n\tif (color1 == null) {\n\t\tcolor1 = \"Default\";\n\t} else if (Array.isArray(color1) && color1.length === 1) {\n\t\tcolor1 = color1[0];\n\t}\n\n\tif (color2 == null) {\n\t\tcolor2 = \"Default\";\n\t} else if (Array.isArray(color2) && color2.length === 1) {\n\t\tcolor2 = color2[0];\n\t}\n\n\treturn (!Array.isArray(color1) || !Array.isArray(color2)) ? color1 === color2 : CommonArraysEqual(color1, color2);\n}\n\nexport function showHelp(helpText: string) {\n\tMainCanvas.fillStyle = \"#ffff88\";\n\tMainCanvas.fillRect(1000, 190, 800, 600);\n\tMainCanvas.strokeStyle = \"Black\";\n\tMainCanvas.strokeRect(1000, 190, 800, 600);\n\tMainCanvas.textAlign = \"left\";\n\tDrawTextWrap(helpText, 1020 - 760 / 2, 210, 760, 560, \"black\");\n}\n\ninterface RoomInfo {\n\tName: string;\n\t// Space: string;\n\tDescription: string;\n\tBackground: string;\n\tLimit: number;\n\tAdmin: number[];\n\tBan: number[];\n\tGame: string;\n\tPrivate: boolean;\n\tLocked: boolean;\n\tBlockCategory: any[];\n}\n\nexport function getCurrentRoomData(): RoomInfo | null {\n\tif (!ChatRoomData)\n\t\treturn null;\n\treturn ({\n\t\tName: ChatRoomData.Name,\n\t\tDescription: ChatRoomData.Description,\n\t\tBackground: ChatRoomData.Background,\n\t\tLimit: ChatRoomData.Limit,\n\t\tAdmin: ChatRoomData.Admin.slice(),\n\t\tBan: ChatRoomData.Ban.slice(),\n\t\tBlockCategory: ChatRoomData.BlockCategory.slice(),\n\t\tGame: ChatRoomGame,\n\t\tPrivate: ChatRoomData.Private,\n\t\tLocked: ChatRoomData.Locked\n\t});\n}\n\nexport function updateChatroom(newData: Partial<RoomInfo>): boolean {\n\tconst data = getCurrentRoomData();\n\tif (!ServerPlayerIsInChatRoom() || !ChatRoomPlayerIsAdmin() || !data)\n\t\treturn false;\n\tconst Room: Record<string, any> = { ...data, ...newData };\n\tRoom.Limit = Room.Limit.toString();\n\tServerSend(\"ChatRoomAdmin\", { MemberNumber: Player.ID, Action: \"Update\", Room });\n\treturn true;\n}\n\nexport function drawTypingIndicatorSpeechBubble(ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, alpha: number, emote: boolean = false) {\n\tctx.save();\n\tctx.globalAlpha = alpha;\n\tctx.translate(x, y);\n\tctx.scale(width / 50, height / 50);\n\tctx.fillStyle = \"white\";\n\tctx.strokeStyle = \"black\";\n\tctx.lineWidth = 3;\n\tlet p = new Path2D(icon_Typing_base);\n\tctx.fill(p);\n\tctx.stroke(p);\n\tctx.fillStyle = \"black\";\n\tp = new Path2D(emote ? icon_Typing_star : icon_Typing_dot);\n\tfor (const dx of [0, 12, 12]) {\n\t\tctx.translate(dx, 0);\n\t\tctx.fill(p);\n\t}\n\tctx.restore();\n}\n\n/**\n * Draws a path from an SVG on canvas, applying all options\n * @param {CanvasRenderingContext2D} ctx - Context of the canvas\n * @param {string} icon - The SVG path for drawing\n * @param {number} x - Icon position on the X axis\n * @param {number} y - Icon position on the Y axis\n * @param {number} width - Width of the icon\n * @param {number} height - Height of the icon\n * @param {number} baseSize - The base size of the provided path from the SVG, assuming equal width and height\n * @param {number} alpha - Transparency between 0-1\n * @param {number} lineWidth - Thickness of icon outline\n * @param {string} fillColor - Icon fill colour\n * @returns {void} - Nothing\n */\nexport function drawIcon(\n\tctx: CanvasRenderingContext2D,\n\ticon: string,\n\tx: number, y: number,\n\twidth: number, height: number,\n\tbaseSize: number,\n\talpha: number,\n\tlineWidth: number,\n\tfillColor: string,\n\tstrokeColor: string = \"black\"\n) {\n\tctx.save();\n\tctx.globalAlpha = alpha;\n\tctx.translate(x, y);\n\tctx.scale(width / baseSize, height / baseSize);\n\tctx.fillStyle = fillColor;\n\tctx.strokeStyle = strokeColor;\n\tctx.lineWidth = lineWidth;\n\tconst p = new Path2D(icon);\n\tctx.fill(p);\n\tctx.stroke(p);\n\tctx.restore();\n}\n","export const VERSION = BCX_VERSION;\n\nexport const VERSION_CHECK_BOT: number = 37685;\n\n// Server commit: a2e5454d002ed8d93c4009e59fdbd47c800277a9\n\n// Game commit: fdf0d0323bf137fbfbaaf8a22ca77f96465beefa\nexport const FUNCTION_HASHES: Record<string, string[]> = {\n\t\"Player.CanChange\": [\"082287C0\", \"F7D498F3\"],\n\t\"Player.GetBlindLevel\": [\"B0DE4B87\"],\n\t\"Player.GetDeafLevel\": [\"42CB6D63\"],\n\t\"Player.IsSlow\": [\"4D9B1713\"],\n\tActivityOrgasmPrepare: [\"E4EE085D\"],\n\tActivityOrgasmStart: [\"5C3627D7\", \"1F7E8FF9\", \"B5D882A8\"],\n\tAppearanceClick: [\"48FA3705\", \"BA17EA90\", \"F0B11F43\", \"CCD4AC31\", \"EECC190D\", \"19A126DF\", \"0D1455A9\"],\n\tAppearanceGetPreviewImageColor: [\"C4BDF19F\"],\n\tAppearanceMenuBuild: [\"264DC3C6\"],\n\tAppearanceMenuClick: [\"187B3371\"],\n\tAppearanceMenuDraw: [\"28FDF65B\"],\n\tAppearanceRun: [\"904E8E84\", \"45C6BA53\", \"6D5EFEAA\", \"6DDA14A1\"],\n\tAsylumEntranceCanWander: [\"3F5F4041\", \"609FA096\", \"A85C35F3\"],\n\tBackgroundSelectionRun: [\"DB865494\"],\n\tCharacterAppearanceLoadCharacter: [\"3641512F\"],\n\tCharacterCanChangeToPose: [\"F55FE4B0\"],\n\tCharacterCanKneel: [\"A5A325E3\"],\n\tCharacterLoadEffect: [\"0498693B\", \"D9ECD497\"],\n\tChatAdminClick: [\"6B460E3D\"],\n\tChatAdminExit: [\"64A8D565\"],\n\tChatAdminLoad: [\"EB8AF0DB\"],\n\tChatAdminRun: [\"CBE642C8\"],\n\tChatCreateClick: [\"765AEBFE\"],\n\tChatCreateLoad: [\"BF403157\"],\n\tChatCreateRun: [\"B0A3D236\"],\n\tChatRoomAddCharacterToChatRoom: [\"5B72DA3E\"],\n\tChatRoomAdminAction: [\"0C867BF6\", \"86DE8F3C\"],\n\tChatRoomCanAttemptKneel: [\"0AA710FA\"],\n\tChatRoomCanAttemptStand: [\"026065D0\"],\n\tChatRoomCanBeLeashedBy: [\"0ADB85BD\"],\n\tChatRoomCanChangeClothes: [\"87102B7C\"],\n\tChatRoomCanLeave: [\"5BEE6F9D\", \"77FB6CF8\", \"7065F82F\"],\n\tChatRoomClearAllElements: [\"D1E1F8C3\", \"D9169281\", \"AFB1B3ED\", \"C49AA2C1\"],\n\tChatRoomClickCharacter: [\"21AEE568\", \"AA9259DF\"],\n\tChatRoomCreateElement: [\"4837C2F6\", \"6C4CCF41\", \"35D54383\"],\n\tChatRoomDrawCharacterOverlay: [\"D58A9AD3\", \"4AE4AD9E\"],\n\tChatRoomFirstTimeHelp: [\"078BEEA9\"],\n\tChatRoomIsOwnedByPlayer: [\"82640FF9\"],\n\tChatRoomKeyDown: [\"5FD37EC9\", \"111B6F0C\", \"33C77F12\"],\n\tChatRoomListUpdate: [\"D7FA0EC7\"],\n\tChatRoomLovershipOptionIs: [\"6F5CE6A0\"],\n\tChatRoomMenuClick: [\"8D9D74CE\", \"959128FD\", \"0B1BA9F4\"],\n\tChatRoomMessage: [\"2C6E4EC3\", \"4340BC41\", \"6026A4B6\", \"E3EE1C77\", \"58EAAE61\", \"60ECCB9B\", \"4E97FAA5\", \"434FF2E9\"],\n\tChatRoomOwnershipOptionIs: [\"FE060F0B\"],\n\tChatRoomSendChat: [\"39B06D87\", \"9019F7EF\", \"D64CCA1D\", \"7F540ED0\"],\n\tChatRoomSendEmote: [\"30DB56A6\"],\n\tChatRoomShouldBlockGaggedOOCMessage: [\"4940C855\"],\n\tChatRoomSync: [\"B67D8226\", \"DF257D5B\", \"EE15739F\"],\n\tChatRoomSyncMemberLeave: [\"A95EADE6\"],\n\tChatRoomUpdateDisplay: [\"8DFC494A\"],\n\tChatSearchJoin: [\"22514B80\"],\n\tChatSearchLoad: [\"F5CC9CAE\", \"8AF12D1C\"],\n\tChatSearchNormalDraw: [\"6BEDBABB\"],\n\tChatSearchRun: [\"4C56AC68\", \"06BFF877\", \"7909670E\"],\n\tCheatFactor: [\"594CFC45\"],\n\tCheatImport: [\"412422CC\", \"26C67608\"],\n\tColorPickerDraw: [\"D1E82FB3\"],\n\tCommandParse: [\"12DC018B\"],\n\tCommonKeyDown: [\"A8EC46AB\"],\n\tCommonSetScreen: [\"17692CD7\"],\n\tDialogCanUnlock: [\"634C862B\", \"B849E6BC\"],\n\tDialogClickExpressionMenu: [\"5938DDC1\"],\n\tDialogDrawExpressionMenu: [\"EEFB3D22\"],\n\tDialogDrawItemMenu: [\"7B1D71E9\", \"0199F25B\", \"D832A940\", \"A6FE3967\"],\n\tDialogDrawPoseMenu: [\"4B146E82\"],\n\tDialogFindPlayer: [\"32851FF2\"],\n\tDialogInventoryAdd: [\"FD9268E1\"],\n\tDialogItemClick: [\"7039462A\", \"A08AC13E\", \"0E0D1707\"],\n\tDialogLeaveItemMenu: [\"B369F7C0\"],\n\tDialogMenuButtonBuild: [\"1D4265E4\", \"75E8CCCD\", \"BC5B2A8A\", \"6B6C875D\"],\n\tDialogMenuButtonClick: [\"9D8202CC\", \"8B705620\", \"621FE5B5\", \"80EA8095\"],\n\tDrawArousalMeter: [\"F4BDB7C1\", \"DC0BB5B4\"],\n\tDrawCharacter: [\"A9C65470\", \"967DB0F1\"],\n\tDrawGetImage: [\"BEC7B0DA\"],\n\tElementIsScrolledToEnd: [\"D28B0638\"],\n\tExtendedItemDraw: [\"486A52DF\", \"9256549A\", \"45432E84\", \"455F5FDD\", \"BDE09647\", \"E831F57A\"],\n\tFriendListBeepMenuSend: [\"B81A695E\"],\n\tFriendListClick: [\"6B039C7C\"],\n\tFriendListLoadFriendList: [\"72099AC9\", \"1F8A29E2\"],\n\tFriendListRun: [\"051E747B\"],\n\tInfiltrationStealItems: [\"1F601756\"],\n\tInformationSheetClick: [\"E535609B\"],\n\tInformationSheetExit: [\"75521907\"],\n\tInformationSheetRun: [\"58B7879C\", \"A8A56ACA\"],\n\tInventoryItemNeckAccessoriesCollarAutoShockUnitDetectSpeech: [\"BE1F6406\"],\n\tLoginMistressItems: [\"B58EF410\"],\n\tLoginResponse: [\"16C2C651\", \"FA9EFD03\", \"02E9D246\", \"548405C8\", \"4FE91547\", \"CF1C0400\", \"17F3A06E\", \"E117B785\"],\n\tLoginStableItems: [\"EA93FBF7\"],\n\tLogValue: [\"6ED63114\"],\n\tMainHallMaidsDisabledBegForMore: [\"EA29F2B3\"],\n\tMainHallWalk: [\"E52553C4\"],\n\tManagementCanBeReleased: [\"A2E2CA35\"],\n\tManagementCanBeReleasedOnline: [\"3374263B\"],\n\tManagementCanBreakDatingLoverOnline: [\"366AECAE\"],\n\tManagementCanBreakTrialOnline: [\"51E9B7F4\", \"2CBA193D\"],\n\tManagementCanBreakUpLoverOnline: [\"92E30200\"],\n\tManagementCannotBeReleased: [\"755DB909\"],\n\tManagementCannotBeReleasedExtreme: [\"2DA1650E\"],\n\tManagementCannotBeReleasedOnline: [\"D1ACE212\"],\n\tPreferenceIsPlayerInSensDep: [\"45EA8806\"],\n\tPreferenceSubscreenDifficultyClick: [\"3882E581\"],\n\tPreferenceSubscreenDifficultyRun: [\"65BF560F\"],\n\tPrivateRansomStart: [\"0E968EDD\", \"511E91C6\"],\n\tServerAccountBeep: [\"2D918B69\", \"D2802EE7\", \"D93AD698\"],\n\tServerPlayerIsInChatRoom: [\"E3771112\"],\n\tServerSend: [\"90A61F57\"],\n\tSpeechGarble: [\"1BC8E005\", \"15C3B50B\", \"9D669F73\"],\n\tStruggleDrawStrengthProgress: [\"4755C02D\"],\n\tTextGet: [\"4DDE5794\"],\n\tValidationResolveModifyDiff: [\"C2FE52D3\"]\n};\n\nexport const FUNCTION_HASHES_NMOD: Record<string, string[]> = {\n\tActivityOrgasmPrepare: [\"AA5FC17F\"],\n\tBackgroundSelectionRun: [\"82E77898\"],\n\tCharacterLoadEffect: [\"74D62AA1\"],\n\tChatAdminClick: [\"3355D63D\"],\n\tChatAdminLoad: [\"BF159B25\"],\n\tChatAdminRun: [\"F92A0B2E\"],\n\tChatRoomAddCharacterToChatRoom: [\"3B0DE035\"],\n\tChatRoomCanChangeClothes: [\"DF8A6550\"],\n\tChatRoomCanLeave: [\"B406F3E5\"],\n\tChatRoomClearAllElements: [\"52F91E02\"],\n\tChatRoomCreateElement: [\"76299AEC\"],\n\tChatRoomDrawCharacterOverlay: [\"61F5F655\"],\n\tChatRoomDrawFriendList: [\"327DA1B8\"],\n\tChatRoomKeyDown: [\"15C1889B\"],\n\tChatRoomMenuClick: [\"098D7C31\"],\n\tChatRoomMessage: [\"83DEF0DF\"],\n\tChatRoomSync: [\"642E4117\"],\n\tChatRoomUpdateDisplay: [\"8B37556F\"],\n\tChatSearchLoad: [\"4659E8F5\"],\n\tCheatImport: [\"1ECB0CC4\"],\n\tColorPickerDraw: [\"FF93AF2E\"],\n\tCommandParse: [\"36295DDC\"],\n\tDialogClickExpressionMenu: [\"AFBB0323\"],\n\tDialogDrawItemMenu: [\"05301080\"],\n\tDialogFindPlayer: [\"44A7263C\"],\n\tDialogInventoryAdd: [\"A6DED236\"],\n\tDialogItemClick: [\"EED79C72\"],\n\tDialogMenuButtonBuild: [\"D97C3EBF\"],\n\tDialogMenuButtonClick: [\"0E218260\"],\n\tDrawCharacter: [\"C9EC1A94\"],\n\tFriendListBeepMenuSend: [\"C5C27229\"],\n\tFriendListClick: [\"E08BFE66\"],\n\tFriendListLoadFriendList: [\"428B288B\"],\n\tFriendListRun: [\"96BCBB6E\"],\n\tInformationSheetRun: [\"19872251\"],\n\tLoginMistressItems: [\"984A6AD9\"],\n\tLoginResponse: [\"A89813D3\"],\n\tLoginStableItems: [\"C3F50DD1\"],\n\tServerAccountBeep: [\"207D9580\"],\n\tServerSend: [\"6DF365ED\"]\n};\n","\nconst encoder = new TextEncoder();\n\n/* eslint-disable no-bitwise */\nexport function crc32(str: string): string {\n\tlet crc = 0 ^ -1;\n\tfor (const b of encoder.encode(str)) {\n\t\tlet c = (crc ^ b) & 0xff;\n\t\tfor (let j = 0; j < 8; j++) {\n\t\t\tc = (c & 1) ? (-306674912 ^ (c >>> 1)) : (c >>> 1);\n\t\t}\n\t\tcrc = (crc >>> 8) ^ c;\n\t}\n\n\treturn ((crc ^ -1) >>> 0).toString(16).padStart(8, \"0\").toUpperCase();\n}\n/* eslint-enable no-bitwise */\n\n/** Utility function to add CSS */\nexport function addStyle(styleString: string): void {\n\tconst style = document.createElement(\"style\");\n\tstyle.textContent = styleString;\n\tdocument.head.append(style);\n}\n\n/** Checks if the `obj` is an object (not null, not array) */\nexport function isObject(obj: unknown): obj is Record<string, any> {\n\treturn !!obj && typeof obj === \"object\" && !Array.isArray(obj);\n}\n\nexport function longestCommonPrefix(strings: string[]): string {\n\tif (strings.length === 0) return \"\";\n\n\tstrings = strings.slice().sort();\n\tlet i = 0;\n\twhile (i < strings[0].length && strings[0][i] === strings[strings.length - 1][i]) {\n\t\ti++;\n\t}\n\treturn strings[0].substring(0, i);\n}\n\nexport function arrayUnique<T>(arr: T[]): T[] {\n\tconst seen = new Set<T>();\n\treturn arr.filter(i => !seen.has(i) && seen.add(i));\n}\n\nexport function capitalizeFirstLetter(str: string): string {\n\treturn str.charAt(0).toLocaleUpperCase() + str.slice(1);\n}\n\n/* eslint-disable no-bitwise */\nexport function uuidv4() {\n\treturn \"10000000-1000-4000-8000-100000000000\".replace(/[018]/g, (c: any) =>\n\t\t(c ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))).toString(16)\n\t);\n}\n/* eslint-enable no-bitwise */\n\nexport const clipboardAvailable = Boolean(navigator.clipboard);\n\n/** Clamp number between two values */\nexport function clamp(value: number, min: number, max: number) {\n\treturn Math.min(Math.max(value, min), max);\n}\n\n/** Clamp number between two values, wrapping if necessary */\nexport function clampWrap(value: number, min: number, max: number): number {\n\treturn value < min ? max : value > max ? min : value;\n}\n\n/** Formats time in ms into days, hours minutes and seconds - also has a short mode that only shows the largest unit, e.g. 17h */\nexport function formatTimeInterval(time: number, mode: \"full\" | \"short\" = \"full\") {\n\tlet res = \"\";\n\tif (time < 0) {\n\t\tres = \"-\";\n\t\ttime *= -1;\n\t}\n\tconst seconds = Math.floor(time / 1000);\n\tconst minutes = Math.floor(seconds / 60);\n\tconst hours = Math.floor(minutes / 60);\n\tconst days = Math.floor(hours / 24);\n\tif (mode === \"full\" || mode === undefined) {\n\t\tif (days > 0) {\n\t\t\tres += `${days} days, `;\n\t\t}\n\t\tif (hours > 0) {\n\t\t\tres += `${hours % 24} hours, `;\n\t\t}\n\t\tif (minutes > 0) {\n\t\t\tres += `${minutes % 60} minutes, `;\n\t\t}\n\t\tif (seconds > 0) {\n\t\t\tres += `${seconds % 60} seconds`;\n\t\t}\n\t} else if (mode === \"short\") {\n\t\tif (days > 1) {\n\t\t\tres += `${days}d`;\n\t\t} else if (hours > 1) {\n\t\t\tres += `${hours}h`;\n\t\t} else if (minutes > 1) {\n\t\t\tres += `${minutes}m`;\n\t\t} else if (seconds > 0) {\n\t\t\tres += `${seconds}s`;\n\t\t}\n\t}\n\treturn res;\n}\n\n/**\n * Replaces texts in `text` using data in `dictionary`, adding some default replacements.\n * Default replacements:\n *\n * `PLAYER_NAME` - Name of current Player\n *\n * @param text - The text to process\n * @param dictionary - The dictionary to apply to the `text`\n * @returns The result of replacements\n */\nexport function dictionaryProcess(text: string, dictionary: Record<string, string>): string {\n\tfor (const [k, v] of Object.entries({\n\t\tPLAYER_NAME: Player.Name,\n\t\t...dictionary\n\t})) {\n\t\ttext = text.replaceAll(k, v);\n\t}\n\treturn text;\n}\n\n/**\n * Creates a new text input element in the main document.\n * @param Type - Type of the input tag to create.\n * @param MaxLength - Maximum input tag of the input to create.\n * @returns - The created HTML input element\n */\nexport function createInputElement(type: string, maxLength?: number): HTMLInputElement {\n\tconst input = document.createElement(\"input\");\n\tinput.type = type;\n\tif (maxLength) {\n\t\tinput.maxLength = maxLength;\n\t}\n\tinput.addEventListener(\"keydown\", KeyDown);\n\tinput.className = \"HideOnPopup\";\n\treturn input;\n}\n\n/**\n * Draws an existing HTML element at a specific position within the document. The element is \"centered\" on the given coordinates by dividing its height and width by two.\n * @param ElementID - The id of the input tag to (re-)position.\n * @param X - Center point of the element on the X axis.\n * @param Y - Center point of the element on the Y axis.\n * @param W - Width of the element.\n * @param H - Height of the element.\n */\nexport function positionElement(element: HTMLElement, X: number, Y: number, W: number, H?: number) {\n\t// Different positions based on the width/height ratio\n\tconst HRatio = MainCanvas.canvas.clientHeight / 1000;\n\tconst WRatio = MainCanvas.canvas.clientWidth / 2000;\n\tconst Font = MainCanvas.canvas.clientWidth <= MainCanvas.canvas.clientHeight * 2 ? MainCanvas.canvas.clientWidth / 50 : MainCanvas.canvas.clientHeight / 25;\n\tconst Height = H ? H * HRatio : Font * 1.15;\n\tconst Width = W * WRatio - 18;\n\tconst Top = MainCanvas.canvas.offsetTop + Y * HRatio - Height / 2;\n\tconst Left = MainCanvas.canvas.offsetLeft + (X - W / 2) * WRatio;\n\n\t// Sets the element style\n\tObject.assign(element.style, {\n\t\tfontSize: Font + \"px\",\n\t\tfontFamily: CommonGetFontName(),\n\t\tposition: \"fixed\",\n\t\tleft: Left + \"px\",\n\t\ttop: Top + \"px\",\n\t\twidth: Width + \"px\",\n\t\theight: Height + \"px\",\n\t\tdisplay: \"inline\"\n\t});\n}\n\nexport function parseBCXVersion(version: string): BCXVersion | null {\n\tconst devMatch = /^(\\d+).(\\d+).(\\d+)-(DEV-\\d+)$/.exec(version);\n\tif (devMatch) {\n\t\treturn {\n\t\t\tmajor: Number.parseInt(devMatch[1], 10),\n\t\t\tminor: Number.parseInt(devMatch[2], 10),\n\t\t\tpatch: Number.parseInt(devMatch[3], 10),\n\t\t\textra: devMatch[4],\n\t\t\tdev: true\n\t\t};\n\t}\n\tconst match = /^(\\d+).(\\d+).(\\d+)-([0-f]+)$/.exec(version);\n\tif (match) {\n\t\treturn {\n\t\t\tmajor: Number.parseInt(match[1], 10),\n\t\t\tminor: Number.parseInt(match[2], 10),\n\t\t\tpatch: Number.parseInt(match[3], 10),\n\t\t\textra: match[4],\n\t\t\tdev: false\n\t\t};\n\t}\n\treturn null;\n}\n\nexport function BCXVersionCompare(a: BCXVersion, b: BCXVersion): number {\n\tif (a.major !== b.major) {\n\t\treturn a.major - b.major;\n\t}\n\tif (a.minor !== b.minor) {\n\t\treturn a.minor - b.minor;\n\t}\n\tif (a.patch !== b.patch) {\n\t\treturn a.patch - b.patch;\n\t}\n\tif ((a.dev ?? false) !== (b.dev ?? false)) {\n\t\treturn a.dev ? 1 : -1;\n\t}\n\treturn 0;\n}\n\nexport function BCXVersionToString(ver: BCXVersion): string {\n\tlet res = `${ver.major}.${ver.minor}.${ver.patch}`;\n\tif (ver.extra) {\n\t\tres += `-${ver.extra}`;\n\t}\n\treturn res;\n}\n\nexport const BCX_VERSION_PARSED: Readonly<BCXVersion> = (() => {\n\tconst res = parseBCXVersion(BCX_VERSION);\n\tif (!res) {\n\t\tthrow Error(\"Failed to parse own version\");\n\t}\n\treturn res;\n})();\n","import { debugContextStart } from \"./BCXContext\";\nimport { FUNCTION_HASHES, FUNCTION_HASHES_NMOD } from \"./config\";\nimport { ModuleCategory } from \"./constants\";\nimport { crc32, isObject } from \"./utils\";\nimport { isNModClient } from \"./utilsClub\";\n\ntype PatchHook = (args: any[], next: (args: any[]) => any) => any;\n\ninterface IpatchedFunctionData {\n\tname: string;\n\tcontext: Record<string, unknown>;\n\toriginal: (...args: any[]) => any;\n\toriginalHash: string;\n\tfinal: (...args: any[]) => any;\n\thooks: {\n\t\thook: PatchHook;\n\t\tpriority: number;\n\t\tmodule: ModuleCategory | null;\n\t}[];\n\tpatches: Record<string, string>;\n}\n\nconst patchedFunctions: Map<string, IpatchedFunctionData> = new Map();\nlet unloaded: boolean = false;\n\n\nfunction makePatchRouter(data: IpatchedFunctionData): (...args: any[]) => any {\n\treturn (...args: any[]) => {\n\t\t// BCX Function hook\n\t\tif (unloaded) {\n\t\t\tconsole.warn(`BCX: Function router called while unloaded for ${data.original.name}`);\n\t\t\treturn data.original(...args);\n\t\t}\n\t\tconst ctx = debugContextStart(`Hooked function ${data.name}`, { bcxArea: true });\n\t\tconst hooks = data.hooks.slice();\n\t\tlet hookIndex = 0;\n\t\tconst callNextHook = (nextargs: any[]) => {\n\t\t\tif (hookIndex < hooks.length) {\n\t\t\t\thookIndex++;\n\t\t\t\treturn hooks[hookIndex - 1].hook(nextargs, callNextHook);\n\t\t\t} else {\n\t\t\t\tconst ctxExit = debugContextStart(`Hook chain exit (${data.name})`, { bcxArea: false });\n\t\t\t\tconst resExit = data.final.apply(data.context, args);\n\t\t\t\tctxExit.end();\n\t\t\t\treturn resExit;\n\t\t\t}\n\t\t};\n\t\tconst res = callNextHook(args);\n\t\tctx.end();\n\t\treturn res;\n\t};\n}\n\nfunction isHashExpected(functionName: string, hash: string): boolean {\n\tconst expectedHashes = FUNCTION_HASHES[functionName] ?? [];\n\tif (isNModClient() && FUNCTION_HASHES_NMOD[functionName]) {\n\t\texpectedHashes.push(...FUNCTION_HASHES_NMOD[functionName]);\n\t}\n\treturn expectedHashes.includes(hash);\n}\n\nfunction initPatchableFunction(target: string): IpatchedFunctionData {\n\tif (unloaded) {\n\t\tthrow new Error(\"Cannot init patchable function after unload\");\n\t}\n\tlet result = patchedFunctions.get(target);\n\tif (!result) {\n\t\tlet context: Record<string, any> = window as any;\n\t\tconst targetPath = target.split(\".\");\n\t\tfor (let i = 0; i < targetPath.length - 1; i++) {\n\t\t\tcontext = context[targetPath[i]];\n\t\t\tif (!isObject(context)) {\n\t\t\t\tthrow new Error(`BCX: Function ${target} to be patched not found; ${targetPath.slice(0, i + 1).join(\".\")} is not object`);\n\t\t\t}\n\t\t}\n\t\tconst original: (...args: any[]) => any = context[targetPath[targetPath.length - 1]];\n\n\t\tif (typeof original !== \"function\") {\n\t\t\tthrow new Error(`BCX: Function ${target} to be patched not found`);\n\t\t}\n\n\t\tconst originalHash = crc32(original.toString().replaceAll(\"\\r\\n\", \"\\n\"));\n\t\tif (!isHashExpected(target, originalHash)) {\n\t\t\tconsole.warn(`BCX: Patched function ${target} has unknown hash ${originalHash}`);\n\t\t}\n\t\tconsole.debug(`BCX: Initialized ${target} for patching`);\n\n\t\tresult = {\n\t\t\tname: target,\n\t\t\toriginal,\n\t\t\toriginalHash,\n\t\t\tfinal: original,\n\t\t\thooks: [],\n\t\t\tpatches: {},\n\t\t\tcontext\n\t\t};\n\t\tpatchedFunctions.set(target, result);\n\t\tcontext[targetPath[targetPath.length - 1]] = makePatchRouter(result);\n\t}\n\treturn result;\n}\n\nfunction applyPatches(info: IpatchedFunctionData) {\n\tif (Object.keys(info.patches).length === 0) {\n\t\tinfo.final = info.original;\n\t\treturn;\n\t}\n\tlet fn_str = info.original.toString();\n\tconst N = `BCX: Patching ${info.original.name}`;\n\tfor (const k of Object.keys(info.patches)) {\n\t\tif (!fn_str.includes(k)) {\n\t\t\tconsole.warn(`${N}: Patch ${k} not applied`);\n\t\t}\n\t\tfn_str = fn_str.replaceAll(k, info.patches[k]);\n\t}\n\t// eslint-disable-next-line no-eval\n\tinfo.final = eval(`(${fn_str})`);\n}\n\nexport function hookFunction(target: string, priority: number, hook: PatchHook, module: ModuleCategory | null = null): void {\n\tconst data = initPatchableFunction(target);\n\n\tif (data.hooks.some(h => h.hook === hook)) {\n\t\tconsole.error(`BCX: Duplicate hook for \"${target}\"`, hook);\n\t\treturn;\n\t}\n\n\tdata.hooks.push({\n\t\thook,\n\t\tpriority,\n\t\tmodule\n\t});\n\tdata.hooks.sort((a, b) => b.priority - a.priority);\n}\n\nexport function removeHooksByModule(target: string, module: ModuleCategory): boolean {\n\tconst data = initPatchableFunction(target);\n\n\tfor (let i = data.hooks.length - 1; i >= 0; i--) {\n\t\tif (data.hooks[i].module === module) {\n\t\t\tdata.hooks.splice(i, 1);\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function removeAllHooksByModule(module: ModuleCategory): boolean {\n\tfor (const data of patchedFunctions.values()) {\n\t\tfor (let i = data.hooks.length - 1; i >= 0; i--) {\n\t\t\tif (data.hooks[i].module === module) {\n\t\t\t\tdata.hooks.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function patchFunction(target: string, patches: Record<string, string>): void {\n\tconst data = initPatchableFunction(target);\n\tObject.assign(data.patches, patches);\n\tapplyPatches(data);\n}\n\nexport function unload_patches() {\n\tunloaded = true;\n\tfor (const [k, v] of patchedFunctions.entries()) {\n\t\tv.hooks = [];\n\t\tv.patches = {};\n\t\tv.final = v.original;\n\t\tconst targetPath = k.split(\".\");\n\t\tv.context[targetPath[targetPath.length - 1]] = v.original;\n\t}\n\tpatchedFunctions.clear();\n}\n\nexport function callOriginal(target: string, args: any[]): any {\n\tconst data = initPatchableFunction(target);\n\treturn data.original(...args);\n}\n\nexport function getPatchedFunctionsHashes(includeExpected: boolean): [string, string][] {\n\treturn Array\n\t\t.from(patchedFunctions.entries())\n\t\t.map<[string, string]>(i => [i[0], i[1].originalHash])\n\t\t.filter(i => includeExpected || !isHashExpected(...i));\n}\n","import { icon_rules } from \"./resources\";\n\nexport enum Preset {\n\tdominant = 0,\n\tswitch = 1,\n\tsubmissive = 2,\n\tslave = 3\n}\n\nexport enum ModuleCategory {\n\tGlobal = 0,\n\tAuthority = 1,\n\tLog = 2,\n\tCurses = 3,\n\tRules = 4,\n\tMisc = 99\n}\n\nexport const MODULE_NAMES: Record<ModuleCategory, string> = {\n\t[ModuleCategory.Global]: \"Global\",\n\t[ModuleCategory.Authority]: \"Authority\",\n\t[ModuleCategory.Log]: \"Behaviour Log\",\n\t[ModuleCategory.Curses]: \"Curses\",\n\t[ModuleCategory.Rules]: \"Rules\",\n\t[ModuleCategory.Misc]: \"Miscellaneous\"\n};\n\nexport const MODULE_ICONS: Record<ModuleCategory, string> = {\n\t[ModuleCategory.Global]: \"Icons/General.png\",\n\t[ModuleCategory.Authority]: \"Icons/Security.png\",\n\t[ModuleCategory.Log]: \"Icons/Title.png\",\n\t[ModuleCategory.Curses]: \"Icons/Struggle.png\",\n\t[ModuleCategory.Rules]: icon_rules,\n\t[ModuleCategory.Misc]: \"Icons/Random.png\"\n};\n\nexport const TOGGLEABLE_MODULES: readonly ModuleCategory[] = [\n\tModuleCategory.Log,\n\tModuleCategory.Curses,\n\tModuleCategory.Rules\n];\n\nexport enum ModuleInitPhase {\n\tconstruct,\n\tinit,\n\tload,\n\tready,\n\tdestroy\n}\n\nexport enum MiscCheat {\n\tBlockRandomEvents = 0,\n\tCantLoseMistress = 1,\n\tGiveMistressKey = 2,\n\tGivePandoraKey = 3\n}\n\nexport enum ConditionsLimit {\n\tnormal = 0,\n\tlimited = 1,\n\tblocked = 2\n}\n\nexport const defaultBCXEffects: Readonly<BCX_effects> = {\n\tEffect: []\n};\n","import type { Preset } from \"../constants\";\n\nexport abstract class BaseModule {\n\n\tinit() {\n\t\t// Empty\n\t}\n\n\tload(preset: Preset) {\n\t\t// Empty\n\t}\n\n\trun() {\n\t\t// Empty\n\t}\n\n\tunload() {\n\t\t// Empty\n\t}\n\n\treload(preset: Preset) {\n\t\t// Empty\n\t}\n\n\tapplyPreset(preset: Preset) {\n\t\t// Empty\n\t}\n}\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import ListCache from './_ListCache.js';\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\nexport default stackClear;\n","/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\nexport default stackDelete;\n","/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\nexport default stackGet;\n","/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\nexport default stackHas;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import ListCache from './_ListCache.js';\nimport Map from './_Map.js';\nimport MapCache from './_MapCache.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\nexport default stackSet;\n","import ListCache from './_ListCache.js';\nimport stackClear from './_stackClear.js';\nimport stackDelete from './_stackDelete.js';\nimport stackGet from './_stackGet.js';\nimport stackHas from './_stackHas.js';\nimport stackSet from './_stackSet.js';\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\nexport default Stack;\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nexport default arrayEach;\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","import defineProperty from './_defineProperty.js';\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nexport default baseAssignValue;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignValue;\n","import assignValue from './_assignValue.js';\nimport baseAssignValue from './_baseAssignValue.js';\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nexport default copyObject;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nexport default baseTimes;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","import baseTimes from './_baseTimes.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isIndex from './_isIndex.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default arrayLikeKeys;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeys from './_baseKeys.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nexport default keys;\n","import copyObject from './_copyObject.js';\nimport keys from './keys.js';\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\nexport default baseAssign;\n","/**\n * This function is like\n * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * except that it includes inherited enumerable properties.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction nativeKeysIn(object) {\n  var result = [];\n  if (object != null) {\n    for (var key in Object(object)) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default nativeKeysIn;\n","import isObject from './isObject.js';\nimport isPrototype from './_isPrototype.js';\nimport nativeKeysIn from './_nativeKeysIn.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeysIn(object) {\n  if (!isObject(object)) {\n    return nativeKeysIn(object);\n  }\n  var isProto = isPrototype(object),\n      result = [];\n\n  for (var key in object) {\n    if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeysIn;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeysIn from './_baseKeysIn.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own and inherited enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keysIn(new Foo);\n * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n */\nfunction keysIn(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);\n}\n\nexport default keysIn;\n","import copyObject from './_copyObject.js';\nimport keysIn from './keysIn.js';\n\n/**\n * The base implementation of `_.assignIn` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssignIn(object, source) {\n  return object && copyObject(source, keysIn(source), object);\n}\n\nexport default baseAssignIn;\n","import root from './_root.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined;\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var length = buffer.length,\n      result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);\n\n  buffer.copy(result);\n  return result;\n}\n\nexport default cloneBuffer;\n","/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\nexport default copyArray;\n","/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default arrayFilter;\n","/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\nexport default stubArray;\n","import arrayFilter from './_arrayFilter.js';\nimport stubArray from './stubArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\nexport default getSymbols;\n","import copyObject from './_copyObject.js';\nimport getSymbols from './_getSymbols.js';\n\n/**\n * Copies own symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\nexport default copySymbols;\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","import arrayPush from './_arrayPush.js';\nimport getPrototype from './_getPrototype.js';\nimport getSymbols from './_getSymbols.js';\nimport stubArray from './stubArray.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own and inherited enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {\n  var result = [];\n  while (object) {\n    arrayPush(result, getSymbols(object));\n    object = getPrototype(object);\n  }\n  return result;\n};\n\nexport default getSymbolsIn;\n","import copyObject from './_copyObject.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\n\n/**\n * Copies own and inherited symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbolsIn(source, object) {\n  return copyObject(source, getSymbolsIn(source), object);\n}\n\nexport default copySymbolsIn;\n","import arrayPush from './_arrayPush.js';\nimport isArray from './isArray.js';\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\nexport default baseGetAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbols from './_getSymbols.js';\nimport keys from './keys.js';\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\nexport default getAllKeys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\nimport keysIn from './keysIn.js';\n\n/**\n * Creates an array of own and inherited enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeysIn(object) {\n  return baseGetAllKeys(object, keysIn, getSymbolsIn);\n}\n\nexport default getAllKeysIn;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = new array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\nexport default initCloneArray;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Uint8Array = root.Uint8Array;\n\nexport default Uint8Array;\n","import Uint8Array from './_Uint8Array.js';\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\nexport default cloneArrayBuffer;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\nexport default cloneDataView;\n","/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\nexport default cloneRegExp;\n","import Symbol from './_Symbol.js';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\nexport default cloneSymbol;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\nexport default cloneTypedArray;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\nimport cloneDataView from './_cloneDataView.js';\nimport cloneRegExp from './_cloneRegExp.js';\nimport cloneSymbol from './_cloneSymbol.js';\nimport cloneTypedArray from './_cloneTypedArray.js';\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Map`, `Number`, `RegExp`, `Set`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return new Ctor;\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return new Ctor;\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\nexport default initCloneByTag;\n","import isObject from './isObject.js';\n\n/** Built-in value references. */\nvar objectCreate = Object.create;\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} proto The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nvar baseCreate = (function() {\n  function object() {}\n  return function(proto) {\n    if (!isObject(proto)) {\n      return {};\n    }\n    if (objectCreate) {\n      return objectCreate(proto);\n    }\n    object.prototype = proto;\n    var result = new object;\n    object.prototype = undefined;\n    return result;\n  };\n}());\n\nexport default baseCreate;\n","import baseCreate from './_baseCreate.js';\nimport getPrototype from './_getPrototype.js';\nimport isPrototype from './_isPrototype.js';\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\nexport default initCloneObject;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]';\n\n/**\n * The base implementation of `_.isMap` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n */\nfunction baseIsMap(value) {\n  return isObjectLike(value) && getTag(value) == mapTag;\n}\n\nexport default baseIsMap;\n","import baseIsMap from './_baseIsMap.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsMap = nodeUtil && nodeUtil.isMap;\n\n/**\n * Checks if `value` is classified as a `Map` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n * @example\n *\n * _.isMap(new Map);\n * // => true\n *\n * _.isMap(new WeakMap);\n * // => false\n */\nvar isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;\n\nexport default isMap;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar setTag = '[object Set]';\n\n/**\n * The base implementation of `_.isSet` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n */\nfunction baseIsSet(value) {\n  return isObjectLike(value) && getTag(value) == setTag;\n}\n\nexport default baseIsSet;\n","import baseIsSet from './_baseIsSet.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsSet = nodeUtil && nodeUtil.isSet;\n\n/**\n * Checks if `value` is classified as a `Set` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n * @example\n *\n * _.isSet(new Set);\n * // => true\n *\n * _.isSet(new WeakSet);\n * // => false\n */\nvar isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;\n\nexport default isSet;\n","import Stack from './_Stack.js';\nimport arrayEach from './_arrayEach.js';\nimport assignValue from './_assignValue.js';\nimport baseAssign from './_baseAssign.js';\nimport baseAssignIn from './_baseAssignIn.js';\nimport cloneBuffer from './_cloneBuffer.js';\nimport copyArray from './_copyArray.js';\nimport copySymbols from './_copySymbols.js';\nimport copySymbolsIn from './_copySymbolsIn.js';\nimport getAllKeys from './_getAllKeys.js';\nimport getAllKeysIn from './_getAllKeysIn.js';\nimport getTag from './_getTag.js';\nimport initCloneArray from './_initCloneArray.js';\nimport initCloneByTag from './_initCloneByTag.js';\nimport initCloneObject from './_initCloneObject.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isMap from './isMap.js';\nimport isObject from './isObject.js';\nimport isSet from './isSet.js';\nimport keys from './keys.js';\nimport keysIn from './keysIn.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_FLAT_FLAG = 2,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Deep clone\n *  2 - Flatten inherited properties\n *  4 - Clone symbols\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, bitmask, customizer, key, object, stack) {\n  var result,\n      isDeep = bitmask & CLONE_DEEP_FLAG,\n      isFlat = bitmask & CLONE_FLAT_FLAG,\n      isFull = bitmask & CLONE_SYMBOLS_FLAG;\n\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      result = (isFlat || isFunc) ? {} : initCloneObject(value);\n      if (!isDeep) {\n        return isFlat\n          ? copySymbolsIn(value, baseAssignIn(result, value))\n          : copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (isSet(value)) {\n    value.forEach(function(subValue) {\n      result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));\n    });\n  } else if (isMap(value)) {\n    value.forEach(function(subValue, key) {\n      result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));\n    });\n  }\n\n  var keysFunc = isFull\n    ? (isFlat ? getAllKeysIn : getAllKeys)\n    : (isFlat ? keysIn : keys);\n\n  var props = isArr ? undefined : keysFunc(value);\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));\n  });\n  return result;\n}\n\nexport default baseClone;\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);\n}\n\nexport default cloneDeep;\n","\nexport enum Views {\n\tAuthorityRoles = 10,\n\tAuthorityPermissions = 11,\n\tLog = 20,\n\tLogConfig = 21,\n\tConditionsViewCurses = 30,\n\tConditionsEditCurses = 31,\n\tConditionsGlobalCurses = 32,\n\tCursesAdd = 33,\n\tCursesAddPermissionMode = 34,\n\tConditionsViewRules = 40,\n\tConditionsEditRules = 41,\n\tConditionsGlobalRules = 42,\n\tRulesAdd = 43,\n\tRulesAddPermissionMode = 44,\n\tMisc = 100\n}\n\n// TODO\nexport const HELP_TEXTS: Record<Views, string> = {\n\t[Views.AuthorityRoles]: \"If you are permitted, this screen enables you to view, add, or remove the BCX-only roles 'Owner' \" +\n\t\"and 'Mistress', which expand the classic roles of BC such as Bondage Club's Owner and the Lovers. The hierarchy of all \" +\n\t\"roles that can be used to set various things in BCX can be seen on the right. The higher up a role is, the more authority it has. \" +\n\t\"For instance, if something applies or is permitted for a Mistress, it also always is for an Owner. Any number of \" +\n\t\"Owners and Mistresses can be set. Check their current power over BCX with the button on the right.\",\n\t[Views.AuthorityPermissions]: \"The heart of BCX: Allows to configure the permissions to set up and use most of \" +\n\t\"BCX. Default settings depend on the initial BCX setup preset selected. \" +\n\t\"Self access is the checkbox next to every permission and the lowest access role is to its right. \" +\n\t\"Example: If 'allow forbidding self access', 'allow granting self access', 'allow lowest access modification' have the checkbox removed \" +\n\t\"and lowest role is 'Owner', then current and newly added BCX owners and the BC owner can get full control over \" +\n\t\"any permissions they have access to. So careful with those three permissions!\",\n\t[Views.Log]: \"This screen shows logs of important events. What is logged depends on the logging configuration, which can be viewed/edited \" +\n\t\"via the button to the right. Log entries can have normal or protected visibility. Access to those as well as removing entries or the \" +\n\t\"configuration is determined by the according authority module permission settings. The log can document the BCX's user's conduct, \" +\n\t\"any rule violations, important changes made to BCX settings, curses or rules, and notes from other people.\",\n\t[Views.LogConfig]: \"This screen determines what is logged in the behaviour log and what the visibility of each type of log messages is. \" +\n\t\"'Yes' means this log type \" +\n\t\"has normal visibility, while 'protected' means only roles who have permission to view protected entries can view them. 'No' means that \" +\n\t\"this log type is not logged at all. In the permission settings view of the authority module, the permissions of this log module can be configured.\",\n\t[Views.ConditionsViewCurses]: \"This screen shows all active curses on the player, including many information, such as duration, if it is \" +\n\t\"a cursed item or a blocked item or clothing slot that forces to stay unrestrained or naked there. Clicking on the button with the cog icon \" +\n\t\"in the middle of each row moves you to a new screen that allows to configure the curse (if you have permission). When the cog icon has a blue \" +\n\t\"aura, that means that the curse's conditions are the same as the global config. If permitted, you can remove single curses with the 'X' button.\",\n\t[Views.ConditionsEditCurses]: \"Here you can switch the curse on/off, set a timer for activating/deactivating/deleting the curse and \" +\n\t\"define when it can trigger, such as either always or based on where the player is and with whom. The small green/red bars next to the \" +\n\t\"checkboxes indicate whether a condition is true at present or not and the big bar whether this means that the curse is in effect, if active. \" +\n\t\"On the right side, you can curse the usage/\" +\n\t\"alteration of an item such as fixing cuffs behind the back. Lastly, in the bottom right you can set the trigger conditions \" +\n\t\"of this curse to the global curses config.\",\n\t[Views.ConditionsGlobalCurses]: \"The settings on this page are the global/default settings for all newly added curses. Changes to the trigger \" +\n\t\"conditions are also applied to existing curses that are (still) set to global curses configuration, though. Exception is if a timer is set here. \" +\n\t\"Such a timer only applies to newly created curses.\",\n\t[Views.CursesAdd]: \"On this screen you can add a curse to any empty slot (white) which will keep it empty or on any worn item (gold) \" +\n\t\"that then will be hard to remove. You add the curse by simply clicking the slot which then becomes purple to indicate that \" +\n\t\"it is now cursed. You can switch the curse's configuration from the default globale configuration on the previous screen. Grey slots indicate \" +\n\t\"that you have no access to them, due to it being blocked or due to your permission settings. Slots can be limited/blocked via the settings button \" +\n\t\"on the very right.\",\n\t[Views.CursesAddPermissionMode]: \"Here you can cycle item and clothing slots between being not limited, limited and blocked. Blocked means \" +\n\t\"no one can add a curse to it, while limited means only roles that have the permission to curse limited slots can curse them. There \" +\n\t\"is no need to save changes as they are instantly in effect.\",\n\t[Views.ConditionsViewRules]: \"This screen shows all active rules for the player, including many information, such as duration, the \" +\n\t\"rule type and little status icons that show if the rule is enforced and/or transgressions are logged. Clicking on the button with the cog icon \" +\n\t\"in the middle of each row moves you to a new screen that allows to configure the rule (if you have permission). When the cog icon has a blue \" +\n\t\"aura, then that means that the rule's conditions are the same as the global config. If permitted, you can remove single rules with the 'X' button.\",\n\t[Views.ConditionsEditRules]: \"Here you switch the rule on/off, set a timer for activating/deactivating/deleting the rule and \" +\n\t\"define when it can trigger, such as either always or based on where the player is and with whom. The small green/red bars next to the \" +\n\t\"checkboxes indicate whether a condition is true at present or not and the big bar whether this means that the rule is in effect, if active. \" +\n\t\"Depending on the rule, you can either enforce its effect, \" +\n\t\"log all violations, or both at the same time. Lastly on the bottom right, you can set whether the trigger conditions \" +\n\t\"of this rule should follow the global rules config or not.\",\n\t[Views.ConditionsGlobalRules]: \"The settings on this page are the global/default settings for all newly added rules. Changes to the trigger \" +\n\t\"conditions are also applied to existing rules that are (still) set to global rules configuration, though. Exception is if a timer is set here. \" +\n\t\"Such a timer only applies to newly established rules.\",\n\t[Views.RulesAdd]: \"On this screen you can establish new rules for the player by simply clicking any rule template. \" +\n\t\"After clicking on it, you can edit the rule's configuration. Purple rule templates indicate, that they are already in use; greyed out \" +\n\t\"ones, that you have no access to them due to being blocked or due to your permission settings. Rule templates can be limited/blocked \" +\n\t\"via the settings button on the very right. Note: If you want to be able to log rule violations, this type of log entry may need to be allowed \" +\n\t\"in the configuration page of the behavior log module.\",\n\t[Views.RulesAddPermissionMode]: \"Here you can cycle rule templates between being not limited, limited and blocked. Blocked means \" +\n\t\"no one can add/use this rule, while limited means only roles that have the permission to establish limited rules can add them. There \" +\n\t\"is no need to save changes as they are instantly in effect.\",\n\t[Views.Misc]: \"This screen offers various settings to configure your Bondage Club experience in general, such as enabling/disabling the \" +\n\t\"typing indicator that shows other BCX users an icon when you are currently typing something to public chat or whispering something to \" +\n\t\"only them. The cheats are only temporarily active as long as they are set; items that were only given via a cheat are then also gone again.\"\n};","import { getCurrentSubscreen, setSubscreen } from \"../modules/gui\";\n\nexport abstract class GuiSubscreen {\n\tget active(): boolean {\n\t\treturn getCurrentSubscreen() === this;\n\t}\n\n\tLoad() {\n\t\t// Empty\n\t}\n\n\tRun() {\n\t\t// Empty\n\t}\n\n\tClick() {\n\t\t// Empty\n\t}\n\n\tExit() {\n\t\tsetSubscreen(null);\n\t}\n\n\tUnload() {\n\t\t// Empty\n\t}\n\n\tonChange(source: number) {\n\t\t// Empty\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { AccessLevel, getPermissionMinDisplayText, PermissionInfo } from \"../modules/authority\";\nimport { capitalizeFirstLetter } from \"../utils\";\nimport { setSubscreen } from \"../modules/gui\";\n\n\nexport class GuiAuthorityDialogMin extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly permission: BCX_Permissions;\n\tprivate permissionData: PermissionInfo;\n\tprivate myAccessLevel: AccessLevel;\n\tprivate noAccess: boolean;\n\n\tprivate selectedLevel: AccessLevel;\n\n\tpublic back: GuiSubscreen;\n\n\tconstructor(character: ChatroomCharacter, permission: BCX_Permissions, data: PermissionInfo, myAccesLevel: AccessLevel, noAccess: boolean, back: GuiSubscreen) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.permission = permission;\n\t\tthis.permissionData = data;\n\t\tthis.back = back;\n\t\tthis.myAccessLevel = myAccesLevel;\n\t\tthis.noAccess = noAccess;\n\n\t\tthis.selectedLevel = data.min;\n\t}\n\n\tRun() {\n\n\t\tDrawTextFit(`- Authority: Changing minimum access to permission \"${this.permissionData.name}\" -`, 125, 125, 1850, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\n\n\t\tDrawText(\"Please select the new lowest role that should still have this permission.\", 1000, 255, \"Black\");\n\t\tDrawTextFit(`Info: Currently set role: ${this.permissionData.min === AccessLevel.self ?\n\t\t\tthis.character.Name : capitalizeFirstLetter(AccessLevel[this.permissionData.min])}  ` +\n\t\t\t`Newly selected role: ${this.selectedLevel === AccessLevel.self ?\n\t\t\t\tthis.character.Name : capitalizeFirstLetter(AccessLevel[this.selectedLevel])}`, 1000, 320, 1850, \"Black\");\n\t\tDrawText(\"All roles to the left of the selected one will also automatically get access.\", 1000, 385, \"Black\");\n\n\t\tif (this.myAccessLevel === AccessLevel.self) {\n\t\t\tconst available = (this.permissionData.min <= AccessLevel.self) || !this.noAccess;\n\t\t\tDrawButton(1000-110, 460, 220, 72, getPermissionMinDisplayText(AccessLevel.self, this.character), this.selectedLevel === AccessLevel.self ? \"Cyan\" : available ? \"White\" : \"#ddd\", undefined, undefined, !available);\n\t\t}\n\n\t\tfor (let i = 1; i < 8; i++) {\n\t\t\tconst current = this.selectedLevel === i;\n\t\t\tconst available =\n\t\t\t\t(this.myAccessLevel === AccessLevel.self && this.permissionData.min <= i && i <= AccessLevel.owner) ||\n\t\t\t\t!this.noAccess && this.myAccessLevel <= i;\n\t\t\tDrawButton(-15 + 230 * i, 577, 190, 72, getPermissionMinDisplayText(i, this.character), current ? \"Cyan\" : available ? \"White\" : \"#ddd\", undefined, undefined, !available);\n\t\t\tif (i < 7)\n\t\t\t\tDrawText(\">\", 196 + 230 * i, 577 + 36, \"Black\");\n\t\t}\n\n\t\tif (this.character.isPlayer() && this.permission === \"authority_revoke_self\" && this.selectedLevel !== AccessLevel.self) {\n\t\t\tDrawText(`WARNING: If you confirm, all permitted roles can remove your access to this and all other permissions!`, 1000, 730, \"Red\", \"Gray\");\n\t\t}\n\n\t\tDrawButton(700, 800, 200, 80, \"Confirm\", \"White\");\n\n\t\tDrawButton(1120, 800, 200, 80, \"Cancel\", \"White\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(700, 800, 200, 80)) return this.Confirm();\n\t\tif (MouseIn(1120, 800, 200, 80)) return this.Exit();\n\n\t\tif (MouseIn(1000-110, 460, 220, 72) && this.myAccessLevel === AccessLevel.self) {\n\t\t\tconst available = (this.permissionData.min <= AccessLevel.self) || !this.noAccess;\n\t\t\tif (available) {\n\t\t\t\tthis.selectedLevel = AccessLevel.self;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 1; i < 8; i++) {\n\t\t\tconst current = this.selectedLevel === i;\n\t\t\tconst available =\n\t\t\t\t(this.myAccessLevel === AccessLevel.self && this.permissionData.min <= i && i <= AccessLevel.owner) ||\n\t\t\t\t!this.noAccess && this.myAccessLevel <= i;\n\t\t\tif (MouseIn(-15 + 230 * i, 577, 190, 72) && !current && available) {\n\t\t\t\tthis.selectedLevel = i;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tConfirm() {\n\t\tthis.character.setPermission(this.permission, \"min\", this.selectedLevel);\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n\n\tonChange() {\n\t\t// When something changes, we bail from change dialog, because it might no longer be valid\n\t\tthis.Exit();\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { PermissionInfo } from \"../modules/authority\";\nimport { setSubscreen } from \"../modules/gui\";\n\nexport class GuiAuthorityDialogSelf extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly permission: BCX_Permissions;\n\tprivate permissionData: PermissionInfo;\n\n\tpublic back: GuiSubscreen;\n\n\tconstructor(character: ChatroomCharacter, permission: BCX_Permissions, data: PermissionInfo, back: GuiSubscreen) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.permission = permission;\n\t\tthis.permissionData = data;\n\t\tthis.back = back;\n\t}\n\n\tRun() {\n\n\t\tDrawTextFit(`- Authority: Removing self access to permission \"${this.permissionData.name}\" -`, 125, 125, 1850, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tDrawText(\"- Warning -\", 1000, 375, \"Black\", \"Black\");\n\t\tDrawText(\"If you confirm, you won't be able to change your access to this permission back yourself.\", 1000, 525, \"Black\");\n\n\t\tDrawButton(700, 720, 200, 80, \"Confirm\", \"White\");\n\n\t\tDrawButton(1120, 720, 200, 80, \"Cancel\", \"White\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(700, 720, 200, 80)) return this.Confirm();\n\t\tif (MouseIn(1120, 720, 200, 80)) return this.Exit();\n\n\t}\n\n\tConfirm() {\n\t\tthis.character.setPermission(this.permission, \"self\", false);\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n\n\tonChange() {\n\t\t// When something changes, we bail from change dialog, because it might no longer be valid\n\t\tthis.Exit();\n\t}\n}\n","import { ChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { ModuleCategory, MODULE_ICONS, MODULE_NAMES } from \"../constants\";\nimport { AccessLevel, checkPermissionAccessData, checkPermissionAccess, getPermissionMinDisplayText, PermissionData, PermissionInfo } from \"../modules/authority\";\nimport { DrawImageEx, showHelp } from \"../utilsClub\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { GuiAuthorityRoles } from \"./authority_roles\";\nimport { GuiAuthorityDialogMin } from \"./authority_dialogMin\";\nimport { GuiAuthorityDialogSelf } from \"./authority_dialogSelf\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { createInputElement, positionElement } from \"../utils\";\n\ntype PermListItem = (\n\t{\n\t\tseparator: false;\n\t\tpermission: BCX_Permissions;\n\t\tpermissionInfo: PermissionInfo;\n\t\teditSelf: boolean;\n\t\teditMin: boolean;\n\t} | {\n\t\tseparator: true;\n\t\tname: string;\n\t} | null\n);\n\nconst PER_PAGE_COUNT = 6;\n\nexport class GuiAuthorityPermissions extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\tprivate permissionData: PermissionData | null = null;\n\tprivate myAccessLevel: AccessLevel = AccessLevel.public;\n\tprivate failed: boolean = false;\n\tprivate permList: PermListItem[] = [];\n\tprivate page: number = 0;\n\n\tprivate showHelp: boolean = false;\n\n\tprivate filterInput = createInputElement(\"text\", 30);\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tif (this.character.isPlayer()) {\n\t\t\tthis.myAccessLevel = AccessLevel.self;\n\t\t}\n\t\tthis.filterInput.addEventListener(\"input\", ev => {\n\t\t\tthis.rebuildList();\n\t\t});\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.permissionData = null;\n\t\tthis.rebuildList();\n\t\tPromise.all([this.character.getPermissions(), this.character.getMyAccessLevel()]).then(res => {\n\t\t\tthis.permissionData = res[0];\n\t\t\tthis.myAccessLevel = res[1];\n\t\t\tthis.rebuildList();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get permission info for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate rebuildList() {\n\t\tif (!this.active) return;\n\n\t\tthis.permList = [];\n\t\tif (this.permissionData === null) {\n\t\t\tthis.filterInput.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.filterInput.parentElement) {\n\t\t\tdocument.body.appendChild(this.filterInput);\n\t\t}\n\n\t\tconst filter = this.filterInput.value.trim().toLocaleLowerCase().split(\" \").filter(Boolean);\n\n\t\tconst access_grantSelf = this.permissionData.authority_grant_self ?\n\t\t\tcheckPermissionAccessData(this.permissionData.authority_grant_self, this.myAccessLevel) :\n\t\t\tfalse;\n\t\tconst access_revokeSelf = this.permissionData.authority_revoke_self ?\n\t\t\tcheckPermissionAccessData(this.permissionData.authority_revoke_self, this.myAccessLevel) :\n\t\t\tfalse;\n\t\tconst access_editMin = this.permissionData.authority_edit_min ?\n\t\t\tcheckPermissionAccessData(this.permissionData.authority_edit_min, this.myAccessLevel) :\n\t\t\tfalse;\n\t\tconst isPlayer = this.myAccessLevel === AccessLevel.self;\n\n\t\tconst categories: Map<ModuleCategory, PermissionData> = new Map();\n\t\tfor (const [k, v] of Object.entries(this.permissionData)) {\n\t\t\tlet permdata = categories.get(v.category);\n\t\t\tif (filter.some(i =>\n\t\t\t\t!MODULE_NAMES[v.category].toLocaleLowerCase().includes(i) &&\n\t\t\t\t!v.name.toLocaleLowerCase().includes(i) &&\n\t\t\t\t!k.toLocaleLowerCase().includes(i)\n\t\t\t)) continue;\n\t\t\tif (!permdata) {\n\t\t\t\tcategories.set(v.category, permdata = {});\n\t\t\t}\n\t\t\tpermdata[k as BCX_Permissions] = v;\n\t\t}\n\t\tfor (const [category, data] of Array.from(categories.entries()).sort((a, b) => a[0] - b[0])) {\n\t\t\tif (filter.length === 0) {\n\t\t\t\twhile (this.permList.length % PER_PAGE_COUNT !== 0) {\n\t\t\t\t\tthis.permList.push(null);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.permList.push({\n\t\t\t\tseparator: true,\n\t\t\t\tname: `${MODULE_NAMES[category]} module permissions`\n\t\t\t});\n\t\t\tfor (const [k, v] of Object.entries(data).sort((a, b) => a[1].name.localeCompare(b[1].name))) {\n\t\t\t\tif (filter.length === 0 && this.permList.length % PER_PAGE_COUNT === 0) {\n\t\t\t\t\tthis.permList.push({\n\t\t\t\t\t\tseparator: true,\n\t\t\t\t\t\tname: `${MODULE_NAMES[category]} module permissions (continued)`\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst access = checkPermissionAccessData(v, this.myAccessLevel);\n\t\t\t\tthis.permList.push({\n\t\t\t\t\tseparator: false,\n\t\t\t\t\tpermission: k as BCX_Permissions,\n\t\t\t\t\tpermissionInfo: v,\n\t\t\t\t\teditSelf:\n\t\t\t\t\t\t// character must have access to \"allow granting/forbidding self access\"\n\t\t\t\t\t\t(v.self ? access_revokeSelf : access_grantSelf) &&\n\t\t\t\t\t\t// Not player must have access to target rule\n\t\t\t\t\t\t(isPlayer || access) &&\n\t\t\t\t\t\t// \"lowest access\" set to \"Self\" forces \"self access\" to \"Yes\"\n\t\t\t\t\t\t(!v.self || v.min !== AccessLevel.self),\n\t\t\t\t\teditMin:\n\t\t\t\t\t\t// Exception: Player can always lower permissions \"Self\"->\"Owner\"\n\t\t\t\t\t\t(isPlayer && v.min < AccessLevel.owner) ||\n\t\t\t\t\t\t// Character must have access to \"allow lowest access modification\" &&\n\t\t\t\t\t\t// Character must have access to target rule\n\t\t\t\t\t\t(access_editMin && access)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst totalPages = Math.ceil(this.permList.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\t\tif (this.permissionData !== null) {\n\n\t\t\tDrawTextFit(this.character.Name, 1111, 190, 189, \"Black\");\n\t\t\tDrawText(\"is permitted\", 1111, 235, \"Black\");\n\t\t\tDrawText(\"Lowest permitted role\", 1370, 235, \"Black\");\n\t\t\tMainCanvas.beginPath();\n\t\t\tMainCanvas.moveTo(1335, 230);\n\t\t\tMainCanvas.lineTo(1335, 230 + 610);\n\t\t\tMainCanvas.stroke();\n\n\t\t\t// filter\n\t\t\tDrawText(\"Filter:\", 130, 215, \"Black\");\n\t\t\tpositionElement(this.filterInput, 550, 210, 600, 64);\n\n\t\t\t//reset button\n\t\t\tif (this.filterInput.value) {\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tDrawButton(870, 182, 64, 64, \"X\", \"White\");\n\t\t\t}\n\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.permList.length) break;\n\t\t\t\tconst e = this.permList[i];\n\t\t\t\tif (e === null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst Y = 275 + off * 100;\n\n\t\t\t\tif (e.separator) {\n\t\t\t\t\t// idea to highlight the section separator\n\t\t\t\t\tMainCanvas.beginPath();\n\t\t\t\t\tMainCanvas.rect(125, Y, 1173, 64);\n\t\t\t\t\tMainCanvas.fillStyle = \"#eeeeee\";\n\t\t\t\t\tMainCanvas.fill();\n\t\t\t\t\tDrawText(e.name, 140, Y + 34, \"Black\");\n\t\t\t\t} else {\n\t\t\t\t\tDrawImageEx(MODULE_ICONS[e.permissionInfo.category], 125, Y, {\n\t\t\t\t\t\tHeight: 64,\n\t\t\t\t\t\tWidth: 64\n\t\t\t\t\t});\n\t\t\t\t\t// Permission name\n\t\t\t\t\tDrawButton(200, Y, 1000, 64, \"\", \"White\");\n\t\t\t\t\tDrawTextFit(e.permissionInfo.name, 210, Y + 34, 990, \"Black\");\n\t\t\t\t\t// Self checkbox\n\t\t\t\t\tDrawButton(1235, Y, 64, 64, \"\", e.editSelf ? \"White\" : \"#ddd\", e.permissionInfo.self ? \"Icons/Checked.png\" : \"\", undefined, !e.editSelf);\n\t\t\t\t\t// Min access\n\t\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\t\tDrawButton(1370, Y, 170, 64, getPermissionMinDisplayText(e.permissionInfo.min, this.character), e.editMin ? \"White\" : \"#ddd\", undefined, undefined, !e.editMin);\n\t\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.max(1, Math.ceil(this.permList.length / PER_PAGE_COUNT));\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawBackNextButton(1605, 800, 300, 90, `${DialogFindPlayer(\"Page\")} ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\t\t} else if (this.failed) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Failed to get permission data from ${this.character.Name}. Maybe you have no access?`, 1000, 480, \"Black\");\n\t\t} else {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(\"Loading...\", 1000, 480, \"Black\");\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.AuthorityPermissions]);\n\t\t}\n\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tDrawText(`- Authority: Permission Settings for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\tDrawButton(1815, 305, 90, 90, \"\", \"White\", \"Icons/West.png\", \"Previous screen\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\n\t\t// Owner list\n\t\tif (MouseIn(1815, 305, 90, 90)) return setSubscreen(new GuiAuthorityRoles(this.character));\n\n\t\tif (this.permissionData !== null) {\n\n\t\t\t//reset button\n\t\t\tif (MouseIn(870, 182, 64, 64)) {\n\t\t\t\tthis.filterInput.value = \"\";\n\t\t\t\tthis.rebuildList();\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.permList.length) break;\n\t\t\t\tconst e = this.permList[i];\n\t\t\t\tif (e === null)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst Y = 275 + off * 100;\n\n\t\t\t\tif (!e.separator) {\n\t\t\t\t\t// Permission name\n\t\t\t\t\tif (MouseIn(200, Y, 1000, 64)) {\n\t\t\t\t\t\t// TODO\n\t\t\t\t\t}\n\t\t\t\t\t// Self checkbox\n\t\t\t\t\tif (MouseIn(1235, Y, 64, 64) && e.editSelf) {\n\t\t\t\t\t\tif (e.permissionInfo.self &&\n\t\t\t\t\t\t\tthis.character.isPlayer() &&\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\te.permission === \"authority_grant_self\" ||\n\t\t\t\t\t\t\t\t!checkPermissionAccess(\"authority_grant_self\", getPlayerCharacter())\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// If Player couldn't switch back on, show warning instead\n\t\t\t\t\t\t\tsetSubscreen(new GuiAuthorityDialogSelf(this.character, e.permission, e.permissionInfo, this));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.character.setPermission(e.permission, \"self\", !e.permissionInfo.self);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Min access\n\t\t\t\t\tif (MouseIn(1370, Y, 170, 64) && e.editMin) {\n\t\t\t\t\t\tconst access_editMin = this.permissionData.authority_edit_min ?\n\t\t\t\t\t\t\tcheckPermissionAccessData(this.permissionData.authority_edit_min, this.myAccessLevel) :\n\t\t\t\t\t\t\tfalse;\n\t\t\t\t\t\tsetSubscreen(new GuiAuthorityDialogMin(\n\t\t\t\t\t\t\tthis.character,\n\t\t\t\t\t\t\te.permission,\n\t\t\t\t\t\t\te.permissionInfo,\n\t\t\t\t\t\t\tthis.myAccessLevel,\n\t\t\t\t\t\t\t!access_editMin || !checkPermissionAccessData(e.permissionInfo, this.myAccessLevel),\n\t\t\t\t\t\t\tthis\n\t\t\t\t\t\t));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.permList.length / PER_PAGE_COUNT);\n\t\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\t\tthis.page--;\n\t\t\t\tif (this.page < 0) {\n\t\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t\t}\n\t\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\t\tthis.page++;\n\t\t\t\tif (this.page >= totalPages) {\n\t\t\t\t\tthis.page = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n\n\tUnload() {\n\t\tthis.filterInput.remove();\n\t}\n}\n","import { ChatroomCharacter, getAllCharactersInRoom } from \"../characters\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { getCharacterName } from \"../utilsClub\";\nimport { setSubscreen } from \"../modules/gui\";\n\nconst PER_PAGE_COUNT = 8;\n\ntype RoleListItem = {\n\ttype: \"Character\" | \"Player\" | \"Clubowner\" | \"Owner\" | \"Lover\" | \"Mistress\" | \"in same room\" | \"Friend\";\n\tmemberNumber: number;\n\tname: string;\n};\n\nexport class GuiMemberSelect extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\tprivate roleData: PermissionRoleBundle | null = null;\n\tprivate roleList: RoleListItem[] = [];\n\tprivate failed: boolean = false;\n\tprivate page: number = 0;\n\tprivate ignoredCharacters: number[];\n\n\treadonly back: GuiSubscreen;\n\treadonly callback: (result: number) => void;\n\n\tconstructor(character: ChatroomCharacter, back: GuiSubscreen, callback: (result: number) => void, ignoredCharacters: number[] = []) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.back = back;\n\t\tthis.callback = callback;\n\t\tthis.ignoredCharacters = ignoredCharacters;\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.roleData = null;\n\t\tthis.refreshScreen();\n\t\tPromise.all([this.character.getRolesData()]).then(res => {\n\t\t\tthis.roleData = res[0];\n\t\t\tthis.refreshScreen();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get role info for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate refreshScreen() {\n\t\tif (!this.active) return;\n\n\t\tthis.roleList = [];\n\n\t\tlet nameFilter = document.getElementById(\"BCX_Filter\") as HTMLInputElement | undefined;\n\n\t\tif (this.roleData === null) {\n\t\t\tif (nameFilter) {\n\t\t\t\tnameFilter.remove();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!nameFilter) {\n\t\t\tnameFilter = ElementCreateInput(\"BCX_Filter\", \"text\", \"\", \"30\");\n\t\t\tnameFilter.addEventListener(\"input\", ev => {\n\t\t\t\tthis.refreshScreen();\n\t\t\t});\n\t\t}\n\n\t\tconst filter = nameFilter.value.trim().toLocaleLowerCase().split(\" \");\n\n\t\tthis.roleList = [\n\t\t\t{\n\t\t\t\ttype: \"Character\",\n\t\t\t\tmemberNumber: this.character.MemberNumber,\n\t\t\t\tname: this.character.Name\n\t\t\t}\n\t\t];\n\n\t\tif (!this.character.isPlayer()) {\n\t\t\tthis.roleList.push({\n\t\t\t\ttype: \"Player\",\n\t\t\t\tmemberNumber: Player.MemberNumber!,\n\t\t\t\tname: Player.Name\n\t\t\t});\n\t\t}\n\n\t\tif (typeof this.character.Character.Ownership?.MemberNumber === \"number\" && !this.roleList.some(r => r.memberNumber === this.character.Character.Ownership?.MemberNumber)) {\n\t\t\tthis.roleList.push({\n\t\t\t\ttype: \"Clubowner\",\n\t\t\t\tmemberNumber: this.character.Character.Ownership.MemberNumber,\n\t\t\t\tname: this.character.Character.Ownership.Name\n\t\t\t});\n\t\t}\n\t\tfor (const owner of this.roleData.owners) {\n\t\t\tif (!this.roleList.some(r => r.memberNumber === owner[0])) {\n\t\t\t\tthis.roleList.push({\n\t\t\t\t\ttype: \"Owner\",\n\t\t\t\t\tmemberNumber: owner[0],\n\t\t\t\t\tname: getCharacterName(owner[0], owner[1] || \"[unknown name]\")\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (Array.isArray(this.character.Character.Lovership)) {\n\t\t\tfor (const L of this.character.Character.Lovership) {\n\t\t\t\tif (typeof L.MemberNumber === \"number\" && !this.roleList.some(r => r.memberNumber === L.MemberNumber)) {\n\t\t\t\t\tthis.roleList.push({\n\t\t\t\t\t\ttype: \"Lover\",\n\t\t\t\t\t\tmemberNumber: L.MemberNumber,\n\t\t\t\t\t\tname: L.Name\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const mistress of this.roleData.mistresses) {\n\t\t\tif (!this.roleList.some(r => r.memberNumber === mistress[0])) {\n\t\t\t\tthis.roleList.push({\n\t\t\t\t\ttype: \"Mistress\",\n\t\t\t\t\tmemberNumber: mistress[0],\n\t\t\t\t\tname: getCharacterName(mistress[0], mistress[1] || \"[unknown name]\")\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// Skip if fully blinded and BlindDisableExamine is set\n\t\tif (Player.GetBlindLevel() < 3 || !Player.GameplaySettings?.BlindDisableExamine) {\n\t\t\tconst ChatRoomCharacterList = getAllCharactersInRoom();\n\t\t\t// Only add adjecent characters if only those can be seen\n\t\t\tif (Player.GetBlindLevel() > 0 && Player.ImmersionSettings?.BlindAdjacent) {\n\t\t\t\tconst playerIndex = ChatRoomCharacterList.findIndex(c => c.isPlayer());\n\t\t\t\t// Filter out the characters adjacent to the player index\n\t\t\t\tfor (let i = 0; i < ChatRoomCharacterList.length; i++) {\n\t\t\t\t\tif (Math.abs(i - playerIndex) === 1 &&\n\t\t\t\t\t!this.roleList.some(r => r.memberNumber === ChatRoomCharacterList[i].MemberNumber)) {\n\t\t\t\t\t\tthis.roleList.push({\n\t\t\t\t\t\t\ttype: \"in same room\",\n\t\t\t\t\t\t\tmemberNumber: ChatRoomCharacterList[i].MemberNumber,\n\t\t\t\t\t\t\tname: ChatRoomCharacterList[i].Name\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// Add the whole room\n\t\t\t} else {\n\t\t\t\tfor (const character of ChatRoomCharacterList) {\n\t\t\t\t\tif (!this.roleList.some(r => r.memberNumber === character.MemberNumber)) {\n\t\t\t\t\t\tthis.roleList.push({\n\t\t\t\t\t\t\ttype: \"in same room\",\n\t\t\t\t\t\t\tmemberNumber: character.MemberNumber,\n\t\t\t\t\t\t\tname: character.Name\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Player.FriendNames) {\n\t\t\tfor (const [memberNumber, name] of Player.FriendNames.entries()) {\n\t\t\t\tif (!this.roleList.some(r => r.memberNumber === memberNumber)) {\n\t\t\t\t\tthis.roleList.push({\n\t\t\t\t\t\ttype: \"Friend\",\n\t\t\t\t\t\tmemberNumber,\n\t\t\t\t\t\tname\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.roleList = this.roleList.filter(e => {\n\t\t\treturn !this.ignoredCharacters.includes(e.memberNumber) && filter.every(f => e.name?.toLocaleLowerCase().includes(f) || e.memberNumber.toString().includes(f));\n\t\t});\n\n\t\tconst totalPages = Math.ceil(this.roleList.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\t\tif (this.roleData !== null) {\n\n\t\t\t// filter\n\t\t\tDrawText(\"Filter name:\", 703, 125, \"Black\");\n\t\t\tElementPosition(\"BCX_Filter\", 1203, 118, 600, 64);\n\n\t\t\t//reset button\n\t\t\tif ((document.getElementById(\"BCX_Filter\") as HTMLInputElement | undefined)?.value) {\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tDrawButton(1510, 92, 64, 64, \"X\", \"White\");\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.roleList.length) break;\n\t\t\t\tconst e = this.roleList[i];\n\n\t\t\t\tconst Y = 290 + off * 75;\n\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tDrawText(`${e.name}`, 383, Y + 34, \"Black\");\n\t\t\t\tDrawText(`${e.memberNumber}`, 780, Y + 34, \"Black\");\n\t\t\t\tDrawText(`${e.type === (\"Character\" || \"Player\") ? \"\" : e.type}`, 1100, Y + 34, \"Black\");\n\n\t\t\t\tMainCanvas.beginPath();\n\t\t\t\tMainCanvas.moveTo(175, Y + 69);\n\t\t\t\tMainCanvas.lineTo(1280, Y + 69);\n\t\t\t\tMainCanvas.strokeStyle = \"#ddd\";\n\t\t\t\tMainCanvas.stroke();\n\t\t\t\tDrawButton(1340, Y, 150, 64, \"Select\", \"White\", \"\");\n\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.max(1, Math.ceil(this.roleList.length / PER_PAGE_COUNT));\n\t\t\tDrawBackNextButton(1605, 800, 300, 90, `${DialogFindPlayer(\"Page\")} ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\t\t} else if (this.failed) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Failed to get data from ${this.character.Name}. Maybe you have no access?`, 1000, 480, \"Black\");\n\t\t} else {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(\"Loading...\", 1000, 480, \"Black\");\n\t\t}\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`Please select a member.`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(125, 176);\n\t\tMainCanvas.lineTo(1566, 176);\n\t\tMainCanvas.stroke();\n\n\t\tDrawText(`Name`, 383, 222, \"Black\");\n\t\tDrawText(`Member number`, 780, 222, \"Black\");\n\t\tDrawText(`Note`, 1100, 222, \"Black\");\n\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(125, 265);\n\t\tMainCanvas.lineTo(1566, 265);\n\t\tMainCanvas.stroke();\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\n\t\tif (this.roleData !== null) {\n\n\t\t\t//reset button\n\t\t\tconst elem = document.getElementById(\"BCX_Filter\") as HTMLInputElement | undefined;\n\t\t\tif (MouseIn(1510, 92, 64, 64) && elem) {\n\t\t\t\telem.value = \"\";\n\t\t\t\tthis.refreshScreen();\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.roleList.length) break;\n\t\t\t\tconst e = this.roleList[i];\n\n\t\t\t\tconst Y = 290 + off * 75;\n\n\t\t\t\tif (MouseIn(1340, Y, 150, 64)) {\n\t\t\t\t\tthis.callback(e.memberNumber);\n\t\t\t\t\tthis.Exit();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.roleList.length / PER_PAGE_COUNT);\n\t\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\t\tthis.page--;\n\t\t\t\tif (this.page < 0) {\n\t\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t\t}\n\t\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\t\tthis.page++;\n\t\t\t\tif (this.page >= totalPages) {\n\t\t\t\t\tthis.page = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n\n\tUnload() {\n\t\tElementRemove(\"BCX_Filter\");\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { AccessLevel } from \"../modules/authority\";\nimport { capitalizeFirstLetter } from \"../utils\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiAuthorityPermissions } from \"./authority_permissions\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { getCharacterName, DrawImageEx, showHelp } from \"../utilsClub\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { GuiMemberSelect } from \"./member_select\";\n\nconst PER_PAGE_COUNT = 6;\n\ntype RoleListItem = {\n\ttype: \"Owner\" | \"Mistress\";\n\tmemberNumber: number;\n\tname: string | null;\n};\n\nexport class GuiAuthorityRoles extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate roleData: PermissionRoleBundle | null = null;\n\tprivate roleList: RoleListItem[] = [];\n\tprivate failed: boolean = false;\n\tprivate page: number = 0;\n\n\tprivate hoveringTextList: string[] = [];\n\tprivate roleAddInputAutofill: number | null = null;\n\n\tprivate showHelp: boolean = false;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\n\t\tthis.hoveringTextList =\n\t\t\tcharacter.isPlayer() ? [\n\t\t\t\t`You - either top or bottom of the hierarchy`,\n\t\t\t\t`Your owner, visible on your character profile`,\n\t\t\t\t`Any character, added to the list on the left as \"Owner\"`,\n\t\t\t\t`Any of your lovers, visible on your character profile`,\n\t\t\t\t`Any character, added to the list on the left as \"Mistress\"`,\n\t\t\t\t`Anyone you have white-listed`,\n\t\t\t\t`Anyone you have friend-listed`,\n\t\t\t\t`Anyone, who can use items on you`\n\t\t\t] : [\n\t\t\t\t`This player - either top or bottom of the hierarchy`,\n\t\t\t\t`This player's owner, visible on their character profile`,\n\t\t\t\t`Any character, added to the list on the left as \"Owner\"`,\n\t\t\t\t`Any lover of this player, visible on their profile`,\n\t\t\t\t`Any character, added to the list on the left as \"Mistress\"`,\n\t\t\t\t`Anyone this player has white-listed`,\n\t\t\t\t`Anyone this player has friend-listed`,\n\t\t\t\t`Anyone, who can use items on this player`\n\t\t\t];\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.roleData = null;\n\t\tthis.rebuildList();\n\t\tPromise.all([this.character.getRolesData()]).then(res => {\n\t\t\tthis.roleData = res[0];\n\t\t\tthis.rebuildList();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get role info for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate rebuildList() {\n\t\tif (!this.active) return;\n\n\t\tthis.roleList = [];\n\n\t\tlet Input = document.getElementById(\"BCX_RoleAdd\") as HTMLInputElement | undefined;\n\n\t\tif (!this.roleData) {\n\t\t\tif (Input) {\n\t\t\t\tInput.remove();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst showInput = this.roleData.allowAddMistress || this.roleData.allowAddOwner;\n\n\t\tif (!showInput && Input) {\n\t\t\tInput.remove();\n\t\t} else if (showInput && !Input) {\n\t\t\tInput = ElementCreateInput(\"BCX_RoleAdd\", \"text\", \"\", \"6\");\n\t\t\tif (this.roleAddInputAutofill !== null) {\n\t\t\t\tInput.value = `${this.roleAddInputAutofill}`;\n\t\t\t\tthis.roleAddInputAutofill = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.roleList = this.roleData.owners.map((i): RoleListItem => ({\n\t\t\ttype: \"Owner\",\n\t\t\tmemberNumber: i[0],\n\t\t\tname: getCharacterName(i[0], i[1] || null)\n\t\t}));\n\t\tthis.roleList.push(...this.roleData.mistresses.map((i): RoleListItem => ({\n\t\t\ttype: \"Mistress\",\n\t\t\tmemberNumber: i[0],\n\t\t\tname: getCharacterName(i[0], i[1] || null)\n\t\t})));\n\n\t\tconst totalPages = Math.ceil(this.roleList.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\n\t\tDrawText(\"Hierarchy of roles:\", 1336, 95, \"Black\");\n\n\t\t// hierarchy background\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(1450, 134);\n\t\tMainCanvas.lineTo(1450 + 150, 134);\n\t\tMainCanvas.lineTo(1450 + 80, 740);\n\t\tMainCanvas.lineTo(1450 + 70, 740);\n\t\tMainCanvas.lineTo(1450, 134);\n\t\tMainCanvas.fillStyle = \"Black\";\n\t\tMainCanvas.fill();\n\n\t\tif (this.roleData) {\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.roleList.length) break;\n\t\t\t\tconst e = this.roleList[i];\n\n\t\t\t\tconst Y = 210 + off * 95;\n\n\t\t\t\t// Owner/Mistress list\n\t\t\t\tMainCanvas.beginPath();\n\t\t\t\tMainCanvas.rect(130, Y, 900, 64);\n\t\t\t\tMainCanvas.stroke();\n\t\t\t\tconst msg = `${e.type} ${e.name === null ? \"[unknown name]\" : e.name} (${e.memberNumber})`;\n\t\t\t\tDrawTextFit(msg, 140, Y + 34, 590, \"Black\");\n\n\t\t\t\tif ((e.type === \"Owner\" ? this.roleData.allowRemoveOwner : this.roleData.allowRemoveMistress) || e.memberNumber === Player.MemberNumber) {\n\t\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\t\tDrawButton(1090, Y, 64, 64, \"X\", \"White\");\n\t\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst Input = document.getElementById(\"BCX_RoleAdd\") as HTMLInputElement | undefined;\n\t\t\tif (Input) {\n\t\t\t\tDrawText(\"Member Number:\", 130, 847, \"Black\");\n\t\t\t\tElementPosition(\"BCX_RoleAdd\", 580, 842, 300, 64);\n\t\t\t}\n\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tif (this.roleData.allowAddOwner) {\n\t\t\t\tDrawButton(833, 815, 210, 64, \"Add as owner\", \"white\");\n\t\t\t}\n\n\t\t\tif (this.roleData.allowAddMistress) {\n\t\t\t\tDrawButton(1074, 815, 210, 64, \"Add as mistress\", \"white\");\n\t\t\t}\n\n\t\t\tif (this.roleData.allowAddMistress || this.roleData.allowAddOwner) {\n\t\t\t\tDrawButton(740, 815, 64, 64, \"\", \"White\", undefined, `Select member number from list`);\n\t\t\t\tDrawImageEx(\"Icons/Title.png\", 742, 815, { Width: 60, Height: 60 });\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.roleList.length / PER_PAGE_COUNT);\n\t\t\tDrawBackNextButton(1430, 800, 300, 90, `Page ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\t\t} else if (this.failed) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Failed to get role data from ${this.character.Name}. Maybe you have no access?`, 800, 480, \"Black\");\n\t\t} else {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(\"Loading...\", 800, 480, \"Black\");\n\t\t}\n\n\t\t// hierarchy roles\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1420, 130, 208, 54, this.character.Name, \"White\", undefined, this.hoveringTextList[0]);\n\t\tfor (let i = 1; i < 8; i++) {\n\t\t\tDrawButton(1430, 130 + 80 * i, 188, 54, capitalizeFirstLetter(AccessLevel[i]), \"White\", undefined, this.hoveringTextList[i]);\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.AuthorityRoles]);\n\t\t}\n\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Authority: Role Management for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\tDrawButton(1815, 305, 90, 90, \"\", \"White\", \"Icons/Preference.png\", \"Configure the role-based BCX permissions\");\n\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\t\tif (MouseIn(1815, 305, 90, 90)) return this.Back();\n\n\t\tif (this.roleData) {\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.roleList.length) break;\n\t\t\t\tconst e = this.roleList[i];\n\n\t\t\t\tconst Y = 210 + off * 95;\n\n\t\t\t\tif (((e.type === \"Owner\" ? this.roleData.allowRemoveOwner : this.roleData.allowRemoveMistress) || e.memberNumber === Player.MemberNumber) && MouseIn(1090, Y, 64, 64)) {\n\t\t\t\t\tthis.character.editRole(e.type === \"Owner\" ? \"owner\" : \"mistress\", \"remove\", e.memberNumber);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst Input = document.getElementById(\"BCX_RoleAdd\") as HTMLInputElement | undefined;\n\t\t\tconst inputText = Input?.value ?? \"\";\n\t\t\tconst inputNumber = /^[0-9]+$/.test(inputText) ? Number.parseInt(inputText, 10) : null;\n\n\t\t\tif (this.roleData.allowAddOwner && Input && inputNumber !== null && MouseIn(833, 815, 210, 64)) {\n\t\t\t\tInput.value = \"\";\n\t\t\t\tthis.character.editRole(\"owner\", \"add\", inputNumber);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.roleData.allowAddMistress && Input && inputNumber !== null && MouseIn(1074, 815, 210, 64)) {\n\t\t\t\tInput.value = \"\";\n\t\t\t\tthis.character.editRole(\"mistress\", \"add\", inputNumber);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.roleList.length / PER_PAGE_COUNT);\n\t\t\tif (MouseIn(1430, 800, 150, 90)) {\n\t\t\t\tthis.page--;\n\t\t\t\tif (this.page < 0) {\n\t\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t\t}\n\t\t\t} else if (MouseIn(1580, 800, 150, 90)) {\n\t\t\t\tthis.page++;\n\t\t\t\tif (this.page >= totalPages) {\n\t\t\t\t\tthis.page = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// member select\n\t\t\tif (MouseIn(740, 815, 64, 64)) {\n\t\t\t\tsetSubscreen(new GuiMemberSelect(this.character, this, result => {\n\t\t\t\t\tthis.roleAddInputAutofill = result;\n\t\t\t\t}));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n\n\tBack() {\n\t\tsetSubscreen(new GuiAuthorityPermissions(this.character));\n\t}\n\n\tUnload() {\n\t\tElementRemove(\"BCX_RoleAdd\");\n\t}\n}\n","import { setSubscreen } from \"../modules/gui\";\nimport { clearAllData } from \"../modules/storage\";\nimport { GuiSubscreen } from \"./subscreen\";\n\nexport class GuiGlobalDialogClearData extends GuiSubscreen {\n\n\tpublic back: GuiSubscreen;\n\n\tprivate allowedConfirmTime: number | null = 0;\n\n\tconstructor(back: GuiSubscreen) {\n\t\tsuper();\n\t\tthis.back = back;\n\t}\n\n\tLoad() {\n\t\tthis.allowedConfirmTime = Date.now() + 10_000;\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tDrawText(`- Permanent deletion of ALL Bondage Club Extended data -`, 1000, 125, \"Black\");\n\n\t\tDrawText(\"- Warning -\", 1000, 225, \"Black\", \"Black\");\n\t\tDrawText(\"If you confirm, all BCX data (including settings, curses, logs, ...) will be permanently deleted!\", 1000, 325, \"Black\");\n\n\t\tDrawText(\"As part of the deletion process, the window will reload, logging you out of your account.\", 1000, 500, \"Gray\");\n\t\tDrawText(\"You will be able to use BCX again, but none of your current data will be coming back!\", 1000, 550, \"Gray\");\n\n\t\tDrawText(\"This action cannot be undone!\", 1000, 625, \"Red\", \"Black\");\n\n\t\tif (this.allowedConfirmTime === null) {\n\t\t\tDrawText(\"Deleting...\", 1000, 720, \"Black\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst now = Date.now();\n\t\tif (now < this.allowedConfirmTime) {\n\t\t\tDrawButton(300, 720, 200, 80, `Confirm (${Math.floor((this.allowedConfirmTime - now) / 1000)})`, \"#ddd\", undefined, undefined, true);\n\t\t} else {\n\t\t\tDrawButton(300, 720, 200, 80, \"Confirm\", \"White\");\n\t\t}\n\n\t\tDrawButton(1520, 720, 200, 80, \"Cancel\", \"White\");\n\t}\n\n\tClick() {\n\t\tif (this.allowedConfirmTime === null) return;\n\n\t\tif (MouseIn(1520, 720, 200, 80)) return this.Exit();\n\n\t\tif (MouseIn(300, 720, 200, 80) && Date.now() >= this.allowedConfirmTime) return this.Confirm();\n\t}\n\n\tConfirm() {\n\t\tthis.allowedConfirmTime = null;\n\t\tclearAllData();\n\t}\n\n\tExit() {\n\t\tif (this.allowedConfirmTime === null) return;\n\t\tsetSubscreen(this.back);\n\t}\n}\n","import { setSubscreen } from \"../modules/gui\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { ModuleCategory, MODULE_ICONS, MODULE_NAMES, TOGGLEABLE_MODULES } from \"../constants\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport { moduleIsEnabled, setDisabledModules } from \"../modules/presets\";\nimport { GuiGlobal } from \"./global\";\nimport { getPlayerCharacter } from \"../characters\";\n\nexport class GuiGlobalModuleToggling extends GuiSubscreen {\n\n\tprivate enabledModules = new Set<ModuleCategory>();\n\tprivate changed: boolean = false;\n\n\tLoad() {\n\t\tthis.enabledModules.clear();\n\t\tfor (const m of TOGGLEABLE_MODULES.filter(i => moduleIsEnabled(i))) {\n\t\t\tthis.enabledModules.add(m);\n\t\t}\n\t\tthis.changed = false;\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Global: Enable/Disable BCX's modules -`, 125, 125, \"Black\", \"Gray\");\n\t\tDrawText(`Warning: Disabling a module will reset all its settings and stored data!`, 125, 180, \"FireBrick\");\n\n\t\tfor (let i = 0; i < TOGGLEABLE_MODULES.length; i++) {\n\t\t\tconst module = TOGGLEABLE_MODULES[i];\n\t\t\tconst PX = Math.floor(i / 5);\n\t\t\tconst PY = i % 5;\n\n\t\t\tDrawCheckbox(150 + 500 * PX, 240 + 110 * PY, 64, 64, \"\", this.enabledModules.has(module));\n\t\t\tDrawImageEx(MODULE_ICONS[module], 280 + 500 * PX, 240 + 110 * PY, {\n\t\t\t\tHeight: 64,\n\t\t\t\tWidth: 64\n\t\t\t});\n\t\t\tDrawText(MODULE_NAMES[module], 370 + 500 * PX, 240 + 32 + 110 * PY, \"Black\");\n\t\t}\n\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tDrawButton(300, 800, 200, 80, \"Confirm\", this.changed ? \"White\" : \"#ddd\", undefined, undefined, !this.changed);\n\n\t\tDrawButton(1520, 800, 200, 80, \"Cancel\", \"White\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\n\t\tfor (let i = 0; i < TOGGLEABLE_MODULES.length; i++) {\n\t\t\tconst module = TOGGLEABLE_MODULES[i];\n\t\t\tconst PX = Math.floor(i / 5);\n\t\t\tconst PY = i % 5;\n\n\t\t\tif (MouseIn(150 + 500 * PX, 240 + 110 * PY, 64, 64)) {\n\t\t\t\tif (this.enabledModules.has(module)) {\n\t\t\t\t\tthis.enabledModules.delete(module);\n\t\t\t\t} else {\n\t\t\t\t\tthis.enabledModules.add(module);\n\t\t\t\t}\n\t\t\t\tthis.changed = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (MouseIn(300, 800, 200, 80) && this.changed) {\n\t\t\tif (setDisabledModules(TOGGLEABLE_MODULES.filter(i => !this.enabledModules.has(i)))) {\n\t\t\t\tthis.Exit();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (MouseIn(1520, 800, 200, 80)) {\n\t\t\treturn this.Exit();\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiGlobal(getPlayerCharacter()));\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiGlobalDialogClearData } from \"./global_dialogClearData\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiGlobalModuleToggling } from \"./global_moduleToggling\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { capitalizeFirstLetter } from \"../utils\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport { getCurrentPreset } from \"../modules/presets\";\nimport { Preset } from \"../constants\";\n\nexport class GuiGlobal extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t}\n\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Global: Configuration for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\n\t\tif (!this.character.isPlayer()) {\n\t\t\tDrawText(`Global configuration is not possible on others`, 1000, 500, \"Black\");\n\t\t\treturn;\n\t\t}\n\n\t\t// preset\n\t\tMainCanvas.fillStyle = \"#ddd\";\n\t\tMainCanvas.fillRect(840, 200, 950, 90);\n\t\tDrawImageEx(\"Icons/Introduction.png\", 840 + 20, 200 + 20, { Height: 50, Width: 50 });\n\t\tDrawTextFit(`Your initially selected BCX preset was: \"${capitalizeFirstLetter(Preset[getCurrentPreset()])}\"`, 1300, 244, 850, \"Black\");\n\n\t\tDrawButton(120, 200, 400, 90, \"Manage BCX modules\", \"White\", \"\", \"Enable/Disable individual modules\");\n\n\t\tDrawButton(1490, 800, 300, 90, \"Clear all BCX data\", \"#FF3232\", \"\", \"Emergency reset of BCX\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\n\t\tif (!this.character.isPlayer())\n\t\t\treturn;\n\n\t\tif (MouseIn(120, 200, 400, 90)) {\n\t\t\tsetSubscreen(new GuiGlobalModuleToggling());\n\t\t\treturn;\n\t\t}\n\n\t\tif (MouseIn(1490, 800, 300, 90)) {\n\t\t\tsetSubscreen(new GuiGlobalDialogClearData(this));\n\t\t\treturn;\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n}\n","/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\nexport default setCacheAdd;\n","/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\nexport default setCacheHas;\n","import MapCache from './_MapCache.js';\nimport setCacheAdd from './_setCacheAdd.js';\nimport setCacheHas from './_setCacheHas.js';\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\nexport default SetCache;\n","/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arraySome;\n","/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\nexport default cacheHas;\n","import SetCache from './_SetCache.js';\nimport arraySome from './_arraySome.js';\nimport cacheHas from './_cacheHas.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Check that cyclic values are equal.\n  var arrStacked = stack.get(array);\n  var othStacked = stack.get(other);\n  if (arrStacked && othStacked) {\n    return arrStacked == other && othStacked == array;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!cacheHas(seen, othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {\n              return seen.push(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, bitmask, customizer, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalArrays;\n","/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\nexport default mapToArray;\n","/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nexport default setToArray;\n","import Symbol from './_Symbol.js';\nimport Uint8Array from './_Uint8Array.js';\nimport eq from './eq.js';\nimport equalArrays from './_equalArrays.js';\nimport mapToArray from './_mapToArray.js';\nimport setToArray from './_setToArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= COMPARE_UNORDERED_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\nexport default equalByTag;\n","import getAllKeys from './_getAllKeys.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      objProps = getAllKeys(object),\n      objLength = objProps.length,\n      othProps = getAllKeys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Check that cyclic values are equal.\n  var objStacked = stack.get(object);\n  var othStacked = stack.get(other);\n  if (objStacked && othStacked) {\n    return objStacked == other && othStacked == object;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalObjects;\n","import Stack from './_Stack.js';\nimport equalArrays from './_equalArrays.js';\nimport equalByTag from './_equalByTag.js';\nimport equalObjects from './_equalObjects.js';\nimport getTag from './_getTag.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = objIsArr ? arrayTag : getTag(object),\n      othTag = othIsArr ? arrayTag : getTag(other);\n\n  objTag = objTag == argsTag ? objectTag : objTag;\n  othTag = othTag == argsTag ? objectTag : othTag;\n\n  var objIsObj = objTag == objectTag,\n      othIsObj = othTag == objectTag,\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && isBuffer(object)) {\n    if (!isBuffer(other)) {\n      return false;\n    }\n    objIsArr = true;\n    objIsObj = false;\n  }\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)\n      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);\n  }\n  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);\n}\n\nexport default baseIsEqualDeep;\n","import baseIsEqualDeep from './_baseIsEqualDeep.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Unordered comparison\n *  2 - Partial comparison\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, bitmask, customizer, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);\n}\n\nexport default baseIsEqual;\n","import baseIsEqual from './_baseIsEqual.js';\n\n/**\n * Performs a deep comparison between two values to determine if they are\n * equivalent.\n *\n * **Note:** This method supports comparing arrays, array buffers, booleans,\n * date objects, error objects, maps, numbers, `Object` objects, regexes,\n * sets, strings, symbols, and typed arrays. `Object` objects are compared\n * by their own, not inherited, enumerable properties. Functions and DOM\n * nodes are compared by strict equality, i.e. `===`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.isEqual(object, other);\n * // => true\n *\n * object === other;\n * // => false\n */\nfunction isEqual(value, other) {\n  return baseIsEqual(value, other);\n}\n\nexport default isEqual;\n","import { ConditionsLimit, ModuleCategory } from \"../constants\";\nimport { registerRule } from \"../modules/rules\";\nimport { AccessLevel, getCharacterAccessLevel } from \"../modules/authority\";\nimport { patchFunction, hookFunction } from \"../patching\";\nimport { ChatRoomActionMessage, getCharacterName, InfoBeep } from \"../utilsClub\";\nimport { ChatroomCharacter, getChatroomCharacter } from \"../characters\";\nimport { getAllCharactersInRoom, registerEffectBuilder } from \"../characters\";\nimport { isObject } from \"../utils\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nexport function initRules_bc_alter() {\n\tregisterRule(\"alt_restrict_hearing\", {\n\t\tname: \"Sensory deprivation: Sound\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"impacts PLAYER_NAME's hearing; adjustable\",\n\t\tlongDescription: \"This rule impacts PLAYER_NAME's natural ability to hear in the same way items do, independent of them (strength of deafening can be adjusted).\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tdeafeningStrength: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [[\"light\", \"Light\"], [\"medium\", \"Medium\"], [\"heavy\", \"Heavy\"]],\n\t\t\t\tdefault: \"light\",\n\t\t\t\tdescription: \"Hearing impairment:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tconst strengthMap: Record<string, number> = {\n\t\t\t\tlight: 1,\n\t\t\t\tmedium: 2,\n\t\t\t\theavy: 4\n\t\t\t};\n\t\t\thookFunction(\"Player.GetDeafLevel\", 1, (args, next) => {\n\t\t\t\tlet res = next(args);\n\t\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\t\tres += strengthMap[state.customData.deafeningStrength] ?? 0;\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"alt_hearing_whitelist\", {\n\t\tname: \"Hearing whitelist\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"of members whom PLAYER_NAME can always understand\",\n\t\tlongDescription: \"This rule defines a list of members whose voice can always be understood by PLAYER_NAME - independent of any sensory deprivation items or hearing impairing BCX rules on PLAYER_NAME. There is an additional option to toggle whether PLAYER_NAME can still understand a white-listed member's voice if that member is speech impaired herself (e.g. by being gagged).\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\twhitelistedMembers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Members numbers still heard while hearing impaired:\",\n\t\t\t\tY: 350,\n\t\t\t\toptions: {\n\t\t\t\t\tpageSize: 3\n\t\t\t\t}\n\t\t\t},\n\t\t\tignoreGaggedMembersToggle: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Also understand if those are speech impaired\",\n\t\t\t\tY: 710\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tlet ignoreDeaf = false;\n\t\t\thookFunction(\"SpeechGarble\", 2, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (state.isEnforced &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\tC.MemberNumber != null &&\n\t\t\t\t\tstate.customData.whitelistedMembers\n\t\t\t\t\t\t.filter(m => m !== Player.MemberNumber)\n\t\t\t\t\t\t.includes(C.MemberNumber) &&\n\t\t\t\t\t(C.CanTalk() || state.customData.ignoreGaggedMembersToggle)\n\t\t\t\t) {\n\t\t\t\t\treturn args[1];\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\t// depends on the function PreferenceIsPlayerInSensDep()\n\t\t\thookFunction(\"ChatRoomMessage\", 9, (args, next) => {\n\t\t\t\tconst C = args[0].Sender;\n\t\t\t\tif (state.isEnforced &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\ttypeof C === \"number\" &&\n\t\t\t\t\tstate.customData.whitelistedMembers\n\t\t\t\t\t\t.filter(m => m !== Player.MemberNumber)\n\t\t\t\t\t\t.includes(C)\n\t\t\t\t) {\n\t\t\t\t\tignoreDeaf = true;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tignoreDeaf = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t\t// does nothing but uses GetDeafLevel -> needs to be watched\n\t\t\thookFunction(\"PreferenceIsPlayerInSensDep\", 4, (args, next) => { return next(args); }, ModuleCategory.Rules);\n\t\t\thookFunction(\"Player.GetDeafLevel\", 9, (args, next) => {\n\t\t\t\tif (ignoreDeaf) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"alt_restrict_sight\", {\n\t\tname: \"Sensory deprivation: Sight\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"impacts PLAYER_NAME's sight; adjustable\",\n\t\tlongDescription: \"This rule impacts PLAYER_NAME's natural ability to see in the same way items do, independent of them (strength of blindness can be adjusted).\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tblindnessStrength: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [[\"light\", \"Light\"], [\"medium\", \"Medium\"], [\"heavy\", \"Heavy\"]],\n\t\t\t\tdefault: \"light\",\n\t\t\t\tdescription: \"Eyesight impairment:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tconst strengthMap: Record<string, number> = {\n\t\t\t\tlight: 1,\n\t\t\t\tmedium: 2,\n\t\t\t\theavy: 3\n\t\t\t};\n\t\t\thookFunction(\"Player.GetBlindLevel\", 1, (args, next) => {\n\t\t\t\tlet res = next(args);\n\t\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\t\tres += strengthMap[state.customData.blindnessStrength] ?? 0;\n\t\t\t\t}\n\t\t\t\treturn Math.min(res, Player.GameplaySettings?.SensDepChatLog === \"SensDepLight\" ? 2 : 3);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"alt_seeing_whitelist\", {\n\t\tname: \"Seeing whitelist\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"of members whom PLAYER_NAME can always see\",\n\t\tlongDescription: \"This rule defines a list of members whose appearance can always be seen normally by PLAYER_NAME - independent of any blinding items or seeing impairing BCX rules on PLAYER_NAME.\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\twhitelistedMembers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Members still seen while under blindness:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tlet noBlind = false;\n\t\t\thookFunction(\"DrawCharacter\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (state.isEnforced && state.customData && C.MemberNumber != null && state.customData.whitelistedMembers.includes(C.MemberNumber)) {\n\t\t\t\t\tnoBlind = true;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tnoBlind = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (state.isEnforced && state.customData && C.MemberNumber != null && state.customData.whitelistedMembers.includes(C.MemberNumber)) {\n\t\t\t\t\tnoBlind = true;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tnoBlind = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomClickCharacter\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (state.isEnforced && state.customData && C.MemberNumber != null && state.customData.whitelistedMembers.includes(C.MemberNumber)) {\n\t\t\t\t\tnoBlind = true;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tnoBlind = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomMessage\", 0, (args, next) => {\n\t\t\t\tlet C: ChatroomCharacter | null = null;\n\t\t\t\tif (typeof args[0]?.Sender === \"number\") {\n\t\t\t\t\tC = getChatroomCharacter(args[0].Sender);\n\t\t\t\t}\n\t\t\t\tif (C && state.isEnforced && state.customData && C.MemberNumber != null && state.customData.whitelistedMembers.includes(C.MemberNumber)) {\n\t\t\t\t\tnoBlind = true;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tnoBlind = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"Player.GetBlindLevel\", 6, (args, next) => {\n\t\t\t\tif (noBlind)\n\t\t\t\t\treturn 0;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomUpdateDisplay\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\t\tif (ChatRoomCharacterCount === 1) {\n\t\t\t\t\t\tChatRoomCharacterDrawlist = [Player];\n\t\t\t\t\t}\n\t\t\t\t\tChatRoomSenseDepBypass = true;\n\t\t\t\t\tfor (const C of ChatRoomCharacter) {\n\t\t\t\t\t\tif (C.MemberNumber != null && !ChatRoomCharacterDrawlist.includes(C) && state.customData.whitelistedMembers.includes(C.MemberNumber)) {\n\t\t\t\t\t\t\tChatRoomCharacterDrawlist.push(C);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tChatRoomCharacterDrawlist.sort((a, b) => {\n\t\t\t\t\t\treturn ChatRoomCharacter.indexOf(a) - ChatRoomCharacter.indexOf(b);\n\t\t\t\t\t});\n\t\t\t\t\tChatRoomCharacterCount = ChatRoomCharacterDrawlist.length;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_eyes_fullblind\", {\n\t\tname: \"Fully blind when eyes are closed\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tlongDescription: \"This rule enforces full blindness when the eyes are closed. (Light sensory deprivation setting is still respected and doesn't blind fully)\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\ttick(state) {\n\t\t\tif (state.isEnforced) {\n\t\t\t\tDialogFacialExpressionsSelectedBlindnessLevel = 3;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"DialogClickExpressionMenu\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced && MouseIn(220, 50, 90, 90))\n\t\t\t\t\treturn;\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_blindfolds_fullblind\", {\n\t\tname: \"Fully blind when blindfolded\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tlongDescription: \"This rule enforces full blindness when wearing any item that limits sight in any way. (This rules does NOT respect Light sensory deprivation setting and always forces player to be fully blind)\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\thookFunction(\"Player.GetBlindLevel\", 2, (args, next) => {\n\t\t\t\tif (state.isEnforced && [\"BlindHeavy\", \"BlindNormal\", \"BlindLight\"].some(i => Player.Effect.includes(i) && !Player.Effect.includes(\"VRAvatars\")))\n\t\t\t\t\treturn 3;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"alt_always_slow\", {\n\t\tname: \"Always leave rooms slowly\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tlongDescription: \"This rule forces PLAYER_NAME to always leave the room slowly, independent of the items she is wearing. WARNING: Due to limitation in Bondage Club itself, only BCX users will be able to stop PLAYER_NAME from leaving the room.\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tinit(state) {\n\t\t\tregisterEffectBuilder(PlayerEffects => {\n\t\t\t\tif (state.isEnforced && !PlayerEffects.Effect.includes(\"Slow\")) {\n\t\t\t\t\tPlayerEffects.Effect.push(\"Slow\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_control_orgasms\", {\n\t\tname: \"Control ability to orgasm\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"adjustable: only-edge, only-ruin, no-resist\",\n\t\tlongDescription: \"This rule impacts PLAYER_NAME's ability to control their orgasms, independent of items. There are three control options, which are: Never cum (always edge, the bar never reaches 100%), force into ruined orgasm (orgasm screen starts, but doesn't let her actually cum) and prevent resisting orgasm (able to enter orgasm screen, but unable to resist it).\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\torgasmHandling: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\tdefault: \"edge\",\n\t\t\t\toptions: [[\"edge\", \"Edge\"], [\"ruined\", \"Ruin\"], [\"noResist\", \"Prevent resisting\"]],\n\t\t\t\tdescription: \"Orgasm attempts will be fixed to:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ServerSend\", 0, (args, next) => {\n\t\t\t\tif (args[0] === \"ChatRoomChat\" && isObject(args[1]) && typeof args[1].Content === \"string\" && args[1].Type === \"Activity\" && state.isEnforced) {\n\t\t\t\t\tif (args[1].Content.startsWith(\"OrgasmFailPassive\")) {\n\t\t\t\t\t\targs[1].Content = \"OrgasmFailPassive0\";\n\t\t\t\t\t} else if (args[1].Content.startsWith(\"OrgasmFailTimeout\")) {\n\t\t\t\t\t\targs[1].Content = \"OrgasmFailTimeout2\";\n\t\t\t\t\t} else if (args[1].Content.startsWith(\"OrgasmFailResist\")) {\n\t\t\t\t\t\targs[1].Content = \"OrgasmFailResist2\";\n\t\t\t\t\t} else if (args[1].Content.startsWith(\"OrgasmFailSurrender\")) {\n\t\t\t\t\t\targs[1].Content = \"OrgasmFailSurrender2\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t});\n\t\t\thookFunction(\"ActivityOrgasmPrepare\", 5, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (state.isEnforced && state.customData && C.ID === 0) {\n\t\t\t\t\tif (state.customData.orgasmHandling === \"edge\") {\n\t\t\t\t\t\tif (C.ArousalSettings) {\n\t\t\t\t\t\t\tC.ArousalSettings.Progress = 95;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (state.customData.orgasmHandling === \"ruined\") {\n\t\t\t\t\t\tconst backup = Player.Effect;\n\t\t\t\t\t\tPlayer.Effect = backup.concat(\"DenialMode\", \"RuinOrgasms\");\n\t\t\t\t\t\tnext(args);\n\t\t\t\t\t\tPlayer.Effect = backup;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (state.customData.orgasmHandling === \"noResist\") {\n\t\t\t\t\t\tActivityOrgasmGameResistCount = 496.5;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"alt_secret_orgasms\", {\n\t\tname: \"Secret orgasm progress\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"unable to see the own arousal meter\",\n\t\tlongDescription: \"This rule prevents PLAYER_NAME from seeing their own arousal meter, even while it is active and working. This means, that it is a surprise to them, when the orgasm (quick-time event) happens. Does not effect other characters being able to see the meter, if club settings allow that.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tload(state) {\n\t\t\thookFunction(\"DrawArousalMeter\", 5, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced)\n\t\t\t\t\treturn;\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t\thookFunction(\"ChatRoomClickCharacter\", 5, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tconst CharX = args[1];\n\t\t\t\tconst CharY = args[2];\n\t\t\t\tconst Zoom = args[3];\n\t\t\t\tif (C.ID === 0 && state.isEnforced && MouseIn(CharX + 60 * Zoom, CharY + 400 * Zoom, 80 * Zoom, 100 * Zoom) && !C.ArousalZoom) return;\n\t\t\t\tif (C.ID === 0 && state.isEnforced && MouseIn(CharX + 50 * Zoom, CharY + 200 * Zoom, 100 * Zoom, 500 * Zoom) && C.ArousalZoom) return;\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_room_admin_transfer\", {\n\t\tname: \"Room admin transfer\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"give admin to defined roles\",\n\t\tlongDescription: \"This rule lets you define a minimum role which PLAYER_NAME will automatically give room admin rights to (if she has admin rights in the room). Also has the option to remove admin rights from PLAYER_NAME afterwards.\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tminimumRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.owner,\n\t\t\t\tdescription: \"Minimum role that gets admin:\",\n\t\t\t\tY: 320\n\t\t\t},\n\t\t\tremoveAdminToggle: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Player loses admin afterwards\",\n\t\t\t\tY: 470\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tlet changed = false;\n\t\t\tif (state.isEnforced && state.customData && ChatRoomPlayerIsAdmin() && ServerPlayerIsInChatRoom()) {\n\t\t\t\tlet hasAdmin = false;\n\t\t\t\tfor (const character of getAllCharactersInRoom()) {\n\t\t\t\t\tif (!character.isPlayer() && getCharacterAccessLevel(character) <= state.customData.minimumRole) {\n\t\t\t\t\t\tif (ChatRoomData?.Admin?.includes(character.MemberNumber)) {\n\t\t\t\t\t\t\thasAdmin = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tServerSend(\"ChatRoomAdmin\", { MemberNumber: character.MemberNumber, Action: \"Promote\" });\n\t\t\t\t\t\t\tchanged = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!changed && hasAdmin && ChatRoomData && state.customData.removeAdminToggle) {\n\t\t\t\t\tconst UpdatedRoom = {\n\t\t\t\t\t\tName: ChatRoomData.Name,\n\t\t\t\t\t\tDescription: ChatRoomData.Description,\n\t\t\t\t\t\tBackground: ChatRoomData.Background,\n\t\t\t\t\t\tLimit: ChatRoomData.Limit.toString(),\n\t\t\t\t\t\tAdmin: ChatRoomData.Admin.filter((i: number) => i !== Player.MemberNumber),\n\t\t\t\t\t\tBan: ChatRoomData.Ban,\n\t\t\t\t\t\tBlockCategory: ChatRoomData.BlockCategory.slice(),\n\t\t\t\t\t\tGame: ChatRoomGame,\n\t\t\t\t\t\tPrivate: ChatRoomData.Private,\n\t\t\t\t\t\tLocked: ChatRoomData.Locked\n\t\t\t\t\t};\n\t\t\t\t\tServerSend(\"ChatRoomAdmin\", { MemberNumber: Player.ID, Room: UpdatedRoom, Action: \"Update\" });\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn changed;\n\t\t}\n\t});\n\n\tregisterRule(\"alt_room_admin_limit\", {\n\t\tname: \"Limit bound admin power\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"restrict room admin powers while restrained\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to do any room admin actions (except for kick/ban), when she is tied (meaning either being unable to use her hands or unable to leave the room). Tip: This rule can be combined with the rule to enforce joining the last room to trap her in it.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\ttriggerTexts: {\n\t\t\tattempt_infoBeep: \"You are forbidden from changing room settings while restrained\"\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ChatAdminLoad\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (state.isEnforced && ChatRoomPlayerIsAdmin() && Player.IsRestrained()) {\n\t\t\t\t\tdocument.getElementById(\"InputName\")?.setAttribute(\"disabled\", \"disabled\");\n\t\t\t\t\tdocument.getElementById(\"InputDescription\")?.setAttribute(\"disabled\", \"disabled\");\n\t\t\t\t\tdocument.getElementById(\"InputSize\")?.setAttribute(\"disabled\", \"disabled\");\n\t\t\t\t\tdocument.getElementById(\"InputAdminList\")?.setAttribute(\"disabled\", \"disabled\");\n\t\t\t\t}\n\t\t\t});\n\t\t\thookFunction(\"ChatAdminRun\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (state.isEnforced && ChatRoomPlayerIsAdmin() && Player.IsRestrained()) {\n\t\t\t\t\tDrawButton(100, 770, 250, 65, TextGet(\"AddOwnerAdminList\"), \"#ebebe4\", \"\", \"\", true);\n\t\t\t\t\tDrawButton(365, 770, 250, 65, TextGet(\"AddLoverAdminList\"), \"#ebebe4\", \"\", \"\", true);\n\t\t\t\t\tDrawBackNextButton(1300, 450, 500, 60, DialogFindPlayer(ChatAdminBackgroundSelect), \"#ebebe4\", \"\",\n\t\t\t\t\t\t() => DialogFindPlayer((ChatAdminBackgroundIndex === 0) ? ChatCreateBackgroundList[ChatCreateBackgroundList.length - 1] : ChatCreateBackgroundList[ChatAdminBackgroundIndex - 1]),\n\t\t\t\t\t\t() => DialogFindPlayer((ChatAdminBackgroundIndex >= ChatCreateBackgroundList.length - 1) ? ChatCreateBackgroundList[0] : ChatCreateBackgroundList[ChatAdminBackgroundIndex + 1]),\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t\tDrawButton(1840, 450, 60, 60, \"\", \"#ebebe4\", \"Icons/Small/Preference.png\", \"\", true);\n\t\t\t\t\tDrawBackNextButton(1625, 575, 275, 60, TextGet(\"Game\" + ChatAdminGame), \"#ebebe4\", \"\", () => \"\", () => \"\", true);\n\t\t\t\t\tDrawButton(1486, 708, 64, 64, \"\", \"#ebebe4\", ChatAdminPrivate ? \"Icons/Checked.png\" : \"\", \"\", true);\n\t\t\t\t\tDrawButton(1786, 708, 64, 64, \"\", \"#ebebe4\", ChatAdminLocked ? \"Icons/Checked.png\" : \"\", \"\", true);\n\t\t\t\t\tMainCanvas.fillStyle = \"#ffff88\";\n\t\t\t\t\tMainCanvas.fillRect(100, 850, 1125, 70);\n\t\t\t\t\tMainCanvas.strokeStyle = \"Black\";\n\t\t\t\t\tMainCanvas.strokeRect(100, 850, 1125, 70);\n\t\t\t\t\tDrawText(\"Some settings are not available due to a BCX rule.\", 650, 885, \"Black\", \"Gray\");\n\t\t\t\t}\n\t\t\t});\n\t\t\thookFunction(\"ChatAdminClick\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced && ChatRoomPlayerIsAdmin() && Player.IsRestrained() && (\n\t\t\t\t\tMouseIn(1300, 75, 600, 350) ||\n\t\t\t\t\tMouseIn(1840, 450, 60, 60) ||\n\t\t\t\t\tMouseIn(1300, 450, 500, 60) ||\n\t\t\t\t\tMouseIn(1625, 575, 275, 60) ||\n\t\t\t\t\tMouseIn(1486, 708, 64, 64) ||\n\t\t\t\t\tMouseIn(1786, 708, 64, 64) ||\n\t\t\t\t\tMouseIn(100, 770, 250, 65) ||\n\t\t\t\t\tMouseIn(365, 770, 250, 65)\n\t\t\t\t))\n\t\t\t\t\treturn;\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t\thookFunction(\"CommonSetScreen\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced && args[0] === \"Online\" && args[1] === \"ChatBlockItem\" && ChatRoomPlayerIsAdmin() && Player.IsRestrained()) {\n\t\t\t\t\tChatBlockItemEditable = false;\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t\thookFunction(\"ChatRoomAdminAction\", 5, (args, next) => {\n\t\t\t\tconst ActionType = args[1] as string;\n\t\t\t\tif (state.isEnforced && Player.IsRestrained() &&\n\t\t\t\t\tActionType !== \"Kick\" && ActionType !== \"Ban\"\n\t\t\t\t) {\n\t\t\t\t\tInfoBeep(`BCX: You are not allowed to use this while restrained.`, 7_000);\n\t\t\t\t\tDialogLeave();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_set_profile_description\", {\n\t\tname: \"Control profile online description\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"directly sets PLAYER_NAME's description\",\n\t\tlongDescription: \"This rule sets PLAYER_NAME's online description (in her profile) to any text entered in the rule config, blocking changes to it. Warning: This rule is editing the actual profile text. This means that after saving a changed text, the original text is lost!\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tplayersProfileDescription: {\n\t\t\t\ttype: \"textArea\",\n\t\t\t\tdefault: () => (Player.Description || \"\"),\n\t\t\t\tdescription: \"Edit this player's profile description:\"\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\tif (Player.Description !== state.customData.playersProfileDescription) {\n\t\t\t\t\tlet Description = Player.Description = state.customData.playersProfileDescription;\n\t\t\t\t\tconst CompressedDescription = \"\" + LZString.compressToUTF16(Description);\n\t\t\t\t\tif (CompressedDescription.length < Description.length || Description.startsWith(\"\")) {\n\t\t\t\t\t\tDescription = CompressedDescription;\n\t\t\t\t\t}\n\t\t\t\t\tServerAccountUpdate.QueueData({ Description });\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\tregisterRule(\"alt_force_suitcase_game\", {\n\t\tname: \"Always carry a suitcase\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"from the kidnappers league multiplayer game\",\n\t\tlongDescription: \"This rule forces PLAYER_NAME to constantly participate in the kidnappers league's suitcase delivery task, by automatically giving her a new suitcase, whenever the suitcase item slot is empty.\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\ttick(state) {\n\t\t\tconst misc = InventoryGet(Player, \"ItemMisc\");\n\t\t\tif (state.isEnforced && ReputationGet(\"Kidnap\") > 0 && Player.CanTalk() && !misc) {\n\t\t\t\tKidnapLeagueOnlineBountyStart();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\tregisterRule(\"alt_restrict_leashability\", {\n\t\tname: \"Restrict being leashed by others\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tlongDescription: \"This rule only allows selected roles to leash PLAYER_NAME, responding with a message about unsuccessful leashing to others when they attempt to do so.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\tminimumRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.owner,\n\t\t\t\tdescription: \"Minimum role that is allowed to leash:\",\n\t\t\t\tY: 320\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomCanBeLeashedBy\", 4, (args, next) => {\n\t\t\t\tconst sourceMemberNumber = args[0] as number;\n\t\t\t\tif (sourceMemberNumber !== 0 &&\n\t\t\t\t\tsourceMemberNumber !== Player.MemberNumber &&\n\t\t\t\t\tstate.isEnforced &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\tgetCharacterAccessLevel(sourceMemberNumber) > state.customData.minimumRole\n\t\t\t\t) {\n\t\t\t\t\tChatRoomActionMessage(`${Player.Name}'s leash seems to be cursed and slips out of ${getCharacterName(sourceMemberNumber, \"[unknown]\")}'s hand.`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_hide_friends\", {\n\t\tname: \"Hide online friends if blind\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"also preventing beeps from the friendlist - exceptions settable\",\n\t\tlongDescription: \"This rule hides persons on PLAYER_NAME's friend list when she is fully blinded, which also makes sending beeps impossible. Received beeps can still be answered. The rule allows to manage a list of members who can be seen normally.\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tallowedMembers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Members numbers that can always be seen:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tpatchFunction(\"FriendListLoadFriendList\", {\n\t\t\t\t'data.forEach(friend => {': 'data.forEach(friend => { if (typeof friend.MemberNumber !== \"number\") return;'\n\t\t\t});\n\t\t\tpatchFunction(\"FriendListLoadFriendList\", {\n\t\t\t\t\"FriendListContent += `<div class='FriendListLinkColumn' onClick='FriendListBeep(${friend.MemberNumber})'> ${BeepCaption} </div>`;\": \"if (typeof friend.MemberNumber === 'number') FriendListContent += `<div class='FriendListLinkColumn' onClick='FriendListBeep(${friend.MemberNumber})'> ${BeepCaption} </div>`;\"\n\t\t\t});\n\t\t\thookFunction(\"FriendListLoadFriendList\", 1, (args, next) => {\n\t\t\t\tconst data = args[0];\n\t\t\t\tconst allowList = state.customData?.allowedMembers;\n\t\t\t\tif (state.isEnforced && allowList && Player.GetBlindLevel() >= 3) {\n\t\t\t\t\tdata.forEach((friend: any) => {\n\t\t\t\t\t\tif (!allowList.includes(friend.MemberNumber)) {\n\t\t\t\t\t\t\tfriend.MemberName = \"Someone\";\n\t\t\t\t\t\t\tfriend.MemberNumber = \"######\";\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"alt_forced_summoning\", {\n\t\tname: \"Ready to be summoned\",\n\t\ticon: \"Icons/Swap.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"leash PLAYER_NAME from anywhere using a beep with message\",\n\t\tlongDescription: \"This rule forces PLAYER_NAME to switch rooms from anywhere in the club to the chat room of the summoner after 15 seconds. It works by sending a beep message with the set text or simply the word 'summon' to PLAYER_NAME. Members who are allowed to summon PLAYER_NAME can be set. NOTES: PLAYER_NAME can always be summoned no matter if she has a leash or is prevented from leaving the room (ignoring restraints or locked rooms). However, if the target room is full or locked, she will end up in the lobby. Summoning will not work if the room name is not included with the beep message!\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are summoned by SUMMONER!\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tallowedMembers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Members numbers allowed to summon:\",\n\t\t\t\tY: 325,\n\t\t\t\toptions: {\n\t\t\t\t\tpageSize: 1\n\t\t\t\t}\n\t\t\t},\n\t\t\tsummoningText: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"Come to my room immediately\",\n\t\t\t\tdescription: \"The text used for summoning:\",\n\t\t\t\tY: 705\n\t\t\t},\n\t\t\tsummonTime: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 15,\n\t\t\t\tdescription: \"Time in seconds before enforcing summon:\",\n\t\t\t\tY: 550\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tlet beep = false;\n\t\t\thookFunction(\"ServerAccountBeep\", 7, (args, next) => {\n\t\t\t\tconst data = args[0];\n\n\t\t\t\tif (isObject(data) &&\n\t\t\t\t\t!data.BeepType &&\n\t\t\t\t\ttypeof data.MemberNumber === \"number\" &&\n\t\t\t\t\tstate.isEnforced &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\tstate.customData.allowedMembers.includes(data.MemberNumber) &&\n\t\t\t\t\ttypeof data.Message === \"string\" &&\n\t\t\t\t\t(data.Message.toLocaleLowerCase().startsWith(state.customData.summoningText.toLocaleLowerCase()) || data.Message.toLocaleLowerCase() === \"summon\") &&\n\t\t\t\t\tdata.ChatRoomName\n\t\t\t\t) {\n\t\t\t\t\tChatRoomActionMessage(`${Player.Name} received a summon: \"${state.customData.summoningText}\".`);\n\t\t\t\t\tbeep = true;\n\t\t\t\t\tBCX_setTimeout(() => {\n\t\t\t\t\t\t// Check if rule is still in effect or if we are already there\n\t\t\t\t\t\tif (!state.isEnforced || ChatRoomData.Name === data.ChatRoomName) return;\n\n\t\t\t\t\t\t// leave\n\t\t\t\t\t\tChatRoomActionMessage(`The demand for ${Player.Name}'s presence is now enforced.`);\n\t\t\t\t\t\tDialogLentLockpicks = false;\n\t\t\t\t\t\tChatRoomClearAllElements();\n\t\t\t\t\t\tServerSend(\"ChatRoomLeave\", \"\");\n\t\t\t\t\t\tChatRoomSetLastChatRoom(\"\");\n\t\t\t\t\t\tChatRoomLeashPlayer = null;\n\t\t\t\t\t\tCommonSetScreen(\"Online\", \"ChatSearch\");\n\t\t\t\t\t\tCharacterDeleteAllOnline();\n\n\t\t\t\t\t\t// join\n\t\t\t\t\t\tChatRoomPlayerCanJoin = true;\n\t\t\t\t\t\tServerSend(\"ChatRoomJoin\", { Name: data.ChatRoomName });\n\t\t\t\t\t}, state.customData.summonTime * 1000);\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t\tif (beep) state.triggerAttempt({ SUMMONER: `${data.MemberName} (${data.MemberNumber})` });\n\t\t\t\tbeep = false;\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n}\n","import { allowMode, isNModClient } from \"../utilsClub\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction, patchFunction } from \"../patching\";\nimport { MiscCheat } from \"../constants\";\nimport { modStorage, modStorageSync } from \"./storage\";\n\nexport const cheatChangeHooks: Partial<Record<MiscCheat, (enabled: boolean) => void>> = {};\n\nexport function cheatIsEnabled(cheat: MiscCheat): boolean {\n\treturn Array.isArray(modStorage.cheats) && modStorage.cheats.includes(cheat);\n}\n\nexport function cheatSetEnabled(cheat: MiscCheat, enabled: boolean) {\n\tif (!Array.isArray(modStorage.cheats)) {\n\t\tconsole.error(`BCX: Attempt to set cheat, while not initalized`);\n\t\treturn;\n\t}\n\n\tif (enabled) {\n\t\tif (!modStorage.cheats.includes(cheat)) {\n\t\t\tmodStorage.cheats.push(cheat);\n\t\t}\n\t} else {\n\t\tmodStorage.cheats = modStorage.cheats.filter(c => c !== cheat);\n\t}\n\tif (cheatChangeHooks[cheat]) {\n\t\tcheatChangeHooks[cheat]!(enabled);\n\t}\n\tmodStorageSync();\n}\n\nexport function cheatToggle(cheat: MiscCheat) {\n\tcheatSetEnabled(cheat, !cheatIsEnabled(cheat));\n}\n\nconst MISTRESS_CHEAT_ONLY_ITEMS = [\"MistressPadlock\", \"MistressPadlockKey\", \"MistressTimerPadlock\"];\nconst PANDORA_CHEAT_ONLY_ITEMS = [\"PandoraPadlock\", \"PandoraPadlockKey\"];\n\nconst PlayerDialogOverrides: Map<string, string> = new Map();\n\nexport function OverridePlayerDialog(keyword: string, value: string) {\n\tPlayerDialogOverrides.set(keyword, value);\n}\n\nconst GetImageRedirects: Map<string, string> = new Map();\n\nexport function RedirectGetImage(original: string, redirect: string) {\n\tGetImageRedirects.set(original, redirect);\n}\n\n/**\n * Function to handle clicks on dialog menu buttons (the buttons on top right when you click character)\n * @returns `false` if original should still be called, `true` if it should be blocked\n */\nexport type DialogMenuButtonClickHook = (C: Character) => boolean;\n\nconst DialogMenuButtonClickHooks: Map<string, DialogMenuButtonClickHook[]> = new Map();\n\nexport function HookDialogMenuButtonClick(button: string, fn: DialogMenuButtonClickHook) {\n\tlet arr = DialogMenuButtonClickHooks.get(button);\n\tif (!arr) {\n\t\tarr = [];\n\t\tDialogMenuButtonClickHooks.set(button, arr);\n\t}\n\tif (!arr.includes(fn)) {\n\t\tarr.push(fn);\n\t}\n}\n\nexport class ModuleMiscPatches extends BaseModule {\n\tload() {\n\t\tif (!Array.isArray(modStorage.cheats)) {\n\t\t\tmodStorage.cheats = [];\n\t\t} else {\n\t\t\tmodStorage.cheats = modStorage.cheats.filter(c => MiscCheat[c] !== undefined);\n\t\t}\n\n\t\thookFunction(\"DialogFindPlayer\", 10, (args, next) => {\n\t\t\tconst override = PlayerDialogOverrides.get(args[0]);\n\t\t\tif (override !== undefined)\n\t\t\t\treturn override;\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"DrawGetImage\", 10, (args, next) => {\n\t\t\tconst redirect = GetImageRedirects.get(args[0]);\n\t\t\tif (redirect !== undefined) {\n\t\t\t\targs[0] = redirect;\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"DialogMenuButtonClick\", 5, (args, next) => {\n\t\t\t// Finds the current icon\n\t\t\tconst C = CharacterGetCurrent();\n\t\t\tfor (let I = 0; I < DialogMenuButton.length; I++) {\n\t\t\t\tif ((MouseX >= 1885 - I * 110) && (MouseX <= 1975 - I * 110) && C) {\n\t\t\t\t\tconst hooks = DialogMenuButtonClickHooks.get(DialogMenuButton[I]);\n\t\t\t\t\tif (hooks?.some(hook => hook(C)))\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"AsylumEntranceCanWander\", 0, () => true);\n\n\t\thookFunction(\"ElementIsScrolledToEnd\", 0, (args) => {\n\t\t\tconst element = document.getElementById(args[0]);\n\t\t\treturn element != null && element.scrollHeight - element.scrollTop - element.clientHeight <= 1;\n\t\t});\n\n\t\thookFunction(\"CheatFactor\", 1, (args, next) => {\n\t\t\tconst [CheatName, Factor] = args as [string, number];\n\n\t\t\tif (CheatName === \"CantLoseMistress\" && cheatIsEnabled(MiscCheat.CantLoseMistress)) {\n\t\t\t\treturn Factor;\n\t\t\t} else if (CheatName === \"BlockRandomKidnap\" && cheatIsEnabled(MiscCheat.BlockRandomEvents)) {\n\t\t\t\treturn Factor;\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"PrivateRansomStart\", 0, (args, next) => {\n\t\t\tif (cheatIsEnabled(MiscCheat.BlockRandomEvents))\n\t\t\t\treturn false;\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"MainHallWalk\", 0, (args, next) => {\n\t\t\tif (cheatIsEnabled(MiscCheat.BlockRandomEvents)) {\n\t\t\t\tMainHallRandomEventOdds = 0;\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\tconst NMod = isNModClient();\n\n\t\tif (!NMod) {\n\t\t\tpatchFunction(\"LoginMistressItems\", { 'LogQuery(\"ClubMistress\", \"Management\")': \"true\" });\n\t\t\thookFunction(\"LoginMistressItems\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (!cheatIsEnabled(MiscCheat.GiveMistressKey) && !LogQuery(\"ClubMistress\", \"Management\")) {\n\t\t\t\t\tfor (const item of MISTRESS_CHEAT_ONLY_ITEMS) {\n\t\t\t\t\t\tInventoryDelete(Player, item, \"ItemMisc\", false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tcheatChangeHooks[MiscCheat.GiveMistressKey] = () => {\n\t\t\t\tLoginMistressItems();\n\t\t\t\tServerPlayerInventorySync();\n\t\t\t};\n\n\t\t\tpatchFunction(\"LoginStableItems\", { 'LogQuery(\"JoinedStable\", \"PonyExam\") || LogQuery(\"JoinedStable\", \"TrainerExam\")': \"true\" });\n\t\t}\n\n\t\tcheatChangeHooks[MiscCheat.GivePandoraKey] = enabled => {\n\t\t\tfor (const item of PANDORA_CHEAT_ONLY_ITEMS) {\n\t\t\t\tif (enabled) {\n\t\t\t\t\tInventoryAdd(Player, item, \"ItemMisc\", false);\n\t\t\t\t} else {\n\t\t\t\t\tInventoryDelete(Player, item, \"ItemMisc\", false);\n\t\t\t\t}\n\t\t\t}\n\t\t\tServerPlayerInventorySync();\n\t\t};\n\n\t\thookFunction(\"InfiltrationStealItems\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tif (cheatIsEnabled(MiscCheat.GivePandoraKey)) {\n\t\t\t\tcheatChangeHooks[MiscCheat.GivePandoraKey]!(true);\n\t\t\t}\n\t\t});\n\n\t\t// Cheats\n\n\t\thookFunction(\"Player.CanChange\", 1, (args, next) => allowMode || next(args));\n\t\thookFunction(\"ChatRoomCanLeave\", 0, (args, next) => allowMode || next(args));\n\n\t\t// Anti-stupid-null\n\n\t\thookFunction(\"DrawCharacter\", 100, (args, next) => {\n\t\t\tif (args[0] != null)\n\t\t\t\treturn next(args);\n\t\t});\n\n\t\tpatchFunction(\"DrawGetImage\", {\n\t\t\t'Img.src = Source;': 'Img.crossOrigin = \"Anonymous\";\\n\\t\\tImg.src = Source;'\n\t\t});\n\n\t\t// fixes a bug in BC\n\t\thookFunction(\"ServerPlayerIsInChatRoom\", 0, (args, next) => {\n\t\t\treturn next(args) || CurrentScreen === \"GetUp\";\n\t\t});\n\t}\n\n\trun() {\n\t\tLoginMistressItems();\n\t\tLoginStableItems();\n\t\tif (cheatIsEnabled(MiscCheat.GivePandoraKey)) {\n\t\t\tcheatChangeHooks[MiscCheat.GivePandoraKey]!(true);\n\t\t}\n\t\tServerPlayerInventorySync();\n\t}\n}\n","import { ModuleCategory, ConditionsLimit } from \"../constants\";\nimport { HookDialogMenuButtonClick as hookDialogMenuButtonClick, OverridePlayerDialog, RedirectGetImage } from \"../modules/miscPatches\";\nimport { registerRule } from \"../modules/rules\";\nimport { hookFunction } from \"../patching\";\nimport { icon_restrictions } from \"../resources\";\nimport { isNModClient, getCharacterName } from \"../utilsClub\";\nimport { AccessLevel, getCharacterAccessLevel } from \"../modules/authority\";\nimport { getAllCharactersInRoom } from \"../characters\";\n\nexport function initRules_bc_blocks() {\n\tconst NMod = isNModClient();\n\n\tregisterRule(\"block_remoteuse_self\", {\n\t\tname: \"Forbid using remotes on self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME using one on PLAYER_NAME\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use or trigger a vibrator or similar remote controlled item on her own body. (Others still can use remotes on her)\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use a remote control for items on your body!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use a remote control on her own body, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used a remote control on her own body, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_RemoteDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Remote.png\", \"Icons/Remote.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"Remote\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_RemoteDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Remote\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_RemoteDisabled\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_remoteuse_others\", {\n\t\tname: \"Forbid using remotes on others\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use or trigger a vibrator or similar remote controlled item on other club members.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use a remote control on other's items!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use a remote control on TARGET_PLAYER's body, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used a remote control on TARGET_PLAYER's body, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_RemoteDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Remote.png\", \"Icons/Remote.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID !== 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"Remote\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_RemoteDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Remote\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_RemoteDisabled\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_keyuse_self\", {\n\t\tname: \"Forbid using keys on self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME using one on PLAYER_NAME\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to unlock any locked item on her own body. Note: Despite the name, this rule also blocks unlocking locks that don't require a key (e.g. exclusive lock). However, locks that can be unlocked in other ways (timer locks by removing time, code/password locks by entering correct code) can still be unlocked by PLAYER_NAME. Others can still unlock her items on her normally.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use a key on items on your body!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use a key on a worn item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used a key on a worn item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_UnlockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Unlock.png\", \"Icons/Unlock.png\");\n\t\t\thookFunction(\"DialogCanUnlock\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced)\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced && DialogMenuButton.includes(\"InspectLock\")) {\n\t\t\t\t\tDialogMenuButton.splice(-1, 0, \"BCX_UnlockDisabled\");\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Unlock\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_UnlockDisabled\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_keyuse_others\", {\n\t\tname: \"Forbid using keys on others\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to unlock any locked item on other club members, with options to still allow unlocking of owner and/or lover locks and items. Note: Despite the name, this rule also blocks unlocking locks that don't require a key (e.g. exclusive lock). However, locks that can be unlocked in other ways (timer locks by removing time, code/password locks by entering correct code) can still be unlocked by PLAYER_NAME.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use a key on other's items!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use a key to unlock TARGET_PLAYER's item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used a key to unlock TARGET_PLAYER's item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tallowOwnerLocks: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Still allow unlocking owner locks or items\"\n\t\t\t},\n\t\t\tallowLoverLocks: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Still allow unlocking lover locks or items\",\n\t\t\t\tY: 530\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tlet ignore = false;\n\t\t\tOverridePlayerDialog(\"BCX_UnlockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Unlock.png\", \"Icons/Unlock.png\");\n\t\t\thookFunction(\"DialogCanUnlock\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tconst Item = args[1] as Item;\n\t\t\t\tconst lock = InventoryGetLock(Item);\n\t\t\t\tif (state.customData &&\n\t\t\t\t\tC.ID !== 0 &&\n\t\t\t\t\tItem != null &&\n\t\t\t\t\tItem.Asset != null &&\n\t\t\t\t\t(\n\t\t\t\t\t\t(state.customData.allowOwnerLocks && (Item.Asset.OwnerOnly || lock?.Asset.OwnerOnly) && C.IsOwnedByPlayer()) ||\n\t\t\t\t\t\t(state.customData.allowLoverLocks && (Item.Asset.LoverOnly || lock?.Asset.LoverOnly) && C.IsLoverOfPlayer())\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tignore = true;\n\t\t\t\t\treturn next(args);\n\t\t\t\t}\n\t\t\t\tignore = false;\n\t\t\t\tif (C.ID !== 0 && state.isEnforced)\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (!ignore) {\n\t\t\t\t\tconst C = args[0] as Character;\n\t\t\t\t\tif (C.ID !== 0 && state.isEnforced && DialogMenuButton.includes(\"InspectLock\")) {\n\t\t\t\t\t\tDialogMenuButton.splice(-1, 0, \"BCX_UnlockDisabled\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Unlock\", (C) => {\n\t\t\t\tif (!ignore && C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_UnlockDisabled\", (C) => {\n\t\t\t\tif (!ignore && C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_lockpicking_self\", {\n\t\tname: \"Forbid picking locks on self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME picking one on PLAYER_NAME\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to lockpick any locked items on her own body. (Others still can pick locks on her normally)\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to lockpick worn items on your body!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to lockpick a worn item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME lockpicked a worn item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_PickLockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_PickLock.png\", \"Icons/PickLock.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"PickLock\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_PickLockDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"PickLock\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_PickLockDisabled\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_lockpicking_others\", {\n\t\tname: \"Forbid picking locks on others\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to lockpick any locked items on other club members.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to lockpick items on others!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to lockpick an item on TARGET_PLAYER, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME lockpicked an item on TARGET_PLAYER, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_PickLockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_PickLock.png\", \"Icons/PickLock.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID !== 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"PickLock\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_PickLockDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"PickLock\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_PickLockDisabled\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_lockuse_self\", {\n\t\tname: \"Forbid using locks on self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME using one on PLAYER_NAME\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use any kind of lock on her own body. (Others still can add locks on her items normally)\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to lock items on your body!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to lock a worn item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME locked a worn item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_LockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Lock.png\", \"Icons/Lock.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"Lock\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_LockDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Lock\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_LockDisabled\", (C) => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_lockuse_others\", {\n\t\tname: \"Forbid using locks on others\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use any kind of lock on other club members.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to lock other's items!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to lock TARGET_PLAYER's item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME locked TARGET_PLAYER's item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_LockDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Lock.png\", \"Icons/Lock.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID !== 0 && state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"Lock\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_LockDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookDialogMenuButtonClick(\"Lock\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\thookDialogMenuButtonClick(\"BCX_LockDisabled\", (C) => {\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\t});\n\n\t// TODO: Make it clearer it is blocked by BCX\n\tregisterRule(\"block_wardrobe_access_self\", {\n\t\tname: \"Forbid wardrobe use on self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME using PLAYER_NAME's wardrobe\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to access her own wardrobe. (Others still can change her clothes normally)\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to change what you are wearing!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use their wardrobe, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used their wardrobe, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\thookFunction(\"Player.CanChange\", 2, (args, next) => {\n\t\t\t\treturn !state.isEnforced && next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"CharacterAppearanceLoadCharacter\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\t// TODO: Make it clearer it is blocked by BCX\n\tregisterRule(\"block_wardrobe_access_others\", {\n\t\tname: \"Forbid wardrobe use on others\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use the wardrobe of other club members.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to change what others wear!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use TARGET_PLAYER's wardrobe, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used TARGET_PLAYER's wardrobe, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomCanChangeClothes\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced)\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"CharacterAppearanceLoadCharacter\", 0, (args, next) => {\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID !== 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"block_restrict_allowed_poses\", {\n\t\tname: \"Restrict allowed body poses\",\n\t\ticon: icon_restrictions,\n\t\tloggable: false,\n\t\tlongDescription: \"Allows to restrict the body poses PLAYER_NAME is able to get into by herself.\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tposeButtons: {\n\t\t\t\ttype: \"poseSelect\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Mark poses as being allowed or forbidden:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tlet bypassPoseChange = false;\n\t\t\thookFunction(\"CharacterCanChangeToPose\", 3, (args, next) => {\n\t\t\t\tif (!bypassPoseChange && state.isEnforced && state.customData?.poseButtons.includes(args[1]))\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomCanAttemptStand\", 3, (args, next) => {\n\t\t\t\tif (state.isEnforced && state.customData?.poseButtons.includes(\"BaseLower\"))\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomCanAttemptKneel\", 3, (args, next) => {\n\t\t\t\tif (state.isEnforced && state.customData?.poseButtons.includes(\"Kneel\"))\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"CharacterCanKneel\", 3, (args, next) => {\n\t\t\t\tif (state.isEnforced && state.customData?.poseButtons.includes(\"Kneel\") && !Player.IsKneeling())\n\t\t\t\t\treturn false;\n\t\t\t\tif (state.isEnforced && state.customData?.poseButtons.includes(\"BaseLower\") && Player.IsKneeling())\n\t\t\t\t\treturn false;\n\t\t\t\tbypassPoseChange = true;\n\t\t\t\tconst res = next(args);\n\t\t\t\tbypassPoseChange = false;\n\t\t\t\treturn res;\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\t// TODO: Triggers on opening chat create *window*, improve to trigger on actual room creation\n\tregisterRule(\"block_creating_rooms\", {\n\t\tname: \"Forbid creating new rooms\",\n\t\ticon: icon_restrictions,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to create new rooms.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to create a new room!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to create a chatroom, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME created a chatroom, which was forbidden\",\n\t\t\tannounce: \"\",\n\t\t\tattempt_announce: \"\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\t// TODO: Fix for NMod\n\t\t\tif (!NMod) {\n\t\t\t\thookFunction(\"ChatSearchRun\", 0, (args, next) => {\n\t\t\t\t\tnext(args);\n\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\tDrawButton(1280, 898, 280, 64, TextGet(\"CreateRoom\"), \"Gray\", undefined, \"Blocked by BCX\", true);\n\t\t\t\t\t}\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t}\n\t\t\thookFunction(\"CommonSetScreen\", 5, (args, next) => {\n\t\t\t\tif (args[0] === \"Online\" && args[1] === \"ChatCreate\") {\n\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (state.inEffect) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\t// TODO: Triggers on attempting to enter room, improve to trigger on actual room entry\n\tregisterRule(\"block_entering_rooms\", {\n\t\tname: \"Restrict entering rooms\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"only allow entering specific ones\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to enter all rooms, that are not on an editable whitelist of still allowed ones. NOTE: As safety measure this rule is not in effect while the list is empty. TIP: This rule can be combined with the rule \\\"Forbid creating new rooms\\\".\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to enter this room!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to enter a forbidden room\",\n\t\t\tlog: \"PLAYER_NAME entered a forbidden room\",\n\t\t\tattempt_announce: \"\",\n\t\t\tannounce: \"PLAYER_NAME violated a rule to not enter this room\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\troomList: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Only joining rooms with these names is allowed:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\t// TODO: Fix for NMod\n\t\t\tif (!NMod) {\n\t\t\t\thookFunction(\"ChatSearchJoin\", 5, (args, next) => {\n\t\t\t\t\tif (state.inEffect && state.customData && state.customData.roomList.length > 0) {\n\t\t\t\t\t\t// Scans results\n\t\t\t\t\t\tlet X = 25;\n\t\t\t\t\t\tlet Y = 25;\n\t\t\t\t\t\tfor (let C = ChatSearchResultOffset; C < ChatSearchResult.length && C < (ChatSearchResultOffset + 24); C++) {\n\t\t\t\t\t\t\t// If the player clicked on a valid room\n\t\t\t\t\t\t\tif (MouseIn(X, Y, 630, 85)) {\n\t\t\t\t\t\t\t\tif (!state.customData.roomList.some(name => name.toLocaleLowerCase() === ChatSearchResult[C].Name.toLocaleLowerCase())) {\n\t\t\t\t\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Moves the next window position\n\t\t\t\t\t\t\tX += 660;\n\t\t\t\t\t\t\tif (X > 1500) {\n\t\t\t\t\t\t\t\tX = 25;\n\t\t\t\t\t\t\t\tY += 109;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tnext(args);\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t\thookFunction(\"ChatSearchNormalDraw\", 5, (args, next) => {\n\t\t\t\t\tnext(args);\n\t\t\t\t\tif (state.isEnforced && state.customData && state.customData.roomList.length > 0) {\n\t\t\t\t\t\t// Scans results\n\t\t\t\t\t\tlet X = 25;\n\t\t\t\t\t\tlet Y = 25;\n\t\t\t\t\t\tfor (let C = ChatSearchResultOffset; C < ChatSearchResult.length && C < (ChatSearchResultOffset + 24); C++) {\n\t\t\t\t\t\t\tif (!state.customData.roomList.some(name => name.toLocaleLowerCase() === ChatSearchResult[C].Name.toLocaleLowerCase())) {\n\t\t\t\t\t\t\t\tDrawButton(X, Y, 630, 85, \"\", \"#88c\", undefined, \"Blocked by BCX\", true);\n\t\t\t\t\t\t\t\tDrawTextFit((ChatSearchResult[C].Friends != null && ChatSearchResult[C].Friends.length > 0 ? \"(\" + ChatSearchResult[C].Friends.length + \") \" : \"\") + ChatSearchMuffle(ChatSearchResult[C].Name) + \" - \" + ChatSearchMuffle(ChatSearchResult[C].Creator) + \" \" + ChatSearchResult[C].MemberCount + \"/\" + ChatSearchResult[C].MemberLimit + \"\", X + 315, Y + 25, 620, \"black\");\n\t\t\t\t\t\t\t\tDrawTextFit(ChatSearchMuffle(ChatSearchResult[C].Description), X + 315, Y + 62, 620, \"black\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Moves the next window position\n\t\t\t\t\t\t\tX += 660;\n\t\t\t\t\t\t\tif (X > 1500) {\n\t\t\t\t\t\t\t\tX = 25;\n\t\t\t\t\t\t\t\tY += 109;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterRule(\"block_leaving_room\", {\n\t\tname: \"Prevent leaving the room\",\n\t\ticon: icon_restrictions,\n\t\tloggable: false,\n\t\tshortDescription: \"while defined roles are inside\",\n\t\tlongDescription: \"This rule prevents PLAYER_NAME from leaving the room they are currently inside while at least one character with the set minimum role or a higher one is present inside. NOTE: Careful when setting the minimum role too low. If it is set to public for instance, it would mean that PLAYER_NAME can only leave the room when they are alone in it.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"Someone's presence does not allowed you to leave!\",\n\t\t\tattempt_announce: \"PLAYER_NAME violated a rule by trying to leave this room\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tminimumRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.mistress,\n\t\t\t\tdescription: \"Minimum role preventing room leaving:\",\n\t\t\t\tY: 320\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tconst active = (): boolean => state.isEnforced &&\n\t\t\t\t!!state.customData &&\n\t\t\t\tgetAllCharactersInRoom()\n\t\t\t\t\t.some(c => !c.isPlayer() && getCharacterAccessLevel(c) <= state.customData!.minimumRole);\n\n\t\t\thookFunction(\"ChatRoomCanLeave\", 6, (args, next) => {\n\t\t\t\tif (active())\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomMenuClick\", 6, (args, next) => {\n\t\t\t\tconst Space = 870 / (ChatRoomMenuButtons.length - 1);\n\t\t\t\tfor (let B = 0; B < ChatRoomMenuButtons.length; B++) {\n\t\t\t\t\tif (MouseXIn(1005 + Space * B, 120) && ChatRoomMenuButtons[B] === \"Exit\" && active()) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"block_freeing_self\", {\n\t\tname: \"Forbid freeing self\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME removing any items from PLAYER_NAME's body\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to remove any items from her own body. Other people can still remove them.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to remove an item from your body!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to remove a worn item, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME removed a worn item, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_RemoveDisabled\", \"Usage blocked by BCX\");\n\t\t\tOverridePlayerDialog(\"BCX_StruggleDisabled\", \"Usage blocked by BCX\");\n\t\t\tOverridePlayerDialog(\"BCX_DismountDisabled\", \"Usage blocked by BCX\");\n\t\t\tOverridePlayerDialog(\"BCX_EscapeDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Remove.png\", \"Icons/Remove.png\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Struggle.png\", \"Icons/Struggle.png\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Dismount.png\", \"Icons/Dismount.png\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Escape.png\", \"Icons/Escape.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C.ID === 0 && state.isEnforced) {\n\t\t\t\t\tconst index_remove = DialogMenuButton.indexOf(\"Remove\");\n\t\t\t\t\tconst index_struggle = DialogMenuButton.indexOf(\"Struggle\");\n\t\t\t\t\tconst index_dismount = DialogMenuButton.indexOf(\"Dismount\");\n\t\t\t\t\tconst index_escape = DialogMenuButton.indexOf(\"Escape\");\n\t\t\t\t\tif (index_remove >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index_remove] = \"BCX_RemoveDisabled\";\n\t\t\t\t\t}\n\t\t\t\t\tif (index_struggle >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index_struggle] = \"BCX_StruggleDisabled\";\n\t\t\t\t\t}\n\t\t\t\t\tif (index_dismount >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index_dismount] = \"BCX_DismountDisabled\";\n\t\t\t\t\t}\n\t\t\t\t\tif (index_escape >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index_escape] = \"BCX_EscapeDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\tconst trigger = (C: Character): boolean => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\tconst attempt = (C: Character): boolean => {\n\t\t\t\tif (C.ID === 0 && state.inEffect) {\n\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\thookDialogMenuButtonClick(\"Remove\", trigger);\n\t\t\thookDialogMenuButtonClick(\"BCX_RemoveDisabled\", attempt);\n\t\t\thookDialogMenuButtonClick(\"Struggle\", trigger);\n\t\t\thookDialogMenuButtonClick(\"BCX_StruggleDisabled\", attempt);\n\t\t\thookDialogMenuButtonClick(\"Dismount\", trigger);\n\t\t\thookDialogMenuButtonClick(\"BCX_DismountDisabled\", attempt);\n\t\t\thookDialogMenuButtonClick(\"Escape\", trigger);\n\t\t\thookDialogMenuButtonClick(\"BCX_EscapeDisabled\", attempt);\n\t\t}\n\t});\n\n\tregisterRule(\"block_tying_others\", {\n\t\tname: \"Forbid tying up others\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"either everybody or only more dominant characters\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use any items on other characters. Can be set to only affect using items on characters with a higher dominant / lower submissive score than PLAYER_NAME has.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use an item on TARGET_PLAYER!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use an item on TARGET_PLAYER, which was forbidden\",\n\t\t\tlog: \"PLAYER_NAME used an item on TARGET_PLAYER, which was forbidden\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tonlyMoreDominantsToggle: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: true,\n\t\t\t\tdescription: \"Only forbid tying people with higher dominance\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"DialogItemClick\", 5, (args, next) => {\n\t\t\t\tif (state.inEffect && state.customData) {\n\t\t\t\t\tconst toggleOn = state.customData.onlyMoreDominantsToggle;\n\t\t\t\t\tconst C = (Player.FocusGroup != null) ? Player : CurrentCharacter;\n\t\t\t\t\tif (C && C.ID !== 0 && (toggleOn ? ReputationCharacterGet(Player, \"Dominant\") < ReputationCharacterGet(C, \"Dominant\") : true)) {\n\t\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${C.Name} (${C.MemberNumber})` });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"AppearanceGetPreviewImageColor\", 5, (args, next) => {\n\t\t\t\tconst toggleOn = state.customData?.onlyMoreDominantsToggle;\n\t\t\t\tconst C = args[0] as Character;\n\t\t\t\tif (C && C.ID !== 0 && state.isEnforced && (toggleOn ? ReputationCharacterGet(Player, \"Dominant\") < ReputationCharacterGet(C, \"Dominant\") : true)) {\n\t\t\t\t\treturn \"grey\";\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"block_blacklisting\", {\n\t\tname: \"Prevent blacklisting\",\n\t\ticon: icon_restrictions,\n\t\tloggable: false,\n\t\tshortDescription: \"and ghosting of the defined roles\",\n\t\tlongDescription: \"This rule prevents PLAYER_NAME from adding characters with the set minimum role or a higher one to their bondage club blacklist and ghostlist.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to blacklist/ghost this person!\",\n\t\t\tattempt_announce: \"PLAYER_NAME violated a rule by trying to blacklist TARGET_CHARACTER\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tminimumRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.mistress,\n\t\t\t\tdescription: \"Minimum role forbidden to blacklist:\",\n\t\t\t\tY: 320\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\t// TODO: Fix for NMod\n\t\t\tif (!NMod) {\n\t\t\t\thookFunction(\"ChatRoomListUpdate\", 6, (args, next) => {\n\t\t\t\t\tconst CN = parseInt(args[2], 10);\n\t\t\t\t\tif (state.isEnforced &&\n\t\t\t\t\t\tstate.customData &&\n\t\t\t\t\t\t(args[0] === Player.BlackList || args[0] === Player.GhostList) &&\n\t\t\t\t\t\targs[1] &&\n\t\t\t\t\t\ttypeof CN === \"number\" &&\n\t\t\t\t\t\tgetCharacterAccessLevel(CN) <= state.customData.minimumRole\n\t\t\t\t\t) {\n\t\t\t\t\t\tstate.triggerAttempt({ TARGET_CHARACTER: `${getCharacterName(CN, \"[Unknown]\")} (${CN})` });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\treturn next(args);\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterRule(\"block_antiblind\", {\n\t\tname: \"Forbid the antiblind option\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"BCX's .antiblind command\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use the antiblind command. Antiblind is a BCX feature that enables a BCX user to see the whole chat room and all other characters at all times, even when wearing a blinding item. If PLAYER_NAME should be forbidden to use the command, this rule should be used.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use the antiblind command!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use the antiblind command\",\n\t\t\tlog: \"PLAYER_NAME used the antiblind command\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal\n\t\t// Implemented externally\n\t});\n\n\tregisterRule(\"block_difficulty_change\", {\n\t\tname: \"Forbid changing difficulty\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"multiplayer difficulty preference\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to change her Bondage Club multiplayer difficulty, regardless of the current value.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to change your difficulty!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to change her multiplayer difficulty\",\n\t\t\tlog: \"PLAYER_NAME changed her multiplayer difficulty\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\thookFunction(\"PreferenceSubscreenDifficultyRun\", 5, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst LastChange = typeof Player?.Difficulty?.LastChange !== \"number\" ? Player.Creation : Player.Difficulty.LastChange;\n\t\t\t\tif (\n\t\t\t\t\tstate.isEnforced &&\n\t\t\t\t\tPreferenceDifficultyLevel != null &&\n\t\t\t\t\tPreferenceDifficultyLevel !== Player.GetDifficulty() &&\n\t\t\t\t\t(PreferenceDifficultyLevel <= 1 || LastChange + 604800000 < CurrentTime) &&\n\t\t\t\t\tPreferenceDifficultyAccept\n\t\t\t\t) {\n\t\t\t\t\tDrawButton(500, 825, 300, 64, TextGet(\"DifficultyChangeMode\") + \" \" + TextGet(\"DifficultyLevel\" + PreferenceDifficultyLevel.toString()), \"#88c\", undefined, \"Blocked by BCX\", true);\n\t\t\t\t}\n\t\t\t});\n\t\t\thookFunction(\"PreferenceSubscreenDifficultyClick\", 5, (args, next) => {\n\t\t\t\tconst LastChange = typeof Player?.Difficulty?.LastChange !== \"number\" ? Player.Creation : Player.Difficulty.LastChange;\n\t\t\t\tif (\n\t\t\t\t\tstate.inEffect &&\n\t\t\t\t\tPreferenceDifficultyLevel != null &&\n\t\t\t\t\tPreferenceDifficultyLevel !== Player.GetDifficulty() &&\n\t\t\t\t\t(PreferenceDifficultyLevel <= 1 || LastChange + 604800000 < CurrentTime) &&\n\t\t\t\t\tPreferenceDifficultyAccept &&\n\t\t\t\t\tMouseIn(500, 825, 300, 64)\n\t\t\t\t) {\n\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tstate.trigger();\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"block_activities\", {\n\t\tname: \"Prevent usage of all activities\",\n\t\ticon: icon_restrictions,\n\t\tloggable: false,\n\t\tshortDescription: \"any action buttons such as kissing or groping\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use any (sexual) activities in chat rooms. Other players can still use activities on her, as this rules does not block the arousal & sexual activities system itself, as forcing the according BC setting would.\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\tOverridePlayerDialog(\"BCX_ActivityDisabled\", \"Usage blocked by BCX\");\n\t\t\tRedirectGetImage(\"Icons/BCX_Activity.png\", \"Icons/Activity.png\");\n\t\t\thookFunction(\"DialogMenuButtonBuild\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\tconst index = DialogMenuButton.indexOf(\"Activity\");\n\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\tDialogMenuButton[index] = \"BCX_ActivityDisabled\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"block_mainhall_maidrescue\", {\n\t\tname: \"Forbid mainhall maid services\",\n\t\tloggable: false,\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"to get out of any restraints\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use a maid's help to get out of restraints in the club's main hall. Recommended to combine with the rule: 'Force 'Cannot enter single-player rooms when restrained' (Existing BC setting)' to prevent NPCs in other rooms from helping.\",\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tload(state) {\n\t\t\thookFunction(\"LogValue\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced && args[0] === \"MaidsDisabled\" && args[1] === \"Maid\")\n\t\t\t\t\treturn CurrentTime + 500_000_000; // 6 days left range for nicest message\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"MainHallMaidsDisabledBegForMore\", 5, (args, next) => {\n\t\t\t\tif (state.isEnforced)\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"block_action\", {\n\t\tname: \"Forbid the action command\",\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"BCX's .action/.a chat command\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use the action command. Action is a BCX feature that enables to format a message to look like a BC chat action. If PLAYER_NAME should be forbidden to use the command to communicate, this rule should be used.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use the action command!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use the action command\",\n\t\t\tlog: \"PLAYER_NAME used the action command\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked\n\t\t// Implemented externally\n\t});\n\n\tregisterRule(\"block_BCX_permissions\", {\n\t\tname: \"Prevent using BCX permissions\",\n\t\tloggable: false,\n\t\ticon: icon_restrictions,\n\t\tshortDescription: \"PLAYER_NAME using her permissions for her own BCX, with some exceptions\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME access to some parts of their own BCX they have permission to use, making it as if they do not have 'self access' (see BCX tutorial on permission system) while the rule is active. This rule still leaves access for all permissions where the lowest permitted role ('lowest access') is also set to PLAYER_NAME (to prevent getting stuck). This rule does not affect PLAYER_NAME's permissions to use another users's BCX.\",\n\t\tdefaultLimit: ConditionsLimit.blocked\n\t\t// Implemented externally\n\t});\n}\n","import { ConditionsLimit } from \"../constants\";\nimport { registerRule } from \"../modules/rules\";\n\nexport function initRules_bc_settings() {\n\n\tfunction preferenceSync() {\n\t\tServerAccountUpdate.QueueData({\n\t\t\tArousalSettings: Player.ArousalSettings,\n\t\t\tGameplaySettings: Player.GameplaySettings,\n\t\t\tImmersionSettings: Player.ImmersionSettings,\n\t\t\tOnlineSettings: Player.OnlineSettings,\n\t\t\tOnlineSharedSettings: Player.OnlineSharedSettings,\n\t\t\tGraphicsSettings: Player.GraphicsSettings,\n\t\t\tItemPermission: Player.ItemPermission\n\t\t});\n\t}\n\n\tfunction settingHelper(setting: string, defaultLimit: ConditionsLimit): RuleDisplayDefinition {\n\t\treturn {\n\t\t\tname: `Force '${setting}'`,\n\t\t\ticon: \"Icons/Preference.png\",\n\t\t\tloggable: false,\n\t\t\tshortDescription: \"Existing BC setting\",\n\t\t\tdefaultLimit,\n\t\t\tlongDescription: `This rule forces PLAYER_NAME's base game setting '${setting}' to configurable value and prevents her from changing it.`,\n\t\t\ttriggerTexts: {\n\t\t\t\tinfoBeep: `Rule changed your '${setting}' setting`\n\t\t\t}\n\t\t};\n\t}\n\n\ttype BooleanRule =\n\t\t| \"setting_forbid_lockpicking\"\n\t\t| \"setting_forbid_SP_rooms\"\n\t\t| \"setting_forbid_safeword\"\n\t\t| \"setting_block_vibe_modes\"\n\t\t| \"setting_show_afk\"\n\t\t| \"setting_show_wardrobe_use\"\n\t\t| \"setting_allow_body_mod\"\n\t\t| \"setting_forbid_cosplay_change\"\n\t\t| \"setting_hide_non_adjecent\"\n\t\t| \"setting_blind_room_garbling\"\n\t\t| \"setting_relog_keeps_restraints\"\n\t\t| \"setting_leashed_roomchange\"\n\t\t| \"setting_plug_vibe_events\"\n\t\t| \"setting_upsidedown_view\";\n\tfunction toggleSettingHelper({\n\t\tid,\n\t\tsetting,\n\t\tdefaultValue,\n\t\tdefaultLimit,\n\t\tget,\n\t\tset\n\t}: {\n\t\tid: BooleanRule;\n\t\tsetting: string;\n\t\tdefaultValue: boolean;\n\t\tdefaultLimit: ConditionsLimit;\n\t\tget: () => boolean | undefined;\n\t\tset: (value: boolean) => void;\n\t}) {\n\t\treturn registerRule<BooleanRule>(id, {\n\t\t\t...settingHelper(setting, defaultLimit),\n\t\t\tlongDescription: `This rule forces PLAYER_NAME's base game setting '${setting}' to configurable value and prevents her from changing it. ` +\n\t\t\t\t`There is also an option to restore the setting to the state it was in before the rule changed it. The restoration happens either when the rule becomes ` +\n\t\t\t\t`inactive (for instance through toggle or unfulfilled trigger conditions) or when it is removed.`,\n\t\t\tdataDefinition: {\n\t\t\t\tvalue: {\n\t\t\t\t\ttype: \"toggle\",\n\t\t\t\t\tdescription: setting,\n\t\t\t\t\tdefault: defaultValue\n\t\t\t\t},\n\t\t\t\trestore: {\n\t\t\t\t\ttype: \"toggle\",\n\t\t\t\t\tdescription: \"Restore previous value when rule ends\",\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tY: 420\n\t\t\t\t}\n\t\t\t},\n\t\t\tinternalDataValidate: (data) => typeof data === \"boolean\",\n\t\t\tinternalDataDefault: () => get() ?? false,\n\t\t\tstateChange(state, newState) {\n\t\t\t\tif (newState) {\n\t\t\t\t\tconst current = get();\n\t\t\t\t\tif (current !== undefined) {\n\t\t\t\t\t\tstate.internalData = current;\n\t\t\t\t\t}\n\t\t\t\t} else if (state.customData?.restore) {\n\t\t\t\t\tconst old = state.internalData;\n\t\t\t\t\tif (old !== undefined) {\n\t\t\t\t\t\tset(old);\n\t\t\t\t\t\tpreferenceSync();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttick(state) {\n\t\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\t\tconst current = get();\n\t\t\t\t\tif (current == null) {\n\t\t\t\t\t\tconsole.error(`BCX: Undfined value while forcing setting ${setting}`);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (current !== state.customData.value) {\n\t\t\t\t\t\tset(state.customData.value);\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t\tpreferenceSync();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t}\n\n\t// \"General\" settings\n\n\tregisterRule(\"setting_item_permission\", {\n\t\t...settingHelper(\"Item permission\", ConditionsLimit.limited),\n\t\tdataDefinition: {\n\t\t\tvalue: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [\n\t\t\t\t\t[\"everyone\", \"Everyone, no exceptions\"],\n\t\t\t\t\t[\"everyoneBlacklist\", \"Everyone, except blacklist\"],\n\t\t\t\t\t[\"dominants\", \"Owner, Lovers, whitelist & Dominants\"],\n\t\t\t\t\t[\"whitelist\", \"Owner, Lovers and whitelist only\"]\n\t\t\t\t],\n\t\t\t\tdefault: \"everyone\",\n\t\t\t\tdescription: \"Item permission\"\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\tconst wanted = ({\n\t\t\t\t\teveryone: 0,\n\t\t\t\t\teveryoneBlacklist: 1,\n\t\t\t\t\tdominants: 2,\n\t\t\t\t\twhitelist: 3\n\t\t\t\t} as Record<string, number>)[state.customData.value] ?? 0;\n\t\t\t\tif (Player.ItemPermission !== wanted) {\n\t\t\t\t\tPlayer.ItemPermission = wanted;\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\tpreferenceSync();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_forbid_lockpicking\",\n\t\tsetting: \"Locks on you can't be picked\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tget: () => Player.OnlineSharedSettings?.DisablePickingLocksOnSelf,\n\t\tset: value => Player.OnlineSharedSettings!.DisablePickingLocksOnSelf = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_forbid_SP_rooms\",\n\t\tsetting: \"Cannot enter single-player rooms when restrained\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tget: () => Player.GameplaySettings?.OfflineLockedRestrained,\n\t\tset: value => Player.GameplaySettings!.OfflineLockedRestrained = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_forbid_safeword\",\n\t\tsetting: \"Allow safeword use\",\n\t\tdefaultValue: false,\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tget: () => Player.GameplaySettings?.EnableSafeword,\n\t\tset: value => Player.GameplaySettings!.EnableSafeword = value\n\t});\n\n\t// \"Arousal\" settings\n\n\tregisterRule(\"setting_arousal_meter\", {\n\t\t...settingHelper(\"Arousal meter\", ConditionsLimit.limited),\n\t\tdataDefinition: {\n\t\t\tactive: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [\n\t\t\t\t\t[\"Inactive\", \"Disable sexual activities\"],\n\t\t\t\t\t[\"NoMeter\", \"Allow without a meter\"],\n\t\t\t\t\t[\"Manual\", \"Allow with a manual meter\"],\n\t\t\t\t\t[\"Hybrid\", \"Allow with a hybrid meter\"],\n\t\t\t\t\t[\"Automatic\", \"Allow with a locked meter\"]\n\t\t\t\t],\n\t\t\t\tdefault: \"Hybrid\",\n\t\t\t\tdescription: \"Sexual activities - Activation\"\n\t\t\t},\n\t\t\tvisible: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [\n\t\t\t\t\t[\"All\", \"Show arousal to everyone\"],\n\t\t\t\t\t[\"Access\", \"Show if they have access\"],\n\t\t\t\t\t[\"Self\", \"Show to yourself only\"]\n\t\t\t\t],\n\t\t\t\tdefault: \"All\",\n\t\t\t\tdescription: \"Meter visibility\",\n\t\t\t\tY: 480\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tlet change = false;\n\t\t\tif (state.isEnforced && state.customData && Player.ArousalSettings) {\n\t\t\t\tif (Player.ArousalSettings.Active !== state.customData.active) {\n\t\t\t\t\tPlayer.ArousalSettings.Active = state.customData.active;\n\t\t\t\t\tchange = true;\n\t\t\t\t}\n\t\t\t\tif (Player.ArousalSettings.Visible !== state.customData.visible) {\n\t\t\t\t\tPlayer.ArousalSettings.Visible = state.customData.visible;\n\t\t\t\t\tchange = true;\n\t\t\t\t}\n\t\t\t\tif (change) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\tpreferenceSync();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn change;\n\t\t}\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_block_vibe_modes\",\n\t\tsetting: \"Block advanced vibrator modes\",\n\t\tdefaultValue: false,\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tget: () => Player.ArousalSettings?.DisableAdvancedVibes,\n\t\tset: value => Player.ArousalSettings!.DisableAdvancedVibes = value\n\t});\n\n\tregisterRule(\"setting_arousal_stutter\", {\n\t\t...settingHelper(\"Arousal speech stuttering\", ConditionsLimit.limited),\n\t\tdataDefinition: {\n\t\t\tvalue: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [\n\t\t\t\t\t[\"None\", \"Never stutter\"],\n\t\t\t\t\t[\"Arousal\", \"When you're aroused\"],\n\t\t\t\t\t[\"Vibration\", \"When you're vibrated\"],\n\t\t\t\t\t[\"All\", \"Aroused & vibrated\"]\n\t\t\t\t],\n\t\t\t\tdefault: \"All\",\n\t\t\t\tdescription: \"Speech stuttering\"\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tif (state.isEnforced && state.customData && Player.ArousalSettings) {\n\t\t\t\tif (Player.ArousalSettings.AffectStutter !== state.customData.value) {\n\t\t\t\t\tPlayer.ArousalSettings.AffectStutter = state.customData.value;\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\tpreferenceSync();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\t// \"Online\" settings\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_show_afk\",\n\t\tsetting: \"Show AFK bubble\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.OnlineSettings?.EnableAfkTimer,\n\t\tset: value => Player.OnlineSettings!.EnableAfkTimer = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_show_wardrobe_use\",\n\t\tsetting: \"Show wardrobe icon\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.OnlineSettings?.EnableWardrobeIcon,\n\t\tset: value => Player.OnlineSettings!.EnableWardrobeIcon = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_allow_body_mod\",\n\t\tsetting: \"Allow others to alter your whole appearance\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.OnlineSharedSettings?.AllowFullWardrobeAccess,\n\t\tset: value => Player.OnlineSharedSettings!.AllowFullWardrobeAccess = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_forbid_cosplay_change\",\n\t\tsetting: \"Prevent others from changing cosplay items\",\n\t\tdefaultValue: false,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.OnlineSharedSettings?.BlockBodyCosplay,\n\t\tset: value => Player.OnlineSharedSettings!.BlockBodyCosplay = value\n\t});\n\n\t// \"Immersion\" settings\n\n\tregisterRule(\"setting_sensdep\", {\n\t\t...settingHelper(\"Sensory deprivation setting\", ConditionsLimit.blocked),\n\t\tdataDefinition: {\n\t\t\tvalue: {\n\t\t\t\ttype: \"listSelect\",\n\t\t\t\toptions: [\n\t\t\t\t\t[\"SensDepLight\", \"Light\"],\n\t\t\t\t\t[\"Normal\", \"Normal\"],\n\t\t\t\t\t[\"SensDepNames\", \"Hide names\"],\n\t\t\t\t\t[\"SensDepTotal\", \"Heavy\"],\n\t\t\t\t\t[\"SensDepExtreme\", \"Total\"]\n\t\t\t\t],\n\t\t\t\tdefault: \"Normal\",\n\t\t\t\tdescription: \"Sensory deprivation setting\"\n\t\t\t},\n\t\t\tdisableExamine: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Disable examining when blind\",\n\t\t\t\tY: 480\n\t\t\t},\n\t\t\thideMessages: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Hide others' messages\",\n\t\t\t\tY: 580\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tlet changed = false;\n\t\t\tif (state.isEnforced && state.customData && Player.GameplaySettings && Player.ImmersionSettings) {\n\t\t\t\tif (Player.GameplaySettings.SensDepChatLog !== state.customData.value) {\n\t\t\t\t\tPlayer.GameplaySettings.SensDepChatLog = state.customData.value;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t\tconst bdeForceOff = state.customData.value === \"SensDepLight\";\n\t\t\t\tconst bdeForceOn = state.customData.value === \"SensDepExtreme\";\n\t\t\t\tconst bdeTarget = (state.customData.disableExamine && !bdeForceOff) || bdeForceOn;\n\t\t\t\tif (Player.GameplaySettings.BlindDisableExamine !== bdeTarget) {\n\t\t\t\t\tPlayer.GameplaySettings.BlindDisableExamine = bdeTarget;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t\tconst canHideMessages = state.customData.value !== \"SensDepLight\";\n\t\t\t\tconst hideMessagesTarget = canHideMessages && state.customData.hideMessages;\n\t\t\t\tif (Player.ImmersionSettings.SenseDepMessages !== hideMessagesTarget) {\n\t\t\t\t\tPlayer.ImmersionSettings.SenseDepMessages = hideMessagesTarget;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t\tif (changed) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\tpreferenceSync();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn changed;\n\t\t}\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_hide_non_adjecent\",\n\t\tsetting: \"Hide non-adjacent players while partially blind\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.ImmersionSettings?.BlindAdjacent,\n\t\tset: value => Player.ImmersionSettings!.BlindAdjacent = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_blind_room_garbling\",\n\t\tsetting: \"Garble chatroom names and descriptions while blind\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.ImmersionSettings?.ChatRoomMuffle,\n\t\tset: value => Player.ImmersionSettings!.ChatRoomMuffle = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_relog_keeps_restraints\",\n\t\tsetting: \"Keep all restraints when relogging\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tget: () => Player.GameplaySettings?.DisableAutoRemoveLogin,\n\t\tset: value => Player.GameplaySettings!.DisableAutoRemoveLogin = value\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_leashed_roomchange\",\n\t\tsetting: \"Players can drag you to rooms when leashed\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.OnlineSharedSettings?.AllowPlayerLeashing,\n\t\tset: value => Player.OnlineSharedSettings!.AllowPlayerLeashing = value\n\t});\n\n\tregisterRule(\"setting_room_rejoin\", {\n\t\t...settingHelper(\"Return to chatrooms on relog\", ConditionsLimit.limited),\n\t\tdataDefinition: {\n\t\t\tvalue: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: true,\n\t\t\t\tdescription: \"Return to chatrooms on relog\"\n\t\t\t},\n\t\t\tremakeRooms: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Auto-remake rooms\",\n\t\t\t\tY: 425\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tlet changed = false;\n\t\t\tif (state.isEnforced && state.customData && Player.ImmersionSettings) {\n\t\t\t\tif (Player.ImmersionSettings.ReturnToChatRoom !== state.customData.value) {\n\t\t\t\t\tPlayer.ImmersionSettings.ReturnToChatRoom = state.customData.value;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t\tconst returnToRoomEnabled = state.customData.value;\n\t\t\t\tconst remakeRoomTarget = returnToRoomEnabled && state.customData.remakeRooms;\n\t\t\t\tif (Player.ImmersionSettings.ReturnToChatRoomAdmin !== remakeRoomTarget) {\n\t\t\t\t\tPlayer.ImmersionSettings.ReturnToChatRoomAdmin = remakeRoomTarget;\n\t\t\t\t\tchanged = true;\n\t\t\t\t}\n\t\t\t\tif (changed) {\n\t\t\t\t\tstate.trigger();\n\t\t\t\t\tpreferenceSync();\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn changed;\n\t\t}\n\t});\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_plug_vibe_events\",\n\t\tsetting: \"Events while plugged or vibed\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tget: () => Player.ImmersionSettings?.StimulationEvents,\n\t\tset: value => Player.ImmersionSettings!.StimulationEvents = value\n\t});\n\n\t// \"Graphics\" settings\n\n\ttoggleSettingHelper({\n\t\tid: \"setting_upsidedown_view\",\n\t\tsetting: \"Flip room vertically when upside-down\",\n\t\tdefaultValue: true,\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tget: () => Player.GraphicsSettings?.InvertRoom,\n\t\tset: value => Player.GraphicsSettings!.InvertRoom = value\n\t});\n}\n","import { ConditionsLimit, ModuleCategory } from \"../constants\";\nimport { registerRule } from \"../modules/rules\";\nimport { hookFunction } from \"../patching\";\nimport { icon_OwnerList } from \"../resources\";\n\nexport function initRules_bc_relation_control() {\n\tregisterRule(\"rc_club_owner\", {\n\t\tname: \"Forbid club owner changes\",\n\t\ticon: icon_OwnerList,\n\t\tshortDescription: \"getting or leaving owner\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to leave their current club owner or get a new one. Advancing ownership from trial to full ownership is unaffected. Doesn't prevent the club owner from releasing her.\",\n\t\t// Logs are not implemented\n\t\tloggable: false,\n\t\t// triggerTexts: {\n\t\t// \tinfoBeep: \"You are not allowed to [leave your|get an] owner!\",\n\t\t// \tattempt_log: \"PLAYER_NAME tried to [leave their|get an] owner, which was forbidden.\",\n\t\t// \tlog: \"PLAYER_NAME [left their|got an] owner, which was forbidden.\"\n\t\t// },\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomOwnershipOptionIs\", 5, (args, next) => {\n\t\t\t\tconst Option = args[0] as string;\n\t\t\t\tif (state.isEnforced && Option === \"CanStartTrial\")\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t\tfor (const fun of [\n\t\t\t\t\"ManagementCanBeReleasedOnline\",\n\t\t\t\t\"ManagementCanBreakTrialOnline\",\n\t\t\t\t\"ManagementCannotBeReleasedOnline\",\n\t\t\t\t\"ManagementCanBeReleased\",\n\t\t\t\t\"ManagementCannotBeReleased\"\n\t\t\t]) {\n\t\t\t\thookFunction(fun, 5, (args, next) => {\n\t\t\t\t\treturn !state.isEnforced && next(args);\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t}\n\t\t\thookFunction(\"ManagementCannotBeReleasedExtreme\", 5, (args, next) => {\n\t\t\t\treturn state.isEnforced || next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"rc_lover_new\", {\n\t\tname: \"Forbid getting new lovers\",\n\t\ticon: icon_OwnerList,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to get a new lover. Advancing lovership from dating to engagement or from engagement to marriage is unaffected.\",\n\t\t// Logs are not implemented\n\t\tloggable: false,\n\t\t// triggerTexts: {\n\t\t// \tinfoBeep: \"Due to a rule, you are not allowed to get a new lover!\",\n\t\t// \tattempt_log: \"PLAYER_NAME tried to get a new lover, TARGET_PLAYER, which was forbidden\",\n\t\t// \tlog: \"PLAYER_NAME got a new lover, TARGET_PLAYER, which was forbidden\"\n\t\t// },\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomLovershipOptionIs\", 5, (args, next) => {\n\t\t\t\tconst Option = args[0] as string;\n\t\t\t\tif (state.isEnforced && (Option === \"CanOfferBeginDating\" || Option === \"CanBeginDating\"))\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"rc_lover_leave\", {\n\t\tname: \"Forbid breaking up with lovers\",\n\t\ticon: icon_OwnerList,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to leave any of their lovers, independent of lovership stage (leaving dating, engaged and married characters is forbidden). Doesn't prevent her lovers from breaking up with her.\",\n\t\t// Logs are not implemented\n\t\tloggable: false,\n\t\t// triggerTexts: {\n\t\t// \tinfoBeep: \"Due to a rule, you are not allowed to leave your lover!\",\n\t\t// \tattempt_log: \"PLAYER_NAME tried to leave their lover, TARGET_PLAYER, which was forbidden\",\n\t\t// \tlog: \"PLAYER_NAME left their lover, TARGET_PLAYER, which was forbidden\"\n\t\t// },\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\tfor (const fun of [\n\t\t\t\t\"ManagementCanBreakDatingLoverOnline\",\n\t\t\t\t\"ManagementCanBreakUpLoverOnline\"\n\t\t\t]) {\n\t\t\t\thookFunction(fun, 5, (args, next) => {\n\t\t\t\t\treturn !state.isEnforced && next(args);\n\t\t\t\t}, ModuleCategory.Rules);\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterRule(\"rc_sub_new\", {\n\t\tname: \"Forbid taking new submissives\",\n\t\ticon: icon_OwnerList,\n\t\tshortDescription: \"by offering them an ownership trial\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to start a trial with new submissive. Advancing ownership from trial to full ownership is unaffected.\",\n\t\t// Logs are not implemented\n\t\tloggable: false,\n\t\t// triggerTexts: {\n\t\t// \tinfoBeep: \"Due to a rule, you are not allowed to own a new submissive!\",\n\t\t// \tattempt_log: \"PLAYER_NAME tried to collar a new sub, TARGET_PLAYER, which was forbidden\",\n\t\t// \tlog: \"PLAYER_NAME collared a new sub, TARGET_PLAYER, which was forbidden\"\n\t\t// },\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomOwnershipOptionIs\", 5, (args, next) => {\n\t\t\t\tconst Option = args[0] as string;\n\t\t\t\tif (state.isEnforced && Option === \"Propose\")\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"rc_sub_leave\", {\n\t\tname: \"Forbid disowning submissives\",\n\t\ticon: icon_OwnerList,\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to let go of any of their subs. (affects both trial and full ownerships). Doesn't prevent her submissives from breaking the bond.\",\n\t\t// Logs are not implemented\n\t\tloggable: false,\n\t\t// triggerTexts: {\n\t\t// \tinfoBeep: \"Due to a rule, you are not allowed to let go of any of your submissive!\",\n\t\t// \tattempt_log: \"PLAYER_NAME tried to let go of their sub, TARGET_PLAYER, which was forbidden\",\n\t\t// \tlog: \"PLAYER_NAME let go of their sub, TARGET_PLAYER, which was forbidden\"\n\t\t// },\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomIsOwnedByPlayer\", 5, (args, next) => {\n\t\t\t\treturn !state.isEnforced && next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n}\n","import { ModuleInitPhase } from \"../constants\";\nimport { moduleInitPhase } from \"../moduleManager\";\nimport { hookFunction } from \"../patching\";\nimport { isObject } from \"../utils\";\nimport { ChatRoomSendLocal } from \"../utilsClub\";\nimport { registerCommand } from \"./commands\";\nimport { RulesGetRuleState } from \"./rules\";\nimport { BaseModule } from \"./_BaseModule\";\n\nexport interface SpeechMessageInfo {\n\treadonly type: \"Chat\" | \"Emote\" | \"Whisper\" | \"Command\";\n\treadonly target: number | null;\n\treadonly rawMessage: string;\n\treadonly originalMessage: string;\n\treadonly noOOCMessage?: string;\n\treadonly hasOOC: boolean;\n}\n\nexport const enum SpeechHookAllow {\n\t/** Message is allowed to continue */\n\tALLOW,\n\t/** Message will be blocked */\n\tBLOCK,\n\t/** Message will not be blocked, even if some hook returned BLOCK */\n\tALLOW_BYPASS\n}\n\nexport interface SpeechHook {\n\tallowSend?(info: SpeechMessageInfo): SpeechHookAllow;\n\tmodify?(info: SpeechMessageInfo, message: string): string;\n\tonSend?(info: SpeechMessageInfo, message: string): void;\n}\n\nconst speechHooks: SpeechHook[] = [];\n\nexport function registerSpeechHook(hook: SpeechHook): void {\n\tif (moduleInitPhase !== ModuleInitPhase.init) {\n\t\tthrow new Error(\"Speech hooks can be registered only during init\");\n\t}\n\tspeechHooks.push(hook);\n}\n\n/**\n * Alters a message so that it sounds like a faltering voice, including random filler sounds. Does not affect OOC talk.\n * @param {string} message - The message that will be randomly changed\n * @returns {string} - Returns the message after studdering and random sounds have been added\n */\nexport function falteringSpeech(message: string): string {\n\tconst soundList: string[] = [\"uuh... \", \"uhh... \", \"...ah... \", \"uhm... \", \"mnn... \", \"..nn... \"];\n\tlet oocMsg: boolean = false;\n\tlet firstWord: boolean = true;\n\tlet alreadyStudderedWord: boolean = false;\n\tlet seed: number = message.length;\n\tfor (let messageIndex = 0; messageIndex < message.length; messageIndex++) {\n\n\t\tconst character = message.charAt(messageIndex).toLowerCase();\n\t\t// from here on out, an out of context part of the message starts that will stay unchanged\n\t\tif (character === \"(\") oocMsg = true;\n\t\tif (!oocMsg && !alreadyStudderedWord && /\\p{L}/igu.test(character)) {\n\t\t\tconst studderFactor: number = Math.floor(Math.sin(seed++) * 100000) % 10;\n\t\t\tif ((!alreadyStudderedWord && studderFactor >= 6) || firstWord) {\n\t\t\t\tmessage = message.substring(0, messageIndex + 1) + \"-\" + message.substring(messageIndex, message.length);\n\t\t\t\tseed++;\n\t\t\t\t// One third chance to add a sound before a studdered word\n\t\t\t\tif (Math.random() < 0.33 && !firstWord) {\n\t\t\t\t\tmessage = message.substring(0, messageIndex) + soundList[Math.floor(Math.random() * soundList.length)] + message.substring(messageIndex, message.length);\n\t\t\t\t}\n\t\t\t\tmessageIndex += 2;\n\t\t\t\tif (firstWord) firstWord = false;\n\t\t\t}\n\t\t\talreadyStudderedWord = true;\n\t\t}\n\t\tif (character === \")\") oocMsg = false;\n\t\tif (character === \" \") alreadyStudderedWord = false;\n\t}\n\treturn message;\n}\n\nfunction parseMsg(msg: string): SpeechMessageInfo | null {\n\tconst rawMessage = msg;\n\tif (msg.startsWith(\"//\")) {\n\t\tmsg = msg.substr(1);\n\t} else if (msg.startsWith(\"/\")) {\n\t\treturn {\n\t\t\ttype: \"Command\",\n\t\t\trawMessage,\n\t\t\toriginalMessage: msg,\n\t\t\ttarget: null,\n\t\t\thasOOC: true\n\t\t};\n\t}\n\tif (msg.startsWith(\"*\") || (Player.ChatSettings?.MuStylePoses && msg.startsWith(\":\") && msg.length > 3)) {\n\t\t// Emotes are handled in `ChatRoomSendEmote`\n\t\treturn null;\n\t}\n\treturn {\n\t\ttype: ChatRoomTargetMemberNumber == null ? \"Chat\" : \"Whisper\",\n\t\trawMessage,\n\t\toriginalMessage: msg,\n\t\ttarget: ChatRoomTargetMemberNumber,\n\t\tnoOOCMessage: msg.replace(/\\([^)]*\\)?\\s?/gs, \"\"),\n\t\thasOOC: msg.includes(\"(\")\n\t};\n}\n\n/**\n * @returns The message that should be sent, or `null` if stopped\n */\nfunction processMsg(msg: SpeechMessageInfo): string | null {\n\t// Don't modify commands this way\n\tif (msg.type === \"Command\") {\n\t\treturn msg.rawMessage;\n\t}\n\n\tif (\n\t\t(msg.type === \"Chat\" || msg.type === \"Whisper\") &&\n\t\tChatRoomShouldBlockGaggedOOCMessage(msg.originalMessage, ChatRoomCharacter.find(C => C.MemberNumber === ChatRoomTargetMemberNumber))\n\t) {\n\t\t// The message will be blocked by BC, just return it\n\t\treturn msg.rawMessage;\n\t}\n\n\t// Let hooks block the messsage\n\tlet result: SpeechHookAllow = SpeechHookAllow.ALLOW;\n\tfor (const hook of speechHooks) {\n\t\tif (hook.allowSend) {\n\t\t\tconst hookResult = hook.allowSend(msg);\n\t\t\tif (hookResult === SpeechHookAllow.ALLOW_BYPASS) {\n\t\t\t\tresult = SpeechHookAllow.ALLOW_BYPASS;\n\t\t\t} else if (hookResult === SpeechHookAllow.BLOCK && result === SpeechHookAllow.ALLOW) {\n\t\t\t\tresult = SpeechHookAllow.BLOCK;\n\t\t\t}\n\t\t}\n\t}\n\tif (result === SpeechHookAllow.BLOCK)\n\t\treturn null;\n\n\tlet message = msg.originalMessage;\n\t// Let hooks modify the message\n\tfor (const hook of speechHooks) {\n\t\tif (hook.modify) {\n\t\t\tmessage = hook.modify(msg, message);\n\t\t}\n\t}\n\n\t// Let hooks react to actual message that will be sent\n\tfor (const hook of speechHooks) {\n\t\tif (hook.onSend) {\n\t\t\thook.onSend(msg, message);\n\t\t}\n\t}\n\n\t// Escape '/' if message starts with it\n\tif (message.startsWith(\"/\")) {\n\t\tmessage = \"/\" + message;\n\t}\n\treturn message;\n}\n\n//#region Antigarble\nlet antigarble = 0;\n\nfunction setAntigarble(value: number): boolean {\n\tif (![0, 1, 2].includes(value)) {\n\t\tthrow new Error(\"Bad antigarble value, expected 0/1/2\");\n\t}\n\tif (value !== 0) {\n\t\tconst blockRule = RulesGetRuleState(\"speech_block_antigarble\");\n\t\tif (blockRule.isEnforced) {\n\t\t\tblockRule.triggerAttempt();\n\t\t\treturn false;\n\t\t} else if (blockRule.inEffect) {\n\t\t\tblockRule.trigger();\n\t\t}\n\t}\n\tantigarble = value;\n\treturn true;\n}\n//#endregion\n\nexport class ModuleSpeech extends BaseModule {\n\tload() {\n\t\tlet lastMessage: string = \"\";\n\t\tlet lastMessageOriginal: string = \"\";\n\t\thookFunction(\"ChatRoomSendChat\", 5, (args, next) => {\n\t\t\tconst chat = document.getElementById(\"InputChat\") as HTMLTextAreaElement | null;\n\t\t\tif (chat) {\n\t\t\t\tconst msg = chat.value.trim();\n\t\t\t\tif (msg) {\n\t\t\t\t\tconst info = parseMsg(msg);\n\t\t\t\t\tif (info) {\n\t\t\t\t\t\tconst msg2 = processMsg(info);\n\t\t\t\t\t\tif (msg2 === null) {\n\t\t\t\t\t\t\tif (RulesGetRuleState(\"speech_force_retype\").isEnforced) {\n\t\t\t\t\t\t\t\tchat.value = \"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tchat.value = msg2;\n\t\t\t\t\t\tlastMessage = msg2.startsWith(\"//\") ? msg2.substring(1) : msg2;\n\t\t\t\t\t\tlastMessageOriginal = info.originalMessage.startsWith(\"//\") ? info.originalMessage.substring(1) : info.originalMessage;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\t//#region Antigarble for pre-garbled whispers\n\t\thookFunction(\"ServerSend\", 1, (args, next) => {\n\t\t\tconst data = args[1];\n\t\t\tif (args[0] === \"ChatRoomChat\" &&\n\t\t\t\tisObject(data) &&\n\t\t\t\tdata.Type === \"Whisper\" &&\n\t\t\t\tdata.Content === lastMessage &&\n\t\t\t\tlastMessageOriginal\n\t\t\t) {\n\t\t\t\tif (!Array.isArray(data.Dictionary)) {\n\t\t\t\t\tdata.Dictionary = [];\n\t\t\t\t}\n\t\t\t\tdata.Dictionary.push({ Tag: \"BCX_ORIGINAL_MESSAGE\", Text: lastMessageOriginal });\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"ChatRoomMessage\", 1, (args, next) => {\n\t\t\tconst data = args[0];\n\t\t\tif (antigarble > 0 &&\n\t\t\t\tisObject(data) &&\n\t\t\t\tdata.Type === \"Whisper\" &&\n\t\t\t\ttypeof data.Content === \"string\" &&\n\t\t\t\tArray.isArray(data.Dictionary)\n\t\t\t) {\n\t\t\t\tconst orig = data.Dictionary.find(i => isObject(i) && i.Tag === \"BCX_ORIGINAL_MESSAGE\" && typeof i.Text === \"string\");\n\t\t\t\tif (orig) {\n\t\t\t\t\tif (antigarble === 2) {\n\t\t\t\t\t\tdata.Content = orig.Text;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.Content += ` <> ${orig.Text}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\t\t//#endregion\n\n\t\t// Even if not modified by hook, the hash is very important\n\t\thookFunction(\"CommandParse\", 0, (args, next) => next(args));\n\n\t\thookFunction(\"ChatRoomSendEmote\", 5, (args, next) => {\n\t\t\tconst rawMessage = args[0] as string;\n\t\t\tlet msg = rawMessage;\n\t\t\tif (Player.ChatSettings?.MuStylePoses && msg.startsWith(\":\")) msg = msg.substring(1);\n\t\t\telse {\n\t\t\t\tmsg = msg.replace(/^\\*/, \"\").replace(/\\*$/, \"\");\n\t\t\t\tif (msg.startsWith(\"/me \")) msg = msg.replace(\"/me \", \"\");\n\t\t\t\tif (msg.startsWith(\"/action \")) msg = msg.replace(\"/action \", \"*\");\n\t\t\t}\n\t\t\tmsg = msg.trim();\n\t\t\tconst msg2 = processMsg({\n\t\t\t\ttype: \"Emote\",\n\t\t\t\trawMessage,\n\t\t\t\toriginalMessage: msg,\n\t\t\t\ttarget: ChatRoomTargetMemberNumber,\n\t\t\t\tnoOOCMessage: msg,\n\t\t\t\thasOOC: false\n\t\t\t});\n\t\t\tif (msg2 !== null) {\n\t\t\t\treturn next([\"*\" + msg2]);\n\t\t\t} else if (RulesGetRuleState(\"speech_force_retype\").isEnforced) {\n\t\t\t\tconst chat = document.getElementById(\"InputChat\") as HTMLTextAreaElement | null;\n\t\t\t\tif (chat) {\n\t\t\t\t\tchat.value = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t//#region Antigarble\n\t\tconst ANTIGARBLE_LEVELS: Record<string, number> = {\n\t\t\t\"0\": 0,\n\t\t\t\"1\": 1,\n\t\t\t\"2\": 2,\n\t\t\t\"normal\": 0,\n\t\t\t\"both\": 1,\n\t\t\t\"ungarbled\": 2\n\t\t};\n\n\t\tconst ANTIGARBLE_LEVEL_NAMES: string[] = Object.keys(ANTIGARBLE_LEVELS).filter(k => k.length > 1);\n\n\t\tregisterCommand(\"antigarble\", \"<level> - Set garble prevention to show [normal|both|ungarbled] messages (only affects received messages!)\", value => {\n\t\t\tconst val = ANTIGARBLE_LEVELS[value || \"\"];\n\t\t\tif (val !== undefined) {\n\t\t\t\tif (setAntigarble(val)) {\n\t\t\t\t\tChatRoomSendLocal(`Antigarble set to ${ANTIGARBLE_LEVEL_NAMES[val]}`);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tChatRoomSendLocal(`Invalid antigarble level; use ${ANTIGARBLE_LEVEL_NAMES.join(\"/\")}`);\n\t\t\treturn false;\n\t\t}, value => {\n\t\t\treturn ANTIGARBLE_LEVEL_NAMES.filter(k => k.length > 1 && k.startsWith(value));\n\t\t});\n\n\t\thookFunction(\"SpeechGarble\", 0, (args, next) => {\n\t\t\tif (antigarble === 2) return args[1];\n\t\t\tlet res = next(args);\n\t\t\tif (typeof res === \"string\" && res !== args[1] && antigarble === 1) res += ` <> ${args[1]}`;\n\t\t\treturn res;\n\t\t});\n\t\t//#endregion\n\n\t\t//#region Item specific fixes\n\n\t\t// Teach shock collar and futuristic gag, that commands are OOC\n\t\tif (typeof (window as any).InventoryItemNeckAccessoriesCollarAutoShockUnitDetectSpeech === \"function\") {\n\t\t\thookFunction(\"InventoryItemNeckAccessoriesCollarAutoShockUnitDetectSpeech\", 10, (args, next) => {\n\t\t\t\tif (ChatRoomLastMessage &&\n\t\t\t\t\tChatRoomLastMessage.length > 0 &&\n\t\t\t\t\tChatRoomLastMessage[ChatRoomLastMessage.length - 1].startsWith(\".\") &&\n\t\t\t\t\t!ChatRoomLastMessage[ChatRoomLastMessage.length - 1].startsWith(\"..\")\n\t\t\t\t)\n\t\t\t\t\treturn false;\n\t\t\t\treturn next(args);\n\t\t\t});\n\t\t}\n\n\t\t//#endregion\n\t}\n}\n","import { ConditionsLimit, ModuleCategory } from \"../constants\";\nimport { registerRule } from \"../modules/rules\";\nimport { AccessLevel, getCharacterAccessLevel } from \"../modules/authority\";\nimport { registerSpeechHook, SpeechMessageInfo, falteringSpeech, SpeechHookAllow } from \"../modules/speech\";\nimport { callOriginal, hookFunction } from \"../patching\";\nimport { getChatroomCharacter } from \"../characters\";\nimport { dictionaryProcess, isObject } from \"../utils\";\nimport { ChatRoomSendLocal, getCharacterName } from \"../utilsClub\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nexport function initRules_bc_speech_control() {\n\tregisterRule(\"speech_specific_sound\", {\n\t\tname: \"Allow specific sounds only\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"such as an animal sound\",\n\t\tlongDescription: \"This rule allows PLAYER_NAME to only communicate using a list of specific sound patterns in chat messages and whispers. These patterns cannot be mixed in the same message, though. Only one sound from the list per message is valid. That said, any variation of a sound in the list is allowed as long as the letters are in order. (Example: if the set sound is 'Meow', then this is a valid message: 'Me..ow? meeeow! mmeooowwwwwww?! meow. me.. oo..w ~')\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are allowed to speak only using one of the defined sounds!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to break a rule to only speak using specific sound patterns\",\n\t\t\tlog: \"PLAYER_NAME broke a rule to only speak using specific sound patterns\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tsoundWhitelist: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Set the allowed sounds:\",\n\t\t\t\toptions: {\n\t\t\t\t\tvalidate: /^\\p{L}*$/iu\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => {\n\t\t\t\tconst sounds = state.customData?.soundWhitelist;\n\t\t\t\tif (sounds && sounds.length > 0 && (msg.type === \"Chat\" || msg.type === \"Whisper\")) {\n\t\t\t\t\tconst message = (msg.noOOCMessage ?? msg.originalMessage).toLocaleLowerCase();\n\t\t\t\t\tfor (let sound of sounds) {\n\t\t\t\t\t\tsound = sound.toLocaleLowerCase();\n\t\t\t\t\t\tlet ok = true;\n\t\t\t\t\t\tlet i = 0;\n\t\t\t\t\t\tfor (const c of message) {\n\t\t\t\t\t\t\tif (/\\p{L}/igu.test(c)) {\n\t\t\t\t\t\t\t\tconst nx = sound[(i + 1) % sound.length];\n\t\t\t\t\t\t\t\tif (c === nx) {\n\t\t\t\t\t\t\t\t\ti = (i + 1) % sound.length;\n\t\t\t\t\t\t\t\t} else if (c !== sound[i]) {\n\t\t\t\t\t\t\t\t\tok = false;\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ok)\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_garble_whispers\", {\n\t\tname: \"Garble whispers while gagged\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"same as normal messages\",\n\t\tlongDescription: \"This rule alters PLAYER_NAME's outgoing whisper messages while gagged to be garbled the same way normal chat messages are. This means, that strength of the effect depends on the type of gag and (OOC text) is not affected. Note: While the rule is in effect, the BC immersion preference 'Prevent OOC & whispers while gagged' is altered, to allow gagged whispers, since those are now garbled by the rule. OOC prevention is not changed.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tinit(state) {\n\t\t\tregisterSpeechHook({\n\t\t\t\tmodify: (info, message) => state.isEnforced && info.type === \"Whisper\" ? callOriginal(\"SpeechGarble\", [Player, message, true]) : message\n\t\t\t});\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomShouldBlockGaggedOOCMessage\", 2, (args, next) => {\n\t\t\t\tif (state.isEnforced && ChatRoomTargetMemberNumber !== null && !args[0].includes(\"(\")) return false;\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"speech_block_gagged_ooc\", {\n\t\tname: \"Block OOC chat while gagged\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"no more misuse of OOC for normal chatting while gagged\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use OOC (messages between round brackets) in chat or OOC whisper messages while she is gagged.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use OOC in messages while gagged.\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use OOC in a message while gagged\",\n\t\t\tlog: \"PLAYER_NAME used OOC in a message while gagged\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => !msg.hasOOC || Player.CanTalk() || msg.type !== \"Chat\" && msg.type !== \"Whisper\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_block_ooc\", {\n\t\tname: \"Block OOC chat\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"blocks use of OOC in messages\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use OOC (messages between round brackets) in chat or OOC whisper messages at any moment. This is a very extreme rule and should be used with great caution!\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use OOC in messages!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use OOC in a message\",\n\t\t\tlog: \"PLAYER_NAME used OOC in a message\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => !msg.hasOOC || msg.type !== \"Chat\" && msg.type !== \"Whisper\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_doll_talk\", {\n\t\tname: \"Doll talk\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"allows only short sentences with simple words\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use any words longer than set limit and limits number of words too. Both limits are configurable independently. Doesn't affect OOC text, but does affect whispers.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You broke the doll talk rule!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to break the doll talk rule\",\n\t\t\tlog: \"PLAYER_NAME broke the doll talk rule\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tmaxWordLength: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 6,\n\t\t\t\tdescription: \"Max. character length of any word:\",\n\t\t\t\tY: 420\n\t\t\t},\n\t\t\tmaxNumberOfWords: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 5,\n\t\t\t\tdescription: \"Max. number of words per message:\",\n\t\t\t\tY: 570\n\t\t\t}\n\t\t},\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => {\n\t\t\t\tif ((msg.type !== \"Chat\" && msg.type !== \"Whisper\") || !state.customData?.maxWordLength || !state.customData.maxNumberOfWords)\n\t\t\t\t\treturn true;\n\t\t\t\tconst words = Array.from((msg.noOOCMessage ?? msg.originalMessage).matchAll(/[^\\t\\p{Z}\\v.:!?~,;^]+/gmu)).map(i => i[0]);\n\t\t\t\tif (words.length > state.customData.maxNumberOfWords)\n\t\t\t\t\treturn false;\n\t\t\t\tif (words.some(word => word.length > state.customData!.maxWordLength))\n\t\t\t\t\treturn false;\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_ban_words\", {\n\t\tname: \"Forbid saying certain words in chat\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"based on a configurable blacklist\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use certain words in the chat. The list of banned words can be configured. Checks are not case sensitive (forbidding 'no' also forbids 'NO' and 'No'). Doesn't affect emotes and OOC text, but does affect whispers.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use the word 'USED_WORD'!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use the banned word 'USED_WORD'\",\n\t\t\tlog: \"PLAYER_NAME used the banned word 'USED_WORD'\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tbannedWords: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"All forbidden words:\"\n\t\t\t}\n\t\t},\n\t\tinit(state) {\n\t\t\tlet transgression: undefined | string;\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => {\n\t\t\t\tif ((msg.type !== \"Chat\" && msg.type !== \"Whisper\") || !state.customData?.bannedWords)\n\t\t\t\t\treturn true;\n\t\t\t\tconst words = Array.from((msg.noOOCMessage ?? msg.originalMessage).toLocaleLowerCase().matchAll(/\\p{L}+/igu)).map(i => i[0]);\n\t\t\t\ttransgression = state.customData?.bannedWords.find(i => words.includes(i.toLocaleLowerCase()));\n\t\t\t\treturn transgression === undefined;\n\t\t\t};\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg) && transgression !== undefined) {\n\t\t\t\t\t\tstate.triggerAttempt({ USED_WORD: transgression });\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg) && transgression !== undefined) {\n\t\t\t\t\t\tstate.trigger({ USED_WORD: transgression });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_forbid_open_talking\", {\n\t\tname: \"Forbid talking openly\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"in a chat room\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to send a message to all people inside a chat room. Does not affect whispers or emotes, but does affect OOC.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to talk openly in chatrooms!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to openly speak in a room\",\n\t\t\tlog: \"PLAYER_NAME spoke openly in a room\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => msg.type !== \"Chat\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_limit_open_talking\", {\n\t\tname: \"Limit talking openly\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"only allow a set number of chat messages per minute\",\n\t\tlongDescription: \"This rule limits PLAYER_NAME's ability to send a message to all people inside a chat room to only the set number per minute. Does not affect whispers or emotes, but does affect OOC. Note: Setting '0' will have no effect, as there is another rule to forbid open talking completely.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You exceeded the number of allowed chat messages per minute!\"\n\t\t},\n\t\tdataDefinition: {\n\t\t\tmaxNumberOfMsg: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 42,\n\t\t\t\tdescription: \"Maximum allowed number of chat messages per minute (> 0):\",\n\t\t\t\tY: 380\n\t\t\t}\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tlet currentCount: number = 0;\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => msg.type !== \"Chat\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.customData?.maxNumberOfMsg && state.customData.maxNumberOfMsg !== 0 && state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tif (currentCount >= state.customData.maxNumberOfMsg) {\n\t\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentCount++;\n\t\t\t\t\t\tBCX_setTimeout(() => {\n\t\t\t\t\t\t\tif (currentCount > 0) {\n\t\t\t\t\t\t\t\tcurrentCount--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 60_000);\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_forbid_emotes\", {\n\t\tname: \"Forbid using emotes\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"in a chat room\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to send an emote (with * or /me) to all people inside a chat room.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use emotes in chatrooms!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use an emote in a room\",\n\t\t\tlog: \"PLAYER_NAME used an emote in a room\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => msg.type !== \"Emote\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_limit_emotes\", {\n\t\tname: \"Limit using emotes\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"only allow a set number of emotes per minute\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to send an emote (with * or /me) to all people inside a chat room to only the set number per minute. Note: Setting '0' will have no effect, as there is another rule to forbid using emotes completely.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You exceeded the number of allowed emotes per minute!\"\n\t\t},\n\t\tdataDefinition: {\n\t\t\tmaxNumberOfEmotes: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 42,\n\t\t\t\tdescription: \"Maximum allowed number of emotes per minute (> 0):\",\n\t\t\t\tY: 380\n\t\t\t}\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tinit(state) {\n\t\t\tlet currentCount: number = 0;\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => msg.type !== \"Emote\";\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.customData?.maxNumberOfEmotes && state.customData.maxNumberOfEmotes !== 0 && state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tif (currentCount >= state.customData.maxNumberOfEmotes) {\n\t\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentCount++;\n\t\t\t\t\t\tBCX_setTimeout(() => {\n\t\t\t\t\t\t\tif (currentCount > 0) {\n\t\t\t\t\t\t\t\tcurrentCount--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 60_000);\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_restrict_whisper_send\", {\n\t\tname: \"Restrict sending whispers\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"except to defined roles\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to whisper anything to most people inside a chat room, except to the defined roles. Also affects whispered OOC messages.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to whisper to TARGET_PLAYER!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to whisper to TARGET_PLAYER\",\n\t\t\tlog: \"PLAYER_NAME whispered to TARGET_PLAYER\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\tminimumPermittedRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.mistress,\n\t\t\t\tdescription: \"Minimum role whispering is still allowed to:\"\n\t\t\t}\n\t\t},\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => {\n\t\t\t\tconst target = msg.target && getChatroomCharacter(msg.target);\n\t\t\t\treturn msg.type !== \"Whisper\" || !target || !state.customData?.minimumPermittedRole || getCharacterAccessLevel(target) <= state.customData.minimumPermittedRole;\n\t\t\t};\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${msg.target ? getCharacterName(msg.target, \"[unknown]\") : \"[unknown]\"} (${msg.target})` });\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${msg.target ? getCharacterName(msg.target, \"[unknown]\") : \"[unknown]\"} (${msg.target})` });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_restrict_whisper_receive\", {\n\t\tname: \"Restrict receiving whispers\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"except from defined roles\",\n\t\tlongDescription: \"This rule prevents PLAYER_NAME from receiving any whispers, except from the defined roles. If someone tries to send PLAYER_NAME a whisper message while this rule blocks them from doing so, they get an auto reply whisper, if the rule has an auto reply set (text field is not empty). PLAYER_NAME won't get any indication that she would have received a whisper. This rule can also be used (by dommes) to prevent getting unwanted whispers from strangers in public.\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tminimumPermittedRole: {\n\t\t\t\ttype: \"roleSelector\",\n\t\t\t\tdefault: AccessLevel.whitelist,\n\t\t\t\tdescription: \"Minimum role still allowed to send whisper:\",\n\t\t\t\tY: 480\n\t\t\t},\n\t\t\tautoreplyText: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"PLAYER_NAME is currently forbidden to receive whispers.\",\n\t\t\t\tdescription: \"Auto replies blocked sender with this:\",\n\t\t\t\tY: 320,\n\t\t\t\toptions: /^([^/.*].*)?$/\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ChatRoomMessage\", 5, (args, next) => {\n\t\t\t\tconst data = args[0];\n\n\t\t\t\tif (isObject(data) &&\n\t\t\t\t\ttypeof data.Content === \"string\" &&\n\t\t\t\t\tdata.Content !== \"\" &&\n\t\t\t\t\tdata.Type === \"Whisper\" &&\n\t\t\t\t\ttypeof data.Sender === \"number\" &&\n\t\t\t\t\tstate.isEnforced &&\n\t\t\t\t\tstate.customData\n\t\t\t\t) {\n\t\t\t\t\tconst character = getChatroomCharacter(data.Sender);\n\t\t\t\t\tif (character && getCharacterAccessLevel(character) >= state.customData.minimumPermittedRole) {\n\t\t\t\t\t\tif (state.customData.autoreplyText) {\n\t\t\t\t\t\t\tServerSend(\"ChatRoomChat\", {\n\t\t\t\t\t\t\t\tContent: `[Automatic reply by BCX]\\n${dictionaryProcess(state.customData.autoreplyText, {})}`,\n\t\t\t\t\t\t\t\tType: \"Whisper\",\n\t\t\t\t\t\t\t\tTarget: data.Sender\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"speech_restrict_beep_send\", {\n\t\tname: \"Restrict sending beep messages\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"except to selected members\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to send any beeps with message, except to the defined list of member numbers. Sending beeps without a message is not affected. Optionally, it can be set that PLAYER_NAME is only forbidden to send beeps while she is unable to use her hands (e.g. fixed to a cross).\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You broke the rule that forbids sending a beep message to TARGET_PLAYER!\",\n\t\t\tattempt_log: \"PLAYER_NAME broke a rule by trying to send a beep message to TARGET_PLAYER\",\n\t\t\tlog: \"PLAYER_NAME broke a rule by sending a beep message to TARGET_PLAYER\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\twhitelistedMemberNumbers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Member numbers still allowed to be beeped:\",\n\t\t\t\toptions: {\n\t\t\t\t\tpageSize: 2\n\t\t\t\t}\n\t\t\t},\n\t\t\tonlyWhenBound: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Only in effect when unable to use hands\",\n\t\t\t\tY: 700\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"FriendListBeepMenuSend\", 5, (args, next) => {\n\t\t\t\tif (state.inEffect &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\t(document.getElementById(\"FriendListBeepTextArea\") as HTMLTextAreaElement | null)?.value &&\n\t\t\t\t\tFriendListBeepTarget != null &&\n\t\t\t\t\t!state.customData.whitelistedMemberNumbers.includes(FriendListBeepTarget) &&\n\t\t\t\t\t(!Player.CanInteract() || !state.customData.onlyWhenBound)\n\t\t\t\t) {\n\t\t\t\t\tif (state.isEnforced) {\n\t\t\t\t\t\tstate.triggerAttempt({ TARGET_PLAYER: `${getCharacterName(FriendListBeepTarget, \"[unknown]\")} (${FriendListBeepTarget})` });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tstate.trigger({ TARGET_PLAYER: `${getCharacterName(FriendListBeepTarget, \"[unknown]\")} (${FriendListBeepTarget})` });\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"speech_restrict_beep_receive\", {\n\t\tname: \"Restrict receiving beeps\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"and beep messages, except from selected members\",\n\t\tlongDescription: \"This rule prevents PLAYER_NAME from receiving any beep (regardless if the beep carries a message or not), except for beeps from the defined list of member numbers. If someone tries to send PLAYER_NAME a beep message while this rule blocks them from doing so, they get an auto reply beep, if the rule has an auto reply set. PLAYER_NAME won't get any indication that she would have received a beep. Optionally, it can be set that PLAYER_NAME is only forbidden to send beeps while she is unable to use her hands (e.g. fixed to a cross).\",\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\twhitelistedMemberNumbers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Member numbers still allowed to send beeps:\",\n\t\t\t\tY: 470,\n\t\t\t\toptions: {\n\t\t\t\t\tpageSize: 2\n\t\t\t\t}\n\t\t\t},\n\t\t\tautoreplyText: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"PLAYER_NAME is currently forbidden to receive beeps.\",\n\t\t\t\tdescription: \"Auto replies blocked sender with this:\",\n\t\t\t\tY: 300\n\t\t\t},\n\t\t\tonlyWhenBound: {\n\t\t\t\ttype: \"toggle\",\n\t\t\t\tdefault: false,\n\t\t\t\tdescription: \"Only in effect when unable to use hands\",\n\t\t\t\tY: 740\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\thookFunction(\"ServerAccountBeep\", 5, (args, next) => {\n\t\t\t\tconst data = args[0];\n\n\t\t\t\tif (isObject(data) &&\n\t\t\t\t\t!data.BeepType &&\n\t\t\t\t\ttypeof data.MemberNumber === \"number\" &&\n\t\t\t\t\tstate.isEnforced &&\n\t\t\t\t\tstate.customData &&\n\t\t\t\t\t!state.customData.whitelistedMemberNumbers.includes(data.MemberNumber) &&\n\t\t\t\t\t(!Player.CanInteract() || !state.customData.onlyWhenBound)\n\t\t\t\t) {\n\t\t\t\t\tif (state.customData.autoreplyText) {\n\t\t\t\t\t\tServerSend(\"AccountBeep\", {\n\t\t\t\t\t\t\tMemberNumber: data.MemberNumber,\n\t\t\t\t\t\t\tBeepType: \"\",\n\t\t\t\t\t\t\tMessage: `[Automatic reply by BCX]\\n${dictionaryProcess(state.customData.autoreplyText, {})}`,\n\t\t\t\t\t\t\tIsSecret: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn next(args);\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\tregisterRule(\"speech_greet_order\", {\n\t\tname: \"Order to greet club\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"when entering it through the login portal\",\n\t\tlongDescription: \"PLAYER_NAME will automatically send all defined member numbers (if they are currently online) a beep the moment PLAYER_NAME joins the club or the moment she start BCX to make her presence known. Disconnects don't count as coming into the club again, as far as detectable. NOTE: Trigger conditions should not be selected when using this rule, as if you for instance select 'when in public room' the rule will only greet when you load BCX in a public room.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"A BCX rule made you greet one or more people (if currently online) with a beep.\",\n\t\t\tattempt_log: \"\",\n\t\t\tlog: \"\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\ttoGreetMemberNumbers: {\n\t\t\t\ttype: \"memberNumberList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"Member numbers that will be greeted:\"\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tif (state.isEnforced && state.customData) {\n\t\t\t\tfor (const number of state.customData.toGreetMemberNumbers) {\n\t\t\t\t\tServerSend(\"AccountBeep\", {\n\t\t\t\t\t\tMemberNumber: number,\n\t\t\t\t\t\tBeepType: \"\",\n\t\t\t\t\t\tIsSecret: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (state.customData.toGreetMemberNumbers.length > 0) {\n\t\t\t\t\tBCX_setTimeout(() => {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}, 5_000);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tregisterRule(\"speech_block_antigarble\", {\n\t\tname: \"Forbid the antigarble option\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"BCX's .antigarble command\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to use the antigarble command. Antigarble is a BCX feature that enables a BCX user to understand muffled voices from other gagged characters or when wearing a deafening item. If PLAYER_NAME should be forbidden to use the command, this rule should be used.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You are not allowed to use the antigarble command!\",\n\t\t\tattempt_log: \"PLAYER_NAME tried to use the antigarble command\",\n\t\t\tlog: \"PLAYER_NAME used the antigarble command\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal\n\t\t// Implemented externally\n\t});\n\n\t/* TODO: Implement\n\tregisterRule(\"replace_spoken_words\", {\n\t\tname: \"Replace spoken words\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"with others in all chat, whisper and OOC messages\",\n\t\tlongDescription: \"Automatically replaces specific words PLAYER_NAME uses in chat messages, whispers and OOC with another set word from a defineable a list of words with a special syntax (e.g. [Clare,Lily;Mistress],[Claudia;the maid],[I;this slut]).\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\tstringWithReplacingSyntax: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"[I,me;this cutie],[spoken_word;replaced_with_this_word]\",\n\t\t\t\tdescription: \"List in syntax: [word1;substitute1],[w2,w3,...;s2],...\",\n\t\t\t\toptions: /^([^/.*()][^()]*)?$/\n\t\t\t}\n\t\t}\n\t});\n\t*/\n\n\t/* TODO: Implement\n\t// TODO: { TARGET_PLAYER: `${msg.target ? getCharacterName(msg.target, \"[unknown]\") : \"[unknown]\"} (${msg.target})` }\n\tregisterRule(\"using_honorifics\", {\n\t\tname: \"Using honorifics\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"in front of specific names in all chat, whisper and OOC messages\",\n\t\tlongDescription: \"Define a listing of words (e.g. Miss, Mistress, ...) where one of them always needs to be typed before any one out of a listing of names (e.g. Julia, Eve, ...) in all chat, whisper and OOC messages. Needs a certain syntax (e.g. [Goddess,Mistress;Lily,Clare],[slut;Mona], ...)\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You broke a rule to always use a honorific when speaking TARGET_PLAYER's name!\",\n\t\t\tattempt_log: \"PLAYER_NAME almost broke a rule by forgetting to be polite to TARGET_PLAYER\",\n\t\t\tlog: \"PLAYER_NAME broke a rule by forgetting to be polite to TARGET_PLAYER\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tstringWithRuleSyntax: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"\",\n\t\t\t\tdescription: \"List in syntax: [honorific1;name1],[h2,h3,...;n2,n3,...],...\",\n\t\t\t\toptions: /^([^/.*()\\s][^()]*)?$/\n\t\t\t}\n\t\t}\n\t});\n\t*/\n\n\tregisterRule(\"speech_force_retype\", {\n\t\tname: \"Force to retype\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"if sending a message in chat is rejected by BCX due to a rule violation\",\n\t\tlongDescription: \"This rule forces PLAYER_NAME to retype any chat/whisper/emote/OOC message as a punishment when they try to send it and another enforced BCX speech rule determines that there is any rule violation in that message.\",\n\t\tdefaultLimit: ConditionsLimit.limited\n\t\t// Implemented externally\n\t});\n\n\tlet alreadyGreeted = false;\n\tlet lastRoomName: string = \"\";\n\tregisterRule(\"greet_room_order\", {\n\t\tname: \"Order to greet room\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"with a settable sentence when entering it newly\",\n\t\tlongDescription: \"Sets a specific sentence that PLAYER_NAME must say loud after entering a room that is not empty. The sentence is autopopulating the chat window text input. When to say it is left to PLAYER_NAME, but when the rule is enforced, it is the only thing that can be said in this room after joining it. Emotes can still be used, though. Disconnects don't count as coming into a new room again, as far as detectable.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You broke the rule to greet this room like taught!\",\n\t\t\tattempt_infoBeep: \"You need to greet this room like taught!\",\n\t\t\tattempt_log: \"PLAYER_NAME almost broke a rule by not greeting the room like taught\",\n\t\t\tlog: \"PLAYER_NAME broke a rule by not greeting the room like taught\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\tgreetingSentence: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"\",\n\t\t\t\tdescription: \"The sentence that has to be used to greet any joined room:\",\n\t\t\t\toptions: /^([^/.*()\\s][^()]*)?$/\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\t// 1. hook ChatRoomSync to set alreadyGreeted to false if the room name is different from the one stored locally\n\t\t\thookFunction(\"ChatRoomSync\", 0, (args, next) => {\n\t\t\t\tconst data = args[0];\n\t\t\t\tif (data.Name !== lastRoomName) alreadyGreeted = false;\n\t\t\t\tnext(args);\n\t\t\t\t// 2. populate chat field with the default text from the rule\n\t\t\t\tconst chat = document.getElementById(\"InputChat\") as HTMLTextAreaElement | null;\n\t\t\t\tif (chat && state.customData && state.inEffect && !alreadyGreeted && data.Name !== lastRoomName) {\n\t\t\t\t\tchat.value = state.customData.greetingSentence;\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t},\n\t\t// 3. do not allow sending anything else when enforced\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => (\n\t\t\t\t(msg.noOOCMessage ?? msg.originalMessage).toLocaleLowerCase() === state.customData?.greetingSentence.trim().toLocaleLowerCase() &&\n\t\t\t\tmsg.type === \"Chat\"\n\t\t\t);\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced &&\n\t\t\t\t\t\tstate.customData?.greetingSentence.trim() &&\n\t\t\t\t\t\t!alreadyGreeted && msg.type !== \"Emote\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tlastRoomName = ChatRoomData.Name;\n\t\t\t\t\t\t// 4. set alreadyGreeted to true and overwrite lastRoomName\n\t\t\t\t\t\tif (check(msg)) {\n\t\t\t\t\t\t\talreadyGreeted = true;\n\t\t\t\t\t\t\treturn SpeechHookAllow.ALLOW_BYPASS;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\t\tChatRoomSendLocal(`You are expected to greet the room with \"${state.customData?.greetingSentence}\".`);\n\t\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (msg.type === \"Emote\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (state.inEffect &&\n\t\t\t\t\t\tstate.customData?.greetingSentence.trim() &&\n\t\t\t\t\t\t!alreadyGreeted\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!check(msg)) {\n\t\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t\t}\n\t\t\t\t\t\talreadyGreeted = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"greet_new_guests\", {\n\t\tname: \"Greet new guests\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"when they join the current room\",\n\t\tlongDescription: \"Forces PLAYER_NAME to greet people newly entering the current chat room with the set sentence. NOTE: Only PLAYER_NAME and the new guest can see the message not to make it spammy. After a new person has been greeted, she will not be greeted for 10 minutes after she left (including disconnect) the room PLAYER_NAME is in.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\tgreetingSentence: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tdefault: \"\",\n\t\t\t\tdescription: \"The sentence that will be used to greet new guests:\",\n\t\t\t\toptions: /^([^/.*].*)?$/\n\t\t\t}\n\t\t},\n\t\tload(state) {\n\t\t\tconst GREET_DELAY = 600_000;\n\t\t\tconst nextGreet: Map<number, number> = new Map();\n\t\t\thookFunction(\"ChatRoomSyncMemberLeave\", 2, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tconst R = args[0] as Record<string, number>;\n\t\t\t\tif (nextGreet.has(R.SourceMemberNumber)) {\n\t\t\t\t\tnextGreet.set(R.SourceMemberNumber, Date.now() + GREET_DELAY);\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t\thookFunction(\"ChatRoomAddCharacterToChatRoom\", 3, (args, next) => {\n\t\t\t\tconst size = ChatRoomCharacter.length;\n\t\t\t\tnext(args);\n\t\t\t\tif (state.customData && state.isEnforced && size < ChatRoomCharacter.length) {\n\t\t\t\t\tconst C = args[0] as Character;\n\t\t\t\t\tif (C.MemberNumber !== undefined &&\n\t\t\t\t\t\tnextGreet.has(C.MemberNumber) &&\n\t\t\t\t\t\tnextGreet.get(C.MemberNumber)! < Date.now()\n\t\t\t\t\t) {\n\t\t\t\t\t\tnextGreet.delete(C.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tBCX_setTimeout(() => {\n\t\t\t\t\t\tif (!state.customData ||\n\t\t\t\t\t\t\t!state.isEnforced ||\n\t\t\t\t\t\t\t!ChatRoomCharacter.includes(C) ||\n\t\t\t\t\t\t\tC.MemberNumber === undefined ||\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tnextGreet.has(C.MemberNumber) &&\n\t\t\t\t\t\t\t\tnextGreet.get(C.MemberNumber)! >= Date.now()\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) return;\n\t\t\t\t\t\tnextGreet.set(C.MemberNumber, 0);\n\t\t\t\t\t\tServerSend(\"ChatRoomChat\", { Content: state.customData.greetingSentence, Type: \"Chat\", Target: C.MemberNumber });\n\t\t\t\t\t\tServerSend(\"ChatRoomChat\", { Content: state.customData.greetingSentence, Type: \"Chat\", Target: Player.MemberNumber });\n\t\t\t\t\t}, 5_000);\n\t\t\t\t}\n\t\t\t}, ModuleCategory.Rules);\n\t\t}\n\t});\n\n\t// Restrained speech:\n\t// the wearer is unable to speak freely, she is given a set of sentences/targets allowed and can only use those with the #name talk command.\n\t// The given sentences can contain the %target% placeholder to have the target inserted into the sentence. The given sentences can contain\n\t// the %self% placeholder which will be replaced by the given \"self\" attribute. By default it is \"I\", but could be changed to something else\n\t// to avoid having to rewrite all the sentences. WARNING: a target id and a message id always needs to be specified. Therefore, you will be\n\t// softlocked/muted if this mode is enabled and you remove all sentences and/or targets.\n\t/* TODO: Implement\n\tregisterRule(\"restrained_speech\", {\n\t\tname: \"Restrained speech\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"only the set sentences are allowed to be spoken\",\n\t\t// TODO: needs an updated describing the special wildcards or placeholders that can be used\n\t\tlongDescription: \"This rule no longer allows PLAYER_NAME to speak freely, she is given a set of sentences allowed and can only use those in chat and whispers. Does not affect OOC.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You broke a rule by not using one of the allowed phrases for you!\",\n\t\t\tattempt_log: \"PLAYER_NAME broke a rule by trying to not use one of the allowed phrases\",\n\t\t\tlog: \"PLAYER_NAME broke a rule by not using one of the allowed phrases\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tlistOfAllowedSentences: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\t// TODO: needs an update describing the special wildcards or placeholders that can be used\n\t\t\t\tdescription: \"Only these phrases are still allowed:\",\n\t\t\t\toptions: /^([^/.*()][^()]*)?$/\n\t\t\t}\n\t\t}\n\t});\n\t*/\n\n\tregisterRule(\"speech_alter_faltering\", {\n\t\tname: \"Enforce faltering speech\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"an enhanced studder effect is added to PLAYER_NAME's chat texts\",\n\t\tlongDescription: \"Thus rule converts PLAYER_NAME's messages, so she is only able to speak studdering and with random filler sounds, for some [RP] reason (anxiousness, arousal, fear, etc.). Converts the typed chat text automatically. Affects chat messages and whispers, but not OOC.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tinit(state) {\n\t\t\tregisterSpeechHook({\n\t\t\t\tmodify: (msg, text) => {\n\t\t\t\t\tif (state.inEffect && (msg.type === \"Chat\" || msg.type === \"Whisper\")) {\n\t\t\t\t\t\treturn falteringSpeech(text);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tregisterRule(\"speech_mandatory_words\", {\n\t\tname: \"Establish mandatory words\",\n\t\ticon: \"Icons/Chat.png\",\n\t\tshortDescription: \"of which at least one needs to always be included when speaking openly\",\n\t\tlongDescription: \"This rule gives PLAYER_NAME a list of words from which at least one has to always be used in any chat message. The list of mandatory words can be configured. Checks are not case sensitive (adding 'miss' also works for 'MISS' and 'Miss'). Doesn't affect whispers, emotes and OOC text.\",\n\t\ttriggerTexts: {\n\t\t\tinfoBeep: \"You forgot to include one of the mandatory words!\",\n\t\t\tattempt_log: \"PLAYER_NAME almost forgot to use a mandatory word while talking\",\n\t\t\tlog: \"PLAYER_NAME did not use a mandatory word while talking\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.normal,\n\t\tdataDefinition: {\n\t\t\tmandatoryWords: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"At least one of these words always needs to be used:\",\n\t\t\t\toptions: {\n\t\t\t\t\tvalidate: /^\\p{L}*$/iu\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tinit(state) {\n\t\t\tconst check = (msg: SpeechMessageInfo): boolean => {\n\t\t\t\tif (msg.type !== \"Chat\" || !state.customData?.mandatoryWords?.length)\n\t\t\t\t\treturn true;\n\t\t\t\tif (msg.noOOCMessage?.trim() === \"\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tconst words = Array.from((msg.noOOCMessage ?? msg.originalMessage).toLocaleLowerCase().matchAll(/\\p{L}+/igu)).map(i => i[0]);\n\t\t\t\treturn state.customData?.mandatoryWords.some(i => words.includes(i.toLocaleLowerCase()));\n\t\t\t};\n\t\t\tregisterSpeechHook({\n\t\t\t\tallowSend: (msg) => {\n\t\t\t\t\tif (state.isEnforced && !check(msg)) {\n\t\t\t\t\t\tstate.triggerAttempt();\n\t\t\t\t\t\treturn SpeechHookAllow.BLOCK;\n\t\t\t\t\t}\n\t\t\t\t\treturn SpeechHookAllow.ALLOW;\n\t\t\t\t},\n\t\t\t\tonSend: (msg) => {\n\t\t\t\t\tif (state.inEffect && !check(msg)) {\n\t\t\t\t\t\tstate.trigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n}\n","import { ConditionsLimit } from \"../constants\";\nimport { registerRule } from \"../modules/rules\";\nimport { ChatRoomSendLocal } from \"../utilsClub\";\n\nexport function initRules_other() {\n\tlet lastAction = Date.now();\n\tlet afkDidTrigger = false;\n\tfunction afk_reset() {\n\t\tlastAction = Date.now();\n\t\tafkDidTrigger = false;\n\t}\n\n\tregisterRule(\"other_forbid_afk\", {\n\t\tname: \"Forbid going afk\",\n\t\ticon: \"Icons/Chest.png\",\n\t\tenforceable: false,\n\t\tshortDescription: \"logs whenever PLAYER_NAME is inactive\",\n\t\tlongDescription: \"This rule forbids PLAYER_NAME to go afk and logs when the allowed inactivity threshold is overstepped.\",\n\t\ttriggerTexts: {\n\t\t\tlog: \"PLAYER_NAME became inactive, which was forbidden\",\n\t\t\tannounce: \"\"\n\t\t},\n\t\tdefaultLimit: ConditionsLimit.blocked,\n\t\tdataDefinition: {\n\t\t\tminutesBeforeAfk: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 10,\n\t\t\t\tdescription: \"Amount of minutes, before being considered inactive:\"\n\t\t\t}\n\t\t},\n\t\tload() {\n\t\t\tAfkTimerEventsList.forEach(e => document.addEventListener(e, afk_reset, true));\n\t\t},\n\t\ttick(state) {\n\t\t\tif (!afkDidTrigger && state.inEffect && state.customData &&\n\t\t\t\tDate.now() > lastAction + state.customData.minutesBeforeAfk * 60 * 1000\n\t\t\t) {\n\t\t\t\tafkDidTrigger = true;\n\t\t\t\tstate.trigger();\n\t\t\t\tChatRoomSendLocal(\"You broke a BCX rule by being inactive for too long. The transgression was logged.\");\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tunload() {\n\t\t\tAfkTimerEventsList.forEach(e => document.removeEventListener(e, afk_reset, true));\n\t\t}\n\t});\n\n\t/* TODO: Implement\n\tregisterRule(\"log_online_time\", {\n\t\tname: \"Track online time\",\n\t\ticon: \"Icons/Chest.png\",\n\t\tenforceable: false,\n\t\tloggable: false,\n\t\tshortDescription: \"counts the time PLAYER_NAME spent in the club\",\n\t\tlongDescription: \"This rule shows the constantly updated amount of minutes, hours and days PLAYER_NAME spent (online) in the club since the rule was added. The value is shown inside the configuration screen of this rule. To reset the counter, remove and add the rule again.\",\n\t\tdefaultLimit: ConditionsLimit.blocked\n\t});\n\t*/\n\n\tlet lastReminder = 0;\n\tregisterRule(\"other_constant_reminder\", {\n\t\tname: \"Listen to my voice\",\n\t\ticon: \"Icons/Chest.png\",\n\t\tloggable: false,\n\t\tenforceable: false,\n\t\tshortDescription: \"regularily show configurable sentences to PLAYER_NAME\",\n\t\tlongDescription: \"This rule reminds or tells PLAYER_NAME one of the recorded sentences at random in a settable interval. Only PLAYER_NAME can see the set message and it is only shown if in a chat room.\",\n\t\tdefaultLimit: ConditionsLimit.limited,\n\t\tdataDefinition: {\n\t\t\treminderText: {\n\t\t\t\ttype: \"stringList\",\n\t\t\t\tdefault: [],\n\t\t\t\tdescription: \"The sentences that will be shown at random:\",\n\t\t\t\tY: 296\n\t\t\t},\n\t\t\treminderFrequency: {\n\t\t\t\ttype: \"number\",\n\t\t\t\tdefault: 15,\n\t\t\t\tdescription: \"Frequency of a sentence being shown (in minutes):\",\n\t\t\t\tY: 715\n\t\t\t}\n\t\t},\n\t\ttick(state) {\n\t\t\tif (state.inEffect && state.customData && state.customData.reminderText !== [] &&\n\t\t\t\tServerPlayerIsInChatRoom() &&\n\t\t\t\tDate.now() > lastReminder + state.customData.reminderFrequency * 60 * 1000\n\t\t\t) {\n\t\t\t\tlastReminder = Date.now();\n\t\t\t\tChatRoomSendLocal(\"[Voice] \" + state.customData.reminderText[Math.floor(Math.random()*state.customData.reminderText.length)]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n\n\t/* TODO: Idea stage\n\tregisterRule(\"restrict_console_usage\", {\n\t\tname: \"Restrict console usage\",\n\t\ticon: \"Icons/Chest.png\",\n\t\tloggable: false,\n\t\tshortDescription: \"to not allow freeing oneself\",\n\t\tlongDescription: \"Makes the player unable to use the browser console to change their own appearance in the club, such as removing restraints.\",\n\t\tdefaultLimit: ConditionsLimit.blocked\n\t});\n\t*/\n\n\t/* TODO: Idea stage\n\tregisterRule(\"track_BCX_activation\", {\n\t\tname: \"Track BCX activation\",\n\t\ticon: \"Icons/Chest.png\",\n\t\tenforceable: false,\n\t\tshortDescription: \"logs if PLAYER_NAME enters the club without BCX\",\n\t\tlongDescription: \"This rule observes PLAYER_NAME, logging it as a rule violation if the club is entered without BCX active.\",\n\t\tdefaultLimit: ConditionsLimit.blocked\n\t});\n\t*/\n}\n","import { ConditionsLimit, ModuleCategory, ModuleInitPhase, MODULE_NAMES } from \"../constants\";\nimport { moduleInitPhase } from \"../moduleManager\";\nimport { capitalizeFirstLetter, isObject } from \"../utils\";\nimport { notifyOfChange, queryHandlers } from \"./messaging\";\nimport { moduleIsEnabled } from \"./presets\";\nimport { modStorage, modStorageSync } from \"./storage\";\nimport { BaseModule } from \"./_BaseModule\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport isEqual from \"lodash-es/isEqual\";\nimport { ChatroomCharacter, getAllCharactersInRoom } from \"../characters\";\nimport { AccessLevel, checkPermissionAccess, getHighestRoleInRoom } from \"./authority\";\nimport { COMMAND_GENERIC_ERROR, Command_parseTime, Command_pickAutocomplete, Command_selectCharacterAutocomplete, Command_selectCharacterMemberNumber } from \"./commands\";\nimport { getCharacterName } from \"../utilsClub\";\nimport { BCX_setInterval } from \"../BCXContext\";\n\nconst CONDITIONS_CHECK_INTERVAL = 2_000;\n\nexport function guard_ConditionsConditionRequirements(data: unknown): data is ConditionsConditionRequirements {\n\treturn isObject(data) &&\n\t\t(\n\t\t\tdata.orLogic === undefined ||\n\t\t\tdata.orLogic === true\n\t\t) &&\n\t\t(\n\t\t\tdata.room === undefined ||\n\t\t\tisObject(data.room) &&\n\t\t\t(data.room.inverted === undefined || data.room.inverted === true) &&\n\t\t\t(data.room.type === \"public\" || data.room.type === \"private\")\n\t\t) &&\n\t\t(\n\t\t\tdata.roomName === undefined ||\n\t\t\tisObject(data.roomName) &&\n\t\t\t(data.roomName.inverted === undefined || data.roomName.inverted === true) &&\n\t\t\ttypeof data.roomName.name === \"string\"\n\t\t) &&\n\t\t(\n\t\t\tdata.role === undefined ||\n\t\t\tisObject(data.role) &&\n\t\t\t(data.role.inverted === undefined || data.role.inverted === true) &&\n\t\t\ttypeof data.role.role === \"number\" &&\n\t\t\tAccessLevel[data.role.role] !== undefined\n\t\t) &&\n\t\t(\n\t\t\tdata.player === undefined ||\n\t\t\tisObject(data.player) &&\n\t\t\t(data.player.inverted === undefined || data.player.inverted === true) &&\n\t\t\ttypeof data.player.memberNumber === \"number\"\n\t\t);\n}\n\nexport function guard_ConditionsConditionPublicData<C extends ConditionsCategories>(category: C, condition: string, data: unknown): data is ConditionsConditionPublicData<C> {\n\tconst d = data as ConditionsConditionPublicData;\n\tconst handler = conditionHandlers.get(category);\n\tif (!handler)\n\t\treturn false;\n\treturn handler.loadValidateConditionKey(condition) &&\n\t\tisObject(d) &&\n\t\ttypeof d.active === \"boolean\" &&\n\t\ttypeof d.favorite === \"boolean\" &&\n\t\t(d.timer === null || typeof d.timer === \"number\") &&\n\t\ttypeof d.timerRemove === \"boolean\" &&\n\t\t(d.requirements === null || guard_ConditionsConditionRequirements(d.requirements)) &&\n\t\t(d.addedBy === undefined || Number.isInteger(d.addedBy)) &&\n\t\thandler.validatePublicData(condition, d.data);\n}\n\nexport function guard_ConditionsCategoryPublicData<C extends ConditionsCategories>(category: C, data: unknown, allowInvalidConditionRemoval: boolean = false): data is ConditionsCategoryPublicData<C> {\n\tconst d = data as ConditionsCategoryPublicData;\n\tconst handler = conditionHandlers.get(category);\n\tif (!handler)\n\t\treturn false;\n\treturn isObject(d) &&\n\t\ttypeof d.access_normal === \"boolean\" &&\n\t\ttypeof d.access_limited === \"boolean\" &&\n\t\ttypeof d.access_configure === \"boolean\" &&\n\t\ttypeof d.access_changeLimits === \"boolean\" &&\n\t\t(\n\t\t\td.highestRoleInRoom === null ||\n\t\t\t(\n\t\t\t\ttypeof d.highestRoleInRoom === \"number\" &&\n\t\t\t\tAccessLevel[d.highestRoleInRoom] !== undefined\n\t\t\t)\n\t\t) &&\n\t\tisObject(d.conditions) &&\n\t\tObject.entries(d.conditions).every(\n\t\t\t([condition, conditionData]) => {\n\t\t\t\tconst res = guard_ConditionsConditionPublicData(category, condition, conditionData);\n\t\t\t\tif (!res && allowInvalidConditionRemoval) {\n\t\t\t\t\tconsole.warn(`BCX: Removing invalid ${condition}:${category} condition from public data`, conditionData);\n\t\t\t\t\tdelete d.conditions[condition];\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t}\n\t\t) &&\n\t\t(d.timer === null || typeof d.timer === \"number\") &&\n\t\ttypeof d.timerRemove === \"boolean\" &&\n\t\thandler.validateCategorySpecificGlobalData(d.data) &&\n\t\tguard_ConditionsConditionRequirements(d.requirements) &&\n\t\tisObject(d.limits) &&\n\t\tObject.entries(d.limits).every(\n\t\t\t([condition, limit]) => limit === undefined || typeof limit === \"number\" && ConditionsLimit[limit] !== undefined\n\t\t);\n}\n\nexport interface ConditionsHandler<C extends ConditionsCategories> {\n\tcategory: ModuleCategory;\n\tpermission_normal: BCX_Permissions;\n\tpermission_limited: BCX_Permissions;\n\tpermission_configure: BCX_Permissions;\n\tpermission_changeLimits: BCX_Permissions;\n\tpermission_viewOriginator: BCX_Permissions;\n\tloadValidateConditionKey(key: string): boolean;\n\tloadValidateCondition(key: string, data: ConditionsConditionData<C>): boolean;\n\tloadCategorySpecificGlobalData(data: ConditionsCategorySpecificGlobalData[C] | undefined): ConditionsCategorySpecificGlobalData[C];\n\tstateChangeHandler(condition: ConditionsCategoryKeys[C], data: ConditionsConditionData<C>, newState: boolean): void;\n\ttickHandler(condition: ConditionsCategoryKeys[C], data: ConditionsConditionData<C>): void;\n\tafterTickHandler?(): void;\n\tmakePublicData(condition: ConditionsCategoryKeys[C], data: ConditionsConditionData<C>): ConditionsCategorySpecificPublicData[C];\n\tvalidateCategorySpecificGlobalData(data: ConditionsCategorySpecificGlobalData[C]): boolean;\n\tvalidatePublicData(condition: ConditionsCategoryKeys[C], data: ConditionsCategorySpecificPublicData[C]): boolean;\n\tupdateCondition(\n\t\tcondition: ConditionsCategoryKeys[C],\n\t\tdata: ConditionsConditionData<C>,\n\t\tupdateData: ConditionsCategorySpecificPublicData[C],\n\t\tcharacter: ChatroomCharacter | null,\n\t\trawData: ConditionsConditionPublicData<C>\n\t): boolean;\n\tlogLimitChange(condition: ConditionsCategoryKeys[C], character: ChatroomCharacter, newLimit: ConditionsLimit, oldLimit: ConditionsLimit): void;\n\tlogConditionUpdate(condition: ConditionsCategoryKeys[C], character: ChatroomCharacter, newData: ConditionsConditionPublicData<C>, oldData: ConditionsConditionPublicData<C>): void;\n\tlogCategoryUpdate(character: ChatroomCharacter, newData: ConditionsCategoryConfigurableData, oldData: ConditionsCategoryConfigurableData): void;\n\tgetDefaultLimits(): Record<string, ConditionsLimit>;\n\tparseConditionName(selector: string, onlyExisting: false | (ConditionsCategoryKeys[C])[]): [boolean, string | ConditionsCategoryKeys[C]];\n\tautocompleteConditionName(selector: string, onlyExisting: false | (ConditionsCategoryKeys[C])[]): string[];\n\tcommandConditionSelectorHelp: string;\n}\n\nconst conditionHandlers: Map<ConditionsCategories, ConditionsHandler<ConditionsCategories>> = new Map();\n\nexport function ConditionsRegisterCategory<C extends ConditionsCategories>(category: C, handler: ConditionsHandler<C>): void {\n\tif (moduleInitPhase !== ModuleInitPhase.init) {\n\t\tthrow new Error(\"Conditions categories can be registered only during init\");\n\t}\n\tif (conditionHandlers.has(category)) {\n\t\tthrow new Error(`Conditions categories \"${category}\" already defined!`);\n\t}\n\tconditionHandlers.set(category, handler);\n}\n\nexport function ConditionsGetCategoryHandler<C extends ConditionsCategories>(category: C): ConditionsHandler<C> {\n\tconst handler = conditionHandlers.get(category);\n\tif (!handler) {\n\t\tthrow new Error(`No handler for conditions category ${category}`);\n\t}\n\treturn handler as ConditionsHandler<C>;\n}\n\nexport function ConditionsGetCategoryEnabled(category: ConditionsCategories): boolean {\n\treturn moduleIsEnabled(ConditionsGetCategoryHandler(category).category);\n}\n\n\n/** Unsafe when category is disabled, check before using */\nexport function ConditionsGetCategoryData<C extends ConditionsCategories>(category: C): ConditionsCategoryData<C> {\n\tif (!conditionHandlers.has(category)) {\n\t\tthrow new Error(`Attempt to get unknown conditions category data ${category}`);\n\t}\n\tconst data = modStorage.conditions?.[category];\n\tif (!data) {\n\t\tthrow new Error(`Attempt to get data for uninitialized category ${category}`);\n\t}\n\treturn data as ConditionsCategoryData<C>;\n}\n\nfunction ConditionsMakeConditionPublicData<C extends ConditionsCategories>(\n\thandler: ConditionsHandler<C>,\n\tcondition: ConditionsCategoryKeys[C],\n\tconditionData: ConditionsConditionData<C>,\n\trequester: ChatroomCharacter | null\n): ConditionsConditionPublicData<C> {\n\tconst res: ConditionsConditionPublicData<C> = {\n\t\tactive: conditionData.active,\n\t\tdata: handler.makePublicData(condition, conditionData),\n\t\ttimer: conditionData.timer ?? null,\n\t\ttimerRemove: conditionData.timerRemove ?? false,\n\t\trequirements: conditionData.requirements ? cloneDeep(conditionData.requirements) : null,\n\t\tfavorite: conditionData.favorite ?? false\n\t};\n\tif (requester === null || checkPermissionAccess(handler.permission_viewOriginator, requester)) {\n\t\tres.addedBy = conditionData.addedBy;\n\t}\n\treturn res;\n}\n\n/** Unsafe when category is disabled, check before using */\nexport function ConditionsGetCategoryPublicData<C extends ConditionsCategories>(category: C, requester: ChatroomCharacter): ConditionsCategoryPublicData<C> {\n\tconst handler = ConditionsGetCategoryHandler<ConditionsCategories>(category);\n\tconst data = ConditionsGetCategoryData<ConditionsCategories>(category);\n\tconst res: ConditionsCategoryPublicData<ConditionsCategories> = {\n\t\taccess_normal: checkPermissionAccess(handler.permission_normal, requester),\n\t\taccess_limited: checkPermissionAccess(handler.permission_limited, requester),\n\t\taccess_configure: checkPermissionAccess(handler.permission_configure, requester),\n\t\taccess_changeLimits: checkPermissionAccess(handler.permission_changeLimits, requester),\n\t\thighestRoleInRoom: getHighestRoleInRoom(),\n\t\tconditions: {},\n\t\ttimer: data.timer ?? null,\n\t\ttimerRemove: data.timerRemove ?? false,\n\t\tdata: cloneDeep(data.data),\n\t\tlimits: {\n\t\t\t...handler.getDefaultLimits(),\n\t\t\t...data.limits\n\t\t},\n\t\trequirements: cloneDeep(data.requirements)\n\t};\n\tfor (const [condition, conditionData] of Object.entries(data.conditions)) {\n\t\tres.conditions[condition] = ConditionsMakeConditionPublicData<ConditionsCategories>(handler, condition, conditionData, requester);\n\t}\n\treturn res as ConditionsCategoryPublicData<C>;\n}\n\nexport function ConditionsGetCondition<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C]): ConditionsConditionData<C> | undefined {\n\tif (!ConditionsGetCategoryEnabled(category))\n\t\treturn undefined;\n\treturn ConditionsGetCategoryData(category).conditions[condition];\n}\n\nexport function ConditionsIsConditionInEffect<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C]): boolean {\n\tif (!ConditionsGetCategoryEnabled(category))\n\t\treturn false;\n\tconst categoryData = ConditionsGetCategoryData(category);\n\tconst conditionData = categoryData.conditions[condition];\n\n\tif (!conditionData)\n\t\treturn false;\n\n\tif (conditionData.timer !== undefined && conditionData.timer <= Date.now())\n\t\treturn false;\n\n\tif (!conditionData.active)\n\t\treturn false;\n\n\tconst requirements = conditionData.requirements ?? categoryData.requirements;\n\tif (!ConditionsEvaluateRequirements(requirements))\n\t\treturn false;\n\n\treturn true;\n}\n\nexport function ConditionsSetCondition<C extends ConditionsCategories>(\n\tcategory: C,\n\tcondition: ConditionsCategoryKeys[C],\n\tdata: ConditionsCategorySpecificData[C],\n\tsource: ChatroomCharacter | null\n) {\n\tconst handler = ConditionsGetCategoryHandler(category);\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn;\n\tconst categoryData = ConditionsGetCategoryData(category);\n\tconst existing = categoryData.conditions[condition];\n\tif (existing) {\n\t\texisting.data = data;\n\t} else {\n\t\tconst res: ConditionsConditionData<C> = {\n\t\t\tactive: true,\n\t\t\tlastActive: false,\n\t\t\ttimer: categoryData.timer !== undefined ? Date.now() + categoryData.timer : undefined,\n\t\t\ttimerRemove: categoryData.timerRemove,\n\t\t\tdata\n\t\t};\n\t\tif (source) {\n\t\t\tres.addedBy = source.MemberNumber;\n\t\t}\n\t\tcategoryData.conditions[condition] = res;\n\t}\n\tmodStorageSync();\n\tnotifyOfChange();\n}\n\nexport function ConditionsGetConditionLimit<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C]): ConditionsLimit {\n\tconst handler = ConditionsGetCategoryHandler(category);\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn ConditionsLimit.blocked;\n\tconst data = ConditionsGetCategoryData(category);\n\treturn data.limits[condition] ?? handler.getDefaultLimits()[condition] ?? ConditionsLimit.normal;\n}\n\nexport function ConditionsCheckAccess<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], character: ChatroomCharacter): boolean {\n\tconst limit = ConditionsGetConditionLimit(category, condition);\n\tif (limit === ConditionsLimit.blocked)\n\t\treturn false;\n\tconst handler = ConditionsGetCategoryHandler(category);\n\treturn checkPermissionAccess(limit === ConditionsLimit.limited ? handler.permission_limited : handler.permission_normal, character);\n}\n\nexport function ConditionsRemoveCondition<C extends ConditionsCategories>(category: C, conditions: ConditionsCategoryKeys[C] | ConditionsCategoryKeys[C][]): boolean {\n\tif (!ConditionsGetCategoryEnabled(category))\n\t\treturn false;\n\tif (!Array.isArray(conditions)) {\n\t\tconditions = [conditions];\n\t}\n\tconst categoryData = ConditionsGetCategoryData(category);\n\tconst handler = ConditionsGetCategoryHandler(category);\n\tlet changed = false;\n\tfor (const condition of conditions) {\n\t\tif (categoryData.conditions[condition]) {\n\t\t\thandler.stateChangeHandler(condition, categoryData.conditions[condition], false);\n\t\t\tdelete categoryData.conditions[condition];\n\t\t\tchanged = true;\n\t\t}\n\t}\n\tif (changed) {\n\t\tmodStorageSync();\n\t\tnotifyOfChange();\n\t}\n\treturn changed;\n}\n\nexport function ConditionsSetLimit<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], limit: ConditionsLimit, character: ChatroomCharacter | null): boolean {\n\tconst handler = ConditionsGetCategoryHandler<ConditionsCategories>(category);\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn false;\n\tif (!handler.loadValidateConditionKey(condition)) {\n\t\tconsole.warn(`Attempt to set invalid condition limit ${category}:${condition}`);\n\t\treturn false;\n\t}\n\tconst data = ConditionsGetCategoryData(category);\n\tif (character && !checkPermissionAccess(handler.permission_changeLimits, character)) {\n\t\treturn false;\n\t}\n\tif (data.conditions[condition] !== undefined)\n\t\treturn false;\n\tconst defaultLimit = handler.getDefaultLimits()[condition] ?? ConditionsLimit.normal;\n\tconst oldLimit = data.limits[condition] ?? defaultLimit;\n\tif (oldLimit === limit)\n\t\treturn true;\n\tif (limit === defaultLimit) {\n\t\tdelete data.limits[condition];\n\t} else {\n\t\tdata.limits[condition] = limit;\n\t}\n\tif (character) {\n\t\thandler.logLimitChange(condition, character, limit, oldLimit);\n\t}\n\tnotifyOfChange();\n\tmodStorageSync();\n\treturn true;\n}\n\nexport function ConditionsUpdate<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], data: ConditionsConditionPublicData<C>, character: ChatroomCharacter | null): boolean {\n\tconst handler = ConditionsGetCategoryHandler<ConditionsCategories>(category);\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn false;\n\tif (character && !ConditionsCheckAccess(category, condition, character))\n\t\treturn false;\n\tconst conditionData = ConditionsGetCondition<ConditionsCategories>(category, condition);\n\tif (!conditionData)\n\t\treturn false;\n\tconst oldData = ConditionsMakeConditionPublicData<ConditionsCategories>(handler, condition, conditionData, character);\n\tif (!handler.updateCondition(condition, conditionData, data.data, character, data))\n\t\treturn false;\n\tconditionData.active = data.active;\n\tif (data.favorite) {\n\t\tconditionData.favorite = true;\n\t} else {\n\t\tdelete conditionData.favorite;\n\t}\n\tif (data.requirements) {\n\t\tconditionData.requirements = data.requirements;\n\t\t// Default back to \"AND\", if requirements are empty\n\t\tconst requirements = conditionData.requirements;\n\t\tconst hasAnyRequirement = !!(requirements.room || requirements.roomName || requirements.role || requirements.player);\n\t\tif (requirements.orLogic && !hasAnyRequirement) {\n\t\t\tdelete requirements.orLogic;\n\t\t}\n\t} else {\n\t\tdelete conditionData.requirements;\n\t}\n\tif (data.timer !== null) {\n\t\tconditionData.timer = data.timer;\n\t} else {\n\t\tdelete conditionData.timer;\n\t}\n\tif (data.timerRemove && data.active) {\n\t\tconditionData.timerRemove = true;\n\t} else {\n\t\tdelete conditionData.timerRemove;\n\t}\n\tif (character) {\n\t\thandler.logConditionUpdate(condition, character, data, oldData);\n\t}\n\tnotifyOfChange();\n\tmodStorageSync();\n\treturn true;\n}\n\nexport function ConditionsCategoryUpdate<C extends ConditionsCategories>(category: C, data: ConditionsCategoryConfigurableData, character: ChatroomCharacter | null): boolean {\n\tconst handler = ConditionsGetCategoryHandler<ConditionsCategories>(category);\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn false;\n\tif (character && !checkPermissionAccess(handler.permission_configure, character))\n\t\treturn false;\n\tconst conditionData = ConditionsGetCategoryData<ConditionsCategories>(category);\n\tif (!conditionData)\n\t\treturn false;\n\tconst oldData = character && ConditionsGetCategoryPublicData(category, character);\n\tconditionData.requirements = data.requirements;\n\t// Default back to \"AND\", if requirements are empty\n\tconst requirements = conditionData.requirements;\n\tconst hasAnyRequirement = !!(requirements.room || requirements.roomName || requirements.role || requirements.player);\n\tif (requirements.orLogic && !hasAnyRequirement) {\n\t\tdelete requirements.orLogic;\n\t}\n\tif (data.timer !== null) {\n\t\tconditionData.timer = data.timer;\n\t} else {\n\t\tdelete conditionData.timer;\n\t}\n\tif (data.timerRemove) {\n\t\tconditionData.timerRemove = true;\n\t} else {\n\t\tdelete conditionData.timerRemove;\n\t}\n\tconditionData.data = cloneDeep(data.data);\n\tif (character && oldData) {\n\t\thandler.logCategoryUpdate(character, data, oldData);\n\t}\n\tnotifyOfChange();\n\tmodStorageSync();\n\treturn true;\n}\n\nexport function ConditionsEvaluateRequirements(requirements: ConditionsConditionRequirements, highestRoleInRoom?: AccessLevel | null): boolean {\n\tconst inChatroom = ServerPlayerIsInChatRoom();\n\tconst chatroomPrivate = inChatroom && ChatRoomData && ChatRoomData.Private;\n\tconst results: boolean[] = [];\n\tif (requirements.room) {\n\t\tconst res = inChatroom &&\n\t\t\t(requirements.room.type === \"public\" ? !chatroomPrivate : chatroomPrivate);\n\t\tresults.push(requirements.room.inverted ? !res : res);\n\t}\n\tif (requirements.roomName) {\n\t\tconst res = inChatroom &&\n\t\t\tChatRoomData &&\n\t\t\ttypeof ChatRoomData.Name === \"string\" &&\n\t\t\tChatRoomData.Name.toLocaleLowerCase() === requirements.roomName.name.toLocaleLowerCase();\n\t\tresults.push(requirements.roomName.inverted ? !res : res);\n\t}\n\tif (requirements.role) {\n\t\tif (highestRoleInRoom === undefined) {\n\t\t\thighestRoleInRoom = getHighestRoleInRoom();\n\t\t}\n\t\tconst res = highestRoleInRoom != null && highestRoleInRoom <= requirements.role.role;\n\t\tresults.push(requirements.role.inverted ? !res : res);\n\t}\n\tif (requirements.player) {\n\t\tconst res = inChatroom &&\n\t\t\tgetAllCharactersInRoom().some(c => c.MemberNumber === requirements.player!.memberNumber);\n\t\tresults.push(requirements.player.inverted ? !res : res);\n\t}\n\n\tif (results.length === 0)\n\t\treturn true;\n\telse if (requirements.orLogic)\n\t\treturn results.includes(true);\n\telse // AND logic\n\t\treturn !results.includes(false);\n}\n\nexport type ConditionsSubcommand = \"setactive\" | \"triggers\" | \"globaltriggers\" | \"timer\" | \"defaulttimer\" | \"setlimit\";\nexport const ConditionsSubcommands: ConditionsSubcommand[] = [\"setactive\", \"triggers\", \"globaltriggers\", \"timer\", \"defaulttimer\", \"setlimit\"];\n\n/*\n!curses setactive <condition> <yes/no> - Switch the curse and its conditions on and off\n\n!curses triggers <condition> global <yes/no> - Set the trigger condition of this curse to the global configuration\n!curses triggers <condition> <[for each trigger separately]>\n!curses globaltriggers <[for each trigger separately]>\n\n!curses timer <condition> <[timer handle]>\n!curses defaulttimer <[timer handle]>\n\n!curses setlimit <condition> <normal/limited/blocked> - Set a limit on certain <condition>\n\ntimer handling:\ndisable - Remove the timer and set lifetime to infinite\nset <time> (time in /[0-9]+d [0-9]+h [0-9]+m [0-9]+s/ format, each part optional) - Set timer to the given amount of days, hours, minutes or seconds (e.g. 23h 30m)\nautoremove <yes/no> - Set if the curse is removed when the timer runs out or just disables itself\n\n(global)triggers commands:\nlogic <or/and>\t\t\t\t\t\t\tIf the logic should be OR or AND logic; defaults to AND\nroom ignore \t\t\t\t\t\t\tRemove the 'room type'-based trigger condition\nroom <is/isnot> <public/private>\t\tAdd such a 'room type'-based trigger condition\nroomname ignore\t\t\t\t\t\t\tRemove the 'room name'-based trigger condition\nroomname <is/isnot> <name>\t\t\t\tAdd such a 'room name'-based trigger condition\nrole ignore\t\t\t\t\t\t\t\tRemove the role-based trigger condition\nrole <with/notwith> <role>\t\t\t\tAdd such a role-based trigger condition\nplayer ignore\t\t\t\t\t\t\tRemove the person-based trigger condition\nplayer <with/notwith> <memberNumber>\tAdd such a person-based trigger condition\n*/\n\nconst ConditionsCommandTriggersKeywords = [\"room\", \"roomname\", \"role\", \"player\"];\nfunction ConditionsCommandProcessTriggers(triggers: ConditionsConditionRequirements, argv: string[], sender: ChatroomCharacter, respond: (msg: string) => void): boolean {\n\tconst trigger = (argv[0] || \"\").toLocaleLowerCase();\n\tconst keyword = (argv[1] || \"\").toLocaleLowerCase();\n\tif (keyword === \"ignore\" && argv.length !== 2) {\n\t\trespond(`Error:\\n'${trigger} ignore' does not expect any extra arguments.`);\n\t\treturn true;\n\t}\n\tif (![\"is\", \"isnot\", \"with\", \"notwith\"].includes(keyword)) {\n\t\trespond(`Error:\\nUnknown setting '${keyword}'. please use one of: ${trigger === \"room\" || trigger === \"roomname\" ? \"is, isnot\" : \"with, notwith\"}`);\n\t\treturn true;\n\t}\n\tif (argv.length !== 3) {\n\t\trespond(`Error:\\n'${trigger} ${keyword} <value>' got too many arguments. Arguments with space need to be \"quoted\".`);\n\t\treturn true;\n\t}\n\tconst inverted = (keyword === \"isnot\" || keyword === \"notwith\") ? true : undefined;\n\tlet value = argv[2];\n\tif (trigger === \"room\") {\n\t\tif (keyword === \"ignore\") {\n\t\t\tdelete triggers.room;\n\t\t\treturn false;\n\t\t}\n\t\tvalue = value.toLocaleLowerCase();\n\t\tif (value !== \"public\" && value !== \"private\") {\n\t\t\trespond(`Error:\\nRoom can be either 'public' or 'private', got: '${value}'`);\n\t\t\treturn true;\n\t\t}\n\t\ttriggers.room = {\n\t\t\ttype: value,\n\t\t\tinverted\n\t\t};\n\t} else if (trigger === \"roomname\") {\n\t\tif (keyword === \"ignore\") {\n\t\t\tdelete triggers.roomName;\n\t\t\treturn false;\n\t\t}\n\t\ttriggers.roomName = {\n\t\t\tname: value,\n\t\t\tinverted\n\t\t};\n\t} else if (trigger === \"role\") {\n\t\tif (keyword === \"ignore\") {\n\t\t\tdelete triggers.role;\n\t\t\treturn false;\n\t\t}\n\t\tconst level = (AccessLevel as any)[value.toLocaleLowerCase()] as AccessLevel;\n\t\tif (typeof level !== \"number\" || level === AccessLevel.self) {\n\t\t\trespond(`Error:\\n` +\n\t\t\t\t`'role ${keyword}' expects one of: clubowner, owner, lover, mistress, whitelist, friend, public; got: '${value.toLocaleLowerCase()}'`);\n\t\t\treturn true;\n\t\t}\n\t\ttriggers.role = {\n\t\t\trole: level,\n\t\t\tinverted\n\t\t};\n\t} else if (trigger === \"player\") {\n\t\tif (keyword === \"ignore\") {\n\t\t\tdelete triggers.player;\n\t\t\treturn false;\n\t\t}\n\t\tconst target = Command_selectCharacterMemberNumber(value, true);\n\t\tif (typeof target === \"string\") {\n\t\t\trespond(target);\n\t\t\treturn true;\n\t\t}\n\t\ttriggers.player = {\n\t\t\tmemberNumber: target,\n\t\t\tinverted\n\t\t};\n\t}\n\treturn false;\n}\nfunction ConditionsCommandTriggersAutocomplete(argv: string[], sender: ChatroomCharacter): string[] {\n\tconst trigger = (argv[0] || \"\").toLocaleLowerCase();\n\tif (argv.length < 2)\n\t\treturn [];\n\tif (trigger === \"room\" && argv.length === 2) {\n\t\treturn Command_pickAutocomplete(argv[1], [\"ignore\", \"is\", \"isnot\"]);\n\t}\n\tif (trigger === \"room\" && argv.length === 3) {\n\t\treturn Command_pickAutocomplete(argv[2], [\"public\", \"private\"]);\n\t}\n\tif (trigger === \"roomname\" && argv.length === 2) {\n\t\treturn Command_pickAutocomplete(argv[1], [\"ignore\", \"is\", \"isnot\"]);\n\t}\n\tif (trigger === \"role\" && argv.length === 2) {\n\t\treturn Command_pickAutocomplete(argv[1], [\"ignore\", \"with\", \"notwith\"]);\n\t}\n\tif (trigger === \"role\" && argv.length === 3) {\n\t\treturn Command_pickAutocomplete(argv[2], [\"clubowner\", \"owner\", \"lover\", \"mistress\", \"whitelist\", \"friend\", \"public\"]);\n\t}\n\tif (trigger === \"player\" && argv.length === 2) {\n\t\treturn Command_pickAutocomplete(argv[1], [\"ignore\", \"with\", \"notwith\"]);\n\t}\n\tif (trigger === \"player\" && argv.length === 3) {\n\t\treturn Command_selectCharacterAutocomplete(argv[2]);\n\t}\n\treturn [];\n}\n\nexport function ConditionsRunSubcommand(category: ConditionsCategories, argv: string[], sender: ChatroomCharacter, respond: (msg: string) => void): void {\n\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase() as ConditionsSubcommand;\n\tif (!ConditionsSubcommands.includes(subcommand)) {\n\t\tthrow new Error(`Subcomand \"${subcommand}\" passed to ConditionsRunSubcommand isn't valid ConditionsSubcommand`);\n\t}\n\n\tconst handler = conditionHandlers.get(category);\n\tif (!handler) {\n\t\tthrow new Error(`Attempt to run command for unknown conditions category ${category}`);\n\t}\n\tif (!moduleIsEnabled(handler.category)) {\n\t\treturn respond(`The command failed to execute, because ${Player.Name} disabled her ${MODULE_NAMES[handler.category]} module.`);\n\t}\n\tconst categoryData = ConditionsGetCategoryData(category);\n\tconst categorySingular = category.slice(0, -1);\n\tconst CSHelp = handler.commandConditionSelectorHelp;\n\n\tif (subcommand === \"setactive\") {\n\t\tconst active = (argv[2] || \"\").toLocaleLowerCase();\n\t\tif (argv.length !== 3 || active !== \"yes\" && active !== \"no\") {\n\t\t\treturn respond(`Usage:\\nsetactive <${CSHelp}> <yes/no>`);\n\t\t}\n\t\tconst [result, condition] = handler.parseConditionName(argv[1], Object.keys(categoryData.conditions));\n\t\tif (!result) {\n\t\t\treturn respond(condition);\n\t\t}\n\t\tif (!categoryData.conditions[condition]) {\n\t\t\treturn respond(`This ${categorySingular} doesn't exist`);\n\t\t}\n\t\tconst conditionData = ConditionsMakeConditionPublicData(handler, condition, categoryData.conditions[condition], sender);\n\t\tconditionData.active = active === \"yes\";\n\t\trespond(ConditionsUpdate(category, condition, conditionData, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t} else if (subcommand === \"triggers\") {\n\t\tconst [result, condition] = handler.parseConditionName(argv[1] || \"\", Object.keys(categoryData.conditions));\n\t\tif (!result) {\n\t\t\treturn respond(condition);\n\t\t}\n\t\tif (!categoryData.conditions[condition]) {\n\t\t\treturn respond(`This ${categorySingular} doesn't exist`);\n\t\t}\n\t\tconst conditionData = ConditionsMakeConditionPublicData(handler, condition, categoryData.conditions[condition], sender);\n\t\tconst keyword = (argv[2] || \"\").toLocaleLowerCase();\n\t\tif (!keyword) {\n\t\t\tif (!conditionData.requirements) {\n\t\t\t\treturn respond(`Current status:\\n` +\n\t\t\t\t\t`Uses global ${category} trigger configuration`\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst triggers: string[] = [];\n\t\t\t\tconst r = conditionData.requirements;\n\t\t\t\ttriggers.push(r.orLogic ? `Logic: OR (at least one)` : `Logic: AND (all of)`);\n\t\t\t\tif (r.room) {\n\t\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t\t}\n\t\t\t\tif (r.roomName) {\n\t\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t\t}\n\t\t\t\tif (r.role) {\n\t\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t\t}\n\t\t\t\tif (r.player) {\n\t\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t\t}\n\t\t\t\tif (triggers.length > 1) {\n\t\t\t\t\treturn respond(`Current status:\\n` +\n\t\t\t\t\t\t`This ${categorySingular} will trigger under following conditions:\\n` +\n\t\t\t\t\t\ttriggers.join(\"\\n\")\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\treturn respond(`Current status:\\n` +\n\t\t\t\t\t\t`No triggers are set. The ${categorySingular} will now always trigger, while it is active`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (keyword === \"global\") {\n\t\t\tconst global = (argv[3] || \"\").toLocaleLowerCase();\n\t\t\tif (argv.length !== 4 || global !== \"yes\" && global !== \"no\") {\n\t\t\t\treturn respond(`Usage:\\ntriggers <${CSHelp}> global <yes/no>`);\n\t\t\t}\n\t\t\tif (global === \"yes\") {\n\t\t\t\tconditionData.requirements = null;\n\t\t\t} else if (!conditionData.requirements) {\n\t\t\t\tconditionData.requirements = cloneDeep(categoryData.requirements);\n\t\t\t}\n\t\t} else if (keyword === \"logic\") {\n\t\t\tconst logic = (argv[3] || \"\").toLocaleLowerCase();\n\t\t\tif (argv.length !== 4 || logic !== \"or\" && logic !== \"and\") {\n\t\t\t\treturn respond(`Usage:\\ntriggers <${CSHelp}> logic <or/and>`);\n\t\t\t}\n\t\t\tif (!conditionData.requirements) {\n\t\t\t\treturn respond(`Cannot configure specific trigger while using global data. First use:\\ntriggers <${CSHelp}> global no`);\n\t\t\t}\n\t\t\tif (logic === \"or\") {\n\t\t\t\tconditionData.requirements.orLogic = true;\n\t\t\t} else {\n\t\t\t\tdelete conditionData.requirements.orLogic;\n\t\t\t}\n\t\t} else if (!ConditionsCommandTriggersKeywords.includes(keyword)) {\n\t\t\treturn respond(\n\t\t\t\t`${keyword !== \"help\" ? `Unknown trigger '${keyword}'. ` : \"\"}List of possible 'triggers <${CSHelp}> *' options:\\n` +\n\t\t\t\t`global <yes/no> - Set the trigger condition of this ${categorySingular} to the global configuration\\n` +\n\t\t\t\t`logic <or/and>\t- Set if the logic should be OR (at least one) or AND (all of) logic; default is AND\\n` +\n\t\t\t\t`room ignore - Remove the 'room type'-based trigger condition\\n` +\n\t\t\t\t`room <is/isnot> <public/private> - Add such a 'room type'-based trigger condition\\n` +\n\t\t\t\t`roomname ignore - Remove the 'room name'-based trigger condition\\n` +\n\t\t\t\t`roomname <is/isnot> <name> - Add such a 'room name'-based trigger condition\\n` +\n\t\t\t\t`role ignore - Remove the role-based trigger condition\\n` +\n\t\t\t\t`role <with/notwith> <role> - Add such a role-based trigger condition\\n` +\n\t\t\t\t`player ignore - Remove the person-based trigger condition\\n` +\n\t\t\t\t`player <with/notwith> <memberNumber> - Add such a person-based trigger condition\\n\\n` +\n\t\t\t\t`To show currently set triggers, use just 'triggers <group>' without adding one of the above sub-commands.`\n\t\t\t);\n\t\t} else if (!conditionData.requirements) {\n\t\t\treturn respond(`Cannot configure specific trigger while using global data. First use:\\ntriggers <${CSHelp}> global no`);\n\t\t} else {\n\t\t\tif (ConditionsCommandProcessTriggers(conditionData.requirements, argv.slice(2), sender, respond))\n\t\t\t\treturn;\n\t\t}\n\t\trespond(ConditionsUpdate(category, condition, conditionData, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t} else if (subcommand === \"globaltriggers\") {\n\t\tconst configData = ConditionsGetCategoryPublicData(category, sender);\n\t\tif (!argv[1]) {\n\t\t\tconst triggers: string[] = [];\n\t\t\tconst r = configData.requirements;\n\t\t\ttriggers.push(r.orLogic ? `Logic: OR (at least one)` : `Logic: AND (all of)`);\n\t\t\tif (r.room) {\n\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t}\n\t\t\tif (r.roomName) {\n\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t}\n\t\t\tif (r.role) {\n\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t}\n\t\t\tif (r.player) {\n\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t}\n\t\t\tif (triggers.length > 1) {\n\t\t\t\treturn respond(`Current status:\\n` +\n\t\t\t\t\t`Globally ${category} are set to trigger under following conditions:\\n` +\n\t\t\t\t\ttriggers.join(\"\\n\")\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn respond(`Current status:\\n` +\n\t\t\t\t\t`No triggers are set globally. ${capitalizeFirstLetter(category)} using global config will now always trigger, if they are active`\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (argv[1].toLocaleLowerCase() === \"logic\") {\n\t\t\tconst logic = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\tif (argv.length !== 3 || logic !== \"or\" && logic !== \"and\") {\n\t\t\t\treturn respond(`Usage:\\nglobaltriggers logic <or/and>`);\n\t\t\t}\n\t\t\tif (logic === \"or\") {\n\t\t\t\tconfigData.requirements.orLogic = true;\n\t\t\t} else {\n\t\t\t\tdelete configData.requirements.orLogic;\n\t\t\t}\n\t\t} else if (!ConditionsCommandTriggersKeywords.includes(argv[1].toLocaleLowerCase())) {\n\t\t\treturn respond(\n\t\t\t\t`${argv[1] !== \"help\" ? `Unknown trigger '${argv[1].toLocaleLowerCase()}'. ` : \"\"}List of possible 'globaltriggers *' options:\\n` +\n\t\t\t\t`logic <or/and>\t- Set if the logic should be OR (at least one) or AND (all of) logic; default is AND\\n` +\n\t\t\t\t`room ignore - Remove the 'room type'-based trigger condition\\n` +\n\t\t\t\t`room <is/isnot> <public/private> - Add such a 'room type'-based trigger condition\\n` +\n\t\t\t\t`roomname ignore - Remove the 'room name'-based trigger condition\\n` +\n\t\t\t\t`roomname <is/isnot> <name> - Add such a 'room name'-based trigger condition\\n` +\n\t\t\t\t`role ignore - Remove the role-based trigger condition\\n` +\n\t\t\t\t`role <with/notwith> <role> - Add such a role-based trigger condition\\n` +\n\t\t\t\t`player ignore - Remove the person-based trigger condition\\n` +\n\t\t\t\t`player <with/notwith> <memberNumber> - Add such a person-based trigger condition\\n\\n` +\n\t\t\t\t`To show currently set global triggers, use just 'globaltriggers' without anything behind.`\n\t\t\t);\n\t\t} else {\n\t\t\tif (ConditionsCommandProcessTriggers(configData.requirements, argv.slice(1), sender, respond))\n\t\t\t\treturn;\n\t\t}\n\t\trespond(ConditionsCategoryUpdate(category, configData, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t} else if (subcommand === \"timer\") {\n\t\tconst [result, condition] = handler.parseConditionName(argv[1] || \"\", Object.keys(categoryData.conditions));\n\t\tif (!result) {\n\t\t\treturn respond(condition);\n\t\t}\n\t\tif (!categoryData.conditions[condition]) {\n\t\t\treturn respond(`This ${categorySingular} doesn't exist`);\n\t\t}\n\t\tconst keyword = (argv[2] || \"\").toLocaleLowerCase();\n\t\tif (keyword !== \"set\" && keyword !== \"disable\" && keyword !== \"autoremove\") {\n\t\t\treturn respond(`Usage:\\n` +\n\t\t\t\t`timer <${CSHelp}> disable - Remove the timer and set lifetime to infinite\\n` +\n\t\t\t\t`timer <${CSHelp}> set <time> - Set timer to the given amount of days, hours, minutes or seconds (e.g. 23h 30m)\\n` +\n\t\t\t\t`timer <${CSHelp}> autoremove <yes/no> - Set if the ${categorySingular} is removed when the timer runs out or just disables itself`\n\t\t\t);\n\t\t}\n\t\tconst conditionData = ConditionsMakeConditionPublicData(handler, condition, categoryData.conditions[condition], sender);\n\t\tif (keyword === \"disable\") {\n\t\t\tconditionData.timer = null;\n\t\t\tconditionData.timerRemove = false;\n\t\t} else if (keyword === \"set\") {\n\t\t\tlet time = 0;\n\t\t\tfor (const v of argv.slice(3)) {\n\t\t\t\tconst i = Command_parseTime(v);\n\t\t\t\tif (typeof i === \"string\") {\n\t\t\t\t\treturn respond(i);\n\t\t\t\t}\n\t\t\t\ttime += i;\n\t\t\t}\n\t\t\tconditionData.timer = Date.now() + time;\n\t\t} else if (keyword === \"autoremove\") {\n\t\t\tconst autoremove = (argv[3] || \"\").toLocaleLowerCase();\n\t\t\tif (argv.length !== 4 || autoremove !== \"yes\" && autoremove !== \"no\") {\n\t\t\t\treturn respond(`Usage:\\ntimer <${CSHelp}> autoremove <yes/no>`);\n\t\t\t} else if (!conditionData.active) {\n\t\t\t\treturn respond(`Timer is counting until ${categorySingular} becomes enabled, cannot use autoremove in this mode.`);\n\t\t\t} else if (conditionData.timer === null) {\n\t\t\t\treturn respond(`Timer is disabled on this ${categorySingular}. To use autoremove, first set timer`);\n\t\t\t}\n\t\t\tconditionData.timerRemove = autoremove === \"yes\";\n\t\t}\n\t\trespond(ConditionsUpdate(category, condition, conditionData, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t} else if (subcommand === \"defaulttimer\") {\n\t\tconst keyword = (argv[1] || \"\").toLocaleLowerCase();\n\t\tif (keyword !== \"set\" && keyword !== \"disable\" && keyword !== \"autoremove\") {\n\t\t\treturn respond(`Usage:\\n` +\n\t\t\t\t`defaulttimer disable - Remove the timer and set lifetime to infinite\\n` +\n\t\t\t\t`defaulttimer set <time> - Set timer to the given amount of days, hours, minutes or seconds (e.g. 23h 30m)\\n` +\n\t\t\t\t`defaulttimer autoremove <yes/no> - Set if the ${categorySingular} is removed when the timer runs out or just disables itself`\n\t\t\t);\n\t\t}\n\t\tconst configData = ConditionsGetCategoryPublicData(category, sender);\n\t\tif (keyword === \"disable\") {\n\t\t\tconfigData.timer = null;\n\t\t\tconfigData.timerRemove = false;\n\t\t} else if (keyword === \"set\") {\n\t\t\tlet time = 0;\n\t\t\tfor (const v of argv.slice(2)) {\n\t\t\t\tconst i = Command_parseTime(v);\n\t\t\t\tif (typeof i === \"string\") {\n\t\t\t\t\treturn respond(i);\n\t\t\t\t}\n\t\t\t\ttime += i;\n\t\t\t}\n\t\t\tconfigData.timer = time;\n\t\t} else if (keyword === \"autoremove\") {\n\t\t\tconst autoremove = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\tif (argv.length !== 3 || autoremove !== \"yes\" && autoremove !== \"no\") {\n\t\t\t\treturn respond(`Usage:\\ndefaulttimer <${CSHelp}> autoremove <yes/no>`);\n\t\t\t}\n\t\t\tif (configData.timer === null) {\n\t\t\t\treturn respond(`Timer is disabled by default for ${category}. To use autoremove, first set timer`);\n\t\t\t}\n\t\t\tconfigData.timerRemove = autoremove === \"yes\";\n\t\t}\n\t\trespond(ConditionsCategoryUpdate(category, configData, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t} else if (subcommand === \"setlimit\") {\n\t\tconst [result, condition] = handler.parseConditionName(argv[1] || \"\", false);\n\t\tif (!result) {\n\t\t\treturn respond(condition);\n\t\t}\n\t\tif (!handler.loadValidateConditionKey(condition)) {\n\t\t\tthrow new Error(\"Parse name returned invalid condition key\");\n\t\t}\n\t\tconst keyword = (argv[2] || \"\").toLocaleLowerCase();\n\t\tif (keyword !== \"normal\" && keyword !== \"limited\" && keyword !== \"blocked\") {\n\t\t\treturn respond(`Usage:\\n` +\n\t\t\t\t`setlimit <${CSHelp}> <normal/limited/blocked> - Set a limit on certain <${CSHelp}>`\n\t\t\t);\n\t\t}\n\t\trespond(ConditionsSetLimit(category, condition, ConditionsLimit[keyword], sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t}\n}\n\nexport function ConditionsAutocompleteSubcommand(category: ConditionsCategories, argv: string[], sender: ChatroomCharacter): string[] {\n\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase() as ConditionsSubcommand;\n\tif (!ConditionsSubcommands.includes(subcommand)) {\n\t\tthrow new Error(`Subcomand \"${subcommand}\" passed to ConditionsAutocompleteSubcommand isn't valid ConditionsSubcommand`);\n\t}\n\n\tconst handler = conditionHandlers.get(category);\n\tif (!handler) {\n\t\tthrow new Error(`Attempt to autocomplete command for unknown conditions category ${category}`);\n\t}\n\tif (!moduleIsEnabled(handler.category))\n\t\treturn [];\n\tconst categoryData = ConditionsGetCategoryData(category);\n\n\tif (subcommand === \"setactive\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn handler.autocompleteConditionName(argv[1], Object.keys(categoryData.conditions));\n\t\t} else if (argv.length === 3) {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"yes\", \"no\"]);\n\t\t}\n\t} else if (subcommand === \"triggers\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn handler.autocompleteConditionName(argv[1], Object.keys(categoryData.conditions));\n\t\t}\n\t\tconst [result, condition] = handler.parseConditionName(argv[1] || \"\", Object.keys(categoryData.conditions));\n\t\tif (!result || !categoryData.conditions[condition]) {\n\t\t\treturn [];\n\t\t}\n\t\tif (argv.length === 3) {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"global\", \"logic\", ...ConditionsCommandTriggersKeywords]);\n\t\t}\n\t\tif (argv[2].toLocaleLowerCase() === \"global\") {\n\t\t\treturn Command_pickAutocomplete(argv[3], [\"yes\", \"no\"]);\n\t\t} else if (argv[2].toLocaleLowerCase() === \"logic\") {\n\t\t\treturn Command_pickAutocomplete(argv[3], [\"and\", \"or\"]);\n\t\t} else if (categoryData.conditions[condition].requirements && ConditionsCommandTriggersKeywords.includes(argv[2].toLocaleLowerCase())) {\n\t\t\treturn ConditionsCommandTriggersAutocomplete(argv.slice(2), sender);\n\t\t}\n\t} else if (subcommand === \"globaltriggers\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn Command_pickAutocomplete(argv[1], [\"logic\", ...ConditionsCommandTriggersKeywords]);\n\t\t} else if (argv[1].toLocaleLowerCase() === \"logic\") {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"and\", \"or\"]);\n\t\t} else if (ConditionsCommandTriggersKeywords.includes(argv[2].toLocaleLowerCase())) {\n\t\t\treturn ConditionsCommandTriggersAutocomplete(argv.slice(1), sender);\n\t\t}\n\t} else if (subcommand === \"timer\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn handler.autocompleteConditionName(argv[1], Object.keys(categoryData.conditions));\n\t\t} else if (argv.length === 3) {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"set\", \"disable\", \"autoremove\"]);\n\t\t} else if (argv.length === 4 && argv[2].toLocaleLowerCase() === \"autoremove\") {\n\t\t\treturn Command_pickAutocomplete(argv[3], [\"yes\", \"no\"]);\n\t\t}\n\t} else if (subcommand === \"defaulttimer\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn Command_pickAutocomplete(argv[1], [\"set\", \"disable\", \"autoremove\"]);\n\t\t} else if (argv.length === 3 && argv[1].toLocaleLowerCase() === \"autoremove\") {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"yes\", \"no\"]);\n\t\t}\n\t} else if (subcommand === \"setlimit\") {\n\t\tif (argv.length === 2) {\n\t\t\treturn handler.autocompleteConditionName(argv[1], false);\n\t\t} else if (argv.length === 3) {\n\t\t\treturn Command_pickAutocomplete(argv[2], [\"normal\", \"limited\", \"blocked\"]);\n\t\t}\n\t}\n\n\treturn [];\n}\n\n\nexport class ModuleConditions extends BaseModule {\n\tprivate timer: number | null = null;\n\n\tload() {\n\t\tif (!isObject(modStorage.conditions)) {\n\t\t\tmodStorage.conditions = {};\n\t\t}\n\n\t\t// cursedItems migration\n\t\tif (modStorage.cursedItems) {\n\t\t\tconst curses: ConditionsCategoryData<\"curses\"> = modStorage.conditions.curses = {\n\t\t\t\tconditions: {},\n\t\t\t\tlimits: {},\n\t\t\t\trequirements: {},\n\t\t\t\tdata: {\n\t\t\t\t\titemRemove: false\n\t\t\t\t}\n\t\t\t};\n\t\t\tfor (const [group, data] of Object.entries(modStorage.cursedItems)) {\n\t\t\t\tcurses.conditions[group] = {\n\t\t\t\t\tactive: true,\n\t\t\t\t\tlastActive: false,\n\t\t\t\t\tdata\n\t\t\t\t};\n\t\t\t}\n\t\t\tdelete modStorage.cursedItems;\n\t\t}\n\n\t\tfor (const key of Object.keys(modStorage.conditions) as ConditionsCategories[]) {\n\t\t\tconst handler = conditionHandlers.get(key);\n\t\t\tif (!handler || !moduleIsEnabled(handler.category)) {\n\t\t\t\tconsole.debug(`BCX: Removing unknown or disabled conditions category ${key}`);\n\t\t\t\tdelete modStorage.conditions[key];\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst data: ConditionsCategoryData<ConditionsCategories> | undefined = modStorage.conditions[key];\n\t\t\tif (!isObject(data) || !isObject(data.conditions)) {\n\t\t\t\tconsole.warn(`BCX: Removing category ${key} with invalid data`);\n\t\t\t\tdelete modStorage.conditions[key];\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (data.timer !== undefined && typeof data.timer !== \"number\") {\n\t\t\t\tconsole.warn(`BCX: Removing category ${key} invalid timer`, data.timer);\n\t\t\t\tdelete data.timer;\n\t\t\t}\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-boolean-literal-compare\n\t\t\tif (data.timerRemove !== undefined && data.timerRemove !== true) {\n\t\t\t\tconsole.warn(`BCX: Removing category ${key} invalid timerRemove`, data.timerRemove);\n\t\t\t\tdelete data.timerRemove;\n\t\t\t}\n\t\t\tif (!isObject(data.limits)) {\n\t\t\t\tconsole.warn(`BCX: Resetting category ${key} limits with invalid data`);\n\t\t\t\tdata.limits = {};\n\t\t\t}\n\t\t\tfor (const [condition, limitValue] of Object.entries(data.limits)) {\n\t\t\t\tif (!handler.loadValidateConditionKey(condition)) {\n\t\t\t\t\tconsole.warn(`BCX: Unknown condition ${key}:${condition} limit, removing it`);\n\t\t\t\t\tdelete data.limits[condition];\n\t\t\t\t} else if (typeof limitValue !== \"number\" ||\n\t\t\t\t\tlimitValue === (handler.getDefaultLimits()[condition] ?? ConditionsLimit.normal) ||\n\t\t\t\t\tConditionsLimit[limitValue] === undefined\n\t\t\t\t) {\n\t\t\t\t\tconsole.warn(`BCX: Bad condition ${key}:${condition} limit value, removing it`, limitValue);\n\t\t\t\t\tdelete data.limits[condition];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!guard_ConditionsConditionRequirements(data.requirements)) {\n\t\t\t\tconsole.warn(`BCX: Resetting category ${key} requirements with invalid data`);\n\t\t\t\tdata.requirements = {};\n\t\t\t}\n\n\t\t\tdata.data = handler.loadCategorySpecificGlobalData(data.data);\n\n\t\t\tfor (const [condition, conditiondata] of Object.entries<ConditionsConditionData>(data.conditions)) {\n\t\t\t\tif (!handler.loadValidateConditionKey(condition)) {\n\t\t\t\t\tconsole.warn(`BCX: Unknown condition ${key}:${condition}, removing it`);\n\t\t\t\t\tdelete data.conditions[condition];\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (!handler.loadValidateCondition(condition, conditiondata)) {\n\t\t\t\t\tdelete data.conditions[condition];\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (\n\t\t\t\t\ttypeof conditiondata.active !== \"boolean\" ||\n\t\t\t\t\tconditiondata.requirements !== undefined && !guard_ConditionsConditionRequirements(conditiondata.requirements) ||\n\t\t\t\t\tconditiondata.timer !== undefined && typeof conditiondata.timer !== \"number\" ||\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-boolean-literal-compare\n\t\t\t\t\tconditiondata.timerRemove !== undefined && conditiondata.timerRemove !== true ||\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-boolean-literal-compare\n\t\t\t\t\tconditiondata.favorite !== undefined && conditiondata.favorite !== true\n\t\t\t\t) {\n\t\t\t\t\tconsole.warn(`BCX: Condition ${key}:${condition} has bad data, removing it`);\n\t\t\t\t\tdelete data.conditions[condition];\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (ConditionsGetConditionLimit(key, condition) === ConditionsLimit.blocked) {\n\t\t\t\t\tconsole.warn(`BCX: Condition ${key}:${condition} became blocked while active, removing it`);\n\t\t\t\t\tdelete data.conditions[condition];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (conditiondata.timerRemove && !conditiondata.active) {\n\t\t\t\t\tconsole.warn(`BCX: Condition ${key}:${condition} had timerRemove while inactive, cleaning up`);\n\t\t\t\t\tdelete conditiondata.timerRemove;\n\t\t\t\t}\n\t\t\t\tif (typeof conditiondata.lastActive !== \"boolean\") {\n\t\t\t\t\tconsole.warn(`BCX: Condition ${key}:${condition} missing lastActive, adding`);\n\t\t\t\t\tconditiondata.lastActive = false;\n\t\t\t\t}\n\t\t\t\tif (conditiondata.addedBy !== undefined && !Number.isInteger(conditiondata.addedBy)) {\n\t\t\t\t\tconsole.warn(`BCX: Condition ${key}:${condition} bad addedBy, cleaning up`, conditiondata.addedBy);\n\t\t\t\t\tdelete conditiondata.addedBy;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const [key, handler] of conditionHandlers.entries()) {\n\t\t\tif (moduleIsEnabled(handler.category) && !isObject(modStorage.conditions[key])) {\n\t\t\t\tconsole.debug(`BCX: Adding missing conditions category ${key}`);\n\t\t\t\t(modStorage.conditions as Record<ConditionsCategories, ConditionsCategoryData>)[key] = {\n\t\t\t\t\tconditions: {},\n\t\t\t\t\tlimits: {},\n\t\t\t\t\trequirements: {},\n\t\t\t\t\tdata: handler.loadCategorySpecificGlobalData(undefined)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tqueryHandlers.conditionsGet = (sender, resolve, data) => {\n\t\t\tif (typeof data === \"string\" && conditionHandlers.has(data) && ConditionsGetCategoryEnabled(data)) {\n\t\t\t\tresolve(true, ConditionsGetCategoryPublicData(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\n\t\tqueryHandlers.conditionSetLimit = (sender, resolve, data) => {\n\t\t\tif (isObject(data) &&\n\t\t\t\ttypeof data.category === \"string\" &&\n\t\t\t\tconditionHandlers.has(data.category) &&\n\t\t\t\ttypeof data.condition === \"string\" &&\n\t\t\t\ttypeof data.limit === \"number\" &&\n\t\t\t\tConditionsLimit[data.limit] !== undefined\n\t\t\t) {\n\t\t\t\tresolve(true, ConditionsSetLimit(data.category, data.condition, data.limit, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\n\t\tqueryHandlers.conditionUpdate = (sender, resolve, data) => {\n\t\t\tif (isObject(data) &&\n\t\t\t\ttypeof data.category === \"string\" &&\n\t\t\t\tconditionHandlers.has(data.category) &&\n\t\t\t\ttypeof data.condition === \"string\" &&\n\t\t\t\tguard_ConditionsConditionPublicData(data.category, data.condition, data.data)\n\t\t\t) {\n\t\t\t\tresolve(true, ConditionsUpdate(data.category, data.condition, data.data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\n\t\tqueryHandlers.conditionCategoryUpdate = (sender, resolve, data) => {\n\t\t\tif (isObject(data) &&\n\t\t\t\ttypeof data.category === \"string\" &&\n\t\t\t\tconditionHandlers.has(data.category) &&\n\t\t\t\tisObject(data.data) &&\n\t\t\t\t(data.data.timer === null || typeof data.data.timer === \"number\") &&\n\t\t\t\ttypeof data.data.timerRemove === \"boolean\" &&\n\t\t\t\tguard_ConditionsConditionRequirements(data.data.requirements)\n\t\t\t) {\n\t\t\t\tresolve(true, ConditionsCategoryUpdate(data.category, data.data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t}\n\n\trun() {\n\t\tthis.timer = BCX_setInterval(() => this.conditionsTick(), CONDITIONS_CHECK_INTERVAL);\n\t}\n\n\tunload() {\n\t\tif (this.timer !== null) {\n\t\t\tclearInterval(this.timer);\n\t\t\tthis.timer = null;\n\t\t}\n\t}\n\n\treload() {\n\t\tthis.unload();\n\t\tthis.load();\n\t\tthis.run();\n\t}\n\n\tconditionsTick() {\n\t\tif (!ServerIsConnected || !modStorage.conditions)\n\t\t\treturn;\n\n\t\tlet dataChanged = false;\n\t\tconst now = Date.now();\n\n\t\tfor (const [category, handler] of conditionHandlers.entries()) {\n\t\t\tconst categoryData = modStorage.conditions[category];\n\n\t\t\tif (!moduleIsEnabled(handler.category) || !categoryData)\n\t\t\t\tcontinue;\n\n\t\t\tfor (const [conditionName, conditionData] of Object.entries<ConditionsConditionData>(categoryData.conditions)) {\n\t\t\t\tif (conditionData.timer !== undefined && conditionData.timer <= now) {\n\t\t\t\t\tif (conditionData.timerRemove && conditionData.active) {\n\t\t\t\t\t\tConditionsRemoveCondition(category, conditionName);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete conditionData.timer;\n\t\t\t\t\t\tdelete conditionData.timerRemove;\n\t\t\t\t\t\tconditionData.active = !conditionData.active;\n\t\t\t\t\t\tdataChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst resolvedActive = conditionData.active && ConditionsEvaluateRequirements(conditionData.requirements ?? categoryData.requirements);\n\n\t\t\t\tif (resolvedActive !== conditionData.lastActive) {\n\t\t\t\t\tconditionData.lastActive = resolvedActive;\n\t\t\t\t\tdataChanged = true;\n\t\t\t\t\tconst copyChange = cloneDeep(conditionData);\n\n\t\t\t\t\thandler.stateChangeHandler(conditionName, conditionData, resolvedActive);\n\n\t\t\t\t\tif (!isEqual(copyChange, conditionData)) {\n\t\t\t\t\t\tdataChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!resolvedActive)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tconst copy = cloneDeep(conditionData);\n\n\t\t\t\thandler.tickHandler(conditionName, conditionData);\n\n\t\t\t\tif (!isEqual(copy, conditionData)) {\n\t\t\t\t\tdataChanged = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thandler.afterTickHandler?.();\n\t\t}\n\n\t\tif (dataChanged) {\n\t\t\tmodStorageSync();\n\t\t\tnotifyOfChange();\n\t\t}\n\t}\n}\n","import cloneDeep from \"lodash-es/cloneDeep\";\nimport isEqual from \"lodash-es/isEqual\";\nimport { ChatroomCharacter } from \"../characters\";\nimport { ModuleCategory, ModuleInitPhase, Preset, ConditionsLimit } from \"../constants\";\nimport { moduleInitPhase } from \"../moduleManager\";\nimport { initRules_bc_alter } from \"../rules/bc_alter\";\nimport { initRules_bc_blocks } from \"../rules/bc_blocks\";\nimport { initRules_bc_settings } from \"../rules/bc_settings\";\nimport { initRules_bc_relation_control } from \"../rules/relation_control\";\nimport { initRules_bc_speech_control } from \"../rules/speech_control\";\nimport { initRules_other } from \"../rules/other\";\nimport { capitalizeFirstLetter, clamp, clampWrap, dictionaryProcess, formatTimeInterval, isObject } from \"../utils\";\nimport { ChatRoomActionMessage, ChatRoomSendLocal, getCharacterName, DrawImageEx, InfoBeep } from \"../utilsClub\";\nimport { AccessLevel, registerPermission } from \"./authority\";\nimport { Command_fixExclamationMark, Command_pickAutocomplete, registerWhisperCommand, COMMAND_GENERIC_ERROR } from \"./commands\";\nimport { ConditionsAutocompleteSubcommand, ConditionsCheckAccess, ConditionsGetCategoryPublicData, ConditionsGetCondition, ConditionsIsConditionInEffect, ConditionsRegisterCategory, ConditionsRemoveCondition, ConditionsRunSubcommand, ConditionsSetCondition, ConditionsSubcommand, ConditionsSubcommands } from \"./conditions\";\nimport { LogEntryType, logMessage } from \"./log\";\nimport { queryHandlers } from \"./messaging\";\nimport { moduleIsEnabled } from \"./presets\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { getCurrentSubscreen, setSubscreen } from \"./gui\";\nimport { GuiMemberSelect } from \"../gui/member_select\";\nimport { modStorageSync } from \"./storage\";\nimport { BCX_setInterval } from \"../BCXContext\";\n\nconst RULES_ANTILOOP_RESET_INTERVAL = 60_000;\nconst RULES_ANTILOOP_THRESHOLD = 10;\nconst RULES_ANTILOOP_SUSPEND_TIME = 600_000;\n\nconst STRING_LIST_MAX_LENGTH = 128;\n\nexport function guard_BCX_Rule(name: unknown): name is BCX_Rule {\n\treturn typeof name === \"string\" && rules.has(name as BCX_Rule);\n}\n\nexport function guard_RuleCustomData(rule: BCX_Rule, data: unknown): boolean {\n\tconst descriptor = rules.get(rule as BCX_Rule);\n\tif (!descriptor)\n\t\treturn false;\n\n\tif (descriptor.dataDefinition) {\n\t\tif (!isObject(data))\n\t\t\treturn false;\n\t\tfor (const k of Object.keys(data)) {\n\t\t\tif (!(descriptor.dataDefinition as Record<string, any>)[k])\n\t\t\t\treturn false;\n\t\t}\n\t\tfor (const [k, def] of Object.entries<RuleCustomDataEntryDefinition>(descriptor.dataDefinition)) {\n\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[def.type];\n\t\t\tif (!handler || !handler.validate(data[k], def))\n\t\t\t\treturn false;\n\t\t}\n\t} else if (data !== undefined) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\ninterface RuleEntry<ID extends BCX_Rule> extends RuleDefinition<ID> {\n\tstate: RuleState<ID>;\n}\n\nconst rules: Map<BCX_Rule, RuleEntry<BCX_Rule>> = new Map();\nconst rulesList: BCX_Rule[] = [];\n\nexport function registerRule<ID extends BCX_Rule>(name: ID, data: RuleDefinition<ID>) {\n\tif (moduleInitPhase !== ModuleInitPhase.init) {\n\t\tthrow new Error(\"Rules can be registered only during init\");\n\t}\n\tif (rules.has(name)) {\n\t\tthrow new Error(`Rule \"${name}\" already defined!`);\n\t}\n\tif (data.dataDefinition) {\n\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(data.dataDefinition)) {\n\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\tif (!handler) {\n\t\t\t\tthrow new Error(`Unknown handler for ${name}:${k} (${v.type})`);\n\t\t\t}\n\t\t\tif (handler.validateOptions && !handler.validateOptions(v.options as any)) {\n\t\t\t\tthrow new Error(`Bad options for ${name}:${k} (${v.type})`);\n\t\t\t}\n\t\t\tconst defaultValue = typeof v.default === \"function\" ? v.default() : v.default;\n\t\t\tif (!handler.validate(defaultValue, v)) {\n\t\t\t\tthrow new Error(`Default doesn't validate for ${name}:${k} (${v.type})`);\n\t\t\t}\n\t\t}\n\t}\n\tif (data.internalDataValidate) {\n\t\tif (!data.internalDataValidate(data.internalDataDefault?.())) {\n\t\t\tthrow new Error(`Default internal data doesn't validate for rule ${name}`);\n\t\t}\n\t} else if (data.internalDataDefault !== undefined) {\n\t\tthrow new Error(`Default internal data for rule ${name} without internal data validation`);\n\t}\n\trules.set(name, {\n\t\t...(data as RuleDefinition<BCX_Rule>),\n\t\tstate: new RuleState<BCX_Rule>(name, data)\n\t});\n\trulesList.push(name);\n}\n\nexport function RulesGetDisplayDefinition(rule: BCX_Rule): RuleDisplayDefinition {\n\tconst data = rules.get(rule);\n\tif (!data) {\n\t\tthrow new Error(`Attempt to get display definition for unknown rule '${rule}'`);\n\t}\n\treturn {\n\t\tname: data.name,\n\t\ticon: data.icon,\n\t\tshortDescription: data.shortDescription,\n\t\tlongDescription: data.longDescription,\n\t\ttriggerTexts: data.triggerTexts,\n\t\tdefaultLimit: data.defaultLimit,\n\t\tenforceable: data.enforceable,\n\t\tloggable: data.loggable,\n\t\tdataDefinition: data.dataDefinition\n\t};\n}\n\nexport function RulesGetRuleState<ID extends BCX_Rule>(rule: ID): RuleState<ID> {\n\tconst data = rules.get(rule);\n\tif (!data) {\n\t\tthrow new Error(`Attempt to get state for unknown rule '${rule}'`);\n\t}\n\treturn data.state as RuleState<ID>;\n}\n\nexport type RuleCustomDataHandler<type extends RuleCustomDataTypes = RuleCustomDataTypes> = {\n\tvalidate(value: unknown, def: RuleCustomDataEntryDefinition<type>): boolean;\n\tonDataChange?(data: {\n\t\tdef: RuleCustomDataEntryDefinition<type>;\n\t\tactive: boolean;\n\t\tkey: string;\n\t\tonInput: () => void;\n\t\tvalue: RuleCustomDataTypesMap[type];\n\t\taccess: boolean;\n\t}): void;\n\tprocessInput?(data: {\n\t\tdef: RuleCustomDataEntryDefinition<type>;\n\t\tkey: string;\n\t\tvalue: RuleCustomDataTypesMap[type];\n\t}): RuleCustomDataTypesMap[type] | undefined;\n\tunload?(data: {\n\t\tdef: RuleCustomDataEntryDefinition<type>;\n\t\tkey: string\n\t}): void;\n\trun(data: {\n\t\tdef: RuleCustomDataEntryDefinition<type>;\n\t\tvalue: RuleCustomDataTypesMap[type];\n\t\tY: number;\n\t\tkey: string;\n\t\ttarget: ChatroomCharacter;\n\t\taccess: boolean;\n\t}): void;\n\tclick?(data: {\n\t\tdef: RuleCustomDataEntryDefinition<type>;\n\t\tvalue: RuleCustomDataTypesMap[type];\n\t\tY: number;\n\t\tkey: string;\n\t\ttarget: ChatroomCharacter;\n\t\taccess: boolean;\n\t}): RuleCustomDataTypesMap[type] | undefined;\n} & (type extends keyof RuleCustomDataTypesOptions ? {\n\tvalidateOptions(options: RuleCustomDataTypesOptions[type]): boolean;\n} : {\n\tvalidateOptions?: undefined\n});\n\nconst ruleCustomDataHandlerPage: Map<string, number> = new Map();\n// memberNumberList helper variable\nlet memberNumberListAutoFill: number | null = null;\n\nexport const ruleCustomDataHandlers: {\n\t[type in RuleCustomDataTypes]: RuleCustomDataHandler<type>;\n} = {\n\t// element has Y length of 150px (description + element plus offset to the next one)\n\tlistSelect: {\n\t\tvalidateOptions: options => Array.isArray(options) && options.every(i => Array.isArray(i) && i.length === 2 && i.every(j => typeof j === \"string\")),\n\t\tvalidate: (value, def) => typeof value === \"string\" && def.options!.map(i => i[0]).includes(value),\n\t\trun({ def, value, Y, access }) {\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 900, \"Black\");\n\t\t\tconst index = def.options!.findIndex(i => i[0] === value);\n\t\t\tif (index < 0) {\n\t\t\t\tthrow new Error(`Bad data during listSelect render`);\n\t\t\t}\n\t\t\tconst next = clampWrap(index + 1, 0, def.options!.length - 1);\n\t\t\tconst prev = clampWrap(index - 1, 0, def.options!.length - 1);\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawBackNextButton(1050, Y + 36, 250, 60,\n\t\t\t\tdef.options![index][1],\n\t\t\t\taccess ? \"White\" : \"#ddd\", \"\",\n\t\t\t\t() => def.options![prev][1],\n\t\t\t\t() => def.options![next][1],\n\t\t\t\t!access\n\t\t\t);\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t},\n\t\tclick({ def, value, Y, access }) {\n\t\t\tif (!access)\n\t\t\t\treturn;\n\t\t\tconst index = def.options!.findIndex(i => i[0] === value);\n\t\t\tif (MouseIn(1050, Y + 36, 125, 60)) {\n\t\t\t\treturn def.options![clampWrap(index - 1, 0, def.options!.length - 1)][0];\n\t\t\t}\n\t\t\tif (MouseIn(1050 + 125, Y + 36, 125, 60)) {\n\t\t\t\treturn def.options![clampWrap(index + 1, 0, def.options!.length - 1)][0];\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t},\n\tmemberNumberList: {\n\t\tvalidateOptions: options => options === undefined || (Number.isInteger(options?.pageSize)),\n\t\tvalidate: value => Array.isArray(value) && value.every(Number.isInteger),\n\t\tonDataChange({ active, key, access }) {\n\t\t\tlet input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (!active) {\n\t\t\t\tif (input) {\n\t\t\t\t\tinput.remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\tinput = ElementCreateInput(`BCX_RCDH_${key}`, \"text\", \"\", \"100\");\n\t\t\t\tinput.inputMode = \"numeric\";\n\t\t\t\tinput.pattern = \"[0-9]+\";\n\t\t\t\tif (memberNumberListAutoFill !== null) {\n\t\t\t\t\tinput.value = `${memberNumberListAutoFill}`;\n\t\t\t\t\tmemberNumberListAutoFill = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinput.disabled = !access;\n\t\t},\n\t\trun({ def, value, Y, key, access }) {\n\t\t\tY -= 20;\n\t\t\tconst PAGE_SIZE = def.options?.pageSize ? def.options.pageSize : 4;\n\t\t\tconst totalPages = Math.max(1, Math.ceil(value.length / PAGE_SIZE));\n\t\t\tconst page = clamp(ruleCustomDataHandlerPage.get(key) ?? 0, 0, totalPages - 1);\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 900, \"Black\");\n\t\t\tfor (let i = 0; i < PAGE_SIZE; i++) {\n\t\t\t\tconst e = page * PAGE_SIZE + i;\n\t\t\t\tif (e >= value.length)\n\t\t\t\t\tbreak;\n\t\t\t\tMainCanvas.strokeRect(1050, Y + 26 + i * 70, 766, 64);\n\t\t\t\tconst msg = `${getCharacterName(value[e], \"[unknown]\")} (${value[e]})`;\n\t\t\t\tDrawTextFit(msg, 1060, Y + 26 + i * 70 + 34, 380, \"Black\");\n\t\t\t\tif (access) {\n\t\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\t\tDrawButton(1836, Y + 26 + i * 70, 64, 64, \"X\", \"White\");\n\t\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 40, 1050, Y + PAGE_SIZE * 70 + 43, 360, 60);\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (input && document.activeElement === input) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tconst val = input.value && Number.parseInt(input.value, 10);\n\t\t\t\t\tif (!val)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tconst Left = 580;\n\t\t\t\t\tconst Top = 630;\n\t\t\t\t\tMainCanvas.fillStyle = \"#FFFF88\";\n\t\t\t\t\tMainCanvas.fillRect(Left, Top, 450, 65);\n\t\t\t\t\tMainCanvas.lineWidth = 2;\n\t\t\t\t\tMainCanvas.strokeStyle = 'black';\n\t\t\t\t\tMainCanvas.strokeRect(Left, Top, 450, 65);\n\t\t\t\t\tDrawTextFit(getCharacterName(val, \"[unknown]\"), Left + 225, Top + 33, 444, \"black\");\n\t\t\t\t});\n\t\t\t}\n\t\t\tDrawButton(1444, Y + PAGE_SIZE * 70 + 43, 64, 64, \"\", access ? \"White\" : \"#ddd\", undefined, undefined, !access);\n\t\t\tDrawImageEx(\"Icons/Title.png\", 1446, Y + PAGE_SIZE * 70 + 43, { Width: 60, Height: 60 });\n\t\t\tDrawButton(1530, Y + PAGE_SIZE * 70 + 43, 100, 64, \"Add\", access ? \"White\" : \"#ddd\", undefined, undefined, !access);\n\t\t\tDrawBackNextButton(1650, Y + PAGE_SIZE * 70 + 43, 250, 64, `Page ${page + 1}/${totalPages}`, \"White\", undefined, () => \"\", () => \"\");\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t},\n\t\tclick({ value, Y, key, target, def, access }) {\n\t\t\tY -= 20;\n\t\t\tconst PAGE_SIZE = def.options?.pageSize ? def.options.pageSize : 4;\n\t\t\tconst totalPages = Math.max(1, Math.ceil(value.length / PAGE_SIZE));\n\t\t\tconst page = clamp(ruleCustomDataHandlerPage.get(key) ?? 0, 0, totalPages - 1);\n\t\t\tfor (let i = 0; i < PAGE_SIZE; i++) {\n\t\t\t\tconst e = page * PAGE_SIZE + i;\n\t\t\t\tif (e >= value.length)\n\t\t\t\t\tbreak;\n\t\t\t\tif (access && MouseIn(1836, Y + 26 + i * 70, 64, 64)) {\n\t\t\t\t\tvalue.splice(e, 1);\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tconst screen = getCurrentSubscreen();\n\t\t\tif (access && MouseIn(1444, Y + PAGE_SIZE * 70 + 43, 64, 64) && input && screen) {\n\t\t\t\tsetSubscreen(new GuiMemberSelect(target, screen, result => {\n\t\t\t\t\tmemberNumberListAutoFill = result;\n\t\t\t\t}, value.slice()));\n\t\t\t}\n\t\t\tif (access && MouseIn(1530, Y + PAGE_SIZE * 70 + 43, 100, 64) && input && input.value) {\n\t\t\t\tconst num = Number.parseInt(input.value, 10);\n\t\t\t\tif (Number.isInteger(num) && !value.includes(num)) {\n\t\t\t\t\tvalue.push(num);\n\t\t\t\t\tvalue.sort((a, b) => a - b);\n\t\t\t\t\tinput.value = \"\";\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (MouseIn(1650, Y + PAGE_SIZE * 70 + 43, 125, 64) && page > 0) {\n\t\t\t\truleCustomDataHandlerPage.set(key, page - 1);\n\t\t\t} else if (MouseIn(1650 + 125, Y + PAGE_SIZE * 70 + 43, 125, 64) && page + 1 < totalPages) {\n\t\t\t\truleCustomDataHandlerPage.set(key, page + 1);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t},\n\t\tunload({ key }) {\n\t\t\tElementRemove(`BCX_RCDH_${key}`);\n\t\t\truleCustomDataHandlerPage.delete(key);\n\t\t}\n\t},\n\tnumber: {\n\t\tvalidate: value => typeof value === \"number\" && Number.isInteger(value),\n\t\tonDataChange({ active, key, onInput, value, access }) {\n\t\t\tlet input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (!active) {\n\t\t\t\tif (input) {\n\t\t\t\t\tinput.remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\tinput = ElementCreateInput(`BCX_RCDH_${key}`, \"text\", value.toString(10), \"50\");\n\t\t\t\tinput.inputMode = \"numeric\";\n\t\t\t\tinput.pattern = \"[0-9]+\";\n\t\t\t\tinput.oninput = onInput;\n\t\t\t} else {\n\t\t\t\tinput.value = value.toString(10);\n\t\t\t}\n\t\t\tinput.disabled = !access;\n\t\t},\n\t\tprocessInput({ key, value }) {\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (input && input.value) {\n\t\t\t\tif (/^[0-9]+$/.test(input.value)) {\n\t\t\t\t\treturn Number.parseInt(input.value, 10);\n\t\t\t\t} else {\n\t\t\t\t\tinput.value = value.toString(10);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t},\n\t\trun({ def, Y, key }) {\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 850, \"Black\");\n\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 40, 1050, Y + 26, 425, 60);\n\t\t},\n\t\tunload({ key }) {\n\t\t\tElementRemove(`BCX_RCDH_${key}`);\n\t\t}\n\t},\n\tposeSelect: {\n\t\t// TODO: stricten\n\t\tvalidate: value => Array.isArray(value) && value.every(i => typeof i === \"string\"),\n\t\trun({ def, value, Y, access }) {\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 900, \"Black\");\n\t\t\tif (!DialogActivePoses || !DialogActivePoses.length) DialogActivePoseMenuBuild();\n\n\t\t\tfor (let I = 0; I < DialogActivePoses.length; I++) {\n\t\t\t\tconst OffsetY = Y + 60 + 140 * I;\n\t\t\t\tconst PoseGroup: Pose[] = DialogActivePoses[I];\n\n\t\t\t\tfor (let P = 0; P < PoseGroup.length; P++) {\n\t\t\t\t\tconst OffsetX = 1070 + 100 * P;\n\t\t\t\t\tconst IsDisabled = value.includes(PoseGroup[P].Name);\n\n\t\t\t\t\tDrawButton(OffsetX, OffsetY, 90, 90, \"\", IsDisabled ? access ? \"Darkred\" : \"#333\" : access ? \"White\" : \"#ddd\", \"Icons/Poses/\" + PoseGroup[P].Name + \".png\", \"\", !access);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tclick({ value, Y, access }) {\n\t\t\tif (!access)\n\t\t\t\treturn;\n\t\t\tfor (let I = 0; I < DialogActivePoses.length; I++) {\n\t\t\t\tconst OffsetY = Y + 60 + 140 * I;\n\t\t\t\tconst PoseGroup: Pose[] = DialogActivePoses[I];\n\n\t\t\t\tfor (let P = 0; P < PoseGroup.length; P++) {\n\t\t\t\t\tconst OffsetX = 1070 + 100 * P;\n\n\t\t\t\t\tif (MouseIn(OffsetX, OffsetY, 90, 90)) {\n\t\t\t\t\t\tif (value.includes(PoseGroup[P].Name)) {\n\t\t\t\t\t\t\tvalue.splice(value.indexOf(PoseGroup[P].Name), 1);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvalue.push(PoseGroup[P].Name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t},\n\t// element has Y length of 150px (description + element plus offset to the next one)\n\troleSelector: {\n\t\tvalidate: value => typeof value === \"number\" && AccessLevel[value] !== undefined,\n\t\trun({ def, value, Y, access }) {\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 900, \"Black\");\n\t\t\tconst roleSelectionNext = value < AccessLevel.public ? value + 1 : AccessLevel.clubowner;\n\t\t\tconst roleSelectionPrev = value > AccessLevel.clubowner ? value - 1 : AccessLevel.public;\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawBackNextButton(1050, Y + 46, 250, 60,\n\t\t\t\tcapitalizeFirstLetter(AccessLevel[value]) + (value !== AccessLevel.clubowner ? \" \" : \"\"),\n\t\t\t\taccess ? \"White\" : \"#ddd\", \"\",\n\t\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionPrev]),\n\t\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionNext]),\n\t\t\t\t!access\n\t\t\t);\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t},\n\t\tclick({ value, Y, access }) {\n\t\t\tif (!access)\n\t\t\t\treturn;\n\t\t\tif (MouseIn(1050, Y + 46, 125, 60)) {\n\t\t\t\treturn value > AccessLevel.clubowner ? value - 1 : AccessLevel.public;\n\t\t\t}\n\t\t\tif (MouseIn(1050 + 125, Y + 46, 125, 60)) {\n\t\t\t\treturn value < AccessLevel.public ? value + 1 : AccessLevel.clubowner;\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t},\n\tstring: {\n\t\tvalidateOptions: options => options === undefined || options instanceof RegExp,\n\t\tvalidate(value, def) {\n\t\t\treturn typeof value === \"string\" &&\n\t\t\t\t(!def.options || def.options.test(value));\n\t\t},\n\t\tonDataChange({ active, key, onInput, value, access, def }) {\n\t\t\tlet input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (!active) {\n\t\t\t\tif (input) {\n\t\t\t\t\tinput.remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\tlet lastValue = value;\n\t\t\t\tconst createdInput = ElementCreateInput(`BCX_RCDH_${key}`, \"text\", lastValue, \"160\");\n\t\t\t\tcreatedInput.oninput = () => {\n\t\t\t\t\tif (!def.options || def.options.test(createdInput.value)) {\n\t\t\t\t\t\tlastValue = createdInput.value;\n\t\t\t\t\t\tonInput();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcreatedInput.value = lastValue;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tinput = createdInput;\n\t\t\t} else {\n\t\t\t\tinput.value = value;\n\t\t\t}\n\t\t\tinput.disabled = !access;\n\t\t},\n\t\tprocessInput({ key, def }) {\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\treturn input && (!def.options || def.options.test(input.value)) ? input.value : undefined;\n\t\t},\n\t\trun({ def, Y, key }) {\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 850, \"Black\");\n\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 40, 1050, Y + 26, 850, 60);\n\t\t},\n\t\tunload({ key }) {\n\t\t\tElementRemove(`BCX_RCDH_${key}`);\n\t\t}\n\t},\n\tstringList: {\n\t\tvalidateOptions: options => options === undefined || (\n\t\t\tisObject(options) &&\n\t\t\t(options.validate === undefined || options.validate instanceof RegExp)\n\t\t),\n\t\tvalidate(value, def) {\n\t\t\treturn Array.isArray(value) &&\n\t\t\t\tvalue.length <= STRING_LIST_MAX_LENGTH &&\n\t\t\t\tvalue.every(i => typeof i === \"string\" && (!def.options?.validate || def.options.validate.test(i)));\n\t\t},\n\t\tonDataChange({ active, key, access, def }) {\n\t\t\tlet input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tif (!active) {\n\t\t\t\tif (input) {\n\t\t\t\t\tinput.remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\tlet last = \"\";\n\t\t\t\tconst newInput = ElementCreateInput(`BCX_RCDH_${key}`, \"text\", \"\", \"120\");\n\t\t\t\tnewInput.oninput = () => {\n\t\t\t\t\tif (def.options?.validate && !def.options.validate.test(newInput.value)) {\n\t\t\t\t\t\tif (newInput.value.length === 1 && def.options.validate.test(\"\")) {\n\t\t\t\t\t\t\tlast = \"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnewInput.value = last;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlast = newInput.value;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tinput = newInput;\n\t\t\t}\n\t\t\tinput.disabled = !access;\n\t\t},\n\t\trun({ def, value, Y, key, access }) {\n\t\t\tY -= 20;\n\t\t\tconst PAGE_SIZE = 4;\n\t\t\tconst totalPages = Math.max(1, Math.ceil(value.length / PAGE_SIZE));\n\t\t\tconst page = clamp(ruleCustomDataHandlerPage.get(key) ?? 0, 0, totalPages - 1);\n\t\t\tDrawTextFit(def.description, 1050, Y + 0, 900, \"Black\");\n\t\t\tfor (let i = 0; i < PAGE_SIZE; i++) {\n\t\t\t\tconst e = page * PAGE_SIZE + i;\n\t\t\t\tif (e >= value.length)\n\t\t\t\t\tbreak;\n\t\t\t\tconst msg = value[e];\n\t\t\t\tif (MouseIn(1050, Y + 26 + i * 70, 766, 64)) {\n\t\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\t\tMainCanvas.save();\n\t\t\t\t\t\tMainCanvas.fillStyle = \"rgba(255, 255, 136, 0.9)\";\n\t\t\t\t\t\tMainCanvas.fillRect(1050, Y + 26, 766, 280);\n\t\t\t\t\t\tMainCanvas.strokeStyle = \"Black\";\n\t\t\t\t\t\tMainCanvas.strokeRect(1050, Y + 26, 766, 280);\n\t\t\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\t\t\tDrawTextWrap(msg + \"   -   [click to copy into the empty input text field]\", 1050 - 746 / 2, Y + 30, 756, 270, \"black\", undefined, 5);\n\t\t\t\t\t\tMainCanvas.restore();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tMainCanvas.strokeRect(1050, Y + 26 + i * 70, 766, 64);\n\t\t\t\tDrawTextFit(msg.length > 61 ? msg.substr(0, 60) + \"\\u2026\" : msg, 1060, Y + 26 + i * 70 + 34, 750, \"Black\");\n\t\t\t\tif (access) {\n\t\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\t\tDrawButton(1836, Y + 26 + i * 70, 64, 64, \"X\", \"White\");\n\t\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 40, 1050, Y + PAGE_SIZE * 70 + 43, 450, 60);\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawButton(1530, Y + PAGE_SIZE * 70 + 43, 100, 64, \"Add\", access ? \"White\" : \"#ddd\", undefined, undefined, !access);\n\t\t\tDrawBackNextButton(1650, Y + PAGE_SIZE * 70 + 43, 250, 64, `Page ${page + 1}/${totalPages}`, \"White\", undefined, () => \"\", () => \"\");\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t},\n\t\tclick({ value, Y, key, def, access }) {\n\t\t\tY -= 20;\n\t\t\tconst PAGE_SIZE = 4;\n\t\t\tconst totalPages = Math.max(1, Math.ceil(value.length / PAGE_SIZE));\n\t\t\tconst page = clamp(ruleCustomDataHandlerPage.get(key) ?? 0, 0, totalPages - 1);\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLInputElement | undefined;\n\t\t\tfor (let i = 0; i < PAGE_SIZE; i++) {\n\t\t\t\tconst e = page * PAGE_SIZE + i;\n\t\t\t\tif (e >= value.length)\n\t\t\t\t\tbreak;\n\t\t\t\tif (access && MouseIn(1050, Y + 26 + i * 70, 766, 64) && input && input.value === \"\") {\n\t\t\t\t\tinput.value = value[e];\n\t\t\t\t}\n\t\t\t\tif (access && MouseIn(1836, Y + 26 + i * 70, 64, 64)) {\n\t\t\t\t\tvalue.splice(e, 1);\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (access && MouseIn(1530, Y + PAGE_SIZE * 70 + 43, 100, 64) &&\n\t\t\t\tinput && input.value &&\n\t\t\t\t(!def.options?.validate || def.options.validate.test(input.value)) &&\n\t\t\t\t!value.includes(input.value)\n\t\t\t) {\n\t\t\t\tif (value.length >= STRING_LIST_MAX_LENGTH) {\n\t\t\t\t\tInfoBeep(\"Reached the max. number of entries - please delete one first\", 10_000);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvalue.push(input.value);\n\t\t\t\tvalue.sort();\n\t\t\t\tinput.value = \"\";\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (MouseIn(1650, Y + PAGE_SIZE * 70 + 43, 125, 64) && page > 0) {\n\t\t\t\truleCustomDataHandlerPage.set(key, page - 1);\n\t\t\t} else if (MouseIn(1650 + 125, Y + PAGE_SIZE * 70 + 43, 125, 64) && page + 1 < totalPages) {\n\t\t\t\truleCustomDataHandlerPage.set(key, page + 1);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t},\n\t\tunload({ key }) {\n\t\t\tElementRemove(`BCX_RCDH_${key}`);\n\t\t\truleCustomDataHandlerPage.delete(key);\n\t\t}\n\t},\n\ttextArea: {\n\t\tvalidate: value => typeof value === \"string\",\n\t\tonDataChange({ active, key, onInput, value, access }) {\n\t\t\tlet input = document.getElementById(`BCX_RCDH_${key}`) as HTMLTextAreaElement | undefined;\n\t\t\tif (!active) {\n\t\t\t\tif (input) {\n\t\t\t\t\tinput.remove();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!input) {\n\t\t\t\tinput = document.createElement(\"textarea\");\n\t\t\t\tinput.id = `BCX_RCDH_${key}`;\n\t\t\t\tinput.name = `BCX_RCDH_${key}`;\n\t\t\t\tinput.value = value;\n\t\t\t\tinput.maxLength = 10000;\n\t\t\t\tinput.setAttribute(\"screen-generated\", CurrentScreen);\n\t\t\t\tinput.className = \"HideOnPopup\";\n\t\t\t\tinput.oninput = onInput;\n\t\t\t\tdocument.body.appendChild(input);\n\t\t\t} else {\n\t\t\t\tinput.value = value;\n\t\t\t}\n\t\t\tinput.disabled = !access;\n\t\t},\n\t\tprocessInput({ key }) {\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLTextAreaElement | undefined;\n\t\t\treturn input ? input.value : undefined;\n\t\t},\n\t\trun({ def, Y, key }) {\n\t\t\tDrawTextFit(def.description, 1000, Y + 0, 900, \"Black\");\n\t\t\tconst input = document.getElementById(`BCX_RCDH_${key}`) as HTMLTextAreaElement | undefined;\n\t\t\tif (input && document.activeElement === input) {\n\t\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 36, 105, 170, 1790, 750);\n\t\t\t} else {\n\t\t\t\tElementPositionFix(`BCX_RCDH_${key}`, 28, 1000, Y + 26, 900, 765 - Y);\n\t\t\t}\n\t\t},\n\t\tunload({ key }) {\n\t\t\tElementRemove(`BCX_RCDH_${key}`);\n\t\t}\n\t},\n\ttoggle: {\n\t\tvalidate: value => typeof value === \"boolean\",\n\t\trun({ def, value, Y, access }) {\n\t\t\tDrawCheckbox(1050, Y, 64, 64, def.description, value, !access);\n\t\t},\n\t\tclick({ value, Y, access }) {\n\t\t\tif (!access)\n\t\t\t\treturn;\n\t\t\tif (MouseIn(1050, Y, 64, 64)) {\n\t\t\t\treturn !value;\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}\n\t}\n};\n\nfunction parseRuleName(selector: string, filter?: (ruleName: BCX_Rule) => boolean): [true, BCX_Rule] | [false, string] {\n\tselector = selector.toLocaleLowerCase();\n\tconst rule = Array.from(rules.entries())\n\t\t.filter(r => !filter || filter(r[0]))\n\t\t.find(([ruleName, data]) => ruleName.toLocaleLowerCase() === selector || data.name.toLocaleLowerCase() === selector);\n\treturn rule ? [true, rule[0]] : [false, `Unknown rule \"${selector}\".`];\n}\n\nfunction autocompleteRuleName(selector: string, filter?: (ruleName: BCX_Rule) => boolean): string[] {\n\tselector = selector.toLocaleLowerCase();\n\n\tlet options: string[] = Array.from(rules.entries())\n\t\t.filter(r => r[1].name.toLocaleLowerCase().startsWith(selector) && (!filter || filter(r[0])))\n\t\t.map(r => r[1].name);\n\n\tif (options.length === 0) {\n\t\toptions = Array.from(rules.entries())\n\t\t\t.filter(r => r[0].toLocaleLowerCase().startsWith(selector) && (!filter || filter(r[0])))\n\t\t\t.map(r => r[0]);\n\t}\n\n\treturn options;\n}\n\nexport function RulesGetList(): [BCX_Rule, RuleDisplayDefinition][] {\n\treturn rulesList.map(rule => [rule, RulesGetDisplayDefinition(rule)]);\n}\n\nexport function RulesCreate(rule: BCX_Rule, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Rules))\n\t\treturn false;\n\n\tif (character && !ConditionsCheckAccess(\"rules\", rule, character))\n\t\treturn false;\n\n\tconst definition = rules.get(rule);\n\tif (!definition) {\n\t\tthrow new Error(`Attempt to create unknown rule '${rule}'`);\n\t}\n\n\tif (!ConditionsGetCondition(\"rules\", rule)) {\n\t\tconst ruleData: ConditionsCategorySpecificData[\"rules\"] = {};\n\t\tif (definition.dataDefinition) {\n\t\t\truleData.customData = {};\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(definition.dataDefinition)) {\n\t\t\t\truleData.customData[k] = cloneDeep(typeof v.default === \"function\" ? v.default() : v.default);\n\t\t\t}\n\t\t}\n\t\tif (definition.internalDataDefault) {\n\t\t\truleData.internalData = definition.internalDataDefault();\n\t\t\tif (!definition.internalDataValidate?.(ruleData.internalData)) {\n\t\t\t\tthrow new Error(`Failed to create valid internal data for rule '${rule}'`);\n\t\t\t}\n\t\t}\n\t\tConditionsSetCondition(\"rules\", rule, ruleData, character);\n\t\tif (character) {\n\t\t\tlogMessage(\"rule_change\", LogEntryType.plaintext, `${character} added a new rule: ${definition.name}`);\n\t\t\tif (!character.isPlayer()) {\n\t\t\t\tChatRoomSendLocal(`${character} gave you a new rule: \"${definition.name}\"`);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function RulesDelete(rule: BCX_Rule, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Rules))\n\t\treturn false;\n\n\tif (character && !ConditionsCheckAccess(\"rules\", rule, character))\n\t\treturn false;\n\n\tconst display = RulesGetDisplayDefinition(rule);\n\n\tif (ConditionsRemoveCondition(\"rules\", rule) && character) {\n\t\tlogMessage(\"rule_change\", LogEntryType.plaintext, `${character} removed the rule: ${display.name}`);\n\t\tif (!character.isPlayer()) {\n\t\t\tChatRoomSendLocal(`${character} removed your rule \"${display.name}\"`);\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport class RuleState<ID extends BCX_Rule> {\n\treadonly rule: ID;\n\treadonly ruleDefinition: RuleDisplayDefinition<ID>;\n\n\tget condition(): ConditionsConditionData<\"rules\"> | undefined {\n\t\treturn ConditionsGetCondition(\"rules\", this.rule);\n\t}\n\n\tget inEffect(): boolean {\n\t\treturn ConditionsIsConditionInEffect(\"rules\", this.rule);\n\t}\n\n\tget isEnforced(): boolean {\n\t\tconst data = this.condition;\n\t\tif (!data || !this.inEffect)\n\t\t\treturn false;\n\t\treturn data.data.enforce !== false;\n\t}\n\n\tget isLogged(): boolean {\n\t\tconst data = this.condition;\n\t\tif (!data || !this.inEffect)\n\t\t\treturn false;\n\t\treturn data.data.log !== false;\n\t}\n\n\tget customData(): ID extends keyof RuleCustomData ? (RuleCustomData[ID] | undefined) : undefined {\n\t\treturn this.condition?.data.customData as any;\n\t}\n\n\tget internalData(): ID extends keyof RuleInternalData ? (RuleInternalData[ID] | undefined) : undefined {\n\t\treturn cloneDeep(this.condition?.data.internalData);\n\t}\n\n\tset internalData(data: ID extends keyof RuleInternalData ? (RuleInternalData[ID] | undefined) : undefined) {\n\t\tconst condition = this.condition;\n\t\tif (condition && !isEqual(condition.data.internalData, data)) {\n\t\t\tcondition.data.internalData = data;\n\t\t\tmodStorageSync();\n\t\t}\n\t}\n\n\tconstructor(rule: ID, definition: RuleDisplayDefinition<ID>) {\n\t\tthis.rule = rule;\n\t\tthis.ruleDefinition = definition;\n\t}\n\n\ttrigger(dictionary: Record<string, string> = {}): void {\n\t\tconst texts = this.ruleDefinition.triggerTexts;\n\t\tif (texts) {\n\t\t\tif (texts.infoBeep) {\n\t\t\t\tInfoBeep(\"BCX: \" + dictionaryProcess(texts.infoBeep, dictionary), 7_000);\n\t\t\t}\n\t\t\tif (this.isLogged) {\n\t\t\t\tconst log = texts.log;\n\t\t\t\tif (log) {\n\t\t\t\t\tlogMessage(\"rule_trigger\", LogEntryType.ruleTrigger, [this.rule, dictionary]);\n\t\t\t\t}\n\t\t\t\tconst announce = texts.announce ?? texts.log;\n\t\t\t\tif (announce) {\n\t\t\t\t\tChatRoomActionMessage(`${dictionaryProcess(announce, dictionary)}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\ttriggerAttempt(dictionary: Record<string, string> = {}): void {\n\t\tconst texts = this.ruleDefinition.triggerTexts;\n\t\tif (texts) {\n\t\t\tconst infoBeep = texts.attempt_infoBeep ?? texts.infoBeep;\n\t\t\tif (infoBeep) {\n\t\t\t\tInfoBeep(\"BCX: \" + dictionaryProcess(infoBeep, dictionary), 7_000);\n\t\t\t}\n\t\t\tif (this.isLogged) {\n\t\t\t\tconst log = texts.attempt_log;\n\t\t\t\tif (log) {\n\t\t\t\t\tlogMessage(\"rule_trigger\", LogEntryType.ruleTriggerAttempt, [this.rule, dictionary]);\n\t\t\t\t}\n\t\t\t\tconst announce = texts.attempt_announce ?? texts.attempt_log;\n\t\t\t\tif (announce) {\n\t\t\t\t\tChatRoomActionMessage(`${dictionaryProcess(announce, dictionary)}.`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class ModuleRules extends BaseModule {\n\tprivate resetTimer: number | null = null;\n\tprivate triggerCounts: Map<BCX_Rule, number> = new Map();\n\tprivate suspendedUntil: number | null = null;\n\n\tinit() {\n\t\tregisterPermission(\"rules_normal\", {\n\t\t\tname: \"Allows controlling non-limited rules\",\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"rules_limited\", {\n\t\t\tname: \"Allows controlling limited rules\",\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.lover]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"rules_global_configuration\", {\n\t\t\tname: \"Allows editing the global rules configuration\",\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.lover]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"rules_change_limits\", {\n\t\t\tname: \"Allows to limit/block specific rules\",\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.self],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"rules_view_originator\", {\n\t\t\tname: \"Allow to view who added the rule originally\",\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\n\t\tqueryHandlers.ruleCreate = (sender, resolve, data) => {\n\t\t\tif (guard_BCX_Rule(data)) {\n\t\t\t\tresolve(true, RulesCreate(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.ruleDelete = (sender, resolve, data) => {\n\t\t\tif (guard_BCX_Rule(data)) {\n\t\t\t\tresolve(true, RulesDelete(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\n\t\tregisterWhisperCommand(\"rules\", \"- Manage rules\", (argv, sender, respond) => {\n\t\t\tif (!moduleIsEnabled(ModuleCategory.Rules)) {\n\t\t\t\treturn respond(`Rules module is disabled.`);\n\t\t\t}\n\t\t\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase();\n\t\t\tconst rulesInfo = ConditionsGetCategoryPublicData(\"rules\", sender).conditions;\n\t\t\tif (ConditionsSubcommands.includes(subcommand as ConditionsSubcommand)) {\n\t\t\t\treturn ConditionsRunSubcommand(\"rules\", argv, sender, respond);\n\t\t\t} else if (subcommand === \"list\") {\n\t\t\t\tlet result = \"Current rules:\";\n\t\t\t\tfor (const [k, v] of Object.entries(rulesInfo)) {\n\t\t\t\t\tconst data = RulesGetDisplayDefinition(k as BCX_Rule);\n\t\t\t\t\tconst timerText = `Timer: ${v.timer ? formatTimeInterval(v.timer - Date.now(), \"short\") : \"\"}`;\n\t\t\t\t\tconst resultItem = `\\n${data.name} | ${timerText}`;\n\t\t\t\t\tif (result.length + resultItem.length >= 990) {\n\t\t\t\t\t\tresult += \"\\n...\";\n\t\t\t\t\t\trespond(result);\n\t\t\t\t\t\tresult = \"Current rules (continued):\";\n\t\t\t\t\t}\n\t\t\t\t\tresult += resultItem;\n\t\t\t\t}\n\t\t\t\trespond(result);\n\t\t\t} else if (subcommand === \"description\") {\n\t\t\t\tconst result = parseRuleName(argv[1] || \"\");\n\t\t\t\tif (!result[0]) {\n\t\t\t\t\treturn respond(result[1]);\n\t\t\t\t}\n\t\t\t\tconst data = RulesGetDisplayDefinition(result[1]);\n\t\t\t\trespond(data.longDescription.replaceAll(\"PLAYER_NAME\", Player.Name));\n\t\t\t} else if (subcommand === \"remove\") {\n\t\t\t\tconst result = parseRuleName(argv[1] || \"\");\n\t\t\t\tif (!result[0]) {\n\t\t\t\t\treturn respond(result[1]);\n\t\t\t\t}\n\t\t\t\trespond(RulesDelete(result[1], sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else {\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!rules usage (page 1):\\n` +\n\t\t\t\t\t`!rules list - List all currently applied rules\\n` +\n\t\t\t\t\t`!rules description <rule> - Show the rule's description\\n` +\n\t\t\t\t\t`!rules remove <rule> - Remove a currently applied rule if permitted to\\n` +\n\t\t\t\t\t`\\nNote: Adding and setting up rules is only supported via using BCX's graphical user interface yourself.`\n\t\t\t\t));\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!rules usage (page 2):\\n` +\n\t\t\t\t\t`!rules setactive <rule> <yes/no> - Switch the rule and its conditions on and off\\n` +\n\t\t\t\t\t`!rules triggers <rule> global <yes/no> - Set the trigger condition of this rule to the global configuration\\n` +\n\t\t\t\t\t`!rules triggers <rule> help - Set the trigger configuration of a rule\\n` +\n\t\t\t\t\t`!rules globaltriggers help - Set global trigger configuration\\n` +\n\t\t\t\t\t`!rules timer <rule> help - Set timer options of a rule\\n` +\n\t\t\t\t\t`!rules defaulttimer help - Set default timer options used on new rules\\n` +\n\t\t\t\t\t`!rules setlimit <rule> <normal/limited/blocked> - Set a limit on certain <rule>\\n` +\n\t\t\t\t\t`\\nHint: If an argument contains spaces: \"put it in quotes\"`\n\t\t\t\t));\n\t\t\t}\n\t\t}, (argv, sender) => {\n\t\t\tif (!moduleIsEnabled(ModuleCategory.Rules)) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tif (argv.length <= 1) {\n\t\t\t\treturn Command_pickAutocomplete(argv[0], [\"list\", \"description\", \"remove\", ...ConditionsSubcommands]);\n\t\t\t}\n\n\t\t\tconst subcommand = argv[0].toLocaleLowerCase();\n\n\t\t\tif (ConditionsSubcommands.includes(subcommand as ConditionsSubcommand)) {\n\t\t\t\treturn ConditionsAutocompleteSubcommand(\"rules\", argv, sender);\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\n\t\tConditionsRegisterCategory(\"rules\", {\n\t\t\tcategory: ModuleCategory.Rules,\n\t\t\tpermission_normal: \"rules_normal\",\n\t\t\tpermission_limited: \"rules_limited\",\n\t\t\tpermission_configure: \"rules_global_configuration\",\n\t\t\tpermission_changeLimits: \"rules_change_limits\",\n\t\t\tpermission_viewOriginator: \"rules_view_originator\",\n\t\t\tloadValidateConditionKey: rule => guard_BCX_Rule(rule),\n\t\t\tloadValidateCondition: (rule, data) => {\n\t\t\t\tconst info = data.data;\n\t\t\t\tconst descriptor = rules.get(rule as BCX_Rule);\n\t\t\t\tif (!descriptor) {\n\t\t\t\t\tconsole.error(`BCX: Bad data for rule ${rule}: descriptor not found, removing it`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (!isObject(info) ||\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-boolean-literal-compare\n\t\t\t\t\t(info.enforce !== undefined && info.enforce !== false) ||\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-boolean-literal-compare\n\t\t\t\t\t(info.log !== undefined && info.log !== false)\n\t\t\t\t) {\n\t\t\t\t\tconsole.error(`BCX: Bad data for rule ${rule}, removing it`, info);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (descriptor.dataDefinition) {\n\t\t\t\t\tif (!isObject(info.customData)) {\n\t\t\t\t\t\tconsole.warn(`BCX: Missing custom data for rule ${rule}, fixing`);\n\t\t\t\t\t\tinfo.customData = {};\n\t\t\t\t\t}\n\t\t\t\t\tfor (const k of Object.keys(info.customData)) {\n\t\t\t\t\t\tif (!(descriptor.dataDefinition as Record<string, any>)[k]) {\n\t\t\t\t\t\t\tconsole.warn(`BCX: Unknown custom data attribute '${k}' for rule ${rule}, cleaning up`, info.customData[k]);\n\t\t\t\t\t\t\tdelete info.customData[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tfor (const [k, def] of Object.entries<RuleCustomDataEntryDefinition>(descriptor.dataDefinition)) {\n\t\t\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[def.type];\n\t\t\t\t\t\tif (!handler) {\n\t\t\t\t\t\t\tconsole.error(`BCX: Custom data for rule ${rule} unknown type ${def.type}, removing it`, info);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!handler.validate(info.customData[k], def)) {\n\t\t\t\t\t\t\tconsole.warn(`BCX: Bad custom data ${k} for rule ${rule}, expected type ${def.type}, replacing with default`, info.customData[k]);\n\t\t\t\t\t\t\tinfo.customData[k] = (typeof def.default === \"function\" ? def.default() : def.default);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (info.customData !== undefined) {\n\t\t\t\t\tconsole.error(`BCX: Custom data for rule ${rule} without data definition, removing it`, info);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (descriptor.internalDataValidate) {\n\t\t\t\t\tif (!descriptor.internalDataValidate(info.internalData)) {\n\t\t\t\t\t\tif (info.internalData === undefined && descriptor.internalDataDefault) {\n\t\t\t\t\t\t\tconsole.warn(`BCX: Missing internal data for rule ${rule}, fixing`);\n\t\t\t\t\t\t\tinfo.internalData = descriptor.internalDataDefault();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error(`BCX: Bad internal data for rule ${rule}, removing it`, info);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (info.internalData !== undefined) {\n\t\t\t\t\tconsole.error(`BCX: Internal data for rule ${rule} without validator, removing it`, info);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tloadCategorySpecificGlobalData: () => undefined,\n\t\t\tstateChangeHandler: this.ruleStateChange.bind(this),\n\t\t\ttickHandler: this.ruleTick.bind(this),\n\t\t\tmakePublicData: (rule, data) => ({\n\t\t\t\tenforce: data.data.enforce ?? true,\n\t\t\t\tlog: data.data.log ?? true,\n\t\t\t\tcustomData: cloneDeep(data.data.customData)\n\t\t\t}),\n\t\t\tvalidateCategorySpecificGlobalData: () => true,\n\t\t\tvalidatePublicData: (rule, data) =>\n\t\t\t\tisObject(data) &&\n\t\t\t\ttypeof data.enforce === \"boolean\" &&\n\t\t\t\ttypeof data.log === \"boolean\" &&\n\t\t\t\tguard_RuleCustomData(rule, data.customData),\n\t\t\tupdateCondition: (condition, data, updateData) => {\n\t\t\t\tif (updateData.enforce) {\n\t\t\t\t\tdelete data.data.enforce;\n\t\t\t\t} else {\n\t\t\t\t\tdata.data.enforce = false;\n\t\t\t\t}\n\n\t\t\t\tif (updateData.log) {\n\t\t\t\t\tdelete data.data.log;\n\t\t\t\t} else {\n\t\t\t\t\tdata.data.log = false;\n\t\t\t\t}\n\n\t\t\t\tif (updateData.customData) {\n\t\t\t\t\tdata.data.customData = cloneDeep(updateData.customData);\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tparseConditionName: (selector, onlyExisting) => {\n\t\t\t\treturn parseRuleName(selector, onlyExisting ? (rule => onlyExisting.includes(rule)) : undefined);\n\t\t\t},\n\t\t\tautocompleteConditionName: (selector, onlyExisting) => {\n\t\t\t\treturn autocompleteRuleName(selector, onlyExisting ? (rule => onlyExisting.includes(rule)) : undefined);\n\t\t\t},\n\t\t\tlogLimitChange: (rule, character, newLimit) => {\n\t\t\t\tconst definition = RulesGetDisplayDefinition(rule);\n\t\t\t\tlogMessage(\"rule_change\", LogEntryType.plaintext,\n\t\t\t\t\t`${character} changed ${Player.Name}'s '${definition.name}' rule permission to ${ConditionsLimit[newLimit]}`);\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tChatRoomSendLocal(`${character} changed '${definition.name}' rule permission to ${ConditionsLimit[newLimit]}`, undefined, character.MemberNumber);\n\t\t\t\t}\n\t\t\t},\n\t\t\tlogConditionUpdate: (rule, character, newData, oldData) => {\n\t\t\t\tconst definition = RulesGetDisplayDefinition(rule);\n\t\t\t\tconst visibleName = definition.name;\n\n\t\t\t\tconst didActiveChange = newData.active !== oldData.active;\n\t\t\t\tconst didTimerChange = newData.timer !== oldData.timer || newData.timerRemove !== oldData.timerRemove;\n\t\t\t\tconst didTriggerChange = !isEqual(newData.requirements, oldData.requirements);\n\t\t\t\tconst didEnforcementChange = newData.data.enforce !== oldData.data.enforce;\n\t\t\t\tconst didLoggingChange = newData.data.log !== oldData.data.log;\n\t\t\t\tconst changeEvents: string[] = [];\n\t\t\t\tif (didActiveChange)\n\t\t\t\t\tchangeEvents.push(\"active state\");\n\t\t\t\tif (didTimerChange)\n\t\t\t\t\tchangeEvents.push(\"timer\");\n\t\t\t\tif (didTriggerChange)\n\t\t\t\t\tchangeEvents.push(\"trigger condition\");\n\t\t\t\tif (didEnforcementChange)\n\t\t\t\t\tchangeEvents.push(\"enforcement\");\n\t\t\t\tif (didLoggingChange)\n\t\t\t\t\tchangeEvents.push(\"logging\");\n\t\t\t\tif (definition.dataDefinition) {\n\t\t\t\t\tfor (const [k, def] of Object.entries<RuleCustomDataEntryDefinition>(definition.dataDefinition)) {\n\t\t\t\t\t\tif (!isEqual(oldData.data.customData?.[k], newData.data.customData?.[k])) {\n\t\t\t\t\t\t\tlet descr = def.description;\n\t\t\t\t\t\t\tif (descr.includes(\":\")) {\n\t\t\t\t\t\t\t\tdescr = descr.slice(0, descr.lastIndexOf(\":\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tchangeEvents.push(`${changeEvents.length > 0 ? \"and \" : \"\"}the value of the setting '${descr}'`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (changeEvents.length > 0) {\n\t\t\t\t\tlogMessage(\"rule_change\", LogEntryType.plaintext,\n\t\t\t\t\t\t`${character} changed the ${changeEvents.join(\", \")} of ${Player.Name}'s '${visibleName}' rule`);\n\t\t\t\t}\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tif (didActiveChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} ${newData.active ? \"reactivated\" : \"deactivated\"} the '${visibleName}' rule`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== oldData.timer)\n\t\t\t\t\t\tif (newData.timer === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} disabled the timer of the '${visibleName}' rule`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the remaining time of the timer of the '${visibleName}' rule to ${formatTimeInterval(newData.timer - Date.now())}`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== null && newData.timerRemove !== oldData.timerRemove)\n\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the timer behavior of the '${visibleName}' rule to ${newData.timerRemove ? \"remove\" : \"disable\"} the rule when time runs out`, undefined, character.MemberNumber);\n\t\t\t\t\tif (didTriggerChange)\n\t\t\t\t\t\tif (newData.requirements === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the triggers of '${visibleName}' rule to the global rules configuration`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst triggers: string[] = [];\n\t\t\t\t\t\t\tconst r = newData.requirements;\n\t\t\t\t\t\t\tif (r.room) {\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.roomName) {\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.role) {\n\t\t\t\t\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.player) {\n\t\t\t\t\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (triggers.length > 0) {\n\t\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the '${visibleName}' rule to trigger under following conditions:\\n` + triggers.join(\"\\n\"), undefined, character.MemberNumber);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tChatRoomSendLocal(`${character} deactivated all trigger conditions of the '${visibleName}' rule. The rule will now always trigger, while it is active`, undefined, character.MemberNumber);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tif (didEnforcementChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} ${newData.data.enforce ? \"enabled enforcement\" : \"stopped enforcement\"} of the '${visibleName}' rule`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (didLoggingChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} ${newData.data.log ? \"enabled logging\" : \"stopped logging\"} of the '${visibleName}' rule`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (definition.dataDefinition) {\n\t\t\t\t\t\tfor (const [k, def] of Object.entries<RuleCustomDataEntryDefinition>(definition.dataDefinition)) {\n\t\t\t\t\t\t\tif (!isEqual(oldData.data.customData?.[k], newData.data.customData?.[k])) {\n\t\t\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the '${visibleName}' rule's setting '${def.description}' from '${oldData.data.customData?.[k]}' to '${newData.data.customData?.[k]}'`, undefined, character.MemberNumber);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tlogCategoryUpdate: (character, newData, oldData) => {\n\t\t\t\tconst didTimerChange = newData.timer !== oldData.timer || newData.timerRemove !== oldData.timerRemove;\n\t\t\t\tconst didTriggerChange = !isEqual(newData.requirements, oldData.requirements);\n\t\t\t\tconst changeEvents = [];\n\t\t\t\tif (didTimerChange)\n\t\t\t\t\tchangeEvents.push(\"default timer\");\n\t\t\t\tif (didTriggerChange)\n\t\t\t\t\tchangeEvents.push(\"trigger condition\");\n\t\t\t\tif (changeEvents.length > 0) {\n\t\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext,\n\t\t\t\t\t\t`${character} changed the ${changeEvents.join(\", \")} of ${Player.Name}'s global rules config`);\n\t\t\t\t}\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tif (newData.timer !== oldData.timer)\n\t\t\t\t\t\tif (newData.timer === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} removed the default timer of the global rules configuration`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the default timer of the global rules configuration to ${formatTimeInterval(newData.timer)}`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== null && newData.timerRemove !== oldData.timerRemove)\n\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the default timeout behavior of the global rules configuration to ${newData.timerRemove ? \"removal of rules\" : \"disabling rules\"} when time runs out`, undefined, character.MemberNumber);\n\t\t\t\t\tif (didTriggerChange) {\n\t\t\t\t\t\tconst triggers: string[] = [];\n\t\t\t\t\t\tconst r = newData.requirements;\n\t\t\t\t\t\tif (r.room) {\n\t\t\t\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.roomName) {\n\t\t\t\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.role) {\n\t\t\t\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.player) {\n\t\t\t\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (triggers.length > 0) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the global rules configuration to trigger rules under following conditions:\\n` + triggers.join(\"\\n\"), undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} deactivated all trigger conditions for the global rules configuration. Rules set to this default configuration will now always trigger, while active`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetDefaultLimits: () => {\n\t\t\t\tconst res: Record<string, ConditionsLimit> = {};\n\t\t\t\tfor (const [k, v] of rules.entries()) {\n\t\t\t\t\tres[k] = v.defaultLimit;\n\t\t\t\t}\n\t\t\t\treturn res;\n\t\t\t},\n\t\t\tcommandConditionSelectorHelp: \"rule\"\n\t\t});\n\n\t\t// Init individual rules\n\t\tinitRules_bc_blocks();\n\t\tinitRules_bc_alter();\n\t\tinitRules_bc_settings();\n\t\tinitRules_bc_relation_control();\n\t\tinitRules_bc_speech_control();\n\t\tinitRules_other();\n\n\t\tfor (const rule of rules.values()) {\n\t\t\tif (rule.init) {\n\t\t\t\trule.init(rule.state);\n\t\t\t}\n\t\t}\n\t}\n\n\tload() {\n\t\tif (!moduleIsEnabled(ModuleCategory.Rules)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const rule of rules.values()) {\n\t\t\tif (rule.load) {\n\t\t\t\trule.load(rule.state);\n\t\t\t}\n\t\t}\n\t}\n\n\trun() {\n\t\tif (!moduleIsEnabled(ModuleCategory.Rules))\n\t\t\treturn;\n\n\t\tthis.resetTimer = BCX_setInterval(() => {\n\t\t\tthis.triggerCounts.clear();\n\t\t}, RULES_ANTILOOP_RESET_INTERVAL);\n\t}\n\n\tunload() {\n\t\tif (this.resetTimer !== null) {\n\t\t\tclearInterval(this.resetTimer);\n\t\t\tthis.resetTimer = null;\n\t\t}\n\n\t\tfor (const rule of rules.values()) {\n\t\t\tif (rule.unload) {\n\t\t\t\trule.unload();\n\t\t\t}\n\t\t}\n\t}\n\n\treload() {\n\t\tthis.unload();\n\t\tthis.load();\n\t\tthis.run();\n\t}\n\n\truleStateChange(rule: BCX_Rule, condition: ConditionsConditionData<\"rules\">, newState: boolean): void {\n\t\tconst ruleDefinition = rules.get(rule);\n\t\tif (!ruleDefinition) {\n\t\t\tthrow new Error(`Definition for rule ${rule} not found`);\n\t\t}\n\n\t\truleDefinition.stateChange?.(ruleDefinition.state, newState);\n\t}\n\n\truleTick(rule: BCX_Rule, condition: ConditionsConditionData<\"rules\">): void {\n\t\tif (this.suspendedUntil !== null) {\n\t\t\tif (Date.now() >= this.suspendedUntil) {\n\t\t\t\tthis.suspendedUntil = null;\n\t\t\t\tthis.triggerCounts.clear();\n\t\t\t\tChatRoomActionMessage(`All of ${Player.Name}'s temporarily suspended rules are in effect again.`);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst ruleDefinition = rules.get(rule);\n\t\tif (!ruleDefinition) {\n\t\t\tthrow new Error(`Definition for rule ${rule} not found`);\n\t\t}\n\n\t\tif (ruleDefinition.tick) {\n\t\t\tif (ruleDefinition.tick(ruleDefinition.state)) {\n\t\t\t\tconst counter = (this.triggerCounts.get(rule) ?? 0) + 1;\n\t\t\t\tthis.triggerCounts.set(rule, counter);\n\n\t\t\t\tif (counter >= RULES_ANTILOOP_THRESHOLD) {\n\t\t\t\t\tChatRoomActionMessage(\"Protection triggered: The effects of rules have been suspended for 10 minutes. Please refrain from triggering rules so rapidly, as it creates strain on the server and may lead to unwanted side effects! If you believe this message was triggered by a bug, please report it to BCX Discord.\");\n\t\t\t\t\tthis.suspendedUntil = Date.now() + RULES_ANTILOOP_SUSPEND_TIME;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ChatRoomActionMessage, ChatRoomSendLocal, getVisibleGroupName, isBind } from \"../utilsClub\";\nimport { ChatroomCharacter, getAllCharactersInRoom, getChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { hookFunction } from \"../patching\";\nimport { arrayUnique, longestCommonPrefix } from \"../utils\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { firstTimeInit, modStorage, modStorageSync } from \"./storage\";\nimport { queryHandlers, sendQuery } from \"./messaging\";\nimport { RulesGetRuleState } from \"./rules\";\n\ninterface ICommandInfo {\n\tdescription: string | null;\n}\n\nexport type CommandHandlerRaw = (args: string) => boolean;\nexport type CommandHandlerParsed = (argv: string[]) => boolean;\nexport type CommandAutocompleterRaw = (args: string) => string[];\nexport type CommandAutocompleterParsed = (argv: string[]) => string[];\n\ntype WhisperCommandHandler = (argv: string[], sender: ChatroomCharacter, respond: (msg: string) => void) => void;\ntype WhisperCommandAutocompleter = (argv: string[], sender: ChatroomCharacter) => string[];\n\ninterface ICommandRaw extends ICommandInfo {\n\tparse: false;\n\tcallback: CommandHandlerRaw;\n\tautocomplete: CommandAutocompleterRaw | null;\n}\n\ninterface ICommandParsed extends ICommandInfo {\n\tparse: true;\n\tcallback: CommandHandlerParsed;\n\tautocomplete: CommandAutocompleterParsed | null;\n}\n\ninterface IWhisperCommand extends ICommandInfo {\n\tcallback: WhisperCommandHandler;\n\tautocomplete: WhisperCommandAutocompleter | null;\n}\n\nexport const COMMAND_GENERIC_ERROR = `The command failed to execute, likely because you are lacking the permission to give it.`;\n\nconst commands: Map<string, ICommandRaw | ICommandParsed> = new Map();\nconst whisperCommands: Map<string, IWhisperCommand> = new Map();\n\nlet firstTimeHelp: HTMLDivElement | null = null;\n\nexport function CommandsShowFirstTimeHelp() {\n\tif (!firstTimeHelp && modStorage.chatShouldDisplayFirstTimeHelp) {\n\t\tfirstTimeHelp = ChatRoomSendLocal(\n\t\t\t`[ BCX commands tutorial ]\\n` +\n\t\t\t`BCX also provides helpful chat commands.\\n` +\n\t\t\t`All commands start with a dot ( . )\\n` +\n\t\t\t`The commands also support auto-completion: While writing a command, press 'Tab' to try automatically completing the currently typed word.\\n` +\n\t\t\t`Other club members can also use commands of your BCX, without needing BCX themselves. They will get a list of all commands they have permission using by whispering '!help' ( ! instead of . ) to you.\\n` +\n\t\t\t`Note: Messages colored like this text can only be seen by you and no one else.\\n` +\n\t\t\t`\\n` +\n\t\t\t`To complete this tutorial, use '.help' command by writing '.he' and pressing 'Tab' to complete it to '.help', it will show you list of available BCX commands.`\n\t\t);\n\t}\n}\n\nfunction CommandsCompleteFirstTimeHelp() {\n\tif (modStorage.chatShouldDisplayFirstTimeHelp !== undefined) {\n\t\tdelete modStorage.chatShouldDisplayFirstTimeHelp;\n\t\tmodStorageSync();\n\t}\n\tif (firstTimeHelp) {\n\t\tfirstTimeHelp.remove();\n\t\tfirstTimeHelp = null;\n\t}\n}\n\nexport function registerCommand(name: string, description: string | null, callback: CommandHandlerRaw, autocomplete: CommandAutocompleterRaw | null = null) {\n\tname = name.toLocaleLowerCase();\n\tif (commands.has(name)) {\n\t\tthrow new Error(`Command \"${name}\" already registered!`);\n\t}\n\tcommands.set(name, {\n\t\tparse: false,\n\t\tcallback,\n\t\tautocomplete,\n\t\tdescription\n\t});\n}\n\nexport function aliasCommand(originalName: string, alias: string): void {\n\toriginalName = originalName.toLocaleLowerCase();\n\talias = alias.toLocaleLowerCase();\n\tconst original = commands.get(originalName);\n\tif (!original) {\n\t\tthrow new Error(`Command \"${originalName}\" to alias not found`);\n\t}\n\tif (original.parse) {\n\t\tcommands.set(alias, {\n\t\t\tparse: true,\n\t\t\tdescription: null,\n\t\t\tcallback: original.callback,\n\t\t\tautocomplete: original.autocomplete\n\t\t});\n\t} else {\n\t\tcommands.set(alias, {\n\t\t\tparse: false,\n\t\t\tdescription: null,\n\t\t\tcallback: original.callback,\n\t\t\tautocomplete: original.autocomplete\n\t\t});\n\t}\n}\n\nexport function registerCommandParsed(\n\tname: string,\n\tdescription: string | null,\n\tcallback: CommandHandlerParsed,\n\tautocomplete: CommandAutocompleterParsed | null = null\n) {\n\tname = name.toLocaleLowerCase();\n\tif (commands.has(name)) {\n\t\tthrow new Error(`Command \"${name}\" already registered!`);\n\t}\n\tcommands.set(name, {\n\t\tparse: true,\n\t\tcallback,\n\t\tautocomplete,\n\t\tdescription\n\t});\n}\n\nexport function registerWhisperCommand(\n\tname: string,\n\tdescription: string | null,\n\tcallback: WhisperCommandHandler,\n\tautocomplete: WhisperCommandAutocompleter | null = null,\n\tregisterNormal: boolean = true\n) {\n\tname = name.toLocaleLowerCase();\n\tif (registerNormal) {\n\t\tregisterCommandParsed(\n\t\t\tname,\n\t\t\tdescription,\n\t\t\t(argv) => { callback(argv, getPlayerCharacter(), (msg) => ChatRoomSendLocal(msg)); return true; },\n\t\t\tautocomplete ? (argv) => autocomplete(argv, getPlayerCharacter()) : null\n\t\t);\n\t}\n\tif (whisperCommands.has(name)) {\n\t\tthrow new Error(`Command \"${name}\" already registered!`);\n\t}\n\twhisperCommands.set(name, {\n\t\tcallback,\n\t\tautocomplete,\n\t\tdescription\n\t});\n}\n\nfunction CommandParse(msg: string): [string, string] {\n\tmsg = msg.trimStart();\n\tconst commandMatch = /^(\\S+)(?:\\s|$)(.*)$/.exec(msg);\n\tif (!commandMatch) {\n\t\treturn [\"\", \"\"];\n\t}\n\treturn [(commandMatch[1] || \"\").toLocaleLowerCase(), commandMatch[2]];\n}\n\nfunction CommandParseArguments(args: string): string[] {\n\treturn [...args.matchAll(/\".*?(?:\"|$)|'.*?(?:'|$)|[^ ]+/g)]\n\t\t.map(a => a[0])\n\t\t.map(a => a[0] === '\"' || a[0] === \"'\" ? a.substring(1, a.length > 1 && a[a.length - 1] === a[0] ? a.length - 1 : a.length) : a);\n}\n\nfunction CommandHasEmptyArgument(args: string): boolean {\n\tconst argv = CommandParseArguments(args);\n\treturn argv.length === 0 || !args.endsWith(argv[argv.length - 1]);\n}\n\nfunction CommandArgumentNeedsQuotes(arg: string): boolean {\n\treturn arg.includes(\" \") || arg.includes('\"') || arg.startsWith(`'`);\n}\n\nfunction CommandQuoteArgument(arg: string, force: boolean = false): string {\n\tif (arg.startsWith(`\"`)) {\n\t\treturn `'${arg}'`;\n\t} else if (arg.startsWith(`'`)) {\n\t\treturn `\"${arg}\"`;\n\t} else if (arg.includes(\" \") || force) {\n\t\treturn arg.includes('\"') ? `'${arg}'` : `\"${arg}\"`;\n\t}\n\treturn arg;\n}\n\nlet autocompleteMessage: null | HTMLDivElement = null;\nlet autocompleteLastQuery: string | null = null;\nlet autocompleteLastResult: [string, string][] = [];\nlet autocompleteNextIndex = 0;\n\nfunction autocompleteClear() {\n\tif (autocompleteMessage) {\n\t\tautocompleteMessage.remove();\n\t\tautocompleteMessage = null;\n\t}\n\tautocompleteLastQuery = null;\n}\n\nfunction autocompleteShow(header: string, options: string[], highlight?: number) {\n\tautocompleteClear();\n\tif (options.length > 0) {\n\t\tconst res = document.createElement(\"div\");\n\t\tres.innerText += `[${header}]\\n`;\n\t\tfor (let i = 0; i < options.length; i++) {\n\t\t\tconst option = document.createElement(\"div\");\n\t\t\toption.innerText = options[i];\n\t\t\tif (i === highlight) {\n\t\t\t\toption.style.background = `#7e7eff54`;\n\t\t\t}\n\t\t\tres.appendChild(option);\n\t\t}\n\t\tautocompleteMessage = ChatRoomSendLocal(res, 10_000);\n\t}\n}\n\nfunction RunCommand(msg: string): boolean {\n\tautocompleteClear();\n\n\tconst [command, args] = CommandParse(msg);\n\n\tconst commandInfo = commands.get(command);\n\tif (!commandInfo) {\n\t\t// Command not found\n\t\tChatRoomSendLocal(\n\t\t\t`Unknown command \"${command}\"\\n` +\n\t\t\t`To see list of valid commands use '.help'`,\n\t\t\t15000\n\t\t);\n\t\treturn false;\n\t}\n\tif (commandInfo.parse) {\n\t\treturn commandInfo.callback(CommandParseArguments(args));\n\t} else {\n\t\treturn commandInfo.callback(args);\n\t}\n}\n\nfunction RunWhisperCommand(msg: string, sender: ChatroomCharacter, respond: (msg: string) => void): void {\n\tconst [command, args] = CommandParse(msg);\n\n\tconst commandInfo = whisperCommands.get(command);\n\tif (!commandInfo) {\n\t\t// Command not found\n\t\trespond(\n\t\t\t`Unknown command \"${command}\"\\n` +\n\t\t\t`To see list of valid commands whisper '!help'`\n\t\t);\n\t\treturn;\n\t}\n\treturn commandInfo.callback(CommandParseArguments(args), sender, respond);\n}\n\nfunction CommandAutocomplete(msg: string): [string, string][] {\n\tmsg = msg.trimStart();\n\tconst [command, args] = CommandParse(msg);\n\n\tif (msg.length === command.length) {\n\t\tconst prefixes = Array.from(commands.entries()).filter(c => c[1].description !== null && c[0].startsWith(command)).map(c => c[0] + \" \");\n\t\tif (prefixes.length === 0)\n\t\t\treturn [];\n\t\treturn prefixes.map(i => [i, i]);\n\t}\n\n\tconst commandInfo = commands.get(command);\n\tif (commandInfo && commandInfo.autocomplete) {\n\t\tif (commandInfo.parse) {\n\t\t\tconst argv = CommandParseArguments(args);\n\t\t\tif (CommandHasEmptyArgument(args)) {\n\t\t\t\targv.push(\"\");\n\t\t\t}\n\t\t\tlet lastOptions = commandInfo.autocomplete(argv);\n\t\t\tconst fin = lastOptions.length === 1;\n\t\t\tif (lastOptions.length === 0) {\n\t\t\t\tlastOptions = [argv[argv.length - 1]];\n\t\t\t}\n\t\t\targv.pop();\n\t\t\tconst needsQuotes = lastOptions.some(CommandArgumentNeedsQuotes);\n\t\t\treturn lastOptions.map(\n\t\t\t\ti => [\n\t\t\t\t\t`${command} ` +\n\t\t\t\t\targv\n\t\t\t\t\t\t.map(a => CommandQuoteArgument(a))\n\t\t\t\t\t\t.concat(needsQuotes ? CommandQuoteArgument(i, true) : i)\n\t\t\t\t\t\t.join(\" \") +\n\t\t\t\t\t(fin ? \" \" : \"\"),\n\t\t\t\t\ti\n\t\t\t\t]\n\t\t\t);\n\t\t} else {\n\t\t\tconst possibleArgs = commandInfo.autocomplete(args);\n\t\t\tif (possibleArgs.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn possibleArgs.map(arg => [`${command} ${arg}`, arg]);\n\t\t}\n\t}\n\n\treturn [];\n}\n\nfunction CommandAutocompleteCycle(msg: string): string {\n\tif (autocompleteLastQuery === msg && autocompleteNextIndex < autocompleteLastResult.length) {\n\t\tautocompleteShow(\"autocomplete hint\", autocompleteLastResult.map(i => i[1]), autocompleteNextIndex);\n\t\tconst res = autocompleteLastResult[autocompleteNextIndex][0].trim();\n\t\tautocompleteNextIndex = (autocompleteNextIndex + 1) % autocompleteLastResult.length;\n\t\tautocompleteLastQuery = res;\n\t\treturn res;\n\t}\n\tautocompleteClear();\n\tautocompleteLastResult = CommandAutocomplete(msg).sort((a, b) => a[1].localeCompare(b[1]));\n\tif (autocompleteLastResult.length === 0) {\n\t\treturn msg;\n\t} else if (autocompleteLastResult.length === 1) {\n\t\treturn autocompleteLastResult[0][0];\n\t}\n\tconst best = longestCommonPrefix(autocompleteLastResult.map(i => i[0]));\n\tautocompleteShow(\"autocomplete hint\", autocompleteLastResult.map(i => i[1]));\n\tautocompleteLastQuery = best;\n\tautocompleteNextIndex = 0;\n\treturn best;\n}\n\nfunction WhisperCommandAutocomplete(msg: string, sender: ChatroomCharacter): [string, string[] | null] {\n\tmsg = msg.trimStart();\n\tconst [command, args] = CommandParse(msg);\n\n\tif (msg.length === command.length) {\n\t\tconst prefixes = Array.from(whisperCommands.entries()).filter(c => c[1].description !== null && c[0].startsWith(command)).map(c => c[0] + \" \");\n\t\tif (prefixes.length === 0)\n\t\t\treturn [msg, null];\n\t\tconst best = longestCommonPrefix(prefixes);\n\t\treturn [best, best === msg ? prefixes.slice().sort() : null];\n\t}\n\n\tconst commandInfo = whisperCommands.get(command);\n\tif (commandInfo && commandInfo.autocomplete) {\n\t\tconst argv = CommandParseArguments(args);\n\t\tif (CommandHasEmptyArgument(args)) {\n\t\t\targv.push(\"\");\n\t\t}\n\t\tconst lastOptions = commandInfo.autocomplete(argv, sender);\n\t\tlet opts: string[] | null = null;\n\t\tif (lastOptions.length > 0) {\n\t\t\tconst best = longestCommonPrefix(lastOptions);\n\t\t\tif (lastOptions.length > 1 && best === argv[argv.length - 1]) {\n\t\t\t\topts = lastOptions.slice().sort();\n\t\t\t}\n\t\t\targv[argv.length - 1] = best;\n\t\t}\n\t\treturn [`${command} ` +\n\t\t\targv.map(i => CommandQuoteArgument(i)).join(\" \") +\n\t\t\t(lastOptions.length === 1 ? \" \" : \"\"), opts];\n\t}\n\n\treturn [msg, null];\n}\n\nexport function Command_fixExclamationMark(sender: ChatroomCharacter, text: string): string {\n\treturn sender.isPlayer() ? text.replace(/^!/gm, \".\") : text;\n}\n\nexport function Command_pickAutocomplete(selector: string, options: string[]): string[] {\n\tselector = selector.toLocaleLowerCase();\n\treturn options.filter(o => o.toLocaleLowerCase().startsWith(selector));\n}\n\nexport function Command_selectCharacter(selector: string): ChatroomCharacter | string {\n\tconst characters = getAllCharactersInRoom();\n\tif (/^[0-9]+$/.test(selector)) {\n\t\tconst MemberNumber = Number.parseInt(selector, 10);\n\t\tconst target = characters.find(c => c.MemberNumber === MemberNumber);\n\t\tif (!target) {\n\t\t\treturn `Player #${MemberNumber} not found in the room.`;\n\t\t}\n\t\treturn target;\n\t}\n\tlet targets = characters.filter(c => c.Name === selector);\n\tif (targets.length === 0)\n\t\ttargets = characters.filter(c => c.Name.toLocaleLowerCase() === selector.toLocaleLowerCase());\n\n\tif (targets.length === 1) {\n\t\treturn targets[0];\n\t} else if (targets.length === 0) {\n\t\treturn `Player \"${selector}\" not found in the room.`;\n\t} else {\n\t\treturn `Multiple players match \"${selector}\". Please use Member Number instead.`;\n\t}\n}\n\nexport function Command_selectCharacterMemberNumber(selector: string, allowNotPresent: boolean = true): number | string {\n\tconst character = Command_selectCharacter(selector);\n\tif (typeof character === \"string\" && allowNotPresent && /^[0-9]+$/.test(selector)) {\n\t\treturn Number.parseInt(selector, 10);\n\t}\n\treturn typeof character === \"string\" ? character : character.MemberNumber;\n}\n\nexport function Command_selectCharacterAutocomplete(selector: string): string[] {\n\tconst characters = getAllCharactersInRoom();\n\tif (/^[0-9]+$/.test(selector)) {\n\t\treturn characters.map(c => c.MemberNumber?.toString(10)).filter(n => n != null && n.startsWith(selector)) as string[];\n\t}\n\treturn characters.map(c => c.Name).filter(n => n.toLocaleLowerCase().startsWith(selector.toLocaleLowerCase()));\n}\n\nexport function Command_selectWornItem(character: ChatroomCharacter, selector: string, filter: (item: Item) => boolean = isBind): Item | string {\n\tconst items = character.Character.Appearance.filter(filter);\n\tlet targets = items.filter(A => A.Asset.Group.Name.toLocaleLowerCase() === selector.toLocaleLowerCase());\n\tif (targets.length === 0)\n\t\ttargets = items.filter(A => getVisibleGroupName(A.Asset.Group).toLocaleLowerCase() === selector.toLocaleLowerCase());\n\tif (targets.length === 0)\n\t\ttargets = items.filter(A => A.Asset.Name.toLocaleLowerCase() === selector.toLocaleLowerCase());\n\tif (targets.length === 0)\n\t\ttargets = items.filter(A => A.Asset.Description.toLocaleLowerCase() === selector.toLocaleLowerCase());\n\n\tif (targets.length === 1) {\n\t\treturn targets[0];\n\t} else if (targets.length === 0) {\n\t\treturn `Item \"${selector}\" not found on character ${character}. If your item(group) consists of more than one word, please put it in quotes, such as \"lower leg\".`;\n\t} else {\n\t\treturn `Multiple items match, please use group name instead. (eg. arms)`;\n\t}\n}\n\nexport function Command_selectWornItemAutocomplete(character: ChatroomCharacter, selector: string, filter: (item: Item) => boolean = isBind): string[] {\n\tconst items = character.Character.Appearance.filter(filter);\n\n\tlet possible = arrayUnique(\n\t\titems.map(A => getVisibleGroupName(A.Asset.Group))\n\t\t\t.concat(items.map(A => A.Asset.Description))\n\t).filter(i => i.toLocaleLowerCase().startsWith(selector.toLocaleLowerCase()));\n\n\tif (possible.length === 0) {\n\t\tpossible = arrayUnique(\n\t\t\titems.map(A => A.Asset.Group.Name)\n\t\t\t\t.concat(items.map(A => A.Asset.Name))\n\t\t).filter(i => i.toLocaleLowerCase().startsWith(selector.toLocaleLowerCase()));\n\t}\n\n\treturn possible;\n}\n\nexport function Command_selectGroup(selector: string, character: ChatroomCharacter | null, filter?: (group: AssetGroup) => boolean): AssetGroup | string {\n\tlet targets = AssetGroup.filter(G => G.Name.toLocaleLowerCase() === selector.toLocaleLowerCase() && (!filter || filter(G)));\n\tif (targets.length === 0)\n\t\ttargets = AssetGroup.filter(G => getVisibleGroupName(G).toLocaleLowerCase() === selector.toLocaleLowerCase() && (!filter || filter(G)));\n\n\tif (targets.length > 1) {\n\t\treturn `Multiple groups match \"${selector}\", please report this as a bug.`;\n\t} else if (targets.length === 1) {\n\t\treturn targets[0];\n\t} else if (character) {\n\t\tconst item = Command_selectWornItem(character, selector, i => (!filter || filter(i.Asset.Group)));\n\t\treturn typeof item === \"string\" ? item : item.Asset.Group;\n\t} else {\n\t\treturn `Unknown group \"${selector}\".`;\n\t}\n}\n\nexport function Command_selectGroupAutocomplete(selector: string, character: ChatroomCharacter | null, filter?: (group: AssetGroup) => boolean): string[] {\n\tconst items = character ? character.Character.Appearance : [];\n\n\tlet possible = arrayUnique(\n\t\tAssetGroup\n\t\t\t.filter(G => !filter || filter(G))\n\t\t\t.map(G => getVisibleGroupName(G))\n\t\t\t.concat(\n\t\t\t\titems\n\t\t\t\t\t.filter(A => !filter || filter(A.Asset.Group))\n\t\t\t\t\t.map(A => A.Asset.Description)\n\t\t\t)\n\t).filter(i => i.toLocaleLowerCase().startsWith(selector.toLocaleLowerCase()));\n\n\tif (possible.length === 0) {\n\t\tpossible = arrayUnique(\n\t\t\tAssetGroup\n\t\t\t\t.filter(G => !filter || filter(G))\n\t\t\t\t.map(G => G.Name)\n\t\t\t\t.concat(\n\t\t\t\t\titems\n\t\t\t\t\t\t.filter(A => !filter || filter(A.Asset.Group))\n\t\t\t\t\t\t.map(A => A.Asset.Name)\n\t\t\t\t)\n\t\t).filter(i => i.toLocaleLowerCase().startsWith(selector.toLocaleLowerCase()));\n\t}\n\n\treturn possible;\n}\n\nexport function Command_parseTime(selector: string): string | number {\n\tconst match = /^([0-9]+)([a-z]+)$/.exec(selector.toLocaleLowerCase());\n\tif (!match) {\n\t\treturn `Unknown time format \"${selector}\", please use format 'number+unit' (e.g. 23h 30m)`;\n\t}\n\tconst num = Number.parseInt(match[1], 10);\n\tconst unit = match[2];\n\tif ([\"d\", \"day\", \"days\"].includes(unit)) {\n\t\treturn num * 24 * 60 * 60 * 1000;\n\t} else if ([\"h\", \"hour\", \"hours\"].includes(unit)) {\n\t\treturn num * 60 * 60 * 1000;\n\t} else if ([\"m\", \"min\", \"minute\", \"minutes\"].includes(unit)) {\n\t\treturn num * 60 * 1000;\n\t} else if ([\"s\", \"sec\", \"second\", \"seconds\"].includes(unit)) {\n\t\treturn num * 1000;\n\t}\n\treturn `Unknown time unit \"${unit}\", please use one of:\\n` +\n\t\t`d (day), h (hour), m (minute), s (second)`;\n}\n\nexport class ModuleCommands extends BaseModule {\n\tload() {\n\t\thookFunction(\"ChatRoomFirstTimeHelp\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tCommandsShowFirstTimeHelp();\n\t\t});\n\n\t\thookFunction(\"ChatRoomClearAllElements\", 1, (args, next) => {\n\t\t\tfirstTimeHelp = null;\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"ChatRoomSendChat\", 10, (args, next) => {\n\t\t\tconst chat = document.getElementById(\"InputChat\") as HTMLTextAreaElement | null;\n\t\t\tif (chat && !firstTimeInit) {\n\t\t\t\tconst msg = chat.value.trim();\n\t\t\t\tif (msg.startsWith(\"..\")) {\n\t\t\t\t\tchat.value = msg.substr(1);\n\t\t\t\t} else if (msg.startsWith(\".\")) {\n\t\t\t\t\tif (RunCommand(msg.substr(1))) {\n\t\t\t\t\t\t// Keeps the chat log in memory so it can be accessed with pageup/pagedown\n\t\t\t\t\t\tChatRoomLastMessage.push(msg);\n\t\t\t\t\t\tChatRoomLastMessageIndex = ChatRoomLastMessage.length;\n\t\t\t\t\t\tchat.value = \"\";\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"ChatRoomKeyDown\", 10, (args, next) => {\n\t\t\tconst chat = document.getElementById(\"InputChat\") as HTMLTextAreaElement | null;\n\t\t\t// Tab for command completion\n\t\t\tif (\n\t\t\t\tKeyPress === 9 &&\n\t\t\t\tchat &&\n\t\t\t\tchat.value.startsWith(\".\") &&\n\t\t\t\t!chat.value.startsWith(\"..\") &&\n\t\t\t\t!firstTimeInit\n\t\t\t) {\n\t\t\t\tconst e = args[0] as KeyboardEvent ?? event;\n\t\t\t\te?.preventDefault();\n\t\t\t\te?.stopImmediatePropagation();\n\n\t\t\t\tchat.value = \".\" + CommandAutocompleteCycle(chat.value.substr(1));\n\t\t\t} else if (\n\t\t\t\tKeyPress === 9 &&\n\t\t\t\tChatRoomTargetMemberNumber != null &&\n\t\t\t\tchat &&\n\t\t\t\tchat.value.startsWith(\"!\") &&\n\t\t\t\t!chat.value.startsWith(\"!!\") &&\n\t\t\t\t!firstTimeInit\n\t\t\t) {\n\t\t\t\tconst currentValue = chat.value;\n\t\t\t\tconst currentTarget = ChatRoomTargetMemberNumber;\n\t\t\t\tconst e = args[0] as KeyboardEvent ?? event;\n\t\t\t\te?.preventDefault();\n\t\t\t\te?.stopImmediatePropagation();\n\n\t\t\t\tsendQuery(\"commandHint\", currentValue, currentTarget).then(result => {\n\t\t\t\t\tif (chat.value !== currentValue || ChatRoomTargetMemberNumber !== currentTarget)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tif (!Array.isArray(result) ||\n\t\t\t\t\t\tresult.length !== 2 ||\n\t\t\t\t\t\ttypeof result[0] !== \"string\" ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tresult[1] !== null &&\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t!Array.isArray(result[1]) ||\n\t\t\t\t\t\t\t\tresult[1].some(i => typeof i !== \"string\")\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tconsole.error(\"BCX: Bad data during 'commandHint' query\\n\", result);\n\t\t\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t\t\t}\n\t\t\t\t\tchat.value = result[0];\n\t\t\t\t\tif (result[1]) {\n\t\t\t\t\t\tChatRoomSendLocal(`[remote autocomplete hint]\\n` + result[1].join('\\n'), 10_000, currentTarget);\n\t\t\t\t\t}\n\t\t\t\t}, () => { /* NOOP */ });\n\t\t\t} else {\n\t\t\t\treturn next(args);\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"ChatRoomMessage\", 9, (args, next) => {\n\t\t\tconst data = args[0];\n\n\t\t\tconst sender = typeof data.Sender === \"number\" && getChatroomCharacter(data.Sender);\n\t\t\tif (data?.Type === \"Whisper\" &&\n\t\t\t\ttypeof data.Content === \"string\" &&\n\t\t\t\tdata.Content.startsWith(\"!\") &&\n\t\t\t\t!data.Content.startsWith(\"!!\") &&\n\t\t\t\tsender &&\n\t\t\t\tsender.hasAccessToPlayer()\n\t\t\t) {\n\t\t\t\tif (data.Sender === Player.MemberNumber || firstTimeInit)\n\t\t\t\t\treturn next(args);\n\t\t\t\tconsole.debug(`BCX: Console command from ${sender}: ${data.Content}`);\n\t\t\t\tRunWhisperCommand(data.Content.substr(1), sender, (msg) => {\n\t\t\t\t\tServerSend(\"ChatRoomChat\", {\n\t\t\t\t\t\tContent: `[BCX]\\n${msg}`,\n\t\t\t\t\t\tType: \"Whisper\",\n\t\t\t\t\t\tTarget: sender.MemberNumber\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\tqueryHandlers.commandHint = (sender, resolve, data) => {\n\t\t\tif (typeof data !== \"string\" || !data.startsWith(\"!\") || data.startsWith(\"!!\")) {\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tconst result = WhisperCommandAutocomplete(data.substr(1), sender);\n\t\t\tresult[0] = '!' + result[0];\n\t\t\tresolve(true, result);\n\t\t};\n\n\t\tregisterCommand(\"help\", \"- Display this help [alias: . ]\", () => {\n\t\t\tCommandsCompleteFirstTimeHelp();\n\t\t\tChatRoomSendLocal(\n\t\t\t\t`Available commands:\\n` +\n\t\t\t\tArray.from(commands.entries())\n\t\t\t\t\t.filter(c => c[1].description !== null)\n\t\t\t\t\t.map(c => `.${c[0]}` + (c[1].description ? ` ${c[1].description}` : \"\"))\n\t\t\t\t\t.sort()\n\t\t\t\t\t.join(\"\\n\")\n\t\t\t);\n\t\t\treturn true;\n\t\t});\n\t\taliasCommand(\"help\", \"\");\n\n\t\tregisterCommand(\"action\", \"- Send custom (action) [alias: .a ]\", (msg) => {\n\t\t\tconst blockRule = RulesGetRuleState(\"block_action\");\n\t\t\tif (blockRule.isEnforced) {\n\t\t\t\tblockRule.triggerAttempt();\n\t\t\t\treturn false;\n\t\t\t} else if (blockRule.inEffect) {\n\t\t\t\tblockRule.trigger();\n\t\t\t}\n\t\t\tChatRoomActionMessage(msg);\n\t\t\treturn true;\n\t\t});\n\t\taliasCommand(\"action\", \"a\");\n\n\t\tregisterWhisperCommand(\"help\", \"- Display this help\", (argv, sender, respond) => {\n\t\t\trespond(\n\t\t\t\t`Available commands:\\n` +\n\t\t\t\tArray.from(whisperCommands.entries())\n\t\t\t\t\t.filter(c => c[1].description !== null)\n\t\t\t\t\t.map(c => `!${c[0]}` + (c[1].description ? ` ${c[1].description}` : \"\"))\n\t\t\t\t\t.sort()\n\t\t\t\t\t.join(\"\\n\")\n\t\t\t);\n\t\t\treturn true;\n\t\t}, null, false);\n\t}\n\n\tunload() {\n\t\tcommands.clear();\n\t}\n}\n","export type cursedChange = \"remove\" | \"add\" | \"swap\" | \"update\" | \"color\";\n\nexport const CURSES_TRIGGER_TEXTS: Record<cursedChange | \"autoremove\", string> = {\n\tremove: \"PLAYER_NAME's body seems to be cursed and the ASSET_NAME just falls off her body.\",\n\tadd: \"The curse on PLAYER_NAME's ASSET_NAME wakes up and the item reappears.\",\n\tswap: \"The curse on PLAYER_NAME's ASSET_NAME wakes up, not allowing the item to be replaced by another item.\",\n\tupdate: \"The curse on PLAYER_NAME's ASSET_NAME wakes up and undoes all changes to the item.\",\n\tcolor: \"The curse on PLAYER_NAME's ASSET_NAME wakes up, changing the color of the item back.\",\n\tautoremove: \"The curse on PLAYER_NAME's body becomes dormant and the ASSET_NAME falls off her body.\"\n};\n\nexport const CURSES_TRIGGER_TEXTS_BATCH: Record<cursedChange | \"autoremove\", string> = {\n\tremove: \"PLAYER_NAME's body seems to be cursed and several items just fall off her body.\",\n\tadd: \"The curses on PLAYER_NAME's body wake up and several items reappear.\",\n\tswap: \"The curses on PLAYER_NAME's body wake up, not allowing several items to be replaced.\",\n\tupdate: \"The curses on PLAYER_NAME's body wake up and undoes all changes to several items.\",\n\tcolor: \"The curses on PLAYER_NAME's body wake up, changing the color of several items back.\",\n\tautoremove: \"The curses on PLAYER_NAME's body become dormant and several items fall off her body.\"\n};\n\nexport const CURSES_TRIGGER_LOGS: Record<cursedChange, string> = {\n\tremove: \"The curse on PLAYER_NAME's body prevented a ASSET_NAME from being added to it\",\n\tadd: \"The curse on PLAYER_NAME's ASSET_NAME made the item reappear\",\n\tswap: \"The curse on PLAYER_NAME's ASSET_NAME prevented the item from being replaced\",\n\tupdate: \"The curse on PLAYER_NAME's ASSET_NAME reverted all changes to the item\",\n\tcolor: \"The curse on PLAYER_NAME's ASSET_NAME reverted the color of the item\"\n};\n\nexport const CURSES_TRIGGER_LOGS_BATCH: Record<cursedChange, string> = {\n\tremove: \"The curses on PLAYER_NAME's body prevented several items from being added to it\",\n\tadd: \"The curses on PLAYER_NAME's body made several items reappear\",\n\tswap: \"The curses on PLAYER_NAME's body prevented several items from being replaced\",\n\tupdate: \"The curses on PLAYER_NAME's body reverted all changes to several items\",\n\tcolor: \"The curses on PLAYER_NAME's body reverted the color of several items\"\n};\n","import { ChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction, removeAllHooksByModule } from \"../patching\";\nimport { clamp, dictionaryProcess, isObject } from \"../utils\";\nimport { ChatRoomSendLocal } from \"../utilsClub\";\nimport { AccessLevel, checkPermissionAccess, registerPermission } from \"./authority\";\nimport { notifyOfChange, queryHandlers } from \"./messaging\";\nimport { moduleIsEnabled } from \"./presets\";\nimport { modStorage, modStorageSync } from \"./storage\";\nimport { ModuleCategory, Preset } from \"../constants\";\nimport { Command_fixExclamationMark, COMMAND_GENERIC_ERROR, registerWhisperCommand } from \"./commands\";\nimport { guard_BCX_Rule, RulesGetDisplayDefinition } from \"./rules\";\nimport { cursedChange, CURSES_TRIGGER_LOGS, CURSES_TRIGGER_LOGS_BATCH } from \"./cursesConstants\";\n\nexport const LOG_ENTRIES_LIMIT = 256;\n\nexport enum LogEntryType {\n\tplaintext = 0,\n\tdeleted = 1,\n\truleTrigger = 2,\n\truleTriggerAttempt = 3,\n\tcurseTrigger = 4,\n\tcurseTriggerBatch = 5\n}\n\nexport enum LogAccessLevel {\n\tnone = 0,\n\tprotected = 1,\n\tnormal = 2,\n\teveryone = 3\n}\n\nexport type LogEntryTypeData = {\n\t/** The data itself */\n\t[LogEntryType.plaintext]: string;\n\t/** Deleted log entries are replaced with this */\n\t[LogEntryType.deleted]: null;\n\t/** When rule is triggered; data is rule name and dictionary */\n\t[LogEntryType.ruleTrigger]: [BCX_Rule, Record<string, string>];\n\t/** When rule is triggered, blocking the action; data is rule name and dictionary */\n\t[LogEntryType.ruleTriggerAttempt]: [BCX_Rule, Record<string, string>];\n\t/** When curse triggers, the second argument is name of item it triggered on */\n\t[LogEntryType.curseTrigger]: [cursedChange, string];\n\t/** When lot of curses trigger */\n\t[LogEntryType.curseTriggerBatch]: cursedChange;\n};\n\n/**\n * Compact format containing following:\n * @property {number} 0 - The time this log was recorded\n * @property {LogAccessLevel} 1 - The required access level to view this log\n * @property {LogEntryType} 2 - The type of the entry\n * @property {LogEntryTypeData} 3 - Extra data defined by the entry type\n */\nexport type LogEntry<Type extends LogEntryType = LogEntryType> = [number, LogAccessLevel, Type, LogEntryTypeData[Type]];\n\nexport type LogConfig = Partial<Record<BCX_LogCategory, LogAccessLevel>>;\n\nexport function logMessage<Type extends LogEntryType>(category: BCX_LogCategory, type: Type, data: LogEntryTypeData[Type]) {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn;\n\n\tconst access = modStorage.logConfig?.[category];\n\tif (access === undefined) {\n\t\tthrow new Error(`Attempt to log message with unknown category \"${category}\"`);\n\t}\n\tif (access > LogAccessLevel.none) {\n\t\tlogMessageAdd(access, type, data);\n\t}\n}\n\nfunction logMessageAdd<Type extends LogEntryType>(access: LogAccessLevel, type: Type, data: LogEntryTypeData[Type]) {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn;\n\n\tif (!modStorage.log) {\n\t\tthrow new Error(\"Mod storage log not initialized\");\n\t}\n\tmodStorage.log.unshift([Date.now(), access, type, data]);\n\t// Time must be unique\n\tif (modStorage.log.length >= 2 && modStorage.log[0][0] <= modStorage.log[1][0]) {\n\t\tmodStorage.log[0][0] = modStorage.log[1][0] + 1;\n\t}\n\tmodStorage.log.splice(LOG_ENTRIES_LIMIT);\n\tmodStorageSync();\n\tnotifyOfChange();\n}\n\nexport function logMessageDelete(time: number, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn false;\n\n\tif (character && !checkPermissionAccess(\"log_delete\", character)) {\n\t\treturn false;\n\t}\n\n\tconst access = modStorage.logConfig?.log_deleted;\n\tif (access === undefined) {\n\t\tthrow new Error(\"log_deleted category not found\");\n\t}\n\tif (!modStorage.log) {\n\t\tthrow new Error(\"Mod storage log not initialized\");\n\t}\n\tfor (let i = 0; i < modStorage.log.length; i++) {\n\t\tconst e = modStorage.log[i];\n\t\tif (e[0] === time) {\n\t\t\tif (access === LogAccessLevel.none) {\n\t\t\t\tmodStorage.log.splice(i, 1);\n\t\t\t} else {\n\t\t\t\te[1] = access;\n\t\t\t\te[2] = LogEntryType.deleted;\n\t\t\t\te[3] = null;\n\t\t\t}\n\t\t\tmodStorageSync();\n\t\t\tnotifyOfChange();\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nexport function logConfigSet(category: BCX_LogCategory, accessLevel: LogAccessLevel, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn false;\n\n\tif (character && !checkPermissionAccess(\"log_configure\", character)) {\n\t\treturn false;\n\t}\n\n\tif (modStorage.logConfig?.[category] === undefined) {\n\t\treturn false;\n\t}\n\n\tif (![LogAccessLevel.none, LogAccessLevel.normal, LogAccessLevel.protected].includes(accessLevel)) {\n\t\treturn false;\n\t}\n\n\tif (character) {\n\t\tconst msg = `${character} changed log configuration \"${LOG_CONFIG_NAMES[category]}\" ` +\n\t\t\t`from \"${LOG_LEVEL_NAMES[modStorage.logConfig[category]!]}\" to \"${LOG_LEVEL_NAMES[accessLevel]}\"`;\n\t\tlogMessage(\"log_config_change\", LogEntryType.plaintext, msg);\n\t\tif (!character.isPlayer()) {\n\t\t\tChatRoomSendLocal(msg, undefined, character.MemberNumber);\n\t\t}\n\t}\n\n\tmodStorage.logConfig[category] = accessLevel;\n\tmodStorageSync();\n\tnotifyOfChange();\n\treturn true;\n}\n\nexport function logClear(character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn false;\n\n\tif (character && !checkPermissionAccess(\"log_delete\", character)) {\n\t\treturn false;\n\t}\n\n\tmodStorage.log = [];\n\tlogMessageAdd(LogAccessLevel.everyone, LogEntryType.plaintext, \"The log has been cleared\");\n\n\treturn true;\n}\n\nexport function getVisibleLogEntries(character: ChatroomCharacter): LogEntry[] {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn [];\n\n\tif (!modStorage.log) {\n\t\tthrow new Error(\"Mod storage log not initialized\");\n\t}\n\n\tconst allow: Record<LogAccessLevel, boolean> = {\n\t\t[LogAccessLevel.none]: character.isPlayer(),\n\t\t[LogAccessLevel.normal]: checkPermissionAccess(\"log_view_normal\", character),\n\t\t[LogAccessLevel.protected]: checkPermissionAccess(\"log_view_protected\", character),\n\t\t[LogAccessLevel.everyone]: true\n\t};\n\treturn modStorage.log.filter(e => allow[e[1]]);\n}\n\nexport function logMessageRender(entry: LogEntry, character: ChatroomCharacter): string {\n\tif (entry[2] === LogEntryType.plaintext) {\n\t\tconst e = entry as LogEntry<LogEntryType.plaintext>;\n\t\treturn e[3];\n\t} else if (entry[2] === LogEntryType.deleted) {\n\t\treturn \"[Log message deleted]\";\n\t} else if (entry[2] === LogEntryType.ruleTrigger || entry[2] === LogEntryType.ruleTriggerAttempt) {\n\t\tconst data = entry[3] as LogEntryTypeData[LogEntryType.ruleTrigger];\n\t\tif (!Array.isArray(data) || data.length !== 2 || typeof data[0] !== \"string\") {\n\t\t\treturn `[ERROR: Bad data for type ${entry[2]}]`;\n\t\t}\n\t\tif (!guard_BCX_Rule(data[0])) {\n\t\t\treturn `[ERROR: Trigger for unknown rule \"${data[0]}\"]`;\n\t\t}\n\t\tconst rule = RulesGetDisplayDefinition(data[0]);\n\t\tconst log = entry[2] === LogEntryType.ruleTriggerAttempt ? rule.triggerTexts?.attempt_log : rule.triggerTexts?.log;\n\t\treturn log ? dictionaryProcess(log, { PLAYER_NAME: character.Name, ...data[1] }) : `[ERROR: Missing log text for rule \"${data[0]}\" trigger]`;\n\t} else if (entry[2] === LogEntryType.curseTrigger) {\n\t\tconst data = entry[3] as LogEntryTypeData[LogEntryType.curseTrigger];\n\t\tif (!Array.isArray(data) ||\n\t\t\tdata.length !== 2 ||\n\t\t\tdata.some(i => typeof i !== \"string\") ||\n\t\t\t!Object.keys(CURSES_TRIGGER_LOGS).includes(data[0])\n\t\t) {\n\t\t\treturn `[ERROR: Bad data for type ${entry[2]}]`;\n\t\t}\n\t\treturn dictionaryProcess(CURSES_TRIGGER_LOGS[data[0]], { PLAYER_NAME: character.Name, ASSET_NAME: data[1] });\n\t} else if (entry[2] === LogEntryType.curseTriggerBatch) {\n\t\tconst data = entry[3] as LogEntryTypeData[LogEntryType.curseTriggerBatch];\n\t\tif (typeof data !== \"string\" ||\n\t\t\t!Object.keys(CURSES_TRIGGER_LOGS_BATCH).includes(data)\n\t\t) {\n\t\t\treturn `[ERROR: Bad data for type ${entry[2]}]`;\n\t\t}\n\t\treturn dictionaryProcess(CURSES_TRIGGER_LOGS_BATCH[data], { PLAYER_NAME: character.Name });\n\t}\n\treturn `[ERROR: Unknown entry type ${entry[2]}]`;\n}\n\nconst alreadyPraisedBy: Set<number> = new Set();\n\nexport function logGetAllowedActions(character: ChatroomCharacter): BCX_logAllowedActions {\n\treturn {\n\t\tconfigure: checkPermissionAccess(\"log_configure\", character),\n\t\tdelete: checkPermissionAccess(\"log_delete\", character),\n\t\tleaveMessage: checkPermissionAccess(\"log_add_note\", character) && !!(modStorage.logConfig?.user_note),\n\t\tpraise: checkPermissionAccess(\"log_praise\", character) && !alreadyPraisedBy.has(character.MemberNumber)\n\t};\n}\n\nexport function logGetConfig(): LogConfig {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn {};\n\n\tif (!modStorage.logConfig) {\n\t\tthrow new Error(\"Mod storage log not initialized\");\n\t}\n\n\treturn { ...modStorage.logConfig };\n}\n\nexport function logPraise(value: -1 | 0 | 1, message: string | null, character: ChatroomCharacter): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Log))\n\t\treturn false;\n\n\tif (![-1, 0, 1].includes(value)) {\n\t\tthrow new Error(\"Invalid value\");\n\t}\n\n\tif (value === 0 && !message)\n\t\treturn false;\n\n\tconst allowed = logGetAllowedActions(character);\n\n\t// allowed.praise implies not alreadyPraisedBy\n\tif (value !== 0 && !allowed.praise)\n\t\treturn false;\n\tif (message && !allowed.leaveMessage)\n\t\treturn false;\n\n\tif (value !== 0) {\n\t\talreadyPraisedBy.add(character.MemberNumber);\n\t}\n\n\tif (value > 0) {\n\t\tif (message) {\n\t\t\tlogMessage(\"user_note\", LogEntryType.plaintext, `Praised by ${character} with note: ${message}`);\n\t\t\tChatRoomSendLocal(`${character} praised you with the following note: ${message}`, undefined, character.MemberNumber);\n\t\t} else {\n\t\t\tlogMessage(\"praise\", LogEntryType.plaintext, `Praised by ${character}`);\n\t\t\tChatRoomSendLocal(`${character} praised you.`, undefined, character.MemberNumber);\n\t\t}\n\t} else if (value < 0) {\n\t\tif (message) {\n\t\t\tlogMessage(\"user_note\", LogEntryType.plaintext, `Scolded by ${character} with note: ${message}`);\n\t\t\tChatRoomSendLocal(`${character} scolded you with the following note: ${message}`, undefined, character.MemberNumber);\n\t\t} else {\n\t\t\tlogMessage(\"praise\", LogEntryType.plaintext, `Scolded by ${character}`);\n\t\t\tChatRoomSendLocal(`${character} scolded you.`, undefined, character.MemberNumber);\n\t\t}\n\t} else if (message) {\n\t\tlogMessage(\"user_note\", LogEntryType.plaintext, `${character} attached a note: ${message}`);\n\t\tChatRoomSendLocal(`${character} put the following note on you: ${message}`, undefined, character.MemberNumber);\n\t}\n\n\treturn true;\n}\n\nconst logConfigDefaults: LogConfig = {\n\tlog_config_change: LogAccessLevel.protected,\n\tlog_deleted: LogAccessLevel.normal,\n\tpraise: LogAccessLevel.normal,\n\tuser_note: LogAccessLevel.normal,\n\tentered_public_room: LogAccessLevel.none,\n\tentered_private_room: LogAccessLevel.none,\n\thad_orgasm: LogAccessLevel.none,\n\tpermission_change: LogAccessLevel.protected,\n\tcurse_change: LogAccessLevel.none,\n\tcurse_trigger: LogAccessLevel.none,\n\trule_change: LogAccessLevel.none,\n\trule_trigger: LogAccessLevel.none,\n\tauthority_roles_change: LogAccessLevel.protected\n};\n\nexport const LOG_CONFIG_NAMES: Record<BCX_LogCategory, string> = {\n\tlog_config_change: \"Log changes in logging configuration\",\n\tlog_deleted: \"Log deleted log entries\",\n\tpraise: \"Log praising or scolding behavior\",\n\tuser_note: \"Ability to see attached notes\",\n\tentered_public_room: \"Log which public rooms are entered\",\n\tentered_private_room: \"Log which private rooms are entered\",\n\thad_orgasm: \"Log each single orgasm\",\n\tpermission_change: \"Log changes in permission settings\",\n\tcurse_change: \"Log each application, removal or change of curses\",\n\tcurse_trigger: \"Log every time a triggered curse reapplies an item\",\n\trule_change: \"Log each addition, removal or change of rules\",\n\trule_trigger: \"Log every rule violation\",\n\tauthority_roles_change: \"Log getting or losing a BCX owner/mistress\"\n};\n\nexport const LOG_LEVEL_NAMES: Record<LogAccessLevel, string> = {\n\t[LogAccessLevel.everyone]: \"[ERROR]\",\n\t[LogAccessLevel.none]: \"No\",\n\t[LogAccessLevel.protected]: \"Protected\",\n\t[LogAccessLevel.normal]: \"Yes\"\n};\n\nexport class ModuleLog extends BaseModule {\n\tinit() {\n\t\tregisterPermission(\"log_view_normal\", {\n\t\t\tname: \"Allow to see normal log entries\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.friend],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.public]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"log_view_protected\", {\n\t\t\tname: \"Allow to see protected log entries\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"log_configure\", {\n\t\t\tname: \"Allow to configure what is logged\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"log_delete\", {\n\t\t\tname: \"Allow deleting log entries\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"log_praise\", {\n\t\t\tname: \"Allow to praise or scold\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [false, AccessLevel.friend],\n\t\t\t\t[Preset.switch]: [false, AccessLevel.friend],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.public],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.public]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"log_add_note\", {\n\t\t\tname: \"Allow to attach notes to the body\",\n\t\t\tcategory: ModuleCategory.Log,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [false, AccessLevel.mistress],\n\t\t\t\t[Preset.switch]: [false, AccessLevel.mistress],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.friend],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.public]\n\t\t\t}\n\t\t});\n\n\t\tqueryHandlers.logData = (sender, resolve) => {\n\t\t\tresolve(true, getVisibleLogEntries(sender));\n\t\t};\n\t\tqueryHandlers.logDelete = (sender, resolve, data) => {\n\t\t\tif (typeof data === \"number\") {\n\t\t\t\tresolve(true, logMessageDelete(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.logConfigGet = (sender, resolve) => {\n\t\t\tif (checkPermissionAccess(\"log_configure\", sender)) {\n\t\t\t\tresolve(true, logGetConfig());\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.logConfigEdit = (sender, resolve, data) => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\ttypeof data.category !== \"string\" ||\n\t\t\t\ttypeof data.target !== \"number\"\n\t\t\t) {\n\t\t\t\tconsole.warn(`BCX: Bad logConfigEdit query from ${sender}`, data);\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\t\t\tresolve(true, logConfigSet(data.category, data.target, sender));\n\t\t};\n\t\tqueryHandlers.logClear = (sender, resolve) => {\n\t\t\tresolve(true, logClear(sender));\n\t\t};\n\t\tqueryHandlers.logPraise = (sender, resolve, data) => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\t(data.message !== null && typeof data.message !== \"string\") ||\n\t\t\t\t![-1, 0, 1].includes(data.value)\n\t\t\t) {\n\t\t\t\tconsole.warn(`BCX: Bad logPraise query from ${sender}`, data);\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\t\t\tresolve(true, logPraise(data.value, data.message, sender));\n\t\t};\n\t\tqueryHandlers.logGetAllowedActions = (sender, resolve) => {\n\t\t\tresolve(true, logGetAllowedActions(sender));\n\t\t};\n\n\t\tregisterWhisperCommand(\"log\", \"- Manage the behaviour log\", (argv, sender, respond) => {\n\t\t\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase();\n\t\t\tif (subcommand === \"list\") {\n\t\t\t\tconst logEntries = getVisibleLogEntries(sender);\n\t\t\t\tif (logEntries.length === 0) {\n\t\t\t\t\treturn respond(`You have no permission to view the log.`);\n\t\t\t\t}\n\t\t\t\tconst totalPages = Math.ceil(logEntries.length / 5);\n\t\t\t\tconst page = clamp(Number.parseInt(argv[1] || \"\", 10) || 1, 1, totalPages);\n\t\t\t\tlet result = `Page ${page} / ${totalPages}:`;\n\t\t\t\tfor (let i = 5 * (page - 1); i < Math.min(5 * page, logEntries.length); i++) {\n\t\t\t\t\tconst entry = logEntries[i];\n\t\t\t\t\tconst time = new Date(entry[0]);\n\t\t\t\t\tresult += `\\n[${time.toUTCString()}] (${entry[0]})\\n  ${logMessageRender(entry, getPlayerCharacter())}`;\n\t\t\t\t}\n\t\t\t\trespond(result);\n\t\t\t} else if (subcommand === \"delete\") {\n\t\t\t\tif (!/^[0-9]+$/.test(argv[1] || \"\")) {\n\t\t\t\t\treturn respond(`Expected number as timestamp.`);\n\t\t\t\t}\n\t\t\t\tconst timestamp = Number.parseInt(argv[1], 10);\n\t\t\t\tif (!getVisibleLogEntries(sender).some(logentry => logentry[0] === timestamp)) {\n\t\t\t\t\treturn respond(`No such log entry found`);\n\t\t\t\t}\n\t\t\t\trespond(logMessageDelete(timestamp, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else if (subcommand === \"praise\" || subcommand === \"scold\") {\n\t\t\t\tif (!checkPermissionAccess(\"log_praise\", sender)) {\n\t\t\t\t\treturn respond(COMMAND_GENERIC_ERROR);\n\t\t\t\t}\n\t\t\t\trespond(logPraise(subcommand === \"praise\" ? 1 : -1, null, sender) ? `Ok.` :\n\t\t\t\t\t`The command failed to execute, likely because you already did ${subcommand} recently.`);\n\t\t\t} else if (subcommand === \"config\") {\n\t\t\t\tif (!checkPermissionAccess(\"log_configure\", sender)) {\n\t\t\t\t\treturn respond(COMMAND_GENERIC_ERROR);\n\t\t\t\t}\n\n\t\t\t\tconst category = argv[1] || \"\";\n\t\t\t\tconst config = logGetConfig();\n\n\t\t\t\tif (!category) {\n\t\t\t\t\tlet result = \"Current log config:\";\n\t\t\t\t\tfor (const [k, v] of Object.entries(config) as [BCX_LogCategory, LogAccessLevel][]) {\n\t\t\t\t\t\tif (LOG_CONFIG_NAMES[k] !== undefined &&\n\t\t\t\t\t\t\tLOG_LEVEL_NAMES[v] !== undefined\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresult += `\\n[${k}]\\n  ${LOG_CONFIG_NAMES[k]}: ${LOG_LEVEL_NAMES[v]}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn respond(result);\n\t\t\t\t} else if (LOG_CONFIG_NAMES[category as BCX_LogCategory] === undefined) {\n\t\t\t\t\treturn respond(`Unknown category \"${category}\".`);\n\t\t\t\t} else {\n\t\t\t\t\tconst level = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\t\t\tif (level !== \"yes\" && level !== \"protected\" && level !== \"no\") {\n\t\t\t\t\t\treturn respond(`Expected level to be one of:\\nno, protected, yes`);\n\t\t\t\t\t}\n\t\t\t\t\treturn respond(\n\t\t\t\t\t\tlogConfigSet(\n\t\t\t\t\t\t\tcategory as BCX_LogCategory,\n\t\t\t\t\t\t\tlevel === \"yes\" ? LogAccessLevel.normal : level === \"protected\" ? LogAccessLevel.protected : LogAccessLevel.none,\n\t\t\t\t\t\t\tsender\n\t\t\t\t\t\t) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!log usage:\\n` +\n\t\t\t\t\t`!log list [page] - List all visible logs\\n` +\n\t\t\t\t\t`!log delete <timestamp> - Deletes the log with the given <timestamp> (the number in parentheses in list)\\n` +\n\t\t\t\t\t`!log praise - Note that you praised ${Player.Name} in her log\\n` +\n\t\t\t\t\t`!log scold - Note that you scolded ${Player.Name} in her log\\n` +\n\t\t\t\t\t`!log config - Shows the current logging settings for ${Player.Name}\\n` +\n\t\t\t\t\t`!log config <category> <no|protected|yes> - Sets visibility of the given config <category>`\n\t\t\t\t));\n\t\t\t}\n\t\t}, (argv, sender) => {\n\t\t\tif (argv.length <= 1) {\n\t\t\t\tconst c = argv[0].toLocaleLowerCase();\n\t\t\t\treturn [\"list\", \"delete\", \"praise\", \"scold\", \"config\"].filter(i => i.startsWith(c));\n\t\t\t}\n\n\t\t\tconst subcommand = argv[0].toLocaleLowerCase();\n\n\t\t\tif (subcommand === \"delete\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn getVisibleLogEntries(sender).map(logentry => logentry[0].toString()).filter(i => i.startsWith(argv[1]));\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"config\") {\n\t\t\t\tif (!checkPermissionAccess(\"log_configure\", sender)) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Object.keys(logGetConfig()).concat(\"\").filter(i => i.startsWith(argv[1].toLocaleLowerCase()));\n\t\t\t\t} else if (argv.length === 3) {\n\t\t\t\t\treturn [\"no\", \"protected\", \"yes\"].filter(i => i.startsWith(argv[2].toLocaleLowerCase()));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\t}\n\n\tload() {\n\t\tif (!moduleIsEnabled(ModuleCategory.Log)) {\n\t\t\tdelete modStorage.log;\n\t\t\tdelete modStorage.logConfig;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(modStorage.log)) {\n\t\t\tlogClear(null);\n\t\t} else if (!modStorage.log.every(e =>\n\t\t\tArray.isArray(e) &&\n\t\t\te.length === 4 &&\n\t\t\ttypeof e[0] === \"number\" &&\n\t\t\ttypeof e[1] === \"number\" &&\n\t\t\ttypeof e[2] === \"number\"\n\t\t)) {\n\t\t\tconsole.error(\"BCX: Some log entries have invalid format, reseting whole log!\");\n\t\t\tlogClear(null);\n\t\t}\n\n\t\tif (!modStorage.logConfig) {\n\t\t\tmodStorage.logConfig = { ...logConfigDefaults };\n\t\t} else {\n\t\t\tconst transitionDictionary: Record<string, BCX_LogCategory> = {\n\t\t\t\tpermissionChange: \"permission_change\",\n\t\t\t\tlogConfigChange: \"log_config_change\",\n\t\t\t\tlogDeleted: \"log_deleted\",\n\t\t\t\tuserNote: \"user_note\",\n\t\t\t\tcurseChange: \"curse_change\",\n\t\t\t\tcurseTrigger: \"curse_trigger\",\n\t\t\t\thadOrgasm: \"had_orgasm\",\n\t\t\t\tenteredPublicRoom: \"entered_public_room\",\n\t\t\t\tenteredPrivateRoom: \"entered_private_room\",\n\t\t\t\townershipChangesBCX: \"authority_roles_change\"\n\t\t\t};\n\t\t\tfor (const k of Object.keys(modStorage.logConfig) as BCX_LogCategory[]) {\n\t\t\t\tif (transitionDictionary[k] !== undefined) {\n\t\t\t\t\tconsole.info(`BCX: Updating log config name \"${k}\"->\"${transitionDictionary[k]}\"`);\n\t\t\t\t\tmodStorage.logConfig[transitionDictionary[k]] = modStorage.logConfig[k];\n\t\t\t\t\tdelete modStorage.logConfig[k];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (logConfigDefaults[k] === undefined) {\n\t\t\t\t\tconsole.info(`BCX: Removing unknown log config category \"${k}\"`);\n\t\t\t\t\tdelete modStorage.logConfig[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const k of Object.keys(logConfigDefaults) as BCX_LogCategory[]) {\n\t\t\t\tif (modStorage.logConfig[k] === undefined) {\n\t\t\t\t\tconsole.info(`BCX: Adding missing log category \"${k}\"`);\n\t\t\t\t\tmodStorage.logConfig[k] = logConfigDefaults[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\thookFunction(\"ActivityOrgasmStart\", 0, (args, next) => {\n\t\t\tconst C = args[0] as Character;\n\t\t\tif (C.ID === 0 && (typeof ActivityOrgasmRuined === \"undefined\" || !ActivityOrgasmRuined)) {\n\t\t\t\tlogMessage(\"had_orgasm\", LogEntryType.plaintext, `${Player.Name} had an orgasm`);\n\t\t\t}\n\t\t\treturn next(args);\n\t\t}, ModuleCategory.Log);\n\n\t\thookFunction(\"ChatRoomSync\", 0, (args, next) => {\n\t\t\tconst data = args[0];\n\t\t\tif (data.Private) {\n\t\t\t\tlogMessage(\"entered_private_room\", LogEntryType.plaintext, `${Player.Name} entered private room \"${data.Name}\"`);\n\t\t\t} else {\n\t\t\t\tlogMessage(\"entered_public_room\", LogEntryType.plaintext, `${Player.Name} entered public room \"${data.Name}\"`);\n\t\t\t}\n\t\t\treturn next(args);\n\t\t}, ModuleCategory.Log);\n\t}\n\n\treload() {\n\t\tremoveAllHooksByModule(ModuleCategory.Log);\n\t\tthis.load();\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { LogAccessLevel, LogConfig, LOG_CONFIG_NAMES, LOG_LEVEL_NAMES } from \"../modules/log\";\nimport { GuiLog } from \"./log\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { showHelp } from \"../utilsClub\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { createInputElement, positionElement } from \"../utils\";\n\ntype ConfigListItem = (\n\t{\n\t\tcategory: BCX_LogCategory;\n\t\taccess: LogAccessLevel;\n\t\tname: string;\n\t}\n);\n\nconst PER_PAGE_COUNT = 6;\n\nexport class GuiLogConfig extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\tprivate config: LogConfig | null = null;\n\tprivate failed: boolean = false;\n\tprivate configList: ConfigListItem[] = [];\n\tprivate allowDelete: boolean = false;\n\tprivate allowConfigure: boolean = false;\n\tprivate page: number = 0;\n\n\tprivate showHelp: boolean = false;\n\n\tprivate filterInput = createInputElement(\"text\", 30);\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.filterInput.addEventListener(\"input\", ev => {\n\t\t\tthis.rebuildList();\n\t\t});\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.config = null;\n\t\tthis.rebuildList();\n\t\tPromise.all([\n\t\t\tthis.character.getLogConfig(),\n\t\t\tthis.character.getPermissionAccess(\"log_delete\"),\n\t\t\tthis.character.getPermissionAccess(\"log_configure\")\n\t\t]).then(res => {\n\t\t\tthis.config = res[0];\n\t\t\tthis.allowDelete = res[1];\n\t\t\tthis.allowConfigure = res[2];\n\t\t\tthis.rebuildList();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get log config for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate rebuildList() {\n\t\tif (!this.active) return;\n\n\t\tthis.configList = [];\n\t\tif (this.config === null) {\n\t\t\tthis.filterInput.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.filterInput.parentElement) {\n\t\t\tdocument.body.appendChild(this.filterInput);\n\t\t}\n\n\t\tconst filter = this.filterInput.value.trim().toLocaleLowerCase().split(\" \");\n\n\t\tfor (const [k, v] of Object.entries(this.config) as [BCX_LogCategory, LogAccessLevel][]) {\n\t\t\tif (LOG_CONFIG_NAMES[k] !== undefined &&\n\t\t\t\tLOG_LEVEL_NAMES[v] !== undefined &&\n\t\t\t\tfilter.every(i =>\n\t\t\t\t\tLOG_CONFIG_NAMES[k].toLocaleLowerCase().includes(i) ||\n\t\t\t\t\tk.toLocaleLowerCase().includes(i)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tthis.configList.push({\n\t\t\t\t\tcategory: k,\n\t\t\t\t\taccess: v,\n\t\t\t\t\tname: LOG_CONFIG_NAMES[k]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.configList.sort((a, b) => a.name.localeCompare(b.name));\n\n\t\tconst totalPages = Math.ceil(this.configList.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\t\tif (this.config !== null) {\n\n\t\t\t// filter\n\t\t\tDrawText(\"Filter:\", 130, 215, \"Black\");\n\t\t\tpositionElement(this.filterInput, 550, 210, 600, 64);\n\n\t\t\t//reset button\n\t\t\tif (this.filterInput.value) {\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tDrawButton(870, 182, 64, 64, \"X\", \"White\");\n\t\t\t}\n\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.configList.length) break;\n\t\t\t\tconst e = this.configList[i];\n\n\t\t\t\tconst Y = 290 + off * 100;\n\n\t\t\t\t// Config name\n\t\t\t\tDrawButton(130, Y, 1070, 64, \"\", \"White\");\n\t\t\t\tDrawTextFit(e.name, 140, Y + 34, 1060, \"Black\");\n\t\t\t\t// Config access\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tif (this.allowConfigure) {\n\t\t\t\t\tDrawBackNextButton(1270, Y, 170, 64, LOG_LEVEL_NAMES[e.access], \"White\", \"\",\n\t\t\t\t\t\t() => (e.access > 0 ? LOG_LEVEL_NAMES[(e.access - 1) as LogAccessLevel] : \"\"),\n\t\t\t\t\t\t() => (e.access < 2 ? LOG_LEVEL_NAMES[(e.access + 1) as LogAccessLevel] : \"\")\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tDrawButton(1270, Y, 170, 64, LOG_LEVEL_NAMES[e.access], \"#ccc\", undefined, undefined, true);\n\t\t\t\t}\n\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.max(1, Math.ceil(this.configList.length / PER_PAGE_COUNT));\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawBackNextButton(1605, 800, 300, 90, `${DialogFindPlayer(\"Page\")} ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\t\t} else if (this.failed) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Failed to get log config data from ${this.character.Name}. Maybe you have no access?`, 1000, 480, \"Black\");\n\t\t} else {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(\"Loading...\", 1000, 480, \"Black\");\n\t\t}\n\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tDrawText(`- Behaviour Log: Configuration for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tif (this.allowDelete) {\n\t\t\tDrawButton(1525, 690, 380, 64, \"Delete all log entries\", \"White\");\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.LogConfig]);\n\t\t}\n\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.config !== null) {\n\n\t\t\t//reset button\n\t\t\tif (MouseIn(870, 182, 64, 64)) {\n\t\t\t\tthis.filterInput.value = \"\";\n\t\t\t\tthis.rebuildList();\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.configList.length) break;\n\t\t\t\tconst e = this.configList[i];\n\n\t\t\t\tconst Y = 290 + off * 100;\n\n\t\t\t\tif (e.access > 0 && MouseIn(1270, Y, 85, 64) && this.allowConfigure) {\n\t\t\t\t\tthis.character.setLogConfig(e.category, (e.access - 1) as LogAccessLevel);\n\t\t\t\t\treturn;\n\t\t\t\t} else if (e.access < 2 && MouseIn(1355, Y, 85, 64) && this.allowConfigure) {\n\t\t\t\t\tthis.character.setLogConfig(e.category, (e.access + 1) as LogAccessLevel);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Clear log button\n\t\t\tif (MouseIn(1525, 690, 380, 64) && this.allowDelete) {\n\t\t\t\tthis.character.logClear().then(() => {\n\t\t\t\t\tsetSubscreen(new GuiLog(this.character));\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.configList.length / PER_PAGE_COUNT);\n\t\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\t\tthis.page--;\n\t\t\t\tif (this.page < 0) {\n\t\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t\t}\n\t\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\t\tthis.page++;\n\t\t\t\tif (this.page >= totalPages) {\n\t\t\t\t\tthis.page = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiLog(this.character));\n\t}\n\n\tUnload() {\n\t\tthis.filterInput.remove();\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { LogAccessLevel, LogEntry, logMessageRender } from \"../modules/log\";\nimport { GuiLogConfig } from \"./log_config\";\nimport { DrawImageEx, showHelp } from \"../utilsClub\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { createInputElement, positionElement } from \"../utils\";\n\nconst PER_PAGE_COUNT = 5;\n\nexport class GuiLog extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\tprivate failed: boolean = false;\n\tprivate logData: LogEntry[] | null = null;\n\tprivate logEntries: LogEntry[] = [];\n\tprivate allowDeletion: boolean = false;\n\tprivate allowConfiguration: boolean = false;\n\tprivate allowPraise: boolean = false;\n\tprivate allowLeaveMessage: boolean = false;\n\tprivate page: number = 0;\n\tprivate showMore: boolean[] = new Array(PER_PAGE_COUNT).fill(false);\n\n\tprivate showHelp: boolean = false;\n\n\tprivate filterInput = createInputElement(\"text\", 30);\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.filterInput.addEventListener(\"input\", ev => {\n\t\t\tthis.refreshScreen();\n\t\t});\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.logData = null;\n\t\tthis.refreshScreen();\n\t\tPromise.all([\n\t\t\tthis.character.getLogEntries(),\n\t\t\tthis.character.logGetAllowedActions()\n\t\t]).then(res => {\n\t\t\tthis.logData = res[0];\n\t\t\tthis.allowDeletion = res[1].delete;\n\t\t\tthis.allowConfiguration = res[1].configure || this.character.isPlayer();\n\t\t\tthis.allowPraise = res[1].praise;\n\t\t\tthis.allowLeaveMessage = res[1].leaveMessage;\n\t\t\tthis.refreshScreen();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get log data for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate refreshScreen() {\n\t\tif (!this.active) return;\n\n\t\tthis.logEntries = [];\n\n\t\tlet NoteField = document.getElementById(\"BCX_NoteField\") as HTMLInputElement | undefined;\n\n\t\tif (this.logData === null) {\n\t\t\tthis.filterInput.remove();\n\t\t\tif (NoteField) {\n\t\t\t\tNoteField.remove();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.filterInput.parentElement) {\n\t\t\tdocument.body.appendChild(this.filterInput);\n\t\t}\n\n\t\tif (!this.allowLeaveMessage && NoteField) {\n\t\t\tNoteField.remove();\n\t\t} else if (this.allowLeaveMessage && !NoteField) {\n\t\t\tNoteField = ElementCreateInput(\"BCX_NoteField\", \"text\", \"\", \"30\");\n\t\t}\n\n\t\tconst filter = this.filterInput.value.trim().toLocaleLowerCase().split(\" \");\n\n\t\tthis.logEntries = this.logData.filter(e => {\n\t\t\tconst msg = logMessageRender(e, this.character).toLocaleLowerCase();\n\t\t\treturn filter.every(f => msg.includes(f));\n\t\t});\n\n\t\tconst totalPages = Math.ceil(this.logEntries.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\t\tif (this.logData !== null) {\n\n\t\t\t// filter\n\t\t\tDrawText(\"Filter:\", 130, 215, \"Black\");\n\t\t\tpositionElement(this.filterInput, 550, 210, 600, 64);\n\n\t\t\t//reset button\n\t\t\tif (this.filterInput.value) {\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t\tDrawButton(870, 182, 64, 64, \"X\", \"White\");\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.logEntries.length) break;\n\t\t\t\tconst e = this.logEntries[i];\n\n\t\t\t\tconst Y = 290 + off * 95;\n\n\t\t\t\t// Log message\n\t\t\t\tDrawImageEx(e[1] === LogAccessLevel.protected ? \"Icons/Security.png\" : \"Icons/Public.png\", 125, Y, {\n\t\t\t\t\tHeight: 64,\n\t\t\t\t\tWidth: 64\n\t\t\t\t});\n\n\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\tconst msg = logMessageRender(e, this.character);\n\t\t\t\tif (this.showMore[off]) {\n\t\t\t\t\tMainCanvas.fillStyle = \"#ffff88\";\n\t\t\t\t\tMainCanvas.fillRect(200, Y - 32, 1030, 128);\n\t\t\t\t\tMainCanvas.strokeStyle = \"Black\";\n\t\t\t\t\tMainCanvas.strokeRect(200, Y - 32, 1030, 128);\n\t\t\t\t\tDrawTextWrap(msg, 200 - 970 / 2, Y - 32 + 5, 990, 128 - 10, \"black\", undefined, 3);\n\t\t\t\t} else {\n\t\t\t\t\tDrawButton(200, Y, 1030, 64, \"\", \"White\");\n\t\t\t\t\tlet msgSmall = msg;\n\t\t\t\t\tif (msg.length > 95) {\n\t\t\t\t\t\tmsgSmall = msgSmall.slice(0, 80) + \"... >> click <<\";\n\t\t\t\t\t}\n\t\t\t\t\tDrawTextFit(msgSmall, 210, Y + 34, 1020, msgSmall.startsWith(\"[\") ? \"Gray\" : \"Black\");\n\t\t\t\t}\n\t\t\t\tMainCanvas.beginPath();\n\t\t\t\tMainCanvas.rect(1270, Y, 320, 64);\n\t\t\t\tMainCanvas.stroke();\n\t\t\t\tDrawTextFit(new Date(e[0]).toLocaleString(), 1290, Y + 34, 300, \"Black\", \"\");\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\n\t\t\t\tif (this.allowDeletion) {\n\t\t\t\t\tDrawButton(1630, Y, 64, 64, \"X\", \"White\", \"\", \"Delete log entry\");\n\t\t\t\t}\n\n\t\t\t\tif (MouseIn(125, Y, 64, 64)) {\n\t\t\t\t\tDrawButtonHover(125, Y, 64, 64, e[1] === LogAccessLevel.protected ? \"Protected visibility\" : \"Normal visibility\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Message field\n\t\t\tif (this.allowLeaveMessage) {\n\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\tDrawText(\"Attach\", 130, 831, \"Black\");\n\t\t\t\tDrawText(\"note:\", 130, 869, \"Black\");\n\t\t\t\tElementPosition(\"BCX_NoteField\", 580, 842, 660, 64);\n\t\t\t}\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t// Praise button\n\t\t\tif (this.allowPraise) {\n\t\t\t\tDrawButton(950, 815, 150, 64, \"Praise\", \"White\");\n\t\t\t}\n\t\t\t// Leave message button\n\t\t\tif (this.allowLeaveMessage) {\n\t\t\t\tDrawButton(1150, 815, 200, 64, \"Only note\", \"White\");\n\t\t\t}\n\t\t\t// Scold button\n\t\t\tif (this.allowPraise) {\n\t\t\t\tDrawButton(1400, 815, 150, 64, \"Scold\", \"White\");\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.max(1, Math.ceil(this.logEntries.length / PER_PAGE_COUNT));\n\t\t\tDrawBackNextButton(1605, 800, 300, 90, `${DialogFindPlayer(\"Page\")} ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\t\t} else if (this.failed) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Failed to get log data from ${this.character.Name}. Maybe you have no access?`, 1000, 480, \"Black\");\n\t\t} else {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(\"Loading...\", 1000, 480, \"Black\");\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.Log]);\n\t\t}\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Behaviour Log: About ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\tDrawButton(1815, 305, 90, 90, \"\", this.allowConfiguration ? \"White\" : \"#ddd\", \"Icons/Preference.png\", \"Configure logging\", !this.allowConfiguration);\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\t\tif (MouseIn(1815, 305, 90, 90) && this.allowConfiguration) return setSubscreen(new GuiLogConfig(this.character));\n\n\t\tif (this.logData !== null) {\n\n\t\t\t//reset button\n\t\t\tif (MouseIn(870, 182, 64, 64)) {\n\t\t\t\tthis.filterInput.value = \"\";\n\t\t\t\tthis.refreshScreen();\n\t\t\t}\n\n\t\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\t\tif (i >= this.logEntries.length) break;\n\t\t\t\tconst e = this.logEntries[i];\n\n\t\t\t\tconst Y = 290 + off * 95;\n\n\t\t\t\tif (this.allowDeletion && MouseIn(1630, Y, 64, 64)) {\n\t\t\t\t\tthis.character.logMessageDelete(e[0]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (MouseIn(200, Y - 32, 1030, 128) && this.showMore[off]) {\n\t\t\t\t\tthis.showMore[off] = !this.showMore[off];\n\t\t\t\t} else if (MouseIn(200, Y, 1030, 64)) {\n\t\t\t\t\tif (this.showMore.includes(true)) {\n\t\t\t\t\t\tthis.showMore.fill(false);\n\t\t\t\t\t}\n\t\t\t\t\tthis.showMore[off] = !this.showMore[off];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst field = document.getElementById(\"BCX_NoteField\") as HTMLInputElement | undefined;\n\t\t\tconst msg = field?.value || null;\n\t\t\tlet didPraise = false;\n\n\t\t\t// Praise button\n\t\t\tif (this.allowPraise && MouseIn(950, 815, 150, 64)) {\n\t\t\t\tthis.character.logPraise(1, msg);\n\t\t\t\tdidPraise = true;\n\t\t\t}\n\t\t\t// Leave message button\n\t\t\tif (this.allowLeaveMessage && MouseIn(1150, 815, 200, 64) && msg) {\n\t\t\t\tthis.character.logPraise(0, msg);\n\t\t\t\tdidPraise = true;\n\t\t\t}\n\t\t\t// Scold button\n\t\t\tif (this.allowPraise && MouseIn(1400, 815, 150, 64)) {\n\t\t\t\tthis.character.logPraise(-1, msg);\n\t\t\t\tdidPraise = true;\n\t\t\t}\n\n\t\t\tif (didPraise) {\n\t\t\t\tthis.allowPraise = false;\n\t\t\t\tif (field) {\n\t\t\t\t\tfield.value = \"\";\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Pagination\n\t\t\tconst totalPages = Math.ceil(this.logEntries.length / PER_PAGE_COUNT);\n\t\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\t\tthis.showMore.fill(false);\n\t\t\t\tthis.page--;\n\t\t\t\tif (this.page < 0) {\n\t\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t\t}\n\t\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\t\tthis.showMore.fill(false);\n\t\t\t\tthis.page++;\n\t\t\t\tif (this.page >= totalPages) {\n\t\t\t\t\tthis.page = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n\n\tUnload() {\n\t\tthis.filterInput.remove();\n\t\tElementRemove(\"BCX_NoteField\");\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { MiscCheat } from \"../constants\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { cheatIsEnabled, cheatToggle } from \"../modules/miscPatches\";\nimport { modStorage, modStorageSync } from \"../modules/storage\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { showHelp } from \"../utilsClub\";\n\nexport class GuiMisc extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate showHelp: boolean = false;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t}\n\n\tLoad() {\n\t\tElementCreateInput(\"BCX_RoomSearchValueField\", \"text\", modStorage.roomSearchAutoFill || \"\", \"20\");\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Miscellaneous: Configuration for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\t\tif (this.character.isPlayer()) {\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\t}\n\n\t\tif (!this.character.isPlayer()) {\n\t\t\tDrawText(`Miscellaneous module configuration is not possible on others`, 1000, 500, \"Black\");\n\t\t\treturn;\n\t\t}\n\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tDrawCheckbox(125, 200, 64, 64, \"Enable typing indicator\", !!modStorage.typingIndicatorEnable);\n\t\tDrawCheckbox(125, 300, 64, 64, \"Enable status indicator showing when you are in any player's BCX menu, biography, or wardrobe\", !!modStorage.screenIndicatorEnable);\n\t\tDrawCheckbox(125, 400, 64, 64, \"Cheat: Prevent random NPC events (kidnappings, ransoms, asylum, club slaves)\", cheatIsEnabled(MiscCheat.BlockRandomEvents));\n\t\tDrawCheckbox(125, 500, 64, 64, \"Cheat: Prevent loosing Mistress status when reputation falls below 50 dominance\", cheatIsEnabled(MiscCheat.CantLoseMistress));\n\t\tDrawCheckbox(125, 600, 64, 64, \"Cheat: Give yourself the mistress padlock and its key\", cheatIsEnabled(MiscCheat.GiveMistressKey));\n\t\tDrawCheckbox(125, 700, 64, 64, \"Cheat: Give yourself the pandora padlock and its key\", cheatIsEnabled(MiscCheat.GivePandoraKey));\n\t\tDrawText(\"Use the following text to auto fill the chat room search field:\", 125, 830, \"Black\", \"Gray\");\n\t\tElementPosition(\"BCX_RoomSearchValueField\", 1320, 827, 460, 64);\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.Misc]);\n\t\t}\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90) && this.character.isPlayer()) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.character.isPlayer())\n\t\t\treturn;\n\n\t\tif (MouseIn(125, 200, 64, 64)) {\n\t\t\tmodStorage.typingIndicatorEnable = !modStorage.typingIndicatorEnable;\n\t\t\tmodStorageSync();\n\t\t}\n\n\t\tif (MouseIn(125, 300, 64, 64)) {\n\t\t\tmodStorage.screenIndicatorEnable = !modStorage.screenIndicatorEnable;\n\t\t\tmodStorageSync();\n\t\t}\n\n\t\tif (MouseIn(125, 400, 64, 64)) {\n\t\t\tcheatToggle(MiscCheat.BlockRandomEvents);\n\t\t}\n\n\t\tif (MouseIn(125, 500, 64, 64)) {\n\t\t\tcheatToggle(MiscCheat.CantLoseMistress);\n\t\t}\n\n\t\tif (MouseIn(125, 600, 64, 64)) {\n\t\t\tcheatToggle(MiscCheat.GiveMistressKey);\n\t\t}\n\n\t\tif (MouseIn(125, 700, 64, 64)) {\n\t\t\tcheatToggle(MiscCheat.GivePandoraKey);\n\t\t}\n\t}\n\n\tExit() {\n\t\tconst field = document.getElementById(\"BCX_RoomSearchValueField\") as HTMLInputElement | undefined;\n\t\tif (field) {\n\t\t\tif (field.value) {\n\t\t\t\tmodStorage.roomSearchAutoFill = field.value;\n\t\t\t} else {\n\t\t\t\tdelete modStorage.roomSearchAutoFill;\n\t\t\t}\n\t\t\tmodStorageSync();\n\t\t}\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n\n\tUnload() {\n\t\tElementRemove(\"BCX_RoomSearchValueField\");\n\t}\n}\n","import { ChatroomCharacter, getChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { arrayUnique, capitalizeFirstLetter, dictionaryProcess, formatTimeInterval, isObject } from \"../utils\";\nimport { ChatRoomActionMessage, ChatRoomSendLocal, getCharacterName, getVisibleGroupName, isBind, itemColorsEquals } from \"../utilsClub\";\nimport { AccessLevel, checkPermissionAccess, registerPermission } from \"./authority\";\nimport { notifyOfChange, queryHandlers } from \"./messaging\";\nimport { modStorageSync } from \"./storage\";\nimport { LogEntryType, logMessage } from \"./log\";\nimport { moduleIsEnabled } from \"./presets\";\nimport { ModuleCategory, Preset, ConditionsLimit } from \"../constants\";\nimport { hookFunction, removeAllHooksByModule } from \"../patching\";\nimport { Command_fixExclamationMark, COMMAND_GENERIC_ERROR, Command_pickAutocomplete, Command_selectGroup, Command_selectGroupAutocomplete, registerWhisperCommand } from \"./commands\";\nimport { ConditionsAutocompleteSubcommand, ConditionsCheckAccess, ConditionsGetCategoryData, ConditionsGetCategoryPublicData, ConditionsGetCondition, ConditionsRegisterCategory, ConditionsRemoveCondition, ConditionsRunSubcommand, ConditionsSetCondition, ConditionsSubcommand, ConditionsSubcommands, ConditionsUpdate } from \"./conditions\";\nimport { cursedChange, CURSES_TRIGGER_TEXTS, CURSES_TRIGGER_TEXTS_BATCH } from \"./cursesConstants\";\nimport { BCX_setInterval } from \"../BCXContext\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport isEqual from \"lodash-es/isEqual\";\n\nconst CURSES_ANTILOOP_RESET_INTERVAL = 60_000;\nconst CURSES_ANTILOOP_THRESHOLD = 10;\nconst CURSES_ANTILOOP_SUSPEND_TIME = 600_000;\n\nconst CURSE_IGNORED_PROPERTIES = ValidationModifiableProperties.slice();\nconst CURSE_IGNORED_EFFECTS = [\"Lock\"];\n\nexport function curseMakeSavedProperty(properties: ItemProperties | undefined): ItemProperties {\n\tconst result: ItemProperties = {};\n\n\tif (isObject(properties)) {\n\t\tfor (const key of Object.keys(properties)) {\n\t\t\tif (key === \"Effect\") {\n\t\t\t\tif (Array.isArray(properties.Effect) && properties.Effect.every(i => typeof i === \"string\")) {\n\t\t\t\t\tconst effect = properties.Effect.filter(i => !CURSE_IGNORED_EFFECTS.includes(i));\n\t\t\t\t\tif (effect.length > 0) {\n\t\t\t\t\t\tresult.Effect = effect;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`BCX: Bad effect of properties: `, properties.Effect);\n\t\t\t\t}\n\t\t\t} else if (!CURSE_IGNORED_PROPERTIES.includes(key) && properties[key] !== undefined) {\n\t\t\t\tresult[key] = cloneDeep(properties[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n}\n\nfunction curseCreateCurseItemInfo(item: Item): CursedItemInfo {\n\tconst result: CursedItemInfo = {\n\t\tName: item.Asset.Name,\n\t\tcurseProperty: false,\n\t\tDifficulty: item.Difficulty || undefined,\n\t\tColor: (item.Color && item.Color !== \"Default\") ? cloneDeep(item.Color) : undefined,\n\t\tProperty: curseMakeSavedProperty(item.Property)\n\t};\n\n\tif (Object.keys(result.Property!).length === 0) {\n\t\tdelete result.Property;\n\t}\n\n\treturn result;\n}\n\nexport function curseAllowItemCurseProperty(asset: Asset): boolean {\n\treturn !!(\n\t\tasset.Extended ||\n\t\tasset.Effect?.includes(\"Egged\") ||\n\t\tasset.AllowEffect?.includes(\"Egged\") ||\n\t\tasset.Effect?.includes(\"UseRemote\") ||\n\t\tasset.AllowEffect?.includes(\"UseRemote\")\n\t);\n}\n\nexport function curseDefaultItemCurseProperty(asset: Asset): boolean {\n\treturn curseAllowItemCurseProperty(asset) && asset.Extended && asset.Archetype === \"typed\";\n}\n\nexport function curseItem(Group: string, curseProperty: boolean | null, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Curses))\n\t\treturn false;\n\n\tconst group = AssetGroup.find(g => g.Name === Group);\n\n\tif (!group || (typeof curseProperty !== \"boolean\" && curseProperty !== null)) {\n\t\tconsole.error(`BCX: Attempt to curse with invalid data`, Group, curseProperty);\n\t\treturn false;\n\t}\n\n\tif (group.Category === \"Appearance\" && !group.Clothing) {\n\t\tconsole.warn(`BCX: Attempt to curse body`, Group);\n\t\treturn false;\n\t}\n\n\tif (character && !ConditionsCheckAccess(\"curses\", Group, character)) {\n\t\treturn false;\n\t}\n\n\tconst currentItem = InventoryGet(Player, Group);\n\n\tif (currentItem) {\n\n\t\tif (curseProperty === null) {\n\t\t\tif (ConditionsGetCondition(\"curses\", Group))\n\t\t\t\treturn true;\n\t\t\tcurseProperty = curseDefaultItemCurseProperty(currentItem.Asset);\n\t\t}\n\n\t\tif (!curseAllowItemCurseProperty(currentItem.Asset) && curseProperty) {\n\t\t\tconsole.warn(`BCX: Attempt to curse properties of item ${currentItem.Asset.Group.Name}:${currentItem.Asset.Name}, while not allowed`);\n\t\t\tcurseProperty = false;\n\t\t}\n\n\t\tconst newCurse = curseCreateCurseItemInfo(currentItem);\n\t\tif (curseProperty) {\n\t\t\tnewCurse.curseProperty = true;\n\t\t}\n\t\tif (ConditionsGetCategoryData(\"curses\").data?.itemRemove) {\n\t\t\tnewCurse.itemRemove = true;\n\t\t}\n\t\tConditionsSetCondition(\"curses\", Group, newCurse, character);\n\t\tif (character) {\n\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} cursed ${Player.Name}'s ${currentItem.Asset.Description}`);\n\t\t\tif (!character.isPlayer()) {\n\t\t\t\tChatRoomSendLocal(`${character} cursed the ${currentItem.Asset.Description} on you`);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tConditionsSetCondition(\"curses\", Group, null, character);\n\t\tif (character) {\n\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} cursed ${Player.Name}'s body part to stay exposed (${getVisibleGroupName(group)})`);\n\t\t\tif (!character.isPlayer()) {\n\t\t\t\tChatRoomSendLocal(`${character} put a curse on you, forcing part of your body to stay exposed (${getVisibleGroupName(group)})`);\n\t\t\t}\n\t\t}\n\t}\n\n\tmodStorageSync();\n\tnotifyOfChange();\n\treturn true;\n}\n\nexport function curseBatch(mode: \"items\" | \"clothes\", includingEmpty: boolean, character: ChatroomCharacter | null): boolean {\n\tif (character && !checkPermissionAccess(\"curses_normal\", character) && !checkPermissionAccess(\"curses_limited\", character))\n\t\treturn false;\n\n\tlet assetGroups: AssetGroup[];\n\tif (mode === \"items\") {\n\t\tassetGroups = AssetGroup.filter(i => i.Category === \"Item\" && (includingEmpty || InventoryGet(Player, i.Name)));\n\t} else if (mode === \"clothes\") {\n\t\tassetGroups = AssetGroup.filter(i => i.Category === \"Appearance\" && i.Clothing && (includingEmpty || InventoryGet(Player, i.Name)));\n\t} else {\n\t\tconsole.error(`BCX: Attempt to curse in invalid mode`, mode);\n\t\treturn false;\n\t}\n\n\tif (character) {\n\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} cursed all of ${Player.Name}'s ` +\n\t\t\t`${includingEmpty ? \"\" : \"occupied \"}${mode === \"items\" ? \"item\" : \"clothing\"} slots`);\n\t\tif (!character.isPlayer()) {\n\t\t\tChatRoomSendLocal(`${character} cursed all of your ${includingEmpty ? \"\" : \"occupied \"}${mode === \"items\" ? \"item\" : \"clothing\"} slots`);\n\t\t}\n\t}\n\n\tfor (const group of assetGroups) {\n\t\tif (ConditionsGetCondition(\"curses\", group.Name))\n\t\t\tcontinue;\n\t\tif (character && !ConditionsCheckAccess(\"curses\", group.Name, character))\n\t\t\tcontinue;\n\t\tif (!curseItem(group.Name, null, null))\n\t\t\treturn false;\n\t}\n\treturn true;\n}\n\nexport function curseLift(Group: string, character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Curses))\n\t\treturn false;\n\n\tif (character && !ConditionsCheckAccess(\"curses\", Group, character))\n\t\treturn false;\n\n\tconst curse = ConditionsGetCondition(\"curses\", Group);\n\tif (curse) {\n\t\tconst group = AssetGroup.find(g => g.Name === Group);\n\t\tif (character && group) {\n\t\t\tconst itemName = curse.data && AssetGet(Player.AssetFamily, Group, curse.data.Name)?.Description;\n\t\t\tif (itemName) {\n\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} lifted the curse on ${Player.Name}'s ${itemName}`);\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tChatRoomSendLocal(`${character} lifted the curse on your ${itemName}`);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} lifted the curse on ${Player.Name}'s body part (${getVisibleGroupName(group)})`);\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tChatRoomSendLocal(`${character} lifted the curse on part of your body (${getVisibleGroupName(group)})`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tConditionsRemoveCondition(\"curses\", Group);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nexport function curseLiftAll(character: ChatroomCharacter | null): boolean {\n\tif (!moduleIsEnabled(ModuleCategory.Curses))\n\t\treturn false;\n\n\tif (character && (!checkPermissionAccess(\"curses_normal\", character) || !checkPermissionAccess(\"curses_limited\", character)))\n\t\treturn false;\n\n\tif (character) {\n\t\tlogMessage(\"curse_change\", LogEntryType.plaintext, `${character} lifted all curse on ${Player.Name}`);\n\t\tif (!character.isPlayer()) {\n\t\t\tChatRoomSendLocal(`${character} lifted all curses on you`);\n\t\t}\n\t}\n\tConditionsRemoveCondition(\"curses\", Object.keys(ConditionsGetCategoryData(\"curses\").conditions));\n\treturn true;\n}\n\nexport class ModuleCurses extends BaseModule {\n\tprivate resetTimer: number | null = null;\n\tprivate triggerCounts: Map<string, number> = new Map();\n\tprivate suspendedUntil: number | null = null;\n\n\tprivate pendingMessages: Record<cursedChange | \"autoremove\", string[]> = {\n\t\tremove: [],\n\t\tadd: [],\n\t\tswap: [],\n\t\tupdate: [],\n\t\tcolor: [],\n\t\tautoremove: []\n\t};\n\n\tinit() {\n\t\tregisterPermission(\"curses_normal\", {\n\t\t\tname: \"Allows handling curses on non-limited object slots\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"curses_limited\", {\n\t\t\tname: \"Allows handling curses on limited object slots\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.lover]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"curses_global_configuration\", {\n\t\t\tname: \"Allows editing the global curses configuration\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.owner],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.lover]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"curses_change_limits\", {\n\t\t\tname: \"Allows to limit/block individual curse object slots\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.self],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"curses_color\", {\n\t\t\tname: \"Allow changing colors of cursed objects\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"curses_view_originator\", {\n\t\t\tname: \"Allow to view who added the curse originally\",\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\n\t\tqueryHandlers.curseItem = (sender, resolve, data) => {\n\t\t\tif (isObject(data) && typeof data.Group === \"string\" && (typeof data.curseProperties === \"boolean\" || data.curseProperties === null)) {\n\t\t\t\tresolve(true, curseItem(data.Group, data.curseProperties, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.curseLift = (sender, resolve, data) => {\n\t\t\tif (typeof data === \"string\") {\n\t\t\t\tresolve(true, curseLift(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.curseBatch = (sender, resolve, data) => {\n\t\t\tif (isObject(data) && typeof data.mode === \"string\" && typeof data.includingEmpty === \"boolean\") {\n\t\t\t\tresolve(true, curseBatch(data.mode, data.includingEmpty, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.curseLiftAll = (sender, resolve) => {\n\t\t\tresolve(true, curseLiftAll(sender));\n\t\t};\n\n\t\tregisterWhisperCommand(\"curses\", \"- Manage curses\", (argv, sender, respond) => {\n\t\t\tif (!moduleIsEnabled(ModuleCategory.Curses)) {\n\t\t\t\treturn respond(`Curses module is disabled.`);\n\t\t\t}\n\t\t\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase();\n\t\t\tconst cursesInfo = ConditionsGetCategoryPublicData(\"curses\", sender).conditions;\n\t\t\tif (ConditionsSubcommands.includes(subcommand as ConditionsSubcommand)) {\n\t\t\t\treturn ConditionsRunSubcommand(\"curses\", argv, sender, respond);\n\t\t\t} else if (subcommand === \"list\") {\n\t\t\t\tlet result = \"Current curses:\";\n\t\t\t\tfor (const [k, v] of Object.entries(cursesInfo)) {\n\t\t\t\t\tconst group = AssetGroup.find(g => g.Name === k);\n\t\t\t\t\tif (!group) {\n\t\t\t\t\t\tconsole.warn(`BCX: Unknown group ${k}`);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet resultItem = `\\n[${group.Clothing ? \"Clothing\" : \"Item\"}] `;\n\n\t\t\t\t\tif (v.data === null) {\n\t\t\t\t\t\tresultItem += `Blocked: ${getVisibleGroupName(group)}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst item = AssetGet(Player.AssetFamily, k, v.data.Name);\n\t\t\t\t\t\tconst timerText = `Timer: ${v.timer ? formatTimeInterval(v.timer - Date.now(), \"short\") : \"\"}`;\n\t\t\t\t\t\tresultItem += `${item?.Description ?? v.data.Name} (${getVisibleGroupName(group)}) | ${timerText}` +\n\t\t\t\t\t\t\t`${v.data.curseProperties ? \" | Item configuration also cursed\" : \"\"}`;\n\t\t\t\t\t}\n\t\t\t\t\tif (result.length + resultItem.length >= 990) {\n\t\t\t\t\t\tresult += \"\\n...\";\n\t\t\t\t\t\trespond(result);\n\t\t\t\t\t\tresult = \"Current curses (continued):\";\n\t\t\t\t\t}\n\t\t\t\t\tresult += resultItem;\n\t\t\t\t}\n\t\t\t\trespond(result);\n\t\t\t} else if (subcommand === \"listgroups\") {\n\t\t\t\tconst listgroup = (argv[1] || \"\").toLocaleLowerCase();\n\t\t\t\tif (listgroup === \"items\") {\n\t\t\t\t\tlet result = `List of item groups:`;\n\t\t\t\t\tconst AssetGroupItems = AssetGroup.filter(g => g.Category === \"Item\");\n\t\t\t\t\tfor (const group of AssetGroupItems) {\n\t\t\t\t\t\tconst currentItem = InventoryGet(Player, group.Name);\n\t\t\t\t\t\tconst itemIsCursed = cursesInfo[group.Name] !== undefined;\n\n\t\t\t\t\t\tresult += `\\n${getVisibleGroupName(group)}: ${currentItem ? currentItem.Asset.Description : \"[Nothing]\"}`;\n\t\t\t\t\t\tif (itemIsCursed) {\n\t\t\t\t\t\t\tresult += ` [cursed]`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\trespond(result);\n\t\t\t\t} else if (listgroup === \"clothes\") {\n\t\t\t\t\tlet result = `List of clothes groups:`;\n\t\t\t\t\tconst AssetGroupClothings = AssetGroup.filter(g => g.Category === \"Appearance\" && g.Clothing);\n\t\t\t\t\tfor (const group of AssetGroupClothings) {\n\t\t\t\t\t\tconst currentItem = InventoryGet(Player, group.Name);\n\t\t\t\t\t\tconst clothingIsCursed = cursesInfo[group.Name] !== undefined;\n\n\t\t\t\t\t\tresult += `\\n${getVisibleGroupName(group)}: ${currentItem ? currentItem.Asset.Description : \"[Nothing]\"}`;\n\t\t\t\t\t\tif (clothingIsCursed) {\n\t\t\t\t\t\t\tresult += ` [cursed]`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\trespond(result);\n\t\t\t\t} else {\n\t\t\t\t\trespond(Command_fixExclamationMark(sender, `Expected one of:\\n` +\n\t\t\t\t\t\t`!curses listgroups items\\n` +\n\t\t\t\t\t\t`!curses listgroups clothes`\n\t\t\t\t\t));\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"curse\") {\n\t\t\t\tconst group = Command_selectGroup(argv[1] || \"\", getPlayerCharacter(), G => G.Category !== \"Appearance\" || G.Clothing);\n\t\t\t\tif (typeof group === \"string\") {\n\t\t\t\t\treturn respond(group);\n\t\t\t\t}\n\t\t\t\tif (cursesInfo[group.Name] !== undefined) {\n\t\t\t\t\treturn respond(`This group or item is already cursed`);\n\t\t\t\t}\n\t\t\t\trespond(curseItem(group.Name, null, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else if (subcommand === \"curseworn\" || subcommand === \"curseall\") {\n\t\t\t\tconst group = (argv[1] || \"\").toLocaleLowerCase();\n\t\t\t\tif (group === \"items\" || group === \"clothes\") {\n\t\t\t\t\treturn respond(curseBatch(group, subcommand === \"curseall\", sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t\t}\n\t\t\t\trespond(Command_fixExclamationMark(sender, `Expected one of:\\n` +\n\t\t\t\t\t`!curses ${subcommand} items\\n` +\n\t\t\t\t\t`!curses ${subcommand} clothes`\n\t\t\t\t));\n\t\t\t} else if (subcommand === \"lift\") {\n\t\t\t\tconst group = Command_selectGroup(argv[1] || \"\", getPlayerCharacter(), G => G.Category !== \"Appearance\" || G.Clothing);\n\t\t\t\tif (typeof group === \"string\") {\n\t\t\t\t\treturn respond(group);\n\t\t\t\t}\n\t\t\t\tif (cursesInfo[group.Name] === undefined) {\n\t\t\t\t\treturn respond(`This group or item is not cursed`);\n\t\t\t\t}\n\t\t\t\trespond(curseLift(group.Name, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else if (subcommand === \"liftall\") {\n\t\t\t\trespond(curseLiftAll(sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else if (subcommand === \"configuration\") {\n\t\t\t\tconst group = Command_selectGroup(argv[1] || \"\", getPlayerCharacter(), G => G.Category !== \"Appearance\" || G.Clothing);\n\t\t\t\tif (typeof group === \"string\") {\n\t\t\t\t\treturn respond(group);\n\t\t\t\t}\n\t\t\t\tconst curse = cursesInfo[group.Name];\n\t\t\t\tif (!curse) {\n\t\t\t\t\treturn respond(`This group or item is not cursed`);\n\t\t\t\t}\n\t\t\t\tconst target = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\t\tif (target !== \"yes\" && target !== \"no\") {\n\t\t\t\t\treturn respond(`Expected yes or no`);\n\t\t\t\t}\n\t\t\t\tif (curse.data == null) {\n\t\t\t\t\treturn respond(`Empty groups cannot have configuration cursed`);\n\t\t\t\t}\n\t\t\t\tconst asset = AssetGet(Player.AssetFamily, group.Name, cursesInfo[group.Name].data!.Name);\n\t\t\t\tif (asset && target === \"yes\" && !curseAllowItemCurseProperty(asset)) {\n\t\t\t\t\treturn respond(`This item cannot have configuration cursed`);\n\t\t\t\t}\n\t\t\t\tcurse.data.curseProperties = target === \"yes\";\n\t\t\t\trespond(ConditionsUpdate(\"curses\", group.Name, curse, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else if (subcommand === \"autoremove\") {\n\t\t\t\tconst group = Command_selectGroup(argv[1] || \"\", getPlayerCharacter(), G => G.Category !== \"Appearance\" || G.Clothing);\n\t\t\t\tif (typeof group === \"string\") {\n\t\t\t\t\treturn respond(group);\n\t\t\t\t}\n\t\t\t\tconst curse = cursesInfo[group.Name];\n\t\t\t\tif (!curse) {\n\t\t\t\t\treturn respond(`This group or item is not cursed`);\n\t\t\t\t}\n\t\t\t\tif (!cursesInfo[group.Name].requirements) {\n\t\t\t\t\treturn respond(`Cannot change autoremove while the curse uses the global configuration. First use:\\ncurses triggers <curse> global no`);\n\t\t\t\t}\n\t\t\t\tconst target = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\t\tif (target !== \"yes\" && target !== \"no\") {\n\t\t\t\t\treturn respond(`Expected yes or no`);\n\t\t\t\t}\n\t\t\t\tif (curse.data == null) {\n\t\t\t\t\treturn respond(`Empty groups have no item to be automatically removed`);\n\t\t\t\t}\n\t\t\t\tcurse.data.itemRemove = target === \"yes\";\n\t\t\t\trespond(ConditionsUpdate(\"curses\", group.Name, curse, sender) ? `Ok.` : COMMAND_GENERIC_ERROR);\n\t\t\t} else {\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!curses usage (page 1):\\n` +\n\t\t\t\t\t`!curses list - List all cursed <group>s and related info (eg. cursed items)\\n` +\n\t\t\t\t\t`!curses listgroups <items|clothes> - Lists all possible item or cloth <group> slots and worn items\\n` +\n\t\t\t\t\t`!curses curse <group> - Places a curse on the specified item/cloth <group>\\n` +\n\t\t\t\t\t`!curses curseworn <items|clothes> - Place a curse on all currently worn items/clothes\\n` +\n\t\t\t\t\t`!curses curseall <items|clothes> - Place a curse on all item/cloth slots, both used and empty\\n` +\n\t\t\t\t\t`!curses lift <group> - Lifts (removes) the curse from the specified item/cloth <group>\\n` +\n\t\t\t\t\t`!curses liftall - Lifts (removes) all curses\\n` +\n\t\t\t\t\t`!curses configuration <group> <yes|no> - Curses or uncurses the item configuration of an item/cloth in <group>\\n` +\n\t\t\t\t\t`!curses autoremove <group> <yes|no> - Removes an item/cloth in <group> when the curse is no longer in effect`\n\t\t\t\t));\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!curses usage (page 2):\\n` +\n\t\t\t\t\t`!curses setactive <group> <yes/no> - Switch the curse and its conditions on and off\\n` +\n\t\t\t\t\t`!curses triggers <group> global <yes/no> - Set the trigger condition of this curse to the global configuration\\n` +\n\t\t\t\t\t`!curses triggers <group> help - Set the trigger configuration of a curse\\n` +\n\t\t\t\t\t`!curses globaltriggers help - Set global trigger configuration\\n` +\n\t\t\t\t\t`!curses timer <group> help - Set timer options of a curse\\n` +\n\t\t\t\t\t`!curses defaulttimer help - Set default timer options used on new curses\\n` +\n\t\t\t\t\t`!curses setlimit <group> <normal/limited/blocked> - Set a limit on certain <group>\\n` +\n\t\t\t\t\t`\\nHint: If an argument contains spaces: \"put it in quotes\"`\n\t\t\t\t));\n\t\t\t}\n\t\t}, (argv, sender) => {\n\t\t\tif (!moduleIsEnabled(ModuleCategory.Curses)) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tif (argv.length <= 1) {\n\t\t\t\treturn Command_pickAutocomplete(argv[0], [\"list\", \"listgroups\", \"curse\", \"curseworn\", \"curseall\", \"lift\", \"liftall\", \"configuration\", \"autoremove\", ...ConditionsSubcommands]);\n\t\t\t}\n\n\t\t\tconst subcommand = argv[0].toLocaleLowerCase();\n\t\t\tconst cursesInfo = ConditionsGetCategoryPublicData(\"curses\", sender).conditions;\n\n\t\t\tif (ConditionsSubcommands.includes(subcommand as ConditionsSubcommand)) {\n\t\t\t\treturn ConditionsAutocompleteSubcommand(\"curses\", argv, sender);\n\t\t\t} else if (subcommand === \"listgroups\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_pickAutocomplete(argv[1], [\"items\", \"clothes\"]);\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"curse\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_selectGroupAutocomplete(argv[1] || \"\", getPlayerCharacter(), G => G.Category !== \"Appearance\" || G.Clothing);\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"curseworn\" || subcommand === \"curseall\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_pickAutocomplete(argv[1], [\"items\", \"clothes\"]);\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"lift\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_selectGroupAutocomplete(argv[1] || \"\", getPlayerCharacter(), G => cursesInfo[G.Name] !== undefined);\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"configuration\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_selectGroupAutocomplete(argv[1] || \"\", getPlayerCharacter(), G => cursesInfo[G.Name] !== undefined);\n\t\t\t\t} else if (argv.length === 3) {\n\t\t\t\t\treturn Command_pickAutocomplete(argv[2], [\"yes\", \"no\"]);\n\t\t\t\t}\n\t\t\t} else if (subcommand === \"autoremove\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn Command_selectGroupAutocomplete(argv[1] || \"\", getPlayerCharacter(), G => cursesInfo[G.Name] !== undefined);\n\t\t\t\t} else if (argv.length === 3) {\n\t\t\t\t\treturn Command_pickAutocomplete(argv[2], [\"yes\", \"no\"]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\n\t\tConditionsRegisterCategory(\"curses\", {\n\t\t\tcategory: ModuleCategory.Curses,\n\t\t\tpermission_normal: \"curses_normal\",\n\t\t\tpermission_limited: \"curses_limited\",\n\t\t\tpermission_configure: \"curses_global_configuration\",\n\t\t\tpermission_changeLimits: \"curses_change_limits\",\n\t\t\tpermission_viewOriginator: \"curses_view_originator\",\n\t\t\tloadValidateConditionKey: (group) => AssetGroup.some(g => g.Name === group),\n\t\t\tloadValidateCondition: (group, data) => {\n\t\t\t\tconst info = data.data;\n\n\t\t\t\tif (info === null)\n\t\t\t\t\treturn true;\n\n\t\t\t\tif (!isObject(info) ||\n\t\t\t\t\ttypeof info.Name !== \"string\" ||\n\t\t\t\t\ttypeof info.curseProperty !== \"boolean\"\n\t\t\t\t) {\n\t\t\t\t\tconsole.error(`BCX: Bad data for cursed item in group ${group}, removing it`, info);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (AssetGet(\"Female3DCG\", group, info.Name) == null) {\n\t\t\t\t\tconsole.warn(`BCX: Unknown cursed item ${group}:${info.Name}, removing it`, info);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tloadCategorySpecificGlobalData: (data) => {\n\t\t\t\tif (!isObject(data)) {\n\t\t\t\t\tconsole.warn(\"BCX: Bad curses global data, resetting\");\n\t\t\t\t\tdata = {\n\t\t\t\t\t\titemRemove: false\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (typeof data.itemRemove !== \"boolean\") {\n\t\t\t\t\tdata.itemRemove = false;\n\t\t\t\t}\n\t\t\t\treturn data;\n\t\t\t},\n\t\t\tstateChangeHandler: this.curseStateChange.bind(this),\n\t\t\ttickHandler: this.curseTick.bind(this),\n\t\t\tafterTickHandler: this.afterCurseTick.bind(this),\n\t\t\tmakePublicData: (group, data) => {\n\t\t\t\tif (data.data === null) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tName: data.data.Name,\n\t\t\t\t\tcurseProperties: data.data.curseProperty,\n\t\t\t\t\titemRemove: data.data.itemRemove ?? false\n\t\t\t\t};\n\t\t\t},\n\t\t\tvalidateCategorySpecificGlobalData: data => isObject(data) && typeof data.itemRemove === \"boolean\",\n\t\t\tvalidatePublicData: (group, data) =>\n\t\t\t\tdata === null ||\n\t\t\t\tisObject(data) &&\n\t\t\t\ttypeof data.Name === \"string\" &&\n\t\t\t\ttypeof data.curseProperties === \"boolean\" &&\n\t\t\t\ttypeof data.itemRemove === \"boolean\",\n\t\t\tupdateCondition: (condition, data, updateData, character, rawData) => {\n\t\t\t\t// Update cannot change cursed item\n\t\t\t\tif (data.data?.Name !== updateData?.Name)\n\t\t\t\t\treturn false;\n\t\t\t\t// Nothing to update on empty slot\n\t\t\t\tif (!data.data || !updateData)\n\t\t\t\t\treturn true;\n\n\t\t\t\tconst asset = AssetGet(Player.AssetFamily, condition, data.data.Name);\n\t\t\t\tif (!asset) {\n\t\t\t\t\tconsole.warn(`BCX: Curse asset ${condition}:${data.data.Name} not found during update`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tdata.data.curseProperty = updateData.curseProperties;\n\t\t\t\tif (!curseAllowItemCurseProperty(asset) && data.data.curseProperty) {\n\t\t\t\t\tconsole.warn(`BCX: Attempt to curse properties of item ${condition}:${data.data.Name}, while not allowed`);\n\t\t\t\t\tdata.data.curseProperty = false;\n\t\t\t\t}\n\n\t\t\t\tif (updateData.itemRemove && rawData.requirements) {\n\t\t\t\t\tdata.data.itemRemove = true;\n\t\t\t\t} else {\n\t\t\t\t\tdelete data.data.itemRemove;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tparseConditionName: (selector, onlyExisting) => {\n\t\t\t\tconst group = Command_selectGroup(selector, getPlayerCharacter(), G => (G.Category !== \"Appearance\" || G.Clothing) && (!onlyExisting || onlyExisting.includes(G.Name)));\n\t\t\t\tif (typeof group === \"string\") {\n\t\t\t\t\treturn [false, group];\n\t\t\t\t}\n\t\t\t\treturn [true, group.Name];\n\t\t\t},\n\t\t\tautocompleteConditionName: (selector, onlyExisting) => {\n\t\t\t\treturn Command_selectGroupAutocomplete(selector, getPlayerCharacter(), G => (G.Category !== \"Appearance\" || G.Clothing) && (!onlyExisting || onlyExisting.includes(G.Name)));\n\t\t\t},\n\t\t\tlogLimitChange: (group, character, newLimit) => {\n\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext,\n\t\t\t\t\t`${character} changed ${Player.Name}'s curse slot '${group}' permission to ${ConditionsLimit[newLimit]}`);\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tChatRoomSendLocal(`${character} changed curse slot '${group}' permission to ${ConditionsLimit[newLimit]}`, undefined, character.MemberNumber);\n\t\t\t\t}\n\t\t\t},\n\t\t\tlogConditionUpdate: (group, character, newData, oldData) => {\n\t\t\t\tconst assetGroup = AssetGroup.find(g => g.Name === group);\n\t\t\t\tconst visibleName = assetGroup ? getVisibleGroupName(assetGroup) : \"[ERROR]\";\n\n\t\t\t\tconst didActiveChange = newData.active !== oldData.active;\n\t\t\t\tconst didTimerChange = newData.timer !== oldData.timer || newData.timerRemove !== oldData.timerRemove;\n\t\t\t\tconst didTriggerChange = !isEqual(newData.requirements, oldData.requirements);\n\t\t\t\tconst didItemRemoveChange = newData.requirements != null && newData.data?.itemRemove !== oldData.data?.itemRemove;\n\t\t\t\tconst didItemConfigCurseChange = newData.data?.curseProperties !== oldData.data?.curseProperties;\n\t\t\t\tconst changeEvents = [];\n\t\t\t\tif (didActiveChange)\n\t\t\t\t\tchangeEvents.push(\"active state\");\n\t\t\t\tif (didTimerChange)\n\t\t\t\t\tchangeEvents.push(\"timer\");\n\t\t\t\tif (didTriggerChange)\n\t\t\t\t\tchangeEvents.push(\"trigger condition\");\n\t\t\t\tif (didItemRemoveChange)\n\t\t\t\t\tchangeEvents.push(\"autoremove option\");\n\t\t\t\tif (didItemConfigCurseChange)\n\t\t\t\t\tchangeEvents.push(\"item config curse\");\n\t\t\t\tif (changeEvents.length > 0) {\n\t\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext,\n\t\t\t\t\t\t`${character} changed the ${changeEvents.join(\", \")} of ${Player.Name}'s curse on slot '${visibleName}'`);\n\t\t\t\t}\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tif (didActiveChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} ${newData.active ? \"reactivated\" : \"deactivated\"} the curse on slot '${visibleName}'`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== oldData.timer)\n\t\t\t\t\t\tif (newData.timer === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} disabled the timer of the curse on slot '${visibleName}'`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the remaining time of the timer of the curse on slot '${visibleName}' to ${formatTimeInterval(newData.timer - Date.now())}`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== null && newData.timerRemove !== oldData.timerRemove)\n\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the timer behavior of the curse on slot '${visibleName}' to ${newData.timerRemove ? \"remove\" : \"disable\"} the curse when time runs out`, undefined, character.MemberNumber);\n\t\t\t\t\tif (didItemRemoveChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} set the curse on slot '${visibleName}' to ${newData.data?.itemRemove ? \"remove\" : \"keep\"} the item when the curse is no longer in effect`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (didTriggerChange)\n\t\t\t\t\t\tif (newData.requirements === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the curse on slot '${visibleName}' to use the global curses configuration`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst triggers: string[] = [];\n\t\t\t\t\t\t\tconst r = newData.requirements;\n\t\t\t\t\t\t\tif (r.room) {\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.roomName) {\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.role) {\n\t\t\t\t\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (r.player) {\n\t\t\t\t\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\t\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (triggers.length > 0) {\n\t\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the curse on slot ${visibleName} to trigger under following conditions:\\n` + triggers.join(\"\\n\"), undefined, character.MemberNumber);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tChatRoomSendLocal(`${character} deactivated all trigger conditions of the curse on slot ${visibleName}. The curse will now always trigger, while it is active`, undefined, character.MemberNumber);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tif (didItemConfigCurseChange)\n\t\t\t\t\t\tChatRoomSendLocal(`${character} ${newData.data?.curseProperties ? \"cursed\" : \"lifted the curse of\"} the '${visibleName}' item's configuration`, undefined, character.MemberNumber);\n\t\t\t\t}\n\t\t\t},\n\t\t\tlogCategoryUpdate: (character, newData, oldData) => {\n\t\t\t\tconst didTimerChange = newData.timer !== oldData.timer || newData.timerRemove !== oldData.timerRemove;\n\t\t\t\tconst didTriggerChange = !isEqual(newData.requirements, oldData.requirements);\n\t\t\t\tconst didItemRemoveChange = newData.data?.itemRemove !== oldData.data?.itemRemove;\n\t\t\t\tconst changeEvents = [];\n\t\t\t\tif (didTimerChange)\n\t\t\t\t\tchangeEvents.push(\"default timer\");\n\t\t\t\tif (didTriggerChange)\n\t\t\t\t\tchangeEvents.push(\"trigger condition\");\n\t\t\t\tif (didItemRemoveChange)\n\t\t\t\t\tchangeEvents.push(\"autoremove option\");\n\t\t\t\tif (changeEvents.length > 0) {\n\t\t\t\t\tlogMessage(\"curse_change\", LogEntryType.plaintext,\n\t\t\t\t\t\t`${character} changed the ${changeEvents.join(\", \")} of ${Player.Name}'s global curses config`);\n\t\t\t\t}\n\t\t\t\tif (!character.isPlayer()) {\n\t\t\t\t\tif (newData.timer !== oldData.timer)\n\t\t\t\t\t\tif (newData.timer === null) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} removed the default timer of the global curses configuration`, undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the default timer of the global curses configuration to ${formatTimeInterval(newData.timer)}`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\tif (newData.timer !== null && newData.timerRemove !== oldData.timerRemove)\n\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the default timeout behavior of the global curses configuration to ${newData.timerRemove ? \"removal of curses\" : \"disabling curses\"} when time runs out`, undefined, character.MemberNumber);\n\t\t\t\t\tif (didItemRemoveChange) {\n\t\t\t\t\t\tChatRoomSendLocal(`${character} changed the default curses behaviour to ${newData.data?.itemRemove ? \"remove\" : \"keep\"} an item when the curse on it is no longer in effect`, undefined, character.MemberNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (didTriggerChange) {\n\t\t\t\t\t\tconst triggers: string[] = [];\n\t\t\t\t\t\tconst r = newData.requirements;\n\t\t\t\t\t\tif (r.room) {\n\t\t\t\t\t\t\ttriggers.push(`When ${r.room.inverted ? \"not in\" : \"in\"} ${r.room.type} room`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.roomName) {\n\t\t\t\t\t\t\ttriggers.push(`When ${r.roomName.inverted ? \"not in\" : \"in\"} room named '${r.roomName.name}'`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.role) {\n\t\t\t\t\t\t\tconst role = capitalizeFirstLetter(AccessLevel[r.role.role]) + (r.role.role !== AccessLevel.clubowner ? \" \" : \"\");\n\t\t\t\t\t\t\ttriggers.push(`When ${r.role.inverted ? \"not in\" : \"in\"} room with role '${role}'`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (r.player) {\n\t\t\t\t\t\t\tconst name = getCharacterName(r.player.memberNumber, null);\n\t\t\t\t\t\t\ttriggers.push(`When ${r.player.inverted ? \"not in\" : \"in\"} room with member '${r.player.memberNumber}'${name ? ` (${name})` : \"\"}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (triggers.length > 0) {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} set the global curses configuration to trigger curses under following conditions:\\n` + triggers.join(\"\\n\"), undefined, character.MemberNumber);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tChatRoomSendLocal(`${character} deactivated all trigger conditions for the global curses configuration. Curses set to this default configuration will now always trigger, while active`, undefined, character.MemberNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetDefaultLimits: () => ({}),\n\t\t\tcommandConditionSelectorHelp: \"group\"\n\t\t});\n\t}\n\n\tload() {\n\t\tif (!moduleIsEnabled(ModuleCategory.Curses)) {\n\t\t\treturn;\n\t\t}\n\n\t\thookFunction(\"ValidationResolveModifyDiff\", 0, (args, next) => {\n\t\t\tconst params = args[2] as AppearanceUpdateParameters;\n\t\t\tconst result = next(args) as ItemDiffResolution;\n\n\t\t\tif (params.C.ID === 0 && result.item) {\n\t\t\t\tconst condition = ConditionsGetCondition(\"curses\", result.item.Asset.Group.Name);\n\t\t\t\tconst curse = condition?.data;\n\t\t\t\tconst character = getChatroomCharacter(params.sourceMemberNumber);\n\t\t\t\tif (curse &&\n\t\t\t\t\tresult.item.Asset.Name === curse.Name &&\n\t\t\t\t\t!itemColorsEquals(curse.Color, result.item.Color) &&\n\t\t\t\t\tcharacter &&\n\t\t\t\t\tcheckPermissionAccess(\"curses_color\", character)\n\t\t\t\t) {\n\t\t\t\t\tif (result.item.Color && result.item.Color !== \"Default\") {\n\t\t\t\t\t\tcurse.Color = cloneDeep(result.item.Color);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete curse.Color;\n\t\t\t\t\t}\n\t\t\t\t\tmodStorageSync();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, ModuleCategory.Curses);\n\n\t\thookFunction(\"ColorPickerDraw\", 0, (args, next) => {\n\t\t\tconst Callback = args[5];\n\t\t\tif (Callback === ItemColorOnPickerChange) {\n\t\t\t\targs[5] = (color: any) => {\n\t\t\t\t\tif (ItemColorCharacter === Player && ItemColorItem) {\n\t\t\t\t\t\t// Original code\n\t\t\t\t\t\tconst newColors = ItemColorState.colors.slice();\n\t\t\t\t\t\tItemColorPickerIndices.forEach(i => newColors[i] = color);\n\t\t\t\t\t\tItemColorItem.Color = newColors;\n\t\t\t\t\t\tCharacterLoadCanvas(ItemColorCharacter);\n\t\t\t\t\t\t// Curse color change code\n\t\t\t\t\t\tconst condition = ConditionsGetCondition(\"curses\", ItemColorItem.Asset.Group.Name);\n\t\t\t\t\t\tconst curse = condition?.data;\n\t\t\t\t\t\tif (curse &&\n\t\t\t\t\t\t\t!itemColorsEquals(curse.Color, ItemColorItem.Color) &&\n\t\t\t\t\t\t\tcheckPermissionAccess(\"curses_color\", getPlayerCharacter())\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (ItemColorItem.Color && ItemColorItem.Color !== \"Default\") {\n\t\t\t\t\t\t\t\tcurse.Color = cloneDeep(ItemColorItem.Color);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdelete curse.Color;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmodStorageSync();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tCallback(color);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\t}\n\n\trun() {\n\t\tif (!moduleIsEnabled(ModuleCategory.Curses))\n\t\t\treturn;\n\n\t\tthis.resetTimer = BCX_setInterval(() => {\n\t\t\tthis.triggerCounts.clear();\n\t\t}, CURSES_ANTILOOP_RESET_INTERVAL);\n\t}\n\n\tunload() {\n\t\tif (this.resetTimer !== null) {\n\t\t\tclearInterval(this.resetTimer);\n\t\t\tthis.resetTimer = null;\n\t\t}\n\t\tremoveAllHooksByModule(ModuleCategory.Curses);\n\t}\n\n\treload() {\n\t\tthis.unload();\n\t\tthis.load();\n\t\tthis.run();\n\t}\n\n\tcurseTick(group: string, condition: ConditionsConditionData<\"curses\">): void {\n\t\tif (this.suspendedUntil !== null) {\n\t\t\tif (Date.now() >= this.suspendedUntil) {\n\t\t\t\tthis.suspendedUntil = null;\n\t\t\t\tthis.triggerCounts.clear();\n\t\t\t\tChatRoomActionMessage(`The dormant curse on ${Player.Name}'s body wakes up again.`);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst assetGroup = AssetGroupGet(Player.AssetFamily, group);\n\t\tif (!assetGroup) {\n\t\t\tconsole.error(`BCX: AssetGroup not found for curse ${group}`, condition);\n\t\t\treturn;\n\t\t}\n\n\t\t// Pause curses of clothes while in appearance menu\n\t\tif (CurrentScreen === \"Appearance\" && !isBind(assetGroup))\n\t\t\treturn;\n\n\t\tconst curse = condition.data;\n\n\t\tif (curse === null) {\n\t\t\tconst current = InventoryGet(Player, group);\n\t\t\tif (current) {\n\t\t\t\tInventoryRemove(Player, group, false);\n\t\t\t\tCharacterRefresh(Player, true);\n\t\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\t\tthis.pendingMessages.remove.push(current.Asset.Description);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\n\t\tconst asset = AssetGet(\"Female3DCG\", group, curse.Name);\n\t\tif (!asset) {\n\t\t\tconsole.error(`BCX: Asset not found for curse ${group}:${curse.Name}`, curse);\n\t\t\treturn;\n\t\t}\n\n\t\tlet changeType: \"\" | cursedChange = \"\";\n\n\t\tlet currentItem = InventoryGet(Player, group);\n\n\t\tif (currentItem && currentItem.Asset.Name !== curse.Name) {\n\t\t\tInventoryRemove(Player, group, false);\n\t\t\tchangeType = \"swap\";\n\t\t\tcurrentItem = null;\n\t\t}\n\n\t\tif (!currentItem) {\n\t\t\tcurrentItem = {\n\t\t\t\tAsset: asset,\n\t\t\t\tColor: curse.Color != null ? cloneDeep(curse.Color) : \"Default\",\n\t\t\t\tProperty: curse.Property != null ? cloneDeep(curse.Property) : {},\n\t\t\t\tDifficulty: curse.Difficulty != null ? curse.Difficulty : 0\n\t\t\t};\n\t\t\tPlayer.Appearance.push(currentItem);\n\t\t\tif (!changeType) changeType = \"add\";\n\t\t}\n\n\n\t\tif (curse.curseProperty) {\n\t\t\tconst itemProperty = currentItem.Property = (currentItem.Property ?? {});\n\t\t\tconst curseProperty = curse.Property ?? {};\n\t\t\tfor (const key of arrayUnique(Object.keys(curseProperty).concat(Object.keys(itemProperty)))) {\n\t\t\t\tif (key === \"Effect\")\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (CURSE_IGNORED_PROPERTIES.includes(key)) {\n\t\t\t\t\tdelete curseProperty[key];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (curseProperty[key] === undefined) {\n\t\t\t\t\tif (itemProperty[key] !== undefined) {\n\t\t\t\t\t\tdelete itemProperty[key];\n\t\t\t\t\t\tif (!changeType) changeType = \"update\";\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof curseProperty[key] !== typeof itemProperty[key] ||\n\t\t\t\t\t!isEqual(curseProperty[key], itemProperty[key])\n\t\t\t\t) {\n\t\t\t\t\titemProperty[key] = cloneDeep(curseProperty[key]);\n\t\t\t\t\tif (!changeType) changeType = \"update\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst itemIgnoredEffects = Array.isArray(itemProperty.Effect) ? itemProperty.Effect.filter(i => CURSE_IGNORED_EFFECTS.includes(i)) : [];\n\t\t\tconst itemEffects = Array.isArray(itemProperty.Effect) ? itemProperty.Effect.filter(i => !CURSE_IGNORED_EFFECTS.includes(i)).sort() : [];\n\t\t\tconst curseEffects = Array.isArray(curseProperty.Effect) ? curseProperty.Effect.filter(i => !CURSE_IGNORED_EFFECTS.includes(i)).sort() : [];\n\t\t\tif (!CommonArraysEqual(itemEffects, curseEffects)) {\n\t\t\t\titemProperty.Effect = curseEffects.concat(itemIgnoredEffects);\n\t\t\t}\n\t\t\tif (Object.keys(curseProperty).length === 0) {\n\t\t\t\tdelete curse.Property;\n\t\t\t} else if (!isEqual(curse.Property, curseProperty)) {\n\t\t\t\tcurse.Property = curseProperty;\n\t\t\t}\n\t\t} else {\n\t\t\tcurse.Property = curseCreateCurseItemInfo(currentItem).Property;\n\t\t}\n\n\t\tif (!itemColorsEquals(curse.Color, currentItem.Color)) {\n\t\t\tif (curse.Color === undefined || curse.Color === \"Default\") {\n\t\t\t\tdelete currentItem.Color;\n\t\t\t} else {\n\t\t\t\tcurrentItem.Color = cloneDeep(curse.Color);\n\t\t\t}\n\t\t\tif (!changeType) changeType = \"color\";\n\t\t}\n\n\t\tif (changeType) {\n\t\t\tCharacterRefresh(Player, true);\n\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\tthis.pendingMessages[changeType].push(asset.Description);\n\n\t\t\tconst counter = (this.triggerCounts.get(group) ?? 0) + 1;\n\t\t\tthis.triggerCounts.set(group, counter);\n\n\t\t\tif (counter >= CURSES_ANTILOOP_THRESHOLD) {\n\t\t\t\tChatRoomActionMessage(\"Protection triggered: Curses have been disabled for 10 minutes. Please refrain from triggering curses so rapidly, as it creates strain on the server and may lead to unwanted side effects! If you believe this message was triggered by a bug, please report it to BCX Discord.\");\n\t\t\t\tthis.suspendedUntil = Date.now() + CURSES_ANTILOOP_SUSPEND_TIME;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate afterCurseTick(): void {\n\t\tfor (const changeType of Object.keys(this.pendingMessages) as (cursedChange | \"autoremove\")[]) {\n\t\t\tconst list = this.pendingMessages[changeType];\n\t\t\tif (list.length === 0)\n\t\t\t\tcontinue;\n\t\t\tif (list.length >= 3) {\n\t\t\t\tChatRoomActionMessage(dictionaryProcess(CURSES_TRIGGER_TEXTS_BATCH[changeType], {}));\n\t\t\t\tif (changeType !== \"autoremove\") {\n\t\t\t\t\tlogMessage(\"curse_trigger\", LogEntryType.curseTriggerBatch, changeType);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const item of list) {\n\t\t\t\t\tChatRoomActionMessage(dictionaryProcess(CURSES_TRIGGER_TEXTS[changeType], { ASSET_NAME: item }));\n\t\t\t\t\tif (changeType !== \"autoremove\") {\n\t\t\t\t\t\tlogMessage(\"curse_trigger\", LogEntryType.curseTrigger, [changeType, item]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.pendingMessages[changeType] = [];\n\t\t}\n\t}\n\n\tprivate curseStateChange(curse: string, data: ConditionsConditionData<\"curses\">, newState: boolean): void {\n\t\tif (!newState &&\n\t\t\tdata.data &&\n\t\t\t(data.requirements ? data.data.itemRemove : ConditionsGetCategoryData(\"curses\").data?.itemRemove)\n\t\t) {\n\t\t\t// Removal of cursed item when curse becomes inactive\n\t\t\tconst currentItem = InventoryGet(Player, curse);\n\t\t\t// Only remove if it is the cursed item and it is not locked\n\t\t\tif (currentItem &&\n\t\t\t\tcurrentItem.Asset.Name === data.data.Name &&\n\t\t\t\tInventoryGetLock(currentItem) == null\n\t\t\t) {\n\t\t\t\tInventoryRemove(Player, curse, true);\n\t\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\t\tthis.pendingMessages.autoremove.push(currentItem.Asset.Description);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ChatroomCharacter, getAllCharactersInRoom } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { DrawImageEx, getCharacterName, drawIcon } from \"../utilsClub\";\nimport { AccessLevel } from \"../modules/authority\";\nimport { ConditionsLimit } from \"../constants\";\nimport { capitalizeFirstLetter, formatTimeInterval } from \"../utils\";\nimport { GuiMemberSelect } from \"./member_select\";\nimport { ConditionsEvaluateRequirements } from \"../modules/conditions\";\nimport { icon_star } from \"../resources\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\n\nexport abstract class GuiConditionEdit<CAT extends ConditionsCategories> extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly conditionCategory: CAT;\n\treadonly conditionName: ConditionsCategoryKeys[CAT];\n\treadonly back: GuiSubscreen;\n\n\tprotected conditionCategoryData: ConditionsCategoryPublicData<CAT> | null = null;\n\tprotected conditionData: ConditionsConditionPublicData<CAT> | null = null;\n\n\tprotected failed: boolean = false;\n\n\tprotected changes: ConditionsConditionPublicData<CAT> | null = null;\n\n\tprotected showHelp: boolean = false;\n\n\tconstructor(character: ChatroomCharacter,\n\t\tconditionCategory: CAT,\n\t\tconditionName: ConditionsCategoryKeys[CAT],\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.conditionCategory = conditionCategory;\n\t\tthis.conditionName = conditionName;\n\t\tthis.back = back;\n\t}\n\n\tprotected makeChangesData(): ConditionsConditionPublicData<CAT> {\n\t\tif (!this.conditionData) {\n\t\t\tthrow new Error(\"Data required\");\n\t\t}\n\t\treturn this.changes ?? cloneDeep(this.conditionData);\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.conditionCategoryData = null;\n\t\tthis.conditionData = null;\n\t\tthis.failed = false;\n\t\tthis.onDataChange();\n\t\tthis.character.conditionsGetByCategory(this.conditionCategory).then(res => {\n\t\t\tif (!this.active)\n\t\t\t\treturn;\n\t\t\tconst condition: ConditionsConditionPublicData<CAT> | undefined = res.conditions[this.conditionName];\n\t\t\tif (condition) {\n\t\t\t\tthis.conditionCategoryData = res;\n\t\t\t\tthis.conditionData = condition;\n\t\t\t\tif (!this.checkAccess()) {\n\t\t\t\t\tthis.changes = null;\n\t\t\t\t}\n\t\t\t\tthis.onDataChange();\n\t\t\t} else {\n\t\t\t\tconsole.warn(`BCX: Condition ${this.conditionCategory}:${this.conditionName} not found in list from ${this.character}`);\n\t\t\t\tthis.failed = true;\n\t\t\t\tthis.Exit();\n\t\t\t}\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get condition info for ${this.conditionCategory}:${this.conditionName} from ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprotected setUseGlobal(useGlobal: boolean) {\n\t\tif (!this.changes || !this.conditionData || !this.conditionCategoryData)\n\t\t\treturn;\n\t\tthis.changes.requirements = useGlobal ? null : cloneDeep(this.conditionData.requirements ?? this.conditionCategoryData.requirements);\n\t}\n\n\tprotected onDataChange() {\n\n\t\tlet inputRoomName = document.getElementById(\"BCX_ConditionRoomName\") as HTMLInputElement | undefined;\n\t\tlet inputMemberNumber = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\n\t\tif (!this.conditionCategoryData || !this.conditionData) {\n\t\t\tif (inputRoomName) {\n\t\t\t\tinputRoomName.remove();\n\t\t\t}\n\t\t\tif (inputMemberNumber) {\n\t\t\t\tinputMemberNumber.remove();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst requirements = data.requirements ?? this.conditionCategoryData.requirements;\n\t\tconst useGlobalCategorySetting = !data.requirements;\n\t\tconst access = this.checkAccess();\n\t\tconst disabled = !access || useGlobalCategorySetting;\n\n\t\tif (!inputRoomName) {\n\t\t\tinputRoomName = ElementCreateInput(\"BCX_ConditionRoomName\", \"text\", requirements.roomName?.name ?? \"\", \"30\");\n\t\t\tinputRoomName.oninput = () => {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.processInputs();\n\t\t\t};\n\t\t}\n\t\tif (!inputMemberNumber) {\n\t\t\tinputMemberNumber = ElementCreateInput(\"BCX_ConditionMemberNumber\", \"text\", requirements.player?.memberNumber?.toString() ?? \"0\", \"6\");\n\t\t\tinputMemberNumber.inputMode = \"numeric\";\n\t\t\tinputMemberNumber.pattern = \"[0-9]+\";\n\t\t\tinputMemberNumber.oninput = () => {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.processInputs();\n\t\t\t};\n\t\t}\n\t\tinputRoomName.disabled = disabled || !requirements.roomName;\n\t\tinputMemberNumber.disabled = disabled || !requirements.player;\n\t\tif (!this.changes || disabled || !requirements.roomName) {\n\t\t\tinputRoomName.value = requirements.roomName?.name ?? \"\";\n\t\t}\n\t\tif (!this.changes || disabled || !requirements.player) {\n\t\t\tinputMemberNumber.value = requirements.player?.memberNumber?.toString() ?? \"0\";\n\t\t}\n\t}\n\n\tprotected processInputs() {\n\t\tconst inputRoomName = document.getElementById(\"BCX_ConditionRoomName\") as HTMLInputElement | undefined;\n\t\tconst inputMemberNumber = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\t\tif (this.changes && inputRoomName && inputMemberNumber) {\n\t\t\tif (this.changes.requirements?.roomName) {\n\t\t\t\tthis.changes.requirements.roomName.name = inputRoomName.value;\n\t\t\t}\n\t\t\tif (this.changes.requirements?.player) {\n\t\t\t\tconst memberNumber = inputMemberNumber.value;\n\t\t\t\tif (!memberNumber)\n\t\t\t\t\treturn;\n\t\t\t\tif (/^[0-9]+$/.test(memberNumber)) {\n\t\t\t\t\tthis.changes.requirements.player.memberNumber = Number.parseInt(memberNumber, 10);\n\t\t\t\t} else {\n\t\t\t\t\tinputMemberNumber.value = (this.changes.requirements?.player?.memberNumber ?? 0).toString();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected checkAccess(): boolean {\n\t\tif (!this.conditionCategoryData)\n\t\t\treturn false;\n\t\tconst limit = this.conditionCategoryData.limits[this.conditionName] ?? ConditionsLimit.normal;\n\t\treturn [this.conditionCategoryData.access_normal, this.conditionCategoryData.access_limited, false][limit];\n\t}\n\n\tprotected abstract headerText(): string;\n\n\tRun(): boolean {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tconst addedBy = this.conditionData?.addedBy;\n\t\tDrawText(`- ${this.headerText()} -`, 180, 108, \"Black\", \"Gray\");\n\t\tif (addedBy !== undefined) {\n\t\t\tMainCanvas.save();\n\t\t\tMainCanvas.font = CommonGetFont(26);\n\t\t\tDrawText(`Added by: ${getCharacterName(addedBy, \"[unknown name]\")} (${addedBy})`, 205, 143, \"#444\");\n\t\t\tMainCanvas.restore();\n\t\t}\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tif (this.changes) {\n\t\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Accept.png\", \"Save all changes and go back\");\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Cancel.png\", \"Go back without saving\");\n\t\t} else {\n\t\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\t}\n\n\t\tif (this.conditionCategoryData === null || this.conditionData === null) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(this.failed ? `Failed to get data from ${this.character.Name}. Maybe you have no access?` : \"Loading...\", 1000, 480, \"Black\");\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.changes && this.changes.timer !== null) {\n\t\t\tif (this.changes.timer < Date.now()) {\n\t\t\t\tthis.changes.timer = null;\n\t\t\t\tthis.changes.timerRemove = false;\n\t\t\t\tthis.changes.active = !this.changes.active;\n\t\t\t} else if (!this.changes.active) {\n\t\t\t\tthis.changes.timerRemove = false;\n\t\t\t}\n\t\t}\n\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst requirements = data.requirements ?? this.conditionCategoryData.requirements;\n\t\tconst useGlobalCategorySetting = !data.requirements;\n\t\tconst access = this.checkAccess();\n\t\tconst disabled = !access || useGlobalCategorySetting;\n\n\t\t// favorite toggle\n\t\tconst color = !access ? \"#ddd\" : data.favorite ? \"Yellow\" : \"White\";\n\t\tdrawIcon(MainCanvas, icon_star, 105, 91, 60, 60, 24, 1, 1.5, color, access && MouseIn(93, 80, 85, 80) ? \"Cyan\" : \"black\");\n\n\t\t// Spacer\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(98, 272);\n\t\tMainCanvas.lineTo(960, 272);\n\t\tMainCanvas.strokeStyle = \"Gray\";\n\t\tMainCanvas.stroke();\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(98, 540);\n\t\tMainCanvas.lineTo(960, 540);\n\t\tMainCanvas.stroke();\n\n\t\t// on-off toggle\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawCheckbox(125, 180, 64, 64, `This ${this.conditionCategory.slice(0, -1)} is active and can trigger`, data.active, !access);\n\n\t\t// global-category-configuration-is-active highlighting\n\t\tif (useGlobalCategorySetting) {\n\t\t\tMainCanvas.fillStyle = \"#0052A3\";\n\t\t\tMainCanvas.fillRect(526, 546, 418, 68);\n\t\t\tMainCanvas.fillRect(120, 615, 74, 74);\n\t\t\tMainCanvas.fillRect(120, 695, 74, 74);\n\t\t\tMainCanvas.fillRect(120, 775, 74, 74);\n\t\t\tMainCanvas.fillRect(120, 855, 74, 74);\n\t\t}\n\n\t\t////// status and timer area\n\t\tMainCanvas.textAlign = \"center\";\n\t\tlet statusText: string;\n\t\tif (data.timer === null) {\n\t\t\tstatusText = \"Timer disabled\";\n\t\t} else {\n\t\t\tstatusText = `${data.active ? 'Deactivates' : 'Activates'} in: ${formatTimeInterval(data.timer - Date.now())}`;\n\t\t}\n\t\tDrawText(statusText, 530, 311, data.active || !data.timer ? \"Black\" : \"#060\");\n\n\t\tif (data.timer === null) {\n\t\t\tDrawButton(120, 360, 820, 160, \"Enable timer\", \"White\");\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t} else {\n\t\t\tDrawButton(120, 360, 85, 60, \"-1d\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 1 day from the timer\", !access);\n\t\t\tDrawButton(120 + 125, 360, 85, 60, \"-1h\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 1 hour from the timer\", !access);\n\t\t\tDrawButton(120 + 2 * (125), 360, 85, 60, \"-5m\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 5 minutes from the timer\", !access);\n\t\t\tDrawButton(120 + 3 * (125), 360, 70, 60, \"\", !access ? \"#ddd\" : \"White\", \"\", \"Disable the timer\", !access);\n\t\t\tDrawButton(105 + 4 * (125), 360, 85, 60, \"+5m\", !access ? \"#ddd\" : \"White\", \"\", \"Add 5 minutes to the timer\", !access);\n\t\t\tDrawButton(105 + 5 * (125), 360, 85, 60, \"+1h\", !access ? \"#ddd\" : \"White\", \"\", \"Add 1 hour to the timer\", !access);\n\t\t\tDrawButton(105 + 6 * (125), 360, 85, 60, \"+1d\", !access ? \"#ddd\" : \"White\", \"\", \"Add 1 day to the timer\", !access);\n\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tif (data.active) {\n\t\t\t\tDrawCheckbox(125, 450, 64, 64, `Delete the ${this.conditionCategory.slice(0, -1)} when timer runs out`, data.timerRemove, !access);\n\t\t\t}\n\t\t}\n\n\t\t////// condition factors area\n\t\tDrawText(`${capitalizeFirstLetter(this.conditionCategory.slice(0, -1))} trigger conditions:`, 130, 580, \"Black\", \"\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tconst hasAnyRequirement = !!(requirements.room || requirements.roomName || requirements.role || requirements.player);\n\t\tDrawButton(530, 550, 410, 60, hasAnyRequirement ? (requirements.orLogic ? \"Any selected below\" : \"All selected below\") : \"Always in effect\", disabled || !hasAnyRequirement ? \"#ddd\" : \"White\", \"\", \"\", disabled || !hasAnyRequirement);\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tMainCanvas.fillStyle = ConditionsEvaluateRequirements(requirements, this.conditionCategoryData.highestRoleInRoom) ? \"#00FF22\" : \"#AA0000\";\n\t\tMainCanvas.fillRect(80, 620, 15, 304);\n\n\t\t// In room\n\t\tDrawCheckbox(125, 620, 64, 64, \"when\", !!requirements.room, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 622, 115, 60, requirements.room?.inverted ? \"not in\" : \"in\", disabled || !requirements.room ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.room);\n\t\tDrawButton(324 + 115 + 14, 622, 130, 60, requirements.room?.type === \"private\" ? \"private\" : \"public\", disabled || !requirements.room ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.room);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room`, 324 + 115 + 14 + 130 + 14, 620 + 32, \"Black\", \"Gray\");\n\t\tif (requirements.room) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst chatroomPrivate = inChatroom && ChatRoomData && ChatRoomData.Private;\n\t\t\tconst res = inChatroom &&\n\t\t\t\t(requirements.room.type === \"public\" ? !chatroomPrivate : chatroomPrivate);\n\t\t\tMainCanvas.fillStyle = (requirements.room.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 620, 15, 64);\n\t\t}\n\n\t\t// In room named\n\t\tDrawCheckbox(125, 700, 64, 64, \"when\", !!requirements.roomName, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 702, 115, 60, requirements.roomName?.inverted ? \"not in\" : \"in\", disabled || !requirements.roomName ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.roomName);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room named`, 324 + 115 + 14, 700 + 32, \"Black\", \"Gray\");\n\t\tElementPosition(\"BCX_ConditionRoomName\", 324 + 115 + 14 + 360, 700 + 26, 285, 60);\n\t\tif (requirements.roomName) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst res = inChatroom &&\n\t\t\t\tChatRoomData &&\n\t\t\t\ttypeof ChatRoomData.Name === \"string\" &&\n\t\t\t\tChatRoomData.Name.toLocaleLowerCase() === requirements.roomName.name.toLocaleLowerCase();\n\t\t\tMainCanvas.fillStyle = (requirements.roomName.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 700, 15, 64);\n\t\t}\n\n\t\t// In presence of role\n\t\tDrawCheckbox(125, 780, 64, 64, \"when\", !!requirements.role, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 782, 115, 60, requirements.role?.inverted ? \"not in\" : \"in\", disabled || !requirements.role ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.role);\n\t\tconst roleSelection = requirements.role?.role ?? AccessLevel.mistress;\n\t\tconst roleSelectionNext = roleSelection < AccessLevel.public ? roleSelection + 1 : AccessLevel.clubowner;\n\t\tconst roleSelectionPrev = roleSelection > AccessLevel.clubowner ? roleSelection - 1 : AccessLevel.public;\n\t\tDrawBackNextButton(324 + 115 + 14 + 242, 782, 244, 60,\n\t\t\tcapitalizeFirstLetter(AccessLevel[roleSelection]) + (roleSelection !== AccessLevel.clubowner ? \" \" : \"\"),\n\t\t\tdisabled || !requirements.role ? \"#ddd\" : \"White\", \"\",\n\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionPrev]),\n\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionNext]),\n\t\t\tdisabled || !requirements.role\n\t\t);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room with role`, 324 + 115 + 14, 780 + 32, \"Black\", \"Gray\");\n\t\tif (requirements.role) {\n\t\t\tconst res = this.conditionCategoryData.highestRoleInRoom != null && this.conditionCategoryData.highestRoleInRoom <= requirements.role.role;\n\t\t\tMainCanvas.fillStyle = (requirements.role.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 780, 15, 64);\n\t\t}\n\n\t\t// In presence of player\n\t\tDrawCheckbox(125, 860, 64, 64, \"when\", !!requirements.player, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 862, 115, 60, requirements.player?.inverted ? \"not in\" : \"in\", disabled || !requirements.player ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.player);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room with member`, 324 + 115 + 14, 860 + 32, \"Black\", \"Gray\");\n\t\tElementPositionFix(\"BCX_ConditionMemberNumber\", 40, 768, 860, 162, 60);\n\t\tDrawButton(950, 862, 64, 64, \"\", disabled || !requirements.player ? \"#ddd\" : \"White\", undefined, undefined, disabled || !requirements.player);\n\t\tDrawImageEx(\"Icons/Title.png\", 952, 864, { Width: 60, Height: 60 });\n\t\tif (requirements.player) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst res = inChatroom &&\n\t\t\t\tgetAllCharactersInRoom().some(c => c.MemberNumber === requirements.player!.memberNumber);\n\t\t\tMainCanvas.fillStyle = (requirements.player.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 860, 15, 64);\n\t\t\tconst input = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\t\t\tif (input && document.activeElement === input) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tif (!requirements.player)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tconst Left = 957;\n\t\t\t\t\tconst Top = 858;\n\t\t\t\t\tMainCanvas.fillStyle = \"#FFFF88\";\n\t\t\t\t\tMainCanvas.fillRect(Left, Top, 450, 65);\n\t\t\t\t\tMainCanvas.lineWidth = 2;\n\t\t\t\t\tMainCanvas.strokeStyle = 'black';\n\t\t\t\t\tMainCanvas.strokeRect(Left, Top, 450, 65);\n\t\t\t\t\tDrawTextFit(getCharacterName(requirements.player.memberNumber, \"[unknown]\"), Left + 225, Top + 33, 444, \"black\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\n\t\t////// global category configuration toggle\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.rect(1190, 830, 720, 104);\n\t\tMainCanvas.strokeStyle = \"#0052A3\";\n\t\tMainCanvas.stroke();\n\t\tDrawCheckbox(1210, 850, 64, 64, `Set to global ${this.conditionCategory} configuration`, useGlobalCategorySetting, !access);\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.ellipse(1877 + 33, 800 + 30, 22, 22, 360, 0, 360);\n\t\tMainCanvas.fillStyle = \"#0052A3\";\n\t\tMainCanvas.fill();\n\t\tDrawImageEx(\"Icons/General.png\", 1877 + 10, 800 + 7, {\n\t\t\tHeight: 46,\n\t\t\tWidth: 46\n\t\t});\n\n\t\t// hover text for timer behavior toggle\n\t\tMainCanvas.textAlign = \"center\";\n\t\tif (data.timer !== null && MouseIn(125, 450, 80, 64)) DrawButtonHover(125, 450, 64, 64, `Removes ${this.conditionCategory.slice(0, -1)} instead of only deactivating it `);\n\n\t\t// hover text for global configuration category toggle\n\t\tif (MouseIn(1190, 830, 100, 104)) DrawButtonHover(1786, 854, 64, 64, `Overwrites current trigger conditions`);\n\n\t\t// hover text for member selector\n\t\tif (MouseIn(950, 862, 64, 64)) DrawButtonHover(950, 782, 4, 64, `Select member number from list`);\n\n\t\t// hover text for favorite toggle\n\t\tif (MouseIn(93, 80, 85, 80)) DrawButtonHover(93, 80, 80, 80, `Favorite: Listed first in overview`);\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (MouseIn(1815, 75, 90, 90)) {\n\t\t\tif (this.changes) {\n\t\t\t\tthis.processInputs();\n\t\t\t\tthis.character.conditionUpdate(this.conditionCategory, this.conditionName, this.changes);\n\t\t\t}\n\t\t\tthis.Exit();\n\t\t\treturn true;\n\t\t}\n\n\t\t// Cancel\n\t\tif (this.changes && MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.Exit();\n\t\t\treturn true;\n\t\t}\n\n\t\t// help text\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.conditionCategoryData === null || this.conditionData === null)\n\t\t\treturn true;\n\n\t\tif (!this.checkAccess())\n\t\t\treturn false;\n\n\t\tconst data = this.changes ?? this.conditionData;\n\n\t\t// on-off toggle\n\t\tif (MouseIn(125, 180, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.active = !this.changes.active;\n\t\t\tthis.changes.timer = null;\n\t\t\tthis.changes.timerRemove = false;\n\t\t\treturn true;\n\t\t}\n\n\t\t// favorite toggle\n\t\tif (MouseIn(93, 80, 85, 80)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.favorite = !this.changes.favorite;\n\t\t\treturn true;\n\t\t}\n\n\n\t\t////// status and timer area\n\t\tif (data.timer === null) {\n\t\t\t// Enable timer\n\t\t\tif (MouseIn(120, 360, 820, 160)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer = Date.now() + 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// -1d\n\t\t\tif (MouseIn(120, 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 1 * 24 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// -1h\n\t\t\tif (MouseIn(120 + 125, 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 1 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// -5m\n\t\t\tif (MouseIn(120 + 2 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// Disable timer\n\t\t\tif (MouseIn(120 + 3 * (125), 360, 70, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer = null;\n\t\t\t\tthis.changes.timerRemove = false;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +5m\n\t\t\tif (MouseIn(105 + 4 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +1h\n\t\t\tif (MouseIn(105 + 5 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 1 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +1d\n\t\t\tif (MouseIn(105 + 6 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 1 * 24 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Timer remove toggle\n\t\t\tif (MouseIn(125, 450, 64, 64) && data.active) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timerRemove = !this.changes.timerRemove;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t////// condition factors area\n\t\tconst useGlobalCategorySetting = !(this.changes ? this.changes.requirements : this.conditionData.requirements);\n\t\tconst requirements = (this.changes ? this.changes.requirements : this.conditionData.requirements) ?? this.conditionCategoryData.requirements;\n\n\t\tif (MouseIn(530, 550, 410, 60) && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.orLogic = this.changes.requirements!.orLogic ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In room\n\t\tif (MouseIn(125, 620, 64, 64) && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room = this.changes.requirements!.room ? undefined : { type: \"public\" };\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 622, 115, 60) && !useGlobalCategorySetting && requirements.room) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room!.inverted = this.changes.requirements!.room!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324 + 115 + 14, 622, 130, 60) && !useGlobalCategorySetting && requirements.room) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room!.type = this.changes.requirements!.room!.type === \"public\" ? \"private\" : \"public\";\n\t\t\treturn true;\n\t\t}\n\n\t\t// In room named\n\t\tif (MouseIn(125, 700, 64, 64) && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.roomName = this.changes.requirements!.roomName ? undefined : { name: \"\" };\n\t\t\tthis.onDataChange();\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 702, 115, 60) && !useGlobalCategorySetting && requirements.roomName) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.roomName!.inverted = this.changes.requirements!.roomName!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In presence of role\n\t\tif (MouseIn(125, 780, 64, 64) && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role = this.changes.requirements!.role ? undefined : { role: AccessLevel.mistress };\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 782, 115, 60) && !useGlobalCategorySetting && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.inverted = this.changes.requirements!.role!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\t\tconst roleSelection = requirements.role?.role ?? AccessLevel.mistress;\n\t\tif (MouseIn(324 + 115 + 14 + 274, 782, 106, 60) && !useGlobalCategorySetting && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.role = roleSelection > AccessLevel.clubowner ? roleSelection - 1 : AccessLevel.public;\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324 + 115 + 14 + 274 + 106, 782, 106, 60) && !useGlobalCategorySetting && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.role = roleSelection < AccessLevel.public ? roleSelection + 1 : AccessLevel.clubowner;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In presence of player\n\t\tif (MouseIn(125, 860, 64, 64) && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.player = this.changes.requirements!.player ? undefined : { memberNumber: 0 };\n\t\t\tthis.onDataChange();\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 862, 115, 60) && !useGlobalCategorySetting && requirements.player) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.player!.inverted = this.changes.requirements!.player!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(950, 862, 64, 64) && !useGlobalCategorySetting && requirements.player) {\n\t\t\tsetSubscreen(new GuiMemberSelect(this.character, this, result => {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.requirements!.player!.memberNumber = result;\n\t\t\t}));\n\t\t\treturn true;\n\t\t}\n\n\n\t\t////// global category configuration toggle\n\t\tif (MouseIn(1210, 850, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.setUseGlobal(!!this.changes.requirements);\n\t\t\tthis.onDataChange();\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n\n\tUnload() {\n\t\tElementRemove(\"BCX_ConditionRoomName\");\n\t\tElementRemove(\"BCX_ConditionMemberNumber\");\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { curseAllowItemCurseProperty, curseDefaultItemCurseProperty } from \"../modules/curses\";\nimport { getVisibleGroupName, showHelp } from \"../utilsClub\";\nimport { GuiConditionEdit } from \"./conditions_edit_base\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\n\nexport class GuiConditionEditCurses extends GuiConditionEdit<\"curses\"> {\n\n\tprivate item: Asset | null = null;\n\tprivate allowSettingsCurse: boolean = false;\n\n\tconstructor(character: ChatroomCharacter,\n\t\tconditionName: ConditionsCategoryKeys[\"curses\"],\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper(character, \"curses\", conditionName, back);\n\t}\n\n\tprotected override headerText(): string {\n\t\tconst group = AssetGroup.find(i => i.Name === this.conditionName);\n\t\treturn `View / Edit the '${group ? getVisibleGroupName(group) : \"[ERROR]\"}' curse`;\n\t}\n\n\tprotected override setUseGlobal(useGlobal: boolean) {\n\t\tsuper.setUseGlobal(useGlobal);\n\n\t\tif (!this.changes || !this.conditionData || !this.conditionCategoryData)\n\t\t\treturn;\n\n\t\tif (this.changes?.data) {\n\t\t\tthis.changes.data.itemRemove = useGlobal ? false : this.conditionCategoryData.data.itemRemove;\n\t\t}\n\t}\n\n\tprotected override onDataChange() {\n\t\tsuper.onDataChange();\n\n\t\tif (!this.conditionCategoryData || !this.conditionData) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.conditionData.data) {\n\t\t\tthis.item = AssetGet(this.character.Character.AssetFamily, this.conditionName, this.conditionData.data.Name);\n\t\t\tthis.allowSettingsCurse = this.conditionData.data.curseProperties || !this.item || curseAllowItemCurseProperty(this.item);\n\t\t} else {\n\t\t\tthis.item = null;\n\t\t\tthis.allowSettingsCurse = false;\n\t\t}\n\n\t\tif (this.changes && this.changes.data?.Name !== this.conditionData.data?.Name) {\n\t\t\tthis.changes.data = cloneDeep(this.conditionData.data);\n\t\t}\n\t}\n\n\tRun(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null || this.conditionData === null)\n\t\t\treturn true;\n\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst useGlobalCategorySetting = !data.requirements;\n\t\tconst itemRemove = !!(useGlobalCategorySetting ? this.conditionCategoryData.data.itemRemove : data.data?.itemRemove);\n\t\tconst access = this.checkAccess();\n\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\t////// right side: special curse category options\n\t\tif (data.data) {\n\t\t\tif (useGlobalCategorySetting) {\n\t\t\t\tMainCanvas.fillStyle = \"#0052A3\";\n\t\t\t\tMainCanvas.fillRect(1045, 100, 74, 74);\n\t\t\t}\n\t\t\tDrawCheckbox(1050, 105, 64, 64, \"Remove the item when the curse\", itemRemove, !access || useGlobalCategorySetting);\n\t\t\tMainCanvas.save();\n\t\t\tMainCanvas.font = CommonGetFont(28);\n\t\t\tDrawText(\"becomes inactive, removed, or is no longer\", 1152, 185, \"Black\");\n\t\t\tDrawText(\"triggering - does not remove locked items\", 1152, 225, \"Black\");\n\t\t\tMainCanvas.restore();\n\t\t}\n\t\tif (this.allowSettingsCurse && data.data) {\n\t\t\tDrawCheckbox(1050, 265, 64, 64, \"Also curse the item's configuration\", data.data.curseProperties, !access);\n\t\t\tMainCanvas.save();\n\t\t\tMainCanvas.font = CommonGetFont(28);\n\t\t\tDrawText(`Example: which rope tie is used`, 1151, 347, \"Black\", \"\");\n\t\t\tMainCanvas.restore();\n\t\t\tif (this.item && !curseDefaultItemCurseProperty(this.item)) {\n\t\t\t\tMainCanvas.save();\n\t\t\t\tMainCanvas.font = CommonGetFont(30);\n\t\t\t\tDrawTextWrap(\n\t\t\t\t\t\"Warning: This item is not standardized and some or all of its configuration states could behave in unexpected ways \" +\n\t\t\t\t\t\"if they are cursed with the above checkbox. Please assume most of them will not work correctly. \" +\n\t\t\t\t\t\"Issues could range from respawning with a different configuration to the curse triggering randomly all the time. \" +\n\t\t\t\t\t\"As some of these items do work (partially), the option to curse the configuration is still offered.\",\n\t\t\t\t\t1051 - 860 / 2, 365, 860, 400, \"FireBrick\");\n\t\t\t\tMainCanvas.restore();\n\t\t\t}\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.ConditionsEditCurses]);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null || this.conditionData === null)\n\t\t\treturn true;\n\n\t\tif (!this.checkAccess())\n\t\t\treturn false;\n\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst useGlobalCategorySetting = !(this.changes ? this.changes.requirements : data.requirements);\n\n\t\tif (MouseIn(1050, 105, 64, 64) && data.data && !useGlobalCategorySetting) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.data!.itemRemove = !this.changes.data!.itemRemove;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (MouseIn(1050, 265, 64, 64) && this.allowSettingsCurse && data.data) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.data!.curseProperties = !this.changes.data!.curseProperties;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { ChatroomCharacter, getAllCharactersInRoom } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { getCharacterName } from \"../utilsClub\";\nimport { AccessLevel } from \"../modules/authority\";\nimport { capitalizeFirstLetter, formatTimeInterval } from \"../utils\";\nimport { ConditionsEvaluateRequirements } from \"../modules/conditions\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\n\nexport abstract class GuiConditionGlobal<CAT extends ConditionsCategories> extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly conditionCategory: CAT;\n\treadonly back: GuiSubscreen;\n\n\tprotected conditionCategoryData: ConditionsCategoryPublicData<CAT> | null = null;\n\n\tprotected failed: boolean = false;\n\n\tprotected showHelp: boolean = false;\n\n\tprotected changes: ConditionsCategoryConfigurableData | null = null;\n\n\tconstructor(character: ChatroomCharacter,\n\t\tconditionCategory: CAT,\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.conditionCategory = conditionCategory;\n\t\tthis.back = back;\n\t}\n\n\tprotected makeChangesData(): ConditionsCategoryConfigurableData {\n\t\tif (!this.conditionCategoryData) {\n\t\t\tthrow new Error(\"Data required\");\n\t\t}\n\t\treturn this.changes ?? {\n\t\t\trequirements: cloneDeep(this.conditionCategoryData.requirements),\n\t\t\ttimer: this.conditionCategoryData.timer,\n\t\t\ttimerRemove: this.conditionCategoryData.timerRemove,\n\t\t\tdata: cloneDeep(this.conditionCategoryData.data)\n\t\t};\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.conditionCategoryData = null;\n\t\tthis.failed = false;\n\t\tthis.onDataChange();\n\t\tthis.character.conditionsGetByCategory(this.conditionCategory).then(res => {\n\t\t\tif (!this.active)\n\t\t\t\treturn;\n\t\t\tthis.conditionCategoryData = res;\n\t\t\tif (!this.checkAccess()) {\n\t\t\t\tthis.changes = null;\n\t\t\t}\n\t\t\tthis.onDataChange();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get condition info for ${this.conditionCategory} from ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprotected onDataChange() {\n\n\t\tlet inputRoomName = document.getElementById(\"BCX_ConditionRoomName\") as HTMLInputElement | undefined;\n\t\tlet inputMemberNumber = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\n\t\tif (!this.conditionCategoryData) {\n\t\t\tif (inputRoomName) {\n\t\t\t\tinputRoomName.remove();\n\t\t\t}\n\t\t\tif (inputMemberNumber) {\n\t\t\t\tinputMemberNumber.remove();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst data = this.changes ?? this.conditionCategoryData;\n\t\tconst requirements = data.requirements;\n\t\tconst access = this.checkAccess();\n\t\tconst disabled = !access;\n\n\t\tif (!inputRoomName) {\n\t\t\tinputRoomName = ElementCreateInput(\"BCX_ConditionRoomName\", \"text\", requirements.roomName?.name ?? \"\", \"30\");\n\t\t\tinputRoomName.oninput = () => {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.processInputs();\n\t\t\t};\n\t\t}\n\t\tif (!inputMemberNumber) {\n\t\t\tinputMemberNumber = ElementCreateInput(\"BCX_ConditionMemberNumber\", \"text\", requirements.player?.memberNumber?.toString() ?? \"0\", \"6\");\n\t\t\tinputMemberNumber.inputMode = \"numeric\";\n\t\t\tinputMemberNumber.pattern = \"[0-9]+\";\n\t\t\tinputMemberNumber.oninput = () => {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.processInputs();\n\t\t\t};\n\t\t}\n\t\tinputRoomName.disabled = disabled || !requirements.roomName;\n\t\tinputMemberNumber.disabled = disabled || !requirements.player;\n\t\tif (!this.changes || disabled || !requirements.roomName) {\n\t\t\tinputRoomName.value = requirements.roomName?.name ?? \"\";\n\t\t}\n\t\tif (!this.changes || disabled || !requirements.player) {\n\t\t\tinputMemberNumber.value = requirements.player?.memberNumber?.toString() ?? \"0\";\n\t\t}\n\t}\n\n\tprotected processInputs() {\n\t\tconst inputRoomName = document.getElementById(\"BCX_ConditionRoomName\") as HTMLInputElement | undefined;\n\t\tconst inputMemberNumber = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\t\tif (this.changes && inputRoomName && inputMemberNumber) {\n\t\t\tif (this.changes.requirements?.roomName) {\n\t\t\t\tthis.changes.requirements.roomName.name = inputRoomName.value;\n\t\t\t}\n\t\t\tif (this.changes.requirements?.player) {\n\t\t\t\tconst memberNumber = inputMemberNumber.value;\n\t\t\t\tif (!memberNumber)\n\t\t\t\t\treturn;\n\t\t\t\tif (/^[0-9]+$/.test(memberNumber)) {\n\t\t\t\t\tthis.changes.requirements.player.memberNumber = Number.parseInt(memberNumber, 10);\n\t\t\t\t} else {\n\t\t\t\t\tinputMemberNumber.value = (this.changes.requirements?.player?.memberNumber ?? 0).toString();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected checkAccess(): boolean {\n\t\tif (!this.conditionCategoryData)\n\t\t\treturn false;\n\t\treturn this.conditionCategoryData.access_configure;\n\t}\n\n\tprotected abstract headerText(): string;\n\n\tRun(): boolean {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- ${this.headerText()} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tif (this.changes) {\n\t\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Accept.png\", \"Save all changes and go back\");\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Cancel.png\", \"Go back without saving\");\n\t\t} else {\n\t\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\t\t}\n\n\t\tif (this.conditionCategoryData === null) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(this.failed ? `Failed to get data from ${this.character.Name}. Maybe you have no access?` : \"Loading...\", 1000, 480, \"Black\");\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.changes && this.changes.timer !== null && this.changes.timer <= 0) {\n\t\t\tthis.changes.timer = null;\n\t\t\tthis.changes.timerRemove = false;\n\t\t}\n\n\t\tconst data = this.changes ?? this.conditionCategoryData;\n\t\tconst requirements = data.requirements;\n\t\tconst access = this.checkAccess();\n\t\tconst disabled = !access;\n\n\t\t// Spacer\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(98, 272);\n\t\tMainCanvas.lineTo(960, 272);\n\t\tMainCanvas.strokeStyle = \"Gray\";\n\t\tMainCanvas.stroke();\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(98, 540);\n\t\tMainCanvas.lineTo(960, 540);\n\t\tMainCanvas.stroke();\n\n\t\t////// status and timer area\n\t\tMainCanvas.textAlign = \"center\";\n\t\tlet statusText: string;\n\t\tif (data.timer === null) {\n\t\t\tstatusText = \"Timer disabled by default\";\n\t\t} else {\n\t\t\tstatusText = `Default timer: ${formatTimeInterval(data.timer)}`;\n\t\t}\n\t\tDrawText(statusText, 530, 311, \"Black\");\n\n\t\tif (data.timer === null) {\n\t\t\tDrawButton(120, 360, 820, 160, \"Enable timer\", \"White\");\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t} else {\n\t\t\tDrawButton(120, 360, 85, 60, \"-1d\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 1 day from the timer\", !access);\n\t\t\tDrawButton(120 + 125, 360, 85, 60, \"-1h\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 1 hour from the timer\", !access);\n\t\t\tDrawButton(120 + 2 * (125), 360, 85, 60, \"-5m\", !access ? \"#ddd\" : \"White\", \"\", \"Remove 5 minutes from the timer\", !access);\n\t\t\tDrawButton(120 + 3 * (125), 360, 70, 60, \"\", !access ? \"#ddd\" : \"White\", \"\", \"Set lifetime to infinite\", !access);\n\t\t\tDrawButton(105 + 4 * (125), 360, 85, 60, \"+5m\", !access ? \"#ddd\" : \"White\", \"\", \"Add 5 minutes to the timer\", !access);\n\t\t\tDrawButton(105 + 5 * (125), 360, 85, 60, \"+1h\", !access ? \"#ddd\" : \"White\", \"\", \"Add 1 hour to the timer\", !access);\n\t\t\tDrawButton(105 + 6 * (125), 360, 85, 60, \"+1d\", !access ? \"#ddd\" : \"White\", \"\", \"Add 1 day to the timer\", !access);\n\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tDrawCheckbox(125, 450, 64, 64, `Remove the ${this.conditionCategory.slice(0, -1)} when timer runs out`, data.timerRemove, !access);\n\t\t}\n\n\t\t////// condition factors area\n\t\tDrawText(`${capitalizeFirstLetter(this.conditionCategory.slice(0, -1))} trigger conditions:`, 130, 580, \"Black\", \"\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tconst hasAnyRequirement = !!(requirements.room || requirements.roomName || requirements.role || requirements.player);\n\t\tDrawButton(530, 550, 410, 60, hasAnyRequirement ? (requirements.orLogic ? \"Any selected below\" : \"All selected below\") : \"Always in effect\", disabled || !hasAnyRequirement ? \"#ddd\" : \"White\", \"\", \"\", disabled || !hasAnyRequirement);\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tMainCanvas.fillStyle = ConditionsEvaluateRequirements(requirements, this.conditionCategoryData.highestRoleInRoom) ? \"#00FF22\" : \"#AA0000\";\n\t\tMainCanvas.fillRect(75, 620, 15, 304);\n\n\t\t// In room\n\t\tDrawCheckbox(125, 620, 64, 64, \"when\", !!requirements.room, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 622, 115, 60, requirements.room?.inverted ? \"not in\" : \"in\", disabled || !requirements.room ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.room);\n\t\tDrawButton(324 + 115 + 14, 622, 130, 60, requirements.room?.type === \"private\" ? \"private\" : \"public\", disabled || !requirements.room ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.room);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room`, 324 + 115 + 14 + 130 + 14, 620 + 32, \"Black\", \"Gray\");\n\t\tif (requirements.room) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst chatroomPrivate = inChatroom && ChatRoomData && ChatRoomData.Private;\n\t\t\tconst res = inChatroom &&\n\t\t\t\t(requirements.room.type === \"public\" ? !chatroomPrivate : chatroomPrivate);\n\t\t\tMainCanvas.fillStyle = (requirements.room.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 620, 15, 64);\n\t\t}\n\n\t\t// In room named\n\t\tDrawCheckbox(125, 700, 64, 64, \"when\", !!requirements.roomName, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 702, 115, 60, requirements.roomName?.inverted ? \"not in\" : \"in\", disabled || !requirements.roomName ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.roomName);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room named`, 324 + 115 + 14, 700 + 32, \"Black\", \"Gray\");\n\t\tElementPosition(\"BCX_ConditionRoomName\", 324 + 115 + 14 + 360, 700 + 26, 285, 60);\n\t\tif (requirements.roomName) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst res = inChatroom &&\n\t\t\t\tChatRoomData &&\n\t\t\t\ttypeof ChatRoomData.Name === \"string\" &&\n\t\t\t\tChatRoomData.Name.toLocaleLowerCase() === requirements.roomName.name.toLocaleLowerCase();\n\t\t\tMainCanvas.fillStyle = (requirements.roomName.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 700, 15, 64);\n\t\t}\n\n\t\t// In presence of role\n\t\tDrawCheckbox(125, 780, 64, 64, \"when\", !!requirements.role, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 782, 115, 60, requirements.role?.inverted ? \"not in\" : \"in\", disabled || !requirements.role ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.role);\n\t\tconst roleSelection = requirements.role?.role ?? AccessLevel.mistress;\n\t\tconst roleSelectionNext = roleSelection < AccessLevel.public ? roleSelection + 1 : AccessLevel.clubowner;\n\t\tconst roleSelectionPrev = roleSelection > AccessLevel.clubowner ? roleSelection - 1 : AccessLevel.public;\n\t\tDrawBackNextButton(324 + 115 + 14 + 242, 782, 244, 60,\n\t\t\tcapitalizeFirstLetter(AccessLevel[roleSelection]) + (roleSelection !== AccessLevel.clubowner ? \" \" : \"\"),\n\t\t\tdisabled || !requirements.role ? \"#ddd\" : \"White\", \"\",\n\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionPrev]),\n\t\t\t() => capitalizeFirstLetter(AccessLevel[roleSelectionNext]),\n\t\t\tdisabled || !requirements.role\n\t\t);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room with role`, 324 + 115 + 14, 780 + 32, \"Black\", \"Gray\");\n\t\tif (requirements.role) {\n\t\t\tconst res = this.conditionCategoryData.highestRoleInRoom != null && this.conditionCategoryData.highestRoleInRoom <= requirements.role.role;\n\t\t\tMainCanvas.fillStyle = (requirements.role.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 780, 15, 64);\n\t\t}\n\n\t\t// In presence of player\n\t\tDrawCheckbox(125, 860, 64, 64, \"when\", !!requirements.player, disabled);\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(324, 862, 115, 60, requirements.player?.inverted ? \"not in\" : \"in\", disabled || !requirements.player ? \"#ddd\" : \"White\", \"\", \"\", disabled || !requirements.player);\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`room with member`, 324 + 115 + 14, 860 + 32, \"Black\", \"Gray\");\n\t\tElementPositionFix(\"BCX_ConditionMemberNumber\", 40, 768, 860, 162, 60);\n\t\tif (requirements.player) {\n\t\t\tconst inChatroom = ServerPlayerIsInChatRoom();\n\t\t\tconst res = inChatroom &&\n\t\t\t\tgetAllCharactersInRoom().some(c => c.MemberNumber === requirements.player!.memberNumber);\n\t\t\tMainCanvas.fillStyle = (requirements.player.inverted ? !res : res) ? \"#00FF22\" : \"#AA0000\";\n\t\t\tMainCanvas.fillRect(95, 860, 15, 64);\n\t\t\tconst input = document.getElementById(\"BCX_ConditionMemberNumber\") as HTMLInputElement | undefined;\n\t\t\tif (input && document.activeElement === input) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tif (!requirements.player)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tconst Left = 957;\n\t\t\t\t\tconst Top = 858;\n\t\t\t\t\tMainCanvas.fillStyle = \"#FFFF88\";\n\t\t\t\t\tMainCanvas.fillRect(Left, Top, 450, 65);\n\t\t\t\t\tMainCanvas.lineWidth = 2;\n\t\t\t\t\tMainCanvas.strokeStyle = 'black';\n\t\t\t\t\tMainCanvas.strokeRect(Left, Top, 450, 65);\n\t\t\t\t\tDrawTextFit(getCharacterName(requirements.player.memberNumber, \"[unknown]\"), Left + 225, Top + 33, 444, \"black\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// hover text for timer behavior toggle\n\t\tMainCanvas.textAlign = \"center\";\n\t\tif (data.timer !== null && MouseIn(125, 450, 80, 64)) DrawButtonHover(125, 450, 64, 64, `Removes ${this.conditionCategory.slice(0, -1)} instead of only deactivating it `);\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (MouseIn(1815, 75, 90, 90)) {\n\t\t\tif (this.changes) {\n\t\t\t\tthis.processInputs();\n\t\t\t\tthis.character.conditionCategoryUpdate(this.conditionCategory, this.changes);\n\t\t\t}\n\t\t\tthis.Exit();\n\t\t\treturn true;\n\t\t}\n\n\t\t// Cancel\n\t\tif (this.changes && MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.Exit();\n\t\t\treturn true;\n\t\t}\n\n\t\t// help text\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tif (!this.checkAccess())\n\t\t\treturn false;\n\n\t\tconst data = this.changes ?? this.conditionCategoryData;\n\n\t\t////// status and timer area\n\t\tif (data.timer === null) {\n\t\t\t// Enable timer\n\t\t\tif (MouseIn(120, 360, 820, 160)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer = 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\t// -1d\n\t\t\tif (MouseIn(120, 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 1 * 24 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// -1h\n\t\t\tif (MouseIn(120 + 125, 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 1 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// -5m\n\t\t\tif (MouseIn(120 + 2 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! -= 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// Disable timer\n\t\t\tif (MouseIn(120 + 3 * (125), 360, 70, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer = null;\n\t\t\t\tthis.changes.timerRemove = false;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +5m\n\t\t\tif (MouseIn(105 + 4 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 5 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +1h\n\t\t\tif (MouseIn(105 + 5 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 1 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t// +1d\n\t\t\tif (MouseIn(105 + 6 * (125), 360, 85, 60)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timer! += 1 * 24 * 60 * 60 * 1000;\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Timer remove toggle\n\t\t\tif (MouseIn(125, 450, 64, 64)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.timerRemove = !this.changes.timerRemove;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\n\t\t////// condition factors area\n\t\tconst requirements = data.requirements;\n\n\t\tif (MouseIn(530, 550, 410, 60)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.orLogic = this.changes.requirements!.orLogic ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In room\n\t\tif (MouseIn(125, 620, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room = this.changes.requirements!.room ? undefined : { type: \"public\" };\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 622, 115, 60) && requirements.room) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room!.inverted = this.changes.requirements!.room!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324 + 115 + 14, 622, 130, 60) && requirements.room) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.room!.type = this.changes.requirements!.room!.type === \"public\" ? \"private\" : \"public\";\n\t\t\treturn true;\n\t\t}\n\n\t\t// In room named\n\t\tif (MouseIn(125, 700, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.roomName = this.changes.requirements!.roomName ? undefined : { name: \"\" };\n\t\t\tthis.onDataChange();\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 702, 115, 60) && requirements.roomName) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.roomName!.inverted = this.changes.requirements!.roomName!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In presence of role\n\t\tif (MouseIn(125, 780, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role = this.changes.requirements!.role ? undefined : { role: AccessLevel.mistress };\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 782, 115, 60) && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.inverted = this.changes.requirements!.role!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\t\tconst roleSelection = requirements.role?.role ?? AccessLevel.mistress;\n\t\tif (MouseIn(324 + 115 + 14 + 274, 782, 106, 60) && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.role = roleSelection > AccessLevel.clubowner ? roleSelection - 1 : AccessLevel.public;\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324 + 115 + 14 + 274 + 106, 782, 106, 60) && requirements.role) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.role!.role = roleSelection < AccessLevel.public ? roleSelection + 1 : AccessLevel.clubowner;\n\t\t\treturn true;\n\t\t}\n\n\t\t// In presence of player\n\t\tif (MouseIn(125, 860, 64, 64)) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.player = this.changes.requirements!.player ? undefined : { memberNumber: 0 };\n\t\t\tthis.onDataChange();\n\t\t\treturn true;\n\t\t}\n\t\tif (MouseIn(324, 862, 115, 60) && requirements.player) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.requirements!.player!.inverted = this.changes.requirements!.player!.inverted ? undefined : true;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n\n\tUnload() {\n\t\tElementRemove(\"BCX_ConditionRoomName\");\n\t\tElementRemove(\"BCX_ConditionMemberNumber\");\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiConditionGlobal } from \"./conditions_global_base\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { showHelp } from \"../utilsClub\";\n\nexport class GuiConditionGlobalCurses extends GuiConditionGlobal<\"curses\"> {\n\n\tconstructor(character: ChatroomCharacter,\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper(character, \"curses\", back);\n\t}\n\n\tprotected override headerText(): string {\n\t\treturn `View / Edit the global ${this.conditionCategory} configuration`;\n\t}\n\n\tRun(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`Note: Settings are applied to new curses and all existing ones set to the global config.`, 130, 210, \"Black\", \"\");\n\n\t\tconst data = this.changes ?? this.conditionCategoryData;\n\t\tconst access = this.checkAccess();\n\n\t\t////// right side: special curse category options\n\t\tif (data.data) {\n\t\t\tDrawCheckbox(1050, 267, 64, 64, \"Remove the item when the curse\", data.data.itemRemove, !access);\n\t\t\tMainCanvas.save();\n\t\t\tMainCanvas.font = CommonGetFont(28);\n\t\t\tDrawText(\"becomes inactive, removed, or is no longer\", 1152, 347, \"Black\");\n\t\t\tDrawText(\"triggering - does not remove locked items\", 1152, 387, \"Black\");\n\t\t\tMainCanvas.restore();\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.ConditionsGlobalCurses]);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tif (!this.checkAccess())\n\t\t\treturn false;\n\n\t\tconst data = this.changes ?? this.conditionCategoryData;\n\n\t\tif (MouseIn(1050, 267, 64, 64) && data.data) {\n\t\t\tthis.changes = this.makeChangesData();\n\t\t\tthis.changes.data!.itemRemove = !this.changes.data!.itemRemove;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { clamp, formatTimeInterval } from \"../utils\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport { ConditionsLimit } from \"../constants\";\n\nconst PER_COLUMN_COUNT = 7;\nconst PER_PAGE_COUNT = PER_COLUMN_COUNT * 2;\n\nexport interface ConditionEntry<CAT extends ConditionsCategories, ExtraData> {\n\tdisplayName: string;\n\tcondition: string;\n\taccess: boolean;\n\tdata: ConditionsConditionPublicData<CAT>;\n\textra: ExtraData\n}\n\nexport abstract class GuiConditionView<CAT extends ConditionsCategories, ExtraData> extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly conditionCategory: CAT;\n\treadonly conditionCategorySingular: string;\n\n\tprivate conditionEntries: ConditionEntry<CAT, ExtraData>[] = [];\n\tprotected conditionCategoryData: ConditionsCategoryPublicData<CAT> | null = null;\n\tprivate failed: boolean = false;\n\tprivate page: number = 0;\n\n\tprotected showHelp: boolean = false;\n\n\tconstructor(character: ChatroomCharacter,\n\t\tconditionCategory: CAT\n\t) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.conditionCategory = conditionCategory;\n\t\tthis.conditionCategorySingular = conditionCategory.slice(0, -1);\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.conditionCategoryData = null;\n\t\tthis.failed = false;\n\t\tthis.onDataChange();\n\t\tthis.character.conditionsGetByCategory(this.conditionCategory).then(res => {\n\t\t\tif (!this.active)\n\t\t\t\treturn;\n\t\t\tthis.conditionCategoryData = res;\n\t\t\tthis.onDataChange();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get condition info for ${this.conditionCategory} from ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate onDataChange() {\n\t\tif (!this.active) return;\n\n\t\tthis.conditionEntries = [];\n\n\t\tif (this.conditionCategoryData === null)\n\t\t\treturn;\n\n\t\tfor (const [condition, data] of Object.entries<ConditionsConditionPublicData<CAT>>(this.conditionCategoryData.conditions)) {\n\t\t\tconst res = this.loadCondition(condition as ConditionsCategoryKeys[CAT], data);\n\t\t\tif (res === null)\n\t\t\t\tcontinue;\n\n\t\t\tconst access = [this.conditionCategoryData.access_normal, this.conditionCategoryData.access_limited, false][this.conditionCategoryData.limits[condition as ConditionsCategoryKeys[CAT]] ?? ConditionsLimit.normal];\n\n\t\t\tthis.conditionEntries.push({\n\t\t\t\tcondition,\n\t\t\t\taccess,\n\t\t\t\tdata,\n\t\t\t\tdisplayName: res[0],\n\t\t\t\textra: res[1]\n\t\t\t});\n\t\t}\n\n\t\tthis.conditionEntries.sort((a, b) => (!a.data.favorite && b.data.favorite) ? 1 : ((a.data.favorite && !b.data.favorite) ? -1 : 0));\n\n\t\tthis.page = clamp(this.page, 0, Math.ceil(this.conditionEntries.length / PER_PAGE_COUNT));\n\t}\n\n\tRun(): boolean {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- ${this.headerText()} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"BCX main menu\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\n\t\tif (this.conditionCategoryData === null) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(this.failed ? `Failed to get data from ${this.character.Name}. Maybe you have no access?` : \"Loading...\", 1000, 480, \"Black\");\n\t\t\treturn true;\n\t\t}\n\n\t\t// Column separator\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.moveTo(953, 160);\n\t\tMainCanvas.lineTo(953, 780);\n\t\tMainCanvas.stroke();\n\n\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\tif (i >= this.conditionEntries.length) break;\n\t\t\tconst e = this.conditionEntries[i];\n\n\t\t\tconst Y = 170 + (off % PER_COLUMN_COUNT) * 90;\n\t\t\tconst X = 120 + Math.floor(off / PER_COLUMN_COUNT) * 865;\n\n\t\t\tconst useGlobalCategorySetting = !e.data.requirements;\n\n\t\t\t// description detailed hover text\n\t\t\tif (\n\t\t\t\t(off + 1) % PER_COLUMN_COUNT === 0 ||\t\t// smaller click area for an element at the end of a full column\n\t\t\t\t\ti === this.conditionEntries.length - 1 ?\t// smaller click area for the last element on the list\n\t\t\t\t\tMouseIn(X, Y, 440, 60) : MouseIn(X, Y, 440, 90)\n\t\t\t) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tthis.showDetailedDescriptionBackground(off < PER_COLUMN_COUNT ? 985 : 120);\n\t\t\t\t\tif (MouseIn(X, Y, 440, 60)) {\n\t\t\t\t\t\tthis.showDetailedDescriptionText(off < PER_COLUMN_COUNT ? 985 : 120, e.condition as ConditionsCategoryKeys[CAT], e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// description\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tDrawButton(X, Y, 440, 60, \"\", \"White\");\n\t\t\tthis.drawCategoryImage(X, Y, e);\n\t\t\tDrawTextFit(e.displayName, X + 65, Y + 30, 365, \"Black\");\n\n\t\t\t// config button info\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawButton(X + 470, Y, 240, 60, \"\", e.data.active ? \"#d8fed7\" : \"White\");\n\t\t\tif (useGlobalCategorySetting) {\n\t\t\t\tMainCanvas.beginPath();\n\t\t\t\tMainCanvas.ellipse(X + 470 + 33, Y + 30, 22, 22, 360, 0, 360);\n\t\t\t\tMainCanvas.fillStyle = \"#0052A3\";\n\t\t\t\tMainCanvas.fill();\n\t\t\t}\n\t\t\tDrawImageEx(\"Icons/General.png\", X + 480, Y + 7, {\n\t\t\t\tHeight: 46,\n\t\t\t\tWidth: 46\n\t\t\t});\n\t\t\t// shows time left (XXd -> XXh -> XXm -> XXs) or \n\t\t\tlet timeLeftText: string = \"n/a\";\n\t\t\tif (e.data.timer === null) {\n\t\t\t\ttimeLeftText = \"\";\n\t\t\t} else {\n\t\t\t\ttimeLeftText = formatTimeInterval(e.data.timer - Date.now(), \"short\");\n\t\t\t}\n\t\t\tDrawText(timeLeftText, X + 570, Y + 30, \"Black\", \"\");\n\t\t\tthis.drawEntryExtra(X, Y, e);\n\n\t\t\t// remove curse\n\t\t\tif (e.access) {\n\t\t\t\tDrawButton(X + 740, Y, 60, 60, \"X\", \"White\", \"\", this.removeLabel);\n\t\t\t}\n\n\t\t\tif (MouseIn(X + 470, Y, 60, 60)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 470, Y, 60, 60, `Change this ${this.conditionCategorySingular}'s configuration`);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (MouseIn(X + 531, Y, 78, 60)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 531, Y, 78, 60, `Remaining duration of the ${this.conditionCategorySingular}`);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tDrawButton(968, 820, 605, 90, \"\", this.conditionCategoryData.access_configure ? \"White\" : \"#ddd\", \"\",\n\t\t\tthis.conditionCategoryData.access_configure ? `Existing ${this.conditionCategory} set to global ${this.conditionCategory} config are also changed` : \"You have no permission to use this\", !this.conditionCategoryData.access_configure);\n\t\tDrawText(`Change global ${this.conditionCategory} config`, 968 + 680 / 2, 865, \"Black\", \"\");\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.ellipse(968 + 10 + 35, 820 + 44, 34, 34, 360, 0, 360);\n\t\tMainCanvas.fillStyle = \"#0052A3\";\n\t\tMainCanvas.fill();\n\t\tDrawImageEx(\"Icons/General.png\", 968 + 10, 820 + 10, {\n\t\t\tHeight: 70,\n\t\t\tWidth: 70\n\t\t});\n\n\t\t// Pagination\n\t\tconst totalPages = Math.ceil(this.conditionEntries.length / PER_PAGE_COUNT);\n\t\tDrawBackNextButton(1605, 820, 300, 90, `Page ${this.page + 1} / ${Math.max(totalPages, 1)}`, \"White\", \"\", () => \"\", () => \"\");\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (MouseIn(1815, 75, 90, 90)) {\n\t\t\tthis.Exit();\n\t\t\treturn true;\n\t\t}\n\n\t\t// help text\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\tif (i >= this.conditionEntries.length) break;\n\t\t\tconst e = this.conditionEntries[i];\n\n\t\t\tconst Y = 170 + (off % PER_COLUMN_COUNT) * 90;\n\t\t\tconst X = 120 + Math.floor(off / PER_COLUMN_COUNT) * 865;\n\n\t\t\t// description\n\t\t\tif (MouseIn(X, Y, 440, 60)) {\n\t\t\t\tthis.onDescriptionTextClick(e.condition as ConditionsCategoryKeys[CAT], e);\n\t\t\t}\n\n\t\t\t// config button info\n\t\t\tif (MouseIn(X + 470, Y, 240, 60)) {\n\t\t\t\tthis.openEditSubscreen(e.condition as ConditionsCategoryKeys[CAT]);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (e.access && MouseIn(X + 740, Y, 60, 60)) {\n\t\t\t\tthis.removeCondition(e.condition as ConditionsCategoryKeys[CAT]);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.conditionCategoryData.access_configure && MouseIn(968, 820, 605, 90)) {\n\t\t\tthis.openGlobalConfig();\n\t\t\treturn true;\n\t\t}\n\n\t\t// Pagination\n\t\tconst totalPages = Math.ceil(this.conditionEntries.length / PER_PAGE_COUNT);\n\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\tthis.page--;\n\t\t\tif (this.page < 0) {\n\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t}\n\t\t\treturn true;\n\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\tthis.page++;\n\t\t\tif (this.page >= totalPages) {\n\t\t\t\tthis.page = 0;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiMainMenu(this.character));\n\t}\n\n\tprotected abstract removeLabel: string;\n\n\tprotected abstract drawCategoryImage(X: number, Y: number, data: ConditionEntry<CAT, ExtraData>): void;\n\tprotected abstract drawEntryExtra(X: number, Y: number, data: ConditionEntry<CAT, ExtraData>): void;\n\n\tprotected abstract headerText(): string;\n\tprotected abstract loadCondition(condition: ConditionsCategoryKeys[CAT], data: ConditionsConditionPublicData<CAT>): [string, ExtraData] | null;\n\tprotected abstract showDetailedDescriptionBackground(X: number): void;\n\tprotected abstract showDetailedDescriptionText(X: number, condition: ConditionsCategoryKeys[CAT], data: ConditionEntry<CAT, ExtraData>): void;\n\tprotected abstract onDescriptionTextClick(condition: ConditionsCategoryKeys[CAT], data: ConditionEntry<CAT, ExtraData>): void;\n\tprotected abstract openEditSubscreen(condition: ConditionsCategoryKeys[CAT]): void;\n\tprotected abstract removeCondition(condition: ConditionsCategoryKeys[CAT]): void;\n\tprotected abstract openGlobalConfig(): void;\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { getVisibleGroupName, showHelp } from \"../utilsClub\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { ConditionsLimit } from \"../constants\";\nimport { GuiConditionViewCurses } from \"./conditions_view_curses\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\n\nexport class GuiCursesAdd extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate curseData: ConditionsCategoryPublicData<\"curses\"> | null = null;\n\tprivate failed: boolean = false;\n\tprivate permissionMode: boolean = false;\n\n\tprivate showHelp: boolean = false;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.curseData = null;\n\t\tthis.character.conditionsGetByCategory(\"curses\").then(res => {\n\t\t\tthis.curseData = res;\n\t\t\tif (!this.curseData.access_changeLimits) {\n\t\t\t\tthis.permissionMode = false;\n\t\t\t}\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get permission info for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Curses: Place new curses on ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\n\t\tif (this.curseData === null) {\n\t\t\tDrawText(this.failed ? `Failed to get curse data from ${this.character.Name}. Maybe you have no access?` : \"Loading...\", 1000, 480, \"Black\");\n\t\t\treturn;\n\t\t}\n\n\t\tDrawButton(1815, 305, 90, 90, \"\",\n\t\t\tthis.curseData.access_changeLimits ? \"White\" : \"#ddd\",\n\t\t\tthis.permissionMode ? \"Icons/Reset.png\" : \"Icons/Preference.png\",\n\t\t\tthis.curseData.access_changeLimits ?\n\t\t\t\t(this.permissionMode ? \"Leave permission mode\" : \"Edit curse slot permissions\") :\n\t\t\t\t\"You have no permission to change limits\",\n\t\t\t!this.curseData.access_changeLimits\n\t\t);\n\n\t\t// items\n\t\tMainCanvas.textAlign = \"left\";\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.rect(105, 165, 830, 64);\n\t\tMainCanvas.fillStyle = \"#cccccc\";\n\t\tMainCanvas.fill();\n\t\tDrawText(`Items`, 120, 165 + 34, \"Black\");\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tif (!this.permissionMode) {\n\t\t\tDrawButton(440, 173, 265, 48, \"Curse occupied\", \"White\", undefined, \"Curse all items on the body at once\");\n\t\t\tDrawButton(720, 173, 200, 48, \"Curse all\", \"White\", undefined, \"Curse all item slots at once\");\n\t\t}\n\n\t\tconst AssetGroupItems = AssetGroup.filter(g => g.Category === \"Item\");\n\t\tfor (let i = 0; i < AssetGroupItems.length; i++) {\n\t\t\tconst row = i % 10;\n\t\t\tconst column = Math.floor(i / 10);\n\t\t\tconst group = AssetGroupItems[i];\n\n\t\t\tconst currentItem = InventoryGet(this.character.Character, group.Name);\n\n\t\t\tconst itemIsCursed = this.curseData.conditions[group.Name] !== undefined;\n\t\t\tconst accessLevel = this.curseData.limits[group.Name] ?? ConditionsLimit.normal;\n\t\t\tconst allowCurse = [this.curseData.access_normal, this.curseData.access_limited, false][accessLevel];\n\t\t\tlet color: string;\n\t\t\tlet text: string;\n\t\t\tif (this.permissionMode) {\n\t\t\t\tcolor = [\"#50ff56\", \"#f6fe78\", \"#ffa7a7 \"][accessLevel];\n\t\t\t\ttext = [\"Normal\", \"Limited\", \"Blocked\"][accessLevel];\n\t\t\t} else {\n\t\t\t\tcolor = itemIsCursed ? \"#88c\" :\n\t\t\t\t\t!allowCurse ? \"#ccc\" :\n\t\t\t\t\t\t(currentItem ? \"Gold\" : \"White\");\n\t\t\t\ttext = itemIsCursed ? \"Already cursed\" :\n\t\t\t\t\t!allowCurse ? \"You have no permission to curse this\" :\n\t\t\t\t\t\t(currentItem ? currentItem.Asset.Description : \"Nothing\");\n\t\t\t}\n\n\t\t\tDrawButton(106 + 281 * column, 240 + 69 * row, 265, 54, getVisibleGroupName(group),\n\t\t\t\tcolor, undefined,\n\t\t\t\ttext, itemIsCursed || !allowCurse || this.permissionMode);\n\t\t}\n\n\t\t// clothing\n\t\tMainCanvas.textAlign = \"left\";\n\t\tMainCanvas.beginPath();\n\t\tMainCanvas.rect(950, 165, 830, 64);\n\t\tMainCanvas.fillStyle = \"#cccccc\";\n\t\tMainCanvas.fill();\n\t\tDrawText(`Clothing`, 965, 165 + 34, \"Black\");\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tif (!this.permissionMode) {\n\t\t\tDrawButton(1285, 173, 265, 48, \"Curse occupied\", \"White\", undefined, \"Curse all clothes on the body at once\");\n\t\t\tDrawButton(1565, 173, 200, 48, \"Curse all\", \"White\", undefined, \"Curse all clothing slots at once\");\n\t\t}\n\n\t\tconst AssetGroupClothings = AssetGroup.filter(g => g.Category === \"Appearance\" && g.Clothing);\n\t\tfor (let i = 0; i < AssetGroupClothings.length; i++) {\n\t\t\tconst row = i % 10;\n\t\t\tconst column = Math.floor(i / 10);\n\t\t\tconst group = AssetGroupClothings[i];\n\n\t\t\tconst currentItem = InventoryGet(this.character.Character, group.Name);\n\n\t\t\tconst clothingIsCursed = this.curseData.conditions[group.Name] !== undefined;\n\t\t\tconst accessLevel = this.curseData.limits[group.Name] ?? ConditionsLimit.normal;\n\t\t\tconst allowCurse = [this.curseData.access_normal, this.curseData.access_limited, false][accessLevel];\n\t\t\tlet color: string;\n\t\t\tlet text: string;\n\t\t\tif (this.permissionMode) {\n\t\t\t\tcolor = [\"#50ff56\", \"#f6fe78\", \"#ffa7a7 \"][accessLevel];\n\t\t\t\ttext = [\"Normal\", \"Limited\", \"Blocked\"][accessLevel];\n\t\t\t} else {\n\t\t\t\tcolor = clothingIsCursed ? \"#88c\" :\n\t\t\t\t\t!allowCurse ? \"#ccc\" :\n\t\t\t\t\t\t(currentItem ? \"Gold\" : \"White\");\n\t\t\t\ttext = clothingIsCursed ? \"Already cursed\" :\n\t\t\t\t\t!allowCurse ? \"You have no permission to curse this\" :\n\t\t\t\t\t\t(currentItem ? currentItem.Asset.Description : \"Nothing\");\n\t\t\t}\n\t\t\tDrawButton(951 + 281 * column, 240 + 69 * row, 265, 54, getVisibleGroupName(group),\n\t\t\t\tcolor, undefined,\n\t\t\t\ttext, clothingIsCursed || !allowCurse || this.permissionMode);\n\t\t}\n\n\t\t//Body\n\t\t// TODO: Actual data\n\n\t\t// const bodyIsCursed = false;\n\t\t// DrawButton(1600, 750, 300, 140, \"Character Body\", bodyIsCursed ? \"#ccc\" : \"White\", undefined,\n\t\t//\tbodyIsCursed ? \"Already cursed\" : \"Size, skin color, eyes, etc.\", bodyIsCursed);\n\n\t\t// permission mode legend\n\t\tif (this.permissionMode) {\n\t\t\tMainCanvas.fillStyle = \"#50ff56\";\n\t\t\tMainCanvas.fillRect(1284, 75, 166, 64);\n\t\t\tMainCanvas.fillStyle = \"#f6fe78\";\n\t\t\tMainCanvas.fillRect(1284 + 1 * 166, 75, 166, 64);\n\t\t\tMainCanvas.fillStyle = \"#ffa7a7\";\n\t\t\tMainCanvas.fillRect(1284 + 2 * 166, 75, 165, 64);\n\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Normal`, 1284 + 166 / 2, 75 + 34, \"Black\");\n\t\t\tDrawText(`Limited`, 1284 + 1 * 166 + 166 / 2, 75 + 34, \"Black\");\n\t\t\tDrawText(`Blocked`, 1284 + 2 * 166 + 166 / 2, 75 + 34, \"Black\");\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[this.permissionMode ? Views.CursesAddPermissionMode : Views.CursesAdd]);\n\t\t}\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.curseData === null)\n\t\t\treturn;\n\n\t\t// Permission mode\n\t\tif (MouseIn(1815, 305, 90, 90)) {\n\t\t\tthis.permissionMode = this.curseData.access_changeLimits && !this.permissionMode;\n\t\t\treturn;\n\t\t}\n\n\t\t// items\n\n\t\tconst AssetGroupItems = AssetGroup.filter(g => g.Category === \"Item\");\n\t\tfor (let i = 0; i < AssetGroupItems.length; i++) {\n\t\t\tconst row = i % 10;\n\t\t\tconst column = Math.floor(i / 10);\n\t\t\tconst group = AssetGroupItems[i];\n\n\t\t\tconst itemIsCursed = this.curseData.conditions[group.Name] !== undefined;\n\n\t\t\tif (MouseIn(106 + 281 * column, 240 + 69 * row, 265, 54)) {\n\t\t\t\tif (this.permissionMode) {\n\t\t\t\t\tconst accessLevel = this.curseData.limits[group.Name] ?? ConditionsLimit.normal;\n\t\t\t\t\tthis.character.conditionSetLimit(\"curses\", group.Name, (accessLevel + 1) % 3);\n\t\t\t\t} else if (!itemIsCursed) {\n\t\t\t\t\tthis.character.curseItem(group.Name, null);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (MouseIn(440, 173, 265, 48) && !this.permissionMode) {\n\t\t\tthis.character.curseBatch(\"items\", false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (MouseIn(720, 173, 200, 48) && !this.permissionMode) {\n\t\t\tthis.character.curseBatch(\"items\", true);\n\t\t\treturn;\n\t\t}\n\n\t\t// clothing\n\n\t\tconst AssetGroupClothings = AssetGroup.filter(g => g.Category === \"Appearance\" && g.Clothing);\n\t\tfor (let i = 0; i < AssetGroupClothings.length; i++) {\n\t\t\tconst row = i % 10;\n\t\t\tconst column = Math.floor(i / 10);\n\t\t\tconst group = AssetGroupClothings[i];\n\n\t\t\tconst clothingIsCursed = this.curseData.conditions[group.Name] !== undefined;\n\n\t\t\tif (MouseIn(951 + 281 * column, 240 + 69 * row, 265, 54)) {\n\t\t\t\tif (this.permissionMode) {\n\t\t\t\t\tconst accessLevel = this.curseData.limits[group.Name] ?? ConditionsLimit.normal;\n\t\t\t\t\tthis.character.conditionSetLimit(\"curses\", group.Name, (accessLevel + 1) % 3);\n\t\t\t\t} else if (!clothingIsCursed) {\n\t\t\t\t\tthis.character.curseItem(group.Name, null);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (MouseIn(1285, 173, 265, 48) && !this.permissionMode) {\n\t\t\tthis.character.curseBatch(\"clothes\", false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (MouseIn(1565, 173, 200, 48) && !this.permissionMode) {\n\t\t\tthis.character.curseBatch(\"clothes\", true);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiConditionViewCurses(this.character));\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { curseAllowItemCurseProperty } from \"../modules/curses\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { DrawImageEx, getVisibleGroupName, showHelp } from \"../utilsClub\";\nimport { GuiConditionEditCurses } from \"./conditions_edit_curses\";\nimport { GuiConditionGlobalCurses } from \"./conditions_global_curses\";\nimport { ConditionEntry, GuiConditionView } from \"./conditions_view_base\";\nimport { GuiCursesAdd } from \"./curses_add\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\n\ninterface CurseEntry {\n\ttype: \"clothing\" | \"item\";\n\tpropertiesCursed?: boolean;\n\tpropertiesCursedShow?: boolean;\n}\n\ntype dataEntry = ConditionEntry<\"curses\", CurseEntry>;\n\nexport class GuiConditionViewCurses extends GuiConditionView<\"curses\", CurseEntry> {\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper(character, \"curses\");\n\t}\n\n\toverride Run(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tDrawButton(120, 820, 384, 90, \"Add new curse\", \"White\", \"\",\n\t\t\t\"Place new curses on body, items or clothes\");\n\n\t\tconst access = this.conditionCategoryData.access_normal || this.conditionCategoryData.access_limited;\n\t\tDrawButton(536, 820, 400, 90, \"Lift all curses\", access ? \"White\" : \"#ddd\", \"\",\n\t\t\taccess ? \"Remove all curses on body, items or clothes\" : \"You have no permission to use this\", !access);\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.ConditionsViewCurses]);\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride Click(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tif (MouseIn(120, 820, 384, 90)) {\n\t\t\tsetSubscreen(new GuiCursesAdd(this.character));\n\t\t\treturn true;\n\t\t}\n\n\t\tconst access = this.conditionCategoryData.access_normal || this.conditionCategoryData.access_limited;\n\t\tif (access && MouseIn(536, 820, 400, 90)) {\n\t\t\tthis.character.curseLiftAll();\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprotected removeLabel: string = \"Lift curse\";\n\n\tprotected drawCategoryImage(X: number, Y: number, data: dataEntry): void {\n\t\tDrawImageEx(data.extra.type === \"clothing\" ? \"Icons/Dress.png\" : \"Assets/Female3DCG/ItemArms/Preview/NylonRope.png\", X + 6, Y + 6, {\n\t\t\tHeight: 50,\n\t\t\tWidth: 50\n\t\t});\n\t}\n\n\tprotected drawEntryExtra(X: number, Y: number, data: dataEntry): void {\n\t\tconst useGlobalCategorySetting = !data.data.requirements;\n\t\tconst itemRemove = useGlobalCategorySetting ? this.conditionCategoryData?.data.itemRemove : data.data.data?.itemRemove;\n\n\t\tif (itemRemove !== undefined && data.data.data) {\n\t\t\tDrawImageEx(\"Icons/Remove.png\", X + 610, Y + 10, {\n\t\t\t\tHeight: 40,\n\t\t\t\tWidth: 40,\n\t\t\t\tAlpha: itemRemove ? 1 : 0.2\n\t\t\t});\n\t\t\tif (MouseIn(X + 610, Y + 6, 44, 44)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 610, Y + 6, 44, 44, itemRemove ? \"Remove item when curse is dormant\" : \"Don't remove item when curse is dormant\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (data.extra.propertiesCursedShow) {\n\t\t\tDrawImageEx(data.extra.propertiesCursed ? \"Icons/Lock.png\" : \"Icons/Unlock.png\", X + 660, Y + 10, {\n\t\t\t\tHeight: 40,\n\t\t\t\tWidth: 40,\n\t\t\t\tAlpha: data.extra.propertiesCursed ? 1 : 0.2\n\t\t\t});\n\t\t\tif (MouseIn(X + 660, Y + 6, 44, 44)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 660, Y + 6, 44, 44, data.extra.propertiesCursed ? \"Item configuration cursed\" : \"Item configuration not cursed\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t}\n\n\tprotected headerText(): string {\n\t\treturn `Curses: All active curses on ${this.character.Name}`;\n\t}\n\n\tprotected loadCondition(condition: ConditionsCategoryKeys[\"curses\"], data: ConditionsConditionPublicData<\"curses\">): [string, CurseEntry] | null {\n\t\tconst group = AssetGroup.find(g => g.Name === condition);\n\t\tif (!group) {\n\t\t\tconsole.warn(`BCX: Unknown group ${condition}`);\n\t\t\treturn null;\n\t\t}\n\t\tif (data.data === null) {\n\t\t\treturn [`Blocked: ${getVisibleGroupName(group)}`, {\n\t\t\t\ttype: group.Clothing ? \"clothing\" : \"item\"\n\t\t\t}];\n\t\t} else {\n\t\t\tconst item = AssetGet(this.character.Character.AssetFamily, condition, data.data.Name);\n\t\t\treturn [`${item?.Description ?? data.data.Name} (${getVisibleGroupName(group)})`, {\n\t\t\t\ttype: group.Clothing ? \"clothing\" : \"item\",\n\t\t\t\tpropertiesCursed: data.data.curseProperties,\n\t\t\t\tpropertiesCursedShow: data.data.curseProperties || !item || curseAllowItemCurseProperty(item)\n\t\t\t}];\n\t\t}\n\t}\n\n\tprotected showDetailedDescriptionBackground(X: number): void {\n\t\treturn;\n\t}\n\n\tprotected showDetailedDescriptionText(X: number, condition: ConditionsCategoryKeys[\"curses\"], data: dataEntry): void {\n\t\treturn;\n\t}\n\n\tprotected onDescriptionTextClick(condition: ConditionsCategoryKeys[\"curses\"], data: dataEntry): void {\n\t\treturn;\n\t}\n\n\tprotected openEditSubscreen(condition: ConditionsCategoryKeys[\"curses\"]): void {\n\t\tsetSubscreen(new GuiConditionEditCurses(this.character, condition, this));\n\t}\n\n\tprotected removeCondition(condition: ConditionsCategoryKeys[\"curses\"]): void {\n\t\tthis.character.curseLift(condition);\n\t}\n\n\tprotected openGlobalConfig(): void {\n\t\tsetSubscreen(new GuiConditionGlobalCurses(this.character, this));\n\t}\n}","import { ChatroomCharacter } from \"../characters\";\nimport { GuiConditionEdit } from \"./conditions_edit_base\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { RuleCustomDataHandler, ruleCustomDataHandlers, RulesGetDisplayDefinition } from \"../modules/rules\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\n\nexport class GuiConditionEditRules extends GuiConditionEdit<\"rules\"> {\n\n\tprivate definition: RuleDisplayDefinition;\n\n\tconstructor(character: ChatroomCharacter,\n\t\tconditionName: ConditionsCategoryKeys[\"rules\"],\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper(character, \"rules\", conditionName, back);\n\t\tthis.definition = RulesGetDisplayDefinition(conditionName);\n\t}\n\n\tprotected override headerText(): string {\n\t\treturn `View / Edit the '${this.definition.name}' rule`;\n\t}\n\n\tprotected override onDataChange() {\n\t\tsuper.onDataChange();\n\n\t\tconst active = !!this.conditionCategoryData && !!this.conditionData;\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst access = this.checkAccess();\n\n\t\tif (this.definition.dataDefinition) {\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(this.definition.dataDefinition)) {\n\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\t\thandler.onDataChange?.({\n\t\t\t\t\tdef: v,\n\t\t\t\t\tactive,\n\t\t\t\t\tkey: k,\n\t\t\t\t\tonInput: () => {\n\t\t\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\t\t\tthis.processInputs();\n\t\t\t\t\t},\n\t\t\t\t\tvalue: data?.data.customData![k] ?? (typeof v.default === \"function\" ? v.default() : v.default),\n\t\t\t\t\taccess\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t}\n\n\tprotected override processInputs() {\n\t\tsuper.processInputs();\n\n\t\tif (this.changes && this.definition.dataDefinition) {\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(this.definition.dataDefinition)) {\n\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\t\tif (handler.processInput) {\n\t\t\t\t\tconst res = handler.processInput({\n\t\t\t\t\t\tdef: v,\n\t\t\t\t\t\tkey: k,\n\t\t\t\t\t\tvalue: this.changes.data.customData![k]\n\t\t\t\t\t});\n\t\t\t\t\tif (res !== undefined) {\n\t\t\t\t\t\tif (!handler.validate(res, v)) {\n\t\t\t\t\t\t\tconsole.error(\"processInput result failed to validate\", res, v);\n\t\t\t\t\t\t\tthrow new Error(\"processInput result failed to validate\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.changes.data.customData![k] = res;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tRun(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null || this.conditionData === null)\n\t\t\treturn true;\n\n\t\tconst data = this.changes ?? this.conditionData;\n\t\tconst access = this.checkAccess();\n\n\t\tMainCanvas.textAlign = \"left\";\n\n\t\tlet Y = 175;\n\n\t\t////// right side: special rules category options\n\t\tif (this.definition.enforceable !== false) {\n\t\t\tDrawCheckbox(1050, Y, 64, 64, \"Enforce this rule\", data.data.enforce, !access);\n\t\t\tY += 100;\n\t\t}\n\t\tif (this.definition.loggable !== false) {\n\t\t\tDrawCheckbox(1050, Y, 64, 64, \"Behaviour log entry when rule is violated\", data.data.log, !access);\n\t\t\tY += 100;\n\t\t}\n\n\t\tY += 45;\n\n\t\tif (this.definition.dataDefinition) {\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(this.definition.dataDefinition)) {\n\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\t\thandler.run({\n\t\t\t\t\tdef: v,\n\t\t\t\t\tvalue: data.data.customData![k],\n\t\t\t\t\tY: v.Y ?? Y,\n\t\t\t\t\tkey: k,\n\t\t\t\t\ttarget: this.character,\n\t\t\t\t\taccess\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tMainCanvas.fillStyle = \"#ffff88\";\n\t\t\tMainCanvas.fillRect(95, 80, 800, 600);\n\t\t\tMainCanvas.strokeStyle = \"Black\";\n\t\t\tMainCanvas.strokeRect(95, 80, 800, 600);\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tDrawTextWrap(HELP_TEXTS[Views.ConditionsEditRules], 115 - 760 / 2, 100, 760, 560, \"black\");\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null || this.conditionData === null)\n\t\t\treturn true;\n\n\t\tconst access = this.checkAccess();\n\n\t\tlet Y = 175;\n\n\t\tif (this.definition.enforceable !== false) {\n\t\t\tif (access && MouseIn(1050, Y, 64, 64)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.data.enforce = !this.changes.data.enforce;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tY += 100;\n\t\t}\n\n\t\tif (this.definition.loggable !== false) {\n\t\t\tif (access && MouseIn(1050, Y, 64, 64)) {\n\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\tthis.changes.data.log = !this.changes.data.log;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tY += 100;\n\t\t}\n\n\t\tY += 45;\n\n\t\tif (this.definition.dataDefinition) {\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(this.definition.dataDefinition)) {\n\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\t\tif (handler.click) {\n\t\t\t\t\tconst data = this.changes ?? this.conditionData;\n\t\t\t\t\tconst res = handler.click({\n\t\t\t\t\t\tdef: v,\n\t\t\t\t\t\tvalue: data.data.customData![k],\n\t\t\t\t\t\tY: v.Y ?? Y,\n\t\t\t\t\t\tkey: k,\n\t\t\t\t\t\ttarget: this.character,\n\t\t\t\t\t\taccess\n\t\t\t\t\t});\n\t\t\t\t\tif (access && res !== undefined) {\n\t\t\t\t\t\tthis.changes = this.makeChangesData();\n\t\t\t\t\t\tthis.changes.data.customData![k] = res;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\toverride Unload() {\n\t\tif (this.definition.dataDefinition) {\n\t\t\tfor (const [k, v] of Object.entries<RuleCustomDataEntryDefinition>(this.definition.dataDefinition)) {\n\t\t\t\tconst handler: RuleCustomDataHandler = ruleCustomDataHandlers[v.type];\n\t\t\t\tif (handler.unload) {\n\t\t\t\t\thandler.unload({\n\t\t\t\t\t\tdef: v,\n\t\t\t\t\t\tkey: k\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsuper.Unload();\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { GuiConditionGlobal } from \"./conditions_global_base\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { showHelp } from \"../utilsClub\";\n\nexport class GuiConditionGlobalRules extends GuiConditionGlobal<\"rules\"> {\n\n\tconstructor(character: ChatroomCharacter,\n\t\tback: GuiSubscreen\n\t) {\n\t\tsuper(character, \"rules\", back);\n\t}\n\n\tprotected override headerText(): string {\n\t\treturn `View / Edit the global ${this.conditionCategory} configuration`;\n\t}\n\n\tRun(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`Note: Settings are applied to new rules and all existing ones set to the global config.`, 130, 210, \"Black\", \"\");\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.ConditionsGlobalRules]);\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tClick(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\treturn false;\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { RulesGetDisplayDefinition } from \"../modules/rules\";\nimport { dictionaryProcess } from \"../utils\";\nimport { GuiConditionEditRules } from \"./conditions_edit_rules\";\nimport { GuiConditionViewRules } from \"./conditions_view_rules\";\n\nexport class GuiRulesViewDescription extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\treadonly back: GuiSubscreen;\n\n\treadonly rule: BCX_Rule;\n\treadonly ruleDefinition: RuleDisplayDefinition;\n\n\tprivate allowAdd: boolean;\n\n\tprivate showFailedMsg: boolean = false;\n\n\tconstructor(character: ChatroomCharacter, back: GuiSubscreen, rule: BCX_Rule, allowAdd: boolean) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.back = back;\n\t\tthis.rule = rule;\n\t\tthis.ruleDefinition = RulesGetDisplayDefinition(rule);\n\t\tthis.allowAdd = allowAdd;\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.Exit();\n\t\t}\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Rules: Description of the rule: \"${this.ruleDefinition.name}\"-`, 125, 125, \"Black\", \"Gray\");\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawTextWrap(dictionaryProcess(this.ruleDefinition.longDescription, { PLAYER_NAME: this.character.Name }), 125 - 1750 / 2, 220, 1750, 500, \"Black\");\n\n\t\tMainCanvas.textAlign = \"center\";\n\t\tif (this.showFailedMsg) {\n\t\t\tDrawText(`Adding this rule failed! Likely cause is that it does not exist on ${this.character.Name}'s BCX version.`, 1000, 750, \"Red\", \"Gray\");\n\t\t}\n\t\tif (this.allowAdd) {\n\t\t\tDrawButton(700, 800, 200, 80, \"Add\", \"White\");\n\t\t\tDrawButton(1100, 800, 200, 80, \"Back\", \"White\");\n\t\t} else {\n\t\t\tDrawButton(900, 800, 200, 80, \"Back\", \"White\");\n\t\t}\n\t}\n\n\tClick() {\n\t\tif (this.allowAdd) {\n\t\t\tif (MouseIn(700, 800, 200, 80)) {\n\t\t\t\tthis.character.ruleCreate(this.rule).then(result => {\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tsetSubscreen(new GuiConditionEditRules(this.character, this.rule, new GuiConditionViewRules(this.character)));\n\t\t\t\t\t}\n\t\t\t\t}).catch((err) => {\n\t\t\t\t\tthis.showFailedMsg = true;\n\t\t\t\t\tconsole.warn(`Error creating rule on ${this.character}: `, err);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (MouseIn(1100, 800, 200, 80)) {\n\t\t\t\treturn this.Exit();\n\t\t\t}\n\t\t} else {\n\t\t\tif (MouseIn(900, 800, 200, 80)) {\n\t\t\t\tthis.Exit();\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.back);\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { GuiConditionViewRules } from \"./conditions_view_rules\";\nimport { RulesGetList } from \"../modules/rules\";\nimport { ConditionsLimit } from \"../constants\";\nimport { DrawImageEx, showHelp } from \"../utilsClub\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { createInputElement, dictionaryProcess, positionElement } from \"../utils\";\nimport { GuiRulesViewDescription } from \"./rules_viewDescription\";\n\ntype RuleListItem = {\n\tname: BCX_Rule;\n\tdefinition: RuleDisplayDefinition;\n};\n\nconst PER_PAGE_COUNT = 6;\n\nexport class GuiRulesAdd extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate rulesData: ConditionsCategoryPublicData<\"rules\"> | null = null;\n\tprivate failed: boolean = false;\n\tprivate permissionMode: boolean = false;\n\n\tprivate ruleList: RuleListItem[] = [];\n\tprivate page: number = 0;\n\n\tprivate showHelp: boolean = false;\n\n\tprivate filterInput = createInputElement(\"text\", 30);\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.filterInput.addEventListener(\"input\", ev => {\n\t\t\tthis.rebuildList();\n\t\t});\n\t}\n\n\tLoad() {\n\t\tthis.requestData();\n\t}\n\n\tonChange(sender: number) {\n\t\tif (sender === this.character.MemberNumber) {\n\t\t\tthis.requestData();\n\t\t}\n\t}\n\n\tprivate requestData() {\n\t\tthis.rulesData = null;\n\t\tthis.rebuildList();\n\t\tthis.character.conditionsGetByCategory(\"rules\").then(res => {\n\t\t\tthis.rulesData = res;\n\t\t\tif (!this.rulesData.access_changeLimits) {\n\t\t\t\tthis.permissionMode = false;\n\t\t\t}\n\t\t\tthis.rebuildList();\n\t\t}, err => {\n\t\t\tconsole.error(`BCX: Failed to get rules info for ${this.character}`, err);\n\t\t\tthis.failed = true;\n\t\t});\n\t}\n\n\tprivate rebuildList() {\n\t\tif (!this.active) return;\n\n\t\tthis.ruleList = [];\n\t\tif (this.rulesData === null) {\n\t\t\tthis.filterInput.remove();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.filterInput.parentElement) {\n\t\t\tdocument.body.appendChild(this.filterInput);\n\t\t}\n\n\t\tconst filter = this.filterInput.value.trim().toLocaleLowerCase().split(\" \").filter(Boolean);\n\n\t\tfor (const entry of RulesGetList()) {\n\t\t\tif (filter.some(i =>\n\t\t\t\t!entry[0].toLocaleLowerCase().includes(i) &&\n\t\t\t\t!entry[1].name.toLocaleLowerCase().includes(i) &&\n\t\t\t\t!entry[1].shortDescription?.toLocaleLowerCase().includes(i)\n\t\t\t)) continue;\n\t\t\tthis.ruleList.push({\n\t\t\t\tname: entry[0],\n\t\t\t\tdefinition: entry[1]\n\t\t\t});\n\t\t}\n\n\t\tconst totalPages = Math.ceil(this.ruleList.length / PER_PAGE_COUNT);\n\t\tif (this.page < 0) {\n\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t} else if (this.page >= totalPages) {\n\t\t\tthis.page = 0;\n\t\t}\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(`- Rules: Create new rules for ${this.character.Name} -`, 125, 125, \"Black\", \"Gray\");\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\", \"Back\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\");\n\n\t\tif (this.rulesData === null) {\n\t\t\tDrawText(this.failed ? `Failed to get rules data from ${this.character.Name}. Maybe you have no access?` : \"Loading...\", 1000, 480, \"Black\");\n\t\t\treturn;\n\t\t}\n\n\t\tDrawButton(1815, 305, 90, 90, \"\",\n\t\t\tthis.rulesData.access_changeLimits ? \"White\" : \"#ddd\",\n\t\t\tthis.permissionMode ? \"Icons/Reset.png\" : \"Icons/Preference.png\",\n\t\t\tthis.rulesData.access_changeLimits ?\n\t\t\t\t(this.permissionMode ? \"Leave permission mode\" : \"Edit rules permissions\") :\n\t\t\t\t\"You have no permission to change limits\",\n\t\t\t!this.rulesData.access_changeLimits\n\t\t);\n\n\t\t// filter\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawText(\"Filter:\", 130, 215, \"Black\");\n\t\tpositionElement(this.filterInput, 550, 210, 600, 64);\n\n\t\t//reset button\n\t\tif (this.filterInput.value) {\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawButton(870, 182, 64, 64, \"X\", \"White\");\n\t\t}\n\n\t\t// Actual rules\n\t\tMainCanvas.textAlign = \"left\";\n\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\tif (i >= this.ruleList.length) break;\n\t\t\tconst e = this.ruleList[i];\n\t\t\tif (e === null)\n\t\t\t\tcontinue;\n\n\t\t\tconst Y = 275 + off * 100;\n\t\t\tconst ruleIsCreated = this.rulesData.conditions[e.name] !== undefined;\n\t\t\tconst accessLevel = this.rulesData.limits[e.name] ?? ConditionsLimit.normal;\n\t\t\tconst allowAccess = [this.rulesData.access_normal, this.rulesData.access_limited, false][accessLevel];\n\n\t\t\tDrawImageEx(e.definition.icon, 125, Y, {\n\t\t\t\tHeight: 64,\n\t\t\t\tWidth: 64\n\t\t\t});\n\n\t\t\tlet color: string;\n\t\t\tlet text: string;\n\t\t\tif (this.permissionMode) {\n\t\t\t\tcolor = [\"#50ff56\", \"#f6fe78\", \"#ffa7a7\"][accessLevel];\n\t\t\t\ttext = [\"Normal\", \"Limited\", \"Blocked\"][accessLevel];\n\t\t\t} else {\n\t\t\t\tcolor = ruleIsCreated ? \"#88c\" :\n\t\t\t\t\t!allowAccess ? \"#ccc\" : \"White\";\n\t\t\t\ttext = ruleIsCreated ? \"Already applied\" :\n\t\t\t\t\t!allowAccess ? \"You don't have permission to use this rule\" : \"\";\n\t\t\t}\n\t\t\t// Rule name\n\t\t\tDrawButton(200, Y, 1350, 64, \"\", color, \"\", \"\", ruleIsCreated || this.permissionMode);\n\t\t\tlet description = e.definition.name;\n\t\t\tif (e.definition.shortDescription) {\n\t\t\t\tdescription += ` (${dictionaryProcess(e.definition.shortDescription, { PLAYER_NAME: this.character.Name })})`;\n\t\t\t}\n\t\t\tDrawTextFit(description, 210, Y + 34, 1340, \"Black\");\n\t\t\tif (MouseIn(200, Y, 1350, 64)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(1200, Y, 60, 60, text);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Pagination\n\t\tconst totalPages = Math.max(1, Math.ceil(this.ruleList.length / PER_PAGE_COUNT));\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawBackNextButton(1605, 800, 300, 90, `${DialogFindPlayer(\"Page\")} ${this.page + 1} / ${totalPages}`, \"White\", \"\", () => \"\", () => \"\");\n\n\t\t// permission mode legend\n\t\tif (this.permissionMode) {\n\t\t\tMainCanvas.fillStyle = \"#50ff56\";\n\t\t\tMainCanvas.fillRect(1284, 75, 166, 64);\n\t\t\tMainCanvas.fillStyle = \"#f6fe78\";\n\t\t\tMainCanvas.fillRect(1284 + 1 * 166, 75, 166, 64);\n\t\t\tMainCanvas.fillStyle = \"#ffa7a7\";\n\t\t\tMainCanvas.fillRect(1284 + 2 * 166, 75, 165, 64);\n\n\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\tDrawText(`Normal`, 1284 + 166 / 2, 75 + 34, \"Black\");\n\t\t\tDrawText(`Limited`, 1284 + 1 * 166 + 166 / 2, 75 + 34, \"Black\");\n\t\t\tDrawText(`Blocked`, 1284 + 2 * 166 + 166 / 2, 75 + 34, \"Black\");\n\t\t}\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[this.permissionMode ? Views.RulesAddPermissionMode : Views.RulesAdd]);\n\t\t}\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tthis.showHelp = !this.showHelp;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.rulesData === null)\n\t\t\treturn;\n\n\t\t// Permission mode\n\t\tif (MouseIn(1815, 305, 90, 90)) {\n\t\t\tthis.permissionMode = this.rulesData.access_changeLimits && !this.permissionMode;\n\t\t\treturn;\n\t\t}\n\n\t\t//reset button\n\t\tif (MouseIn(870, 182, 64, 64)) {\n\t\t\tthis.filterInput.value = \"\";\n\t\t\tthis.rebuildList();\n\t\t}\n\n\t\t// Actual rules\n\t\tfor (let off = 0; off < PER_PAGE_COUNT; off++) {\n\t\t\tconst i = this.page * PER_PAGE_COUNT + off;\n\t\t\tif (i >= this.ruleList.length) break;\n\t\t\tconst e = this.ruleList[i];\n\t\t\tif (e === null)\n\t\t\t\tcontinue;\n\n\t\t\tconst Y = 275 + off * 100;\n\t\t\tconst ruleIsCreated = this.rulesData.conditions[e.name] !== undefined;\n\t\t\tconst accessLevel = this.rulesData.limits[e.name] ?? ConditionsLimit.normal;\n\t\t\tconst allowAccess = [this.rulesData.access_normal, this.rulesData.access_limited, false][accessLevel];\n\n\t\t\t// Rule name\n\t\t\tif (MouseIn(200, Y, 1350, 64)) {\n\t\t\t\tconst ruleName = e.name;\n\t\t\t\tif (this.permissionMode) {\n\t\t\t\t\tthis.character.conditionSetLimit(\"rules\", e.name, (accessLevel + 1) % 3);\n\t\t\t\t} else if (!ruleIsCreated) {\n\t\t\t\t\tsetSubscreen(new GuiRulesViewDescription(this.character, this, ruleName, allowAccess));\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Pagination\n\t\tconst totalPages = Math.ceil(this.ruleList.length / PER_PAGE_COUNT);\n\t\tif (MouseIn(1605, 800, 150, 90)) {\n\t\t\tthis.page--;\n\t\t\tif (this.page < 0) {\n\t\t\t\tthis.page = Math.max(totalPages - 1, 0);\n\t\t\t}\n\t\t} else if (MouseIn(1755, 800, 150, 90)) {\n\t\t\tthis.page++;\n\t\t\tif (this.page >= totalPages) {\n\t\t\t\tthis.page = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(new GuiConditionViewRules(this.character));\n\t}\n\n\tUnload() {\n\t\tthis.filterInput.remove();\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { RulesGetDisplayDefinition } from \"../modules/rules\";\nimport { DrawImageEx, showHelp } from \"../utilsClub\";\nimport { GuiConditionEditRules } from \"./conditions_edit_rules\";\nimport { GuiConditionGlobalRules } from \"./conditions_global_rules\";\nimport { ConditionEntry, GuiConditionView } from \"./conditions_view_base\";\nimport { GuiRulesAdd } from \"./rules_add\";\nimport { Views, HELP_TEXTS } from \"../helpTexts\";\nimport { dictionaryProcess } from \"../utils\";\nimport { GuiRulesViewDescription } from \"./rules_viewDescription\";\n\ninterface RuleEntry {\n\tdefinition: RuleDisplayDefinition;\n}\n\ntype dataEntry = ConditionEntry<\"rules\", RuleEntry>;\n\nexport class GuiConditionViewRules extends GuiConditionView<\"rules\", RuleEntry> {\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper(character, \"rules\");\n\t}\n\n\toverride Run(): boolean {\n\t\tif (super.Run() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tDrawButton(120, 820, 384, 90, \"Add new rule\", \"White\", \"\",\n\t\t\t\"...from the list of yet unestablished rules\");\n\n\t\t// help text\n\t\tif (this.showHelp) {\n\t\t\tshowHelp(HELP_TEXTS[Views.ConditionsViewRules]);\n\t\t}\n\t\treturn false;\n\t}\n\n\toverride Click(): boolean {\n\t\tif (super.Click() || this.conditionCategoryData === null)\n\t\t\treturn true;\n\n\t\tif (MouseIn(120, 820, 384, 90)) {\n\t\t\tsetSubscreen(new GuiRulesAdd(this.character));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprotected removeLabel: string = \"Remove rule\";\n\n\tprotected drawCategoryImage(X: number, Y: number, entry: dataEntry): void {\n\t\tDrawImageEx(entry.extra.definition.icon, X + 6, Y + 6, {\n\t\t\tHeight: 50,\n\t\t\tWidth: 50\n\t\t});\n\t}\n\n\tprotected drawEntryExtra(X: number, Y: number, entry: dataEntry): void {\n\t\tif (entry.extra.definition.enforceable !== false) {\n\t\t\tDrawImageEx(\"Icons/Management.png\", X + 610, Y + 10, {\n\t\t\t\tHeight: 40,\n\t\t\t\tWidth: 40,\n\t\t\t\tAlpha: entry.data.data.enforce ? 1 : 0.2\n\t\t\t});\n\t\t\tif (MouseIn(X + 610, Y + 6, 44, 44)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 610, Y + 6, 44, 44, entry.data.data.enforce ? \"Rule will be enforced\" : \"Rule will not be enforced\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (entry.extra.definition.loggable !== false) {\n\t\t\tDrawImageEx(\"Icons/Title.png\", X + 660, Y + 10, {\n\t\t\t\tHeight: 40,\n\t\t\t\tWidth: 40,\n\t\t\t\tAlpha: entry.data.data.log ? 1 : 0.2\n\t\t\t});\n\t\t\tif (MouseIn(X + 660, Y + 6, 44, 44)) {\n\t\t\t\tDrawHoverElements.push(() => {\n\t\t\t\t\tDrawButtonHover(X + 660, Y + 6, 44, 44, entry.data.data.log ? \"Rule violations will be logged\" : \"Rule violations will not be logged\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected headerText(): string {\n\t\treturn `Rules: All active rules on ${this.character.Name}`;\n\t}\n\n\tprotected loadCondition(condition: ConditionsCategoryKeys[\"rules\"], data: ConditionsConditionPublicData<\"rules\">): [string, RuleEntry] | null {\n\t\tconst definition = RulesGetDisplayDefinition(condition);\n\t\treturn [definition.name, { definition }];\n\t}\n\n\tprotected showDetailedDescriptionBackground(X: number): void {\n\t\tconst backgroundY = 170;\n\n\t\tMainCanvas.fillStyle = \"White\";\n\t\tMainCanvas.fillRect(X, backgroundY, 801, 600);\n\t\tMainCanvas.strokeStyle = \"Black\";\n\t\tMainCanvas.strokeRect(X, backgroundY, 801, 600);\n\t}\n\n\tprotected showDetailedDescriptionText(X: number, condition: ConditionsCategoryKeys[\"rules\"], data: dataEntry): void {\n\t\tconst backgroundY = 170;\n\n\t\tMainCanvas.textAlign = \"left\";\n\t\tDrawTextWrap(dictionaryProcess(data.extra.definition.longDescription, { PLAYER_NAME: this.character.Name }), X + 20 - 760 / 2, backgroundY + 20, 760, 560, \"black\");\n\t}\n\n\tprotected onDescriptionTextClick(condition: ConditionsCategoryKeys[\"rules\"], data: dataEntry): void {\n\t\tsetSubscreen(new GuiRulesViewDescription(this.character, this, condition, false));\n\t}\n\n\n\tprotected openEditSubscreen(condition: ConditionsCategoryKeys[\"rules\"]): void {\n\t\tsetSubscreen(new GuiConditionEditRules(this.character, condition, this));\n\t}\n\n\tprotected removeCondition(condition: ConditionsCategoryKeys[\"rules\"]): void {\n\t\tthis.character.ruleDelete(condition);\n\t}\n\n\tprotected openGlobalConfig(): void {\n\t\tsetSubscreen(new GuiConditionGlobalRules(this.character, this));\n\t}\n}\n","import { getPlayerCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { applyPreset } from \"../modules/presets\";\nimport { icon_OwnerList } from \"../resources\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { GuiTutorial } from \"./tutorial\";\nimport { ChatroomCharacter } from \"../characters\";\n\nexport class GuiWelcomeSelection extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate selectedPreset: number = -1;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t}\n\n\tRun() {\n\t\tMainCanvas.textAlign = \"center\";\n\n\t\tDrawButton(800, 66, 400, 54, \"<< Back to the tutorial\", \"White\");\n\t\tDrawText(`Please choose a preset, which sets your default experience, permissions and configuration.`, 1000, 150, \"Black\");\n\t\tDrawText(`Note: You can change the defaults, but changing to another preset is not possible without resetting BCX fully.`, 1000, 200, \"FireBrick\");\n\n\t\tconst width = 400;\n\t\tconst texts = [\"Dominant\", \"Switch/Exploring\", \"Submissive\", \"Slave\"];\n\t\tconst images = [\"Icons/Management.png\", \"Icons/Swap.png\", \"Icons/Kneel.png\", icon_OwnerList];\n\n\t\tconst descriptionDominant =\n\t\t\t`This preset is for dominants who\\n` +\n\t\t\t`never intend to submit. Therefore,\\n` +\n\t\t\t`most modules are not loaded at\\n` +\n\t\t\t`start. That said, you can still use\\n` +\n\t\t\t`the BCX graphical user interface\\n` +\n\t\t\t`on other BCX users to use actions,\\n` +\n\t\t\t`you have permission for, on them,\\n` +\n\t\t\t`same as with all other presets.`;\n\n\t\tconst descriptionSwitch =\n\t\t\t`This preset is for switches who\\n` +\n\t\t\t`are sometimes dominant and\\n` +\n\t\t\t`sometimes submissive, enabling\\n` +\n\t\t\t`them to explore BCX slowly, while\\n` +\n\t\t\t`having full control over all of its\\n` +\n\t\t\t`settings and features.`;\n\n\t\tconst descriptionSubmissive =\n\t\t\t`This preset is for submissives,\\n` +\n\t\t\t`who want to give some of their\\n` +\n\t\t\t`control to selected dominants and\\n` +\n\t\t\t`lovers, giving only them authority\\n` +\n\t\t\t`over some of BCX's settings. You\\n` +\n\t\t\t`can irreversably give away more\\n` +\n\t\t\t`and more control, when you want.`;\n\n\t\tconst descriptionSlave =\n\t\t\t`This preset is a much more\\n` +\n\t\t\t`extreme submissive experience,\\n` +\n\t\t\t`not leaving much control over the\\n` +\n\t\t\t`settings and permissions to you,\\n` +\n\t\t\t`thus enabling others to use many\\n` +\n\t\t\t`of BCX's features on you. Owners\\n` +\n\t\t\t`can even unblock the most extreme\\n` +\n\t\t\t`settings, if they desire so.`;\n\n\t\tconst descriptions = [descriptionDominant, descriptionSwitch, descriptionSubmissive, descriptionSlave];\n\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tconst X = 125 + i * (width + 50);\n\t\t\tif (MouseIn(X, 250, width, 575)) {\n\t\t\t\tDrawRect(X, 250, width, 575, \"#ddd\");\n\t\t\t}\n\t\t\tDrawEmptyRect(X, 250, width, 575, \"Black\");\n\t\t\tif (i === this.selectedPreset) {\n\t\t\t\tconst border = 10;\n\t\t\t\tDrawEmptyRect(X - border, 250 - border, width + 2 * border, 575 + 2 * border, \"Cyan\", 5);\n\t\t\t\tDrawButton(X + 20, 850, width - 40, 65, \"Confirm\", \"White\");\n\t\t\t}\n\t\t\tDrawImageEx(images[i], X + width / 2 - 43, 275);\n\t\t\tDrawText(texts[i], X + width / 2, 400, \"Black\");\n\t\t\tMainCanvas.font = CommonGetFont(24);\n\t\t\tlet texty = 475;\n\t\t\tfor (const line of descriptions[i].split(\"\\n\")) {\n\t\t\t\tDrawText(line, X + width / 2, texty, \"Black\");\n\t\t\t\ttexty += 36;\n\t\t\t}\n\t\t\tif (i === 1) {\n\t\t\t\tDrawText(\"Easily try out all features\", X + width / 2, 775, \"Black\");\n\t\t\t} else if (i === 2) {\n\t\t\t\tDrawText(\"Similar to Ace's Cursed Script\", X + width / 2, 775, \"Black\");\n\t\t\t}\n\t\t\tMainCanvas.font = CommonGetFont(36);\n\t\t}\n\t}\n\n\tClick() {\n\n\t\tconst width = 400;\n\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tconst X = 125 + i * (width + 50);\n\t\t\tif (MouseIn(X, 250, width, 575)) {\n\t\t\t\tthis.selectedPreset = i;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (i === this.selectedPreset && MouseIn(X + 20, 850, width - 40, 65)) {\n\t\t\t\tapplyPreset(i);\n\t\t\t\tsetSubscreen(new GuiMainMenu(getPlayerCharacter()));\n\t\t\t}\n\t\t}\n\n\t\tif (MouseIn(800, 66, 400, 54)) setSubscreen(new GuiTutorial(this.character, true));\n\n\t}\n\n\tExit() {\n\t\t// Empty\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { GuiMainMenu } from \"./mainmenu\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { drawIcon, DrawImageBCX, drawTypingIndicatorSpeechBubble } from \"../utilsClub\";\nimport { icon_heart } from \"../resources\";\nimport { clampWrap } from \"../utils\";\nimport { GuiWelcomeSelection } from \"./welcome\";\n\ninterface TutorialPage {\n\tname: string;\n\timage?: string;\n\tafterDraw?: () => void;\n}\n\nconst TUTORIAL_PAGES: TutorialPage[] = [\n\t{\n\t\tname: \"Welcome\",\n\t\timage: \"welcome.png\",\n\t\tafterDraw() {\n\t\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\", \"\", true);\n\t\t\tMainCanvas.save();\n\t\t\tMainCanvas.font = '28px \"Arial\", sans-serif';\n\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\tDrawText(`Dear ${Player.Name},`, 285, 510, \"Black\");\n\t\t\tDrawTextWrap(\n\t\t\t\t`we are happy you are interested in our extension for the Bondage Club (BC) in which we invest a lot of our free time and love. If you have any questions, suggestions, or encounter any bugs, please feel free to get in touch with us on Discord. A button linking to it is in the main menu.`\n\t\t\t\t, 285 - 940 / 2, 544, 940, 160, \"black\");\n\t\t\tMainCanvas.restore();\n\t\t}\n\t},\n\t{\n\t\tname: \"Quick overview\",\n\t\timage: \"quick_overview.png\"\n\t},\n\t{\n\t\tname: \"New chat room icons\",\n\t\timage: \"status_icons.png\",\n\t\tafterDraw() {\n\t\t\tDrawCharacter(Player, 130, 100, 0.82, true, MainCanvas);\n\t\t\tdrawIcon(MainCanvas, icon_heart, 450, 70, 50, 50, 50, 1, 4, \"#6e6eff\");\n\t\t\tconst tick = Date.now() % 10_000;\n\t\t\tif (tick < 4_000 || tick > 6_000 && tick < 9_000) {\n\t\t\t\tdrawTypingIndicatorSpeechBubble(MainCanvas, 450, 128, 50, 48, 1);\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\tname: \"Introduction to roles and permissions\",\n\t\timage: \"basic_roles_permissions.png\"\n\t},\n\t{\n\t\tname: \"End of introduction\",\n\t\timage: \"basic_end.png\",\n\t\tafterDraw() {\n\t\t\tDrawCharacter(Player, 220, 160, 0.78, true, MainCanvas);\n\t\t}\n\t},\n\t{\n\t\tname: \"Logging module screen\",\n\t\timage: \"log_part1.png\"\n\t},\n\t{\n\t\tname: \"Logging configuration screen\",\n\t\timage: \"log_part2.png\"\n\t},\n\t{\n\t\tname: \"Curses module overview\",\n\t\timage: \"curses1.png\"\n\t},\n\t{\n\t\tname: \"Adding curses\",\n\t\timage: \"curses2.png\"\n\t},\n\t{\n\t\tname: \"Rules module overview\",\n\t\timage: \"rules1.png\"\n\t},\n\t{\n\t\tname: \"Adding a rule\",\n\t\timage: \"rules2.png\"\n\t},\n\t{\n\t\tname: \"Limiting curse slots / rules\",\n\t\timage: \"limit_system.png\"\n\t},\n\t{\n\t\tname: \"Trigger conditions\",\n\t\timage: \"trigger_conditions.png\"\n\t},\n\t{\n\t\tname: \"Permission system overview\",\n\t\timage: \"permissions1.png\"\n\t},\n\t{\n\t\tname: \"Permission system base principles\",\n\t\timage: \"permissions2.png\"\n\t},\n\t{\n\t\tname: \"General permission examples\",\n\t\timage: \"permissions3.png\"\n\t},\n\t{\n\t\tname: \"Permission setup example 1\",\n\t\timage: \"permissions4.png\"\n\t},\n\t{\n\t\tname: \"Permission setup example 2\",\n\t\timage: \"permissions5.png\"\n\t},\n\t{\n\t\tname: \"Chat commands\",\n\t\timage: \"chat_commands.png\"\n\t}\n];\n\nconst TUTORIAL_BASIC_END = TUTORIAL_PAGES.findIndex(i => i.name === \"End of introduction\");\n\nexport class GuiTutorial extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate page = 0;\n\tpublic firstRun: boolean;\n\n\tconstructor(character: ChatroomCharacter, firstRun: boolean) {\n\t\tsuper();\n\t\tthis.character = character;\n\t\tthis.firstRun = firstRun;\n\t}\n\n\tLoad() {\n\t\tthis.page = 0;\n\t}\n\n\tRun() {\n\t\tconst currentPage = TUTORIAL_PAGES[this.page];\n\n\t\tMainCanvas.textAlign = \"center\";\n\t\tDrawText(`BCX TUTORIAL: ${currentPage.name}`, 1000, 125, \"Black\", \"Gray\");\n\t\tDrawButton(1500, 830, 300, 90, (this.firstRun && this.page < TUTORIAL_BASIC_END) ? \"Skip tutorial\" : \"Close tutorial\", \"White\");\n\n\t\tif (currentPage.image) {\n\t\t\tif (!DrawImageBCX(\"tutorial/\" + currentPage.image, 200, 180)) {\n\t\t\t\tDrawText(\"Loading...\", 1000, 500, \"Black\");\n\t\t\t}\n\t\t}\n\t\tif (currentPage.afterDraw) {\n\t\t\tcurrentPage.afterDraw();\n\t\t}\n\n\t\tDrawBackNextButton(850, 830, 300, 90, `Page ${this.page + 1}/${TUTORIAL_PAGES.length}`, \"White\", undefined, () => \"\", () => \"\");\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1500, 830, 300, 90)) return this.Exit();\n\n\t\tif (MouseIn(850, 830, 150, 90)) {\n\t\t\tthis.page = clampWrap(this.page - 1, 0, TUTORIAL_PAGES.length - 1);\n\t\t}\n\t\tif (MouseIn(1000, 830, 150, 90)) {\n\t\t\tthis.page = clampWrap(this.page + 1, 0, TUTORIAL_PAGES.length - 1);\n\t\t}\n\t}\n\n\tExit() {\n\t\tsetSubscreen(this.firstRun ? new GuiWelcomeSelection(this.character) : new GuiMainMenu(this.character));\n\t}\n}\n","import { VERSION, VERSION_CHECK_BOT } from \"../config\";\nimport { hiddenBeepHandlers, sendHiddenBeep } from \"./messaging\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { isObject } from \"../utils\";\nimport { BCX_setTimeout } from \"../BCXContext\";\nimport { BCXSource, BCXSourceExternal, ChatRoomSendLocal, InfoBeep } from \"../utilsClub\";\nimport { unload } from \"../main\";\n\nlet nextCheckTimer: number | null = null;\nexport let versionCheckNewAvailable: boolean | null = null;\nlet versionCheckDidNotify = false;\n\nfunction sendVersionCheckBeep(): void {\n\tif (nextCheckTimer !== null) {\n\t\tclearTimeout(nextCheckTimer);\n\t\tnextCheckTimer = null;\n\t}\n\n\tsendHiddenBeep(\"versionCheck\", {\n\t\tversion: VERSION,\n\t\tdevel: BCX_DEVEL,\n\t\tGameVersion,\n\t\tSource: (BCXSourceExternal ? \"E:\" : \"\") + BCXSource,\n\t\tUA: window.navigator.userAgent\n\t}, VERSION_CHECK_BOT, true);\n\n\t// Set check retry timer to 5 minutes\n\tnextCheckTimer = BCX_setTimeout(sendVersionCheckBeep, 5 * 60_000);\n}\n\nexport class ModuleVersionCheck extends BaseModule {\n\tload() {\n\t\thiddenBeepHandlers.set(\"versionResponse\", (sender, message: BCX_beep_versionResponse) => {\n\t\t\tif (sender !== VERSION_CHECK_BOT) {\n\t\t\t\tconsole.warn(`BCX: got versionResponse from unexpected sender ${sender}, ignoring`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!isObject(message) || typeof message.status !== \"string\") {\n\t\t\t\tconsole.warn(`BCX: bad versionResponse`, message);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Got valid version response, reset timer to 15 minutes\n\t\t\tif (nextCheckTimer !== null) {\n\t\t\t\tclearTimeout(nextCheckTimer);\n\t\t\t}\n\t\t\tnextCheckTimer = BCX_setTimeout(sendVersionCheckBeep, 15 * 60_000);\n\n\t\t\tif (message.status === \"current\") {\n\t\t\t\tversionCheckNewAvailable = false;\n\t\t\t\treturn;\n\t\t\t} else if (message.status === \"newAvailable\") {\n\t\t\t\tversionCheckNewAvailable = true;\n\t\t\t\tif (versionCheckDidNotify)\n\t\t\t\t\treturn;\n\t\t\t\tversionCheckDidNotify = true;\n\n\t\t\t\tif (ServerPlayerIsInChatRoom()) {\n\t\t\t\t\tChatRoomSendLocal(\"New BCX version is available! You can upgrade by logging in again.\");\n\t\t\t\t} else {\n\t\t\t\t\tInfoBeep(\"New BCX version is available! You can upgrade by logging in again.\", 10_000);\n\t\t\t\t}\n\t\t\t} else if (message.status === \"deprecated\") {\n\t\t\t\tversionCheckNewAvailable = true;\n\n\t\t\t\tif (versionCheckDidNotify)\n\t\t\t\t\treturn;\n\t\t\t\tversionCheckDidNotify = true;\n\n\t\t\t\tconst overlay = document.createElement(\"div\");\n\t\t\t\toverlay.style.position = \"fixed\";\n\t\t\t\toverlay.style.top = \"0px\";\n\t\t\t\toverlay.style.right = \"0px\";\n\t\t\t\toverlay.style.bottom = \"0px\";\n\t\t\t\toverlay.style.left = \"0px\";\n\t\t\t\toverlay.style.background = \"#00000090\";\n\t\t\t\toverlay.style.display = \"flex\";\n\t\t\t\toverlay.style.alignItems = \"center\";\n\t\t\t\toverlay.style.justifyContent = \"center\";\n\n\t\t\t\t// Nice window\n\t\t\t\tconst win = document.createElement(\"div\");\n\t\t\t\toverlay.appendChild(win);\n\t\t\t\twin.style.background = \"white\";\n\t\t\t\twin.style.display = \"flex\";\n\t\t\t\twin.style.flexDirection = \"column\";\n\t\t\t\twin.style.padding = \"1em\";\n\n\t\t\t\t// Title\n\t\t\t\tconst titleElem = document.createElement(\"h1\");\n\t\t\t\twin.appendChild(titleElem);\n\t\t\t\ttitleElem.innerText = \"Deprecated BCX version\";\n\n\t\t\t\t// Description\n\t\t\t\tconst descriptionElement = document.createElement(\"p\");\n\t\t\t\twin.appendChild(descriptionElement);\n\t\t\t\tdescriptionElement.innerText = \"The BCX version you are using is too old and either contains critical bugs or \" +\n\t\t\t\t\t\"is no longer compatible with the current Bondage Club release version.\\n\" +\n\t\t\t\t\t\"Unless you are using additional mods preventing this, please refresh the page and log into the club again to load the newest version.\";\n\n\t\t\t\t// Close button\n\t\t\t\tconst close = document.createElement(\"button\");\n\t\t\t\twin.appendChild(close);\n\t\t\t\tclose.innerText = \"Close\";\n\t\t\t\tclose.onclick = () => {\n\t\t\t\t\toverlay.remove();\n\t\t\t\t};\n\n\t\t\t\t// Display it\n\t\t\t\t(document.activeElement as HTMLElement)?.blur?.();\n\t\t\t\twindow.document.body.appendChild(overlay);\n\t\t\t} else if (message.status === \"unsupported\") {\n\t\t\t\tunload();\n\t\t\t\talert(\"The BCX version you are trying to load is too old and either contains critical bugs or \" +\n\t\t\t\t\t\"is no longer compatible with the current Bondage Club release version. Please update your BCX.\");\n\t\t\t} else {\n\t\t\t\tconsole.warn(`BCX: bad versionResponse status \"${message.status}\"`);\n\t\t\t}\n\t\t});\n\t}\n\n\trun() {\n\t\tsendVersionCheckBeep();\n\t}\n\n\tunload() {\n\t\tif (nextCheckTimer !== null) {\n\t\t\tclearTimeout(nextCheckTimer);\n\t\t\tnextCheckTimer = null;\n\t\t}\n\t}\n}\n","import { ChatroomCharacter } from \"../characters\";\nimport { ModuleCategory, MODULE_ICONS, MODULE_NAMES, TOGGLEABLE_MODULES } from \"../constants\";\nimport { GuiAuthorityRoles } from \"./authority_roles\";\nimport { GuiGlobal } from \"./global\";\nimport { GuiLog } from \"./log\";\nimport { GuiMisc } from \"./misc\";\nimport { GuiSubscreen } from \"./subscreen\";\nimport { setSubscreen } from \"../modules/gui\";\nimport { VERSION } from \"../config\";\nimport { icon_ExternalLink } from \"../resources\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport { GuiConditionViewCurses } from \"./conditions_view_curses\";\nimport { GuiConditionViewRules } from \"./conditions_view_rules\";\nimport { GuiTutorial } from \"./tutorial\";\nimport { versionCheckNewAvailable } from \"../modules/versionCheck\";\nimport { modStorage, modStorageSync } from \"../modules/storage\";\n\nconst MAIN_MENU_ITEMS: { module: ModuleCategory; onclick: (C: ChatroomCharacter) => void; }[] = [\n\t{\n\t\tmodule: ModuleCategory.Global,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiGlobal(C));\n\t\t}\n\t},\n\t{\n\t\tmodule: ModuleCategory.Authority,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiAuthorityRoles(C));\n\t\t}\n\t},\n\t{\n\t\tmodule: ModuleCategory.Log,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiLog(C));\n\t\t}\n\t},\n\t{\n\t\tmodule: ModuleCategory.Curses,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiConditionViewCurses(C));\n\t\t}\n\t},\n\t{\n\t\tmodule: ModuleCategory.Rules,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiConditionViewRules(C));\n\t\t}\n\t},\n\t{\n\t\tmodule: ModuleCategory.Misc,\n\t\tonclick: (C) => {\n\t\t\tsetSubscreen(new GuiMisc(C));\n\t\t}\n\t}\n];\n\nexport class GuiMainMenu extends GuiSubscreen {\n\n\treadonly character: ChatroomCharacter;\n\n\tprivate disabledModules: readonly ModuleCategory[] = TOGGLEABLE_MODULES;\n\n\tconstructor(character: ChatroomCharacter) {\n\t\tsuper();\n\t\tthis.character = character;\n\t}\n\n\tLoad() {\n\t\tthis.character.getDisabledModules(5_000).then(data => {\n\t\t\tthis.disabledModules = data;\n\t\t}).catch(e => {\n\t\t\tthis.disabledModules = [];\n\t\t\tconsole.error(`BCX: error getting disabled modules`, e);\n\t\t});\n\t}\n\n\tonChange(source: number) {\n\t\tif (source === this.character.MemberNumber) {\n\t\t\tthis.Load();\n\t\t}\n\t}\n\n\tRun() {\n\t\tDrawText(\"- Bondage Club Extended -\", 125, 125, \"Black\", \"Gray\");\n\t\tDrawButton(1815, 75, 90, 90, \"\", \"White\", \"Icons/Exit.png\");\n\t\tDrawButton(1815, 190, 90, 90, \"\", \"White\", \"Icons/Question.png\", \"Show the BCX tutorial again\");\n\n\t\tif (this.character.isPlayer() && modStorage.menuShouldDisplayTutorialHelp) {\n\t\t\tMainCanvas.beginPath();\n\t\t\tMainCanvas.rect(950, 190, 850, 90);\n\t\t\tMainCanvas.fillStyle = \"Black\";\n\t\t\tMainCanvas.fill();\n\t\t\tDrawText(`New advanced tutorial pages are now available `, 980, 190 + 45, \"White\");\n\t\t}\n\n\t\tfor (let i = 0; i < MAIN_MENU_ITEMS.length; i++) {\n\t\t\tconst e = MAIN_MENU_ITEMS[i];\n\t\t\tconst PX = Math.floor(i / 7);\n\t\t\tconst PY = i % 7;\n\n\t\t\tconst isDisabled = this.disabledModules.includes(e.module);\n\n\t\t\tDrawButton(150 + 420 * PX, 160 + 110 * PY, 400, 90, \"\", isDisabled ? \"#ddd\" : \"White\", MODULE_ICONS[e.module],\n\t\t\t\tisDisabled ? \"Module is deactivated\" : \"\", isDisabled);\n\t\t\tDrawTextFit(MODULE_NAMES[e.module], 250 + 420 * PX, 205 + 110 * PY, 310, \"Black\");\n\t\t}\n\n\t\tMainCanvas.textAlign = \"center\";\n\t\tif (this.character.isPlayer()) {\n\t\t\tDrawText(`Your BCX version: ${VERSION.replace(/-[0-f]+$/i, \"\")}`, 1450 + 400 / 2, 610, \"Black\", \"\");\n\t\t\tDrawButton(1450, 700, 400, 90, \"\", \"White\", \"\", \"Open changelog on GitHub\");\n\t\t\tif (versionCheckNewAvailable === true) {\n\t\t\t\tconst tick = Date.now() % 6_000;\n\t\t\t\tif (tick < 3_000) {\n\t\t\t\t\tDrawText(`New version available`, 1450 + 400 / 2, 665, \"Red\", \"Black\");\n\t\t\t\t} else {\n\t\t\t\t\tDrawText(`Login again to upgrade`, 1450 + 400 / 2, 665, \"Red\", \"Black\");\n\t\t\t\t}\n\t\t\t} else if (versionCheckNewAvailable === false) {\n\t\t\t\tDrawText(`This is the latest version`, 1450 + 400 / 2, 665, \"Black\", \"\");\n\t\t\t}\n\t\t\tDrawText(`View changelog`, 1450 + 350 / 2, 745, \"Black\", \"\");\n\t\t\tDrawImageEx(icon_ExternalLink, 1770, 730, { Width: 30, Height: 30 });\n\t\t\tDrawButton(1450, 810, 400, 90, \"\", \"White\", \"\", \"Open invite to BCX Discord server\");\n\t\t\tDrawText(`BCX Discord`, 1450 + 350 / 2, 855, \"Black\", \"\");\n\t\t\tDrawImageEx(icon_ExternalLink, 1770, 840, { Width: 30, Height: 30 });\n\t\t} else {\n\t\t\tDrawText(`Your BCX version: ${VERSION.replace(/-[0-f]+$/i, \"\")}`, 1450 + 400 / 2, 765, \"Black\", \"\");\n\t\t\tDrawText(`${this.character.Name}'s BCX version: ${this.character.BCXVersion?.replace(/-[0-f]+$/i, \"\")}`, 1450 + 400 / 2, 845, \"Black\", \"\");\n\t\t}\n\t}\n\n\tClick() {\n\t\tif (MouseIn(1815, 75, 90, 90)) return this.Exit();\n\n\t\tif (MouseIn(1815, 190, 90, 90)) {\n\t\t\tif (modStorage.menuShouldDisplayTutorialHelp) {\n\t\t\t\tdelete modStorage.menuShouldDisplayTutorialHelp;\n\t\t\t\tmodStorageSync();\n\t\t\t}\n\t\t\tsetSubscreen(new GuiTutorial(this.character, false));\n\t\t}\n\n\t\t// Changelog\n\t\tif (MouseIn(1450, 700, 400, 90) && this.character.isPlayer()) {\n\t\t\twindow.open(`https://github.com/Jomshir98/bondage-club-extended/blob/${BCX_DEVEL ? 'master' : 'stable'}/CHANGELOG.md`, \"_blank\");\n\t\t}\n\t\t// Discord invite\n\t\tif (MouseIn(1450, 810, 400, 90) && this.character.isPlayer()) {\n\t\t\twindow.open(\"https://discord.gg/SHJMjEh9VH\", \"_blank\");\n\t\t}\n\n\t\tfor (let i = 0; i < MAIN_MENU_ITEMS.length; i++) {\n\t\t\tconst e = MAIN_MENU_ITEMS[i];\n\t\t\tconst PX = Math.floor(i / 7);\n\t\t\tconst PY = i % 7;\n\t\t\tif (MouseIn(150 + 420 * PX, 160 + 110 * PY, 400, 90) && !this.disabledModules.includes(e.module)) {\n\t\t\t\treturn e.onclick(this.character);\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ChatroomCharacter, getChatroomCharacter } from \"../characters\";\nimport { GuiMainMenu } from \"../gui/mainmenu\";\nimport { GuiSubscreen } from \"../gui/subscreen\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction, patchFunction } from \"../patching\";\nimport { icon_BCX } from \"../resources\";\nimport { changeHandlers } from \"./messaging\";\nimport { firstTimeInit } from \"./storage\";\nimport { developmentMode } from \"../utilsClub\";\nimport { ChatroomSM } from \"./chatroom\";\nimport { GuiTutorial } from \"../gui/tutorial\";\n\nexport function getCurrentSubscreen(): GuiSubscreen | null {\n\treturn ModuleGUI.instance && ModuleGUI.instance.currentSubscreen;\n}\n\nexport function setSubscreen(subscreen: GuiSubscreen | null): void {\n\tif (!ModuleGUI.instance) {\n\t\tthrow new Error(\"Attempt to set subscreen before init\");\n\t}\n\tModuleGUI.instance.currentSubscreen = subscreen;\n}\n\nexport class ModuleGUI extends BaseModule {\n\tstatic instance: ModuleGUI | null = null;\n\n\tprivate _currentSubscreen: GuiSubscreen | null = null;\n\n\tget currentSubscreen(): GuiSubscreen | null {\n\t\treturn this._currentSubscreen;\n\t}\n\n\tset currentSubscreen(subscreen: GuiSubscreen | null) {\n\t\tif (this._currentSubscreen) {\n\t\t\tthis._currentSubscreen.Unload();\n\t\t}\n\t\tthis._currentSubscreen = subscreen;\n\t\tif (this._currentSubscreen) {\n\t\t\tthis._currentSubscreen.Load();\n\t\t}\n\t\tChatroomSM.UpdateStatus();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tif (ModuleGUI.instance) {\n\t\t\tthrow new Error(\"Duplicate initialization\");\n\t\t}\n\t\tModuleGUI.instance = this;\n\t}\n\n\tgetInformationSheetCharacter(): ChatroomCharacter | null {\n\t\tconst C = InformationSheetSelection;\n\t\tif (!C || typeof C.MemberNumber !== \"number\") return null;\n\t\treturn getChatroomCharacter(C.MemberNumber);\n\t}\n\n\tinit() {\n\t\tchangeHandlers.push(source => {\n\t\t\tif (this._currentSubscreen) {\n\t\t\t\tthis._currentSubscreen.onChange(source);\n\t\t\t}\n\t\t});\n\t}\n\n\tload() {\n\t\tpatchFunction(\"InformationSheetRun\", {\n\t\t\t'DrawButton(1815, 765, 90, 90,': 'DrawButton(1815, 800, 90, 90,'\n\t\t});\n\t\tpatchFunction(\"InformationSheetClick\", {\n\t\t\t'MouseIn(1815, 765, 90, 90)': 'MouseIn(1815, 800, 90, 90)'\n\t\t});\n\t\thookFunction(\"InformationSheetRun\", 10, (args, next) => {\n\t\t\tif (this._currentSubscreen) {\n\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\tthis._currentSubscreen.Run();\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\n\t\t\t\tif (developmentMode) {\n\t\t\t\t\tif (MouseX > 0 || MouseY > 0) {\n\t\t\t\t\t\tMainCanvas.save();\n\t\t\t\t\t\tMainCanvas.lineWidth = 1;\n\t\t\t\t\t\tMainCanvas.strokeStyle = \"red\";\n\t\t\t\t\t\tMainCanvas.beginPath();\n\t\t\t\t\t\tMainCanvas.moveTo(0, MouseY);\n\t\t\t\t\t\tMainCanvas.lineTo(2000, MouseY);\n\t\t\t\t\t\tMainCanvas.moveTo(MouseX, 0);\n\t\t\t\t\t\tMainCanvas.lineTo(MouseX, 1000);\n\t\t\t\t\t\tMainCanvas.stroke();\n\t\t\t\t\t\tMainCanvas.fillStyle = \"black\";\n\t\t\t\t\t\tMainCanvas.strokeStyle = \"white\";\n\t\t\t\t\t\tMainCanvas.fillRect(0, 950, 250, 50);\n\t\t\t\t\t\tMainCanvas.strokeRect(0, 950, 250, 50);\n\t\t\t\t\t\tDrawText(`X: ${MouseX} Y: ${MouseY}`, 125, 975, \"white\");\n\t\t\t\t\t\tMainCanvas.restore();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnext(args);\n\t\t\tconst C = this.getInformationSheetCharacter();\n\t\t\tif (firstTimeInit) {\n\t\t\t\tif (C && C.isPlayer()) {\n\t\t\t\t\tDrawButton(1815, 685, 90, 90, \"\", \"White\", icon_BCX);\n\t\t\t\t\tMainCanvas.beginPath();\n\t\t\t\t\tMainCanvas.rect(1300, 685, 500, 90);\n\t\t\t\t\tMainCanvas.fillStyle = \"Black\";\n\t\t\t\t\tMainCanvas.fill();\n\t\t\t\t\tDrawText(`You can find BCX here `, 1550, 685 + 45, \"White\");\n\t\t\t\t}\n\t\t\t} else if (C && C.BCXVersion !== null) {\n\t\t\t\tconst playerHasAccessToCharacter = C.playerHasAccessToCharacter();\n\t\t\t\tDrawButton(1815, 685, 90, 90, \"\", playerHasAccessToCharacter ? \"White\" : \"#ddd\", icon_BCX, playerHasAccessToCharacter ? \"BCX\" : \"Needs BC item permission\", !playerHasAccessToCharacter);\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"InformationSheetClick\", 10, (args, next) => {\n\t\t\tif (this._currentSubscreen) {\n\t\t\t\treturn this._currentSubscreen.Click();\n\t\t\t}\n\n\t\t\tconst C = this.getInformationSheetCharacter();\n\t\t\tif (MouseIn(1815, 685, 90, 90)) {\n\t\t\t\tif (firstTimeInit) {\n\t\t\t\t\tif (C && C.isPlayer()) {\n\t\t\t\t\t\tServerBeep = { Message: \"\", Timer: 0 };\n\t\t\t\t\t\tthis.currentSubscreen = new GuiTutorial(C, true);\n\t\t\t\t\t}\n\t\t\t\t} else if (C && C.BCXVersion !== null && C.playerHasAccessToCharacter()) {\n\t\t\t\t\tthis.currentSubscreen = new GuiMainMenu(C);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn next(args);\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"InformationSheetExit\", 10, (args, next) => {\n\t\t\tif (this._currentSubscreen) {\n\t\t\t\treturn this._currentSubscreen.Exit();\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\t}\n\n\tunload() {\n\t\tthis.currentSubscreen = null;\n\t}\n}\n","import { isNModClient, drawIcon, DrawImageEx, drawTypingIndicatorSpeechBubble } from \"../utilsClub\";\nimport { VERSION } from \"../config\";\nimport { hiddenMessageHandlers, sendHiddenMessage } from \"./messaging\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction, patchFunction } from \"../patching\";\nimport { getChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { modStorage } from \"./storage\";\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport { defaultBCXEffects } from \"../constants\";\nimport { isObject } from \"../utils\";\nimport { icon_heart, icon_BCX_cross } from \"../resources\";\nimport { BCX_setTimeout } from \"../BCXContext\";\nimport { getCurrentSubscreen } from \"./gui\";\n\nexport enum ChatRoomStatusManagerStatusType {\n\tNone = \"None\",\n\tTyping = \"Typing\",\n\tEmote = \"Emote\",\n\tWhisper = \"Whisper\",\n\tDMS = \"DMS\",\n\tWardrobe = \"Wardrobe\",\n\tProfile = \"Profile\",\n\t// NMod\n\tAction = \"Action\",\n\tAfk = 'Afk'\n}\n\nclass ChatRoomStatusManager {\n\tInputTimeoutMs = 3_000;\n\n\t// Required for NMod!\n\tStatusTypes = {};\n\n\tprivate InputElement: HTMLTextAreaElement | null = null;\n\n\tprivate InputTimeout: number | null = null;\n\n\tStatus: ChatRoomStatusManagerStatusType = ChatRoomStatusManagerStatusType.None;\n\n\t// Status triggers\n\tDMS: boolean = false;\n\tprivate TypingStatus: ChatRoomStatusManagerStatusType = ChatRoomStatusManagerStatusType.None;\n\tprivate WhisperTarget: number | null = null;\n\n\tGetCharacterStatus(C: Character): string | undefined {\n\t\treturn C.ID === 0 ? ChatroomSM.Status : C.Status;\n\t}\n\n\tSetInputElement(elem: HTMLTextAreaElement | null) {\n\t\tif (this.InputElement !== elem) {\n\t\t\tthis.InputElement = elem;\n\t\t\tif (elem !== null) {\n\t\t\t\telem.addEventListener(\"blur\", this.InputEnd.bind(this));\n\t\t\t\telem.addEventListener(\"input\", this.InputChange.bind(this));\n\t\t\t}\n\t\t}\n\t}\n\n\tGetStatus(): ChatRoomStatusManagerStatusType {\n\t\tif (this.DMS)\n\t\t\treturn ChatRoomStatusManagerStatusType.DMS;\n\t\tif (modStorage.screenIndicatorEnable) {\n\t\t\tif (CurrentScreen === \"Appearance\")\n\t\t\t\treturn ChatRoomStatusManagerStatusType.Wardrobe;\n\t\t\tif (CurrentScreen === \"OnlineProfile\" || getCurrentSubscreen() != null)\n\t\t\t\treturn ChatRoomStatusManagerStatusType.Profile;\n\t\t}\n\t\tif (modStorage.typingIndicatorEnable)\n\t\t\treturn this.TypingStatus;\n\t\treturn ChatRoomStatusManagerStatusType.None;\n\t}\n\n\tUpdateStatus() {\n\t\tconst newStatus = this.GetStatus();\n\t\tif (newStatus !== this.Status) {\n\t\t\tif (this.WhisperTarget !== null && newStatus === ChatRoomStatusManagerStatusType.Whisper) {\n\t\t\t\tthis.SendUpdate(ChatRoomStatusManagerStatusType.None, null);\n\t\t\t}\n\t\t\tthis.Status = newStatus;\n\t\t\tthis.SendUpdate(newStatus, newStatus === ChatRoomStatusManagerStatusType.Whisper ? this.WhisperTarget : null);\n\t\t}\n\t}\n\n\tprivate SendUpdate(type: ChatRoomStatusManagerStatusType, target: number | null = null) {\n\t\tsendHiddenMessage(\"ChatRoomStatusEvent\", { Type: type, Target: target }, target);\n\t\tconst NMod = isNModClient();\n\t\tif (NMod) ServerSend(\"ChatRoomStatusEvent\", { Type: type, Target: target });\n\t}\n\n\tInputChange() {\n\t\tconst value = this.InputElement?.value;\n\t\tif (typeof value === \"string\" && value.length > 1) {\n\t\t\tthis.TypingStatus = ChatRoomStatusManagerStatusType.Typing;\n\t\t\tthis.WhisperTarget = null;\n\t\t\tif (value.startsWith(\"*\") || value.startsWith(\"/me \") || value.startsWith(\"/emote \") || value.startsWith(\"/action \")) {\n\t\t\t\tthis.TypingStatus = ChatRoomStatusManagerStatusType.Emote;\n\t\t\t} else if (value.startsWith(\"/\") || value.startsWith(\".\")) {\n\t\t\t\treturn this.InputEnd();\n\t\t\t} else if (ChatRoomTargetMemberNumber !== null) {\n\t\t\t\tthis.TypingStatus = ChatRoomStatusManagerStatusType.Whisper;\n\t\t\t\tthis.WhisperTarget = ChatRoomTargetMemberNumber;\n\t\t\t}\n\t\t\tif (this.InputTimeout !== null) {\n\t\t\t\tclearTimeout(this.InputTimeout);\n\t\t\t}\n\t\t\tthis.InputTimeout = BCX_setTimeout(this.InputEnd.bind(this), this.InputTimeoutMs);\n\t\t\tthis.UpdateStatus();\n\t\t} else {\n\t\t\tthis.InputEnd();\n\t\t}\n\t}\n\n\tInputEnd() {\n\t\tif (this.InputTimeout !== null) {\n\t\t\tclearTimeout(this.InputTimeout);\n\t\t\tthis.InputTimeout = null;\n\t\t}\n\t\tthis.TypingStatus = ChatRoomStatusManagerStatusType.None;\n\t\tthis.UpdateStatus();\n\t}\n\n\tunload() {\n\t\tthis.DMS = false;\n\t\tthis.InputEnd();\n\t}\n}\n\nfunction DMSKeydown(ev: KeyboardEvent) {\n\tif (ev.altKey && ev.code === \"NumpadEnter\") {\n\t\tev.preventDefault();\n\t\tev.stopImmediatePropagation();\n\t\tif (document.activeElement instanceof HTMLElement) {\n\t\t\tdocument.activeElement.blur();\n\t\t}\n\t\tChatroomSM.DMS = true;\n\t\tChatroomSM.UpdateStatus();\n\t}\n}\n\nfunction DMSKeyup(ev: KeyboardEvent) {\n\tif (ChatroomSM.DMS && (ev.key === \"Alt\" || ev.code === \"NumpadEnter\")) {\n\t\tChatroomSM.DMS = false;\n\t\tChatroomSM.UpdateStatus();\n\t}\n}\n\nexport let ChatroomSM: ChatRoomStatusManager;\n\nfunction queryAnnounce() {\n\tannounceSelf(true);\n}\n\nexport class ModuleChatroom extends BaseModule {\n\tinit() {\n\t\tChatroomSM = new ChatRoomStatusManager();\n\t}\n\n\tprivate o_ChatRoomSM: any | null = null;\n\n\tload() {\n\t\tif (typeof modStorage.typingIndicatorEnable !== \"boolean\") {\n\t\t\tmodStorage.typingIndicatorEnable = true;\n\t\t}\n\t\tif (typeof modStorage.screenIndicatorEnable !== \"boolean\") {\n\t\t\tmodStorage.screenIndicatorEnable = true;\n\t\t}\n\n\t\thiddenMessageHandlers.set(\"hello\", (sender, message) => {\n\t\t\tconst char = getChatroomCharacter(sender);\n\t\t\tif (!char) {\n\t\t\t\tconsole.warn(`BCX: Hello from character not found in room`, sender);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof message?.version !== \"string\") {\n\t\t\t\tconsole.warn(`BCX: Invalid hello`, sender, message);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// if (char.BCXVersion !== message.version) {\n\t\t\t// \tconsole.log(`BCX: ${char.Character.Name} (${char.Character.MemberNumber}) uses BCX version ${message.version}`);\n\t\t\t// }\n\t\t\tchar.BCXVersion = message.version;\n\t\t\t// Apply effects\n\t\t\tconst effects: Partial<BCX_effects> = isObject(message.effects) ? message.effects : {};\n\t\t\tchar.Effects = cloneDeep(defaultBCXEffects);\n\t\t\tif (Array.isArray(effects.Effect) && effects.Effect.every(i => typeof i === \"string\")) {\n\t\t\t\tchar.Effects.Effect = effects.Effect;\n\t\t\t}\n\t\t\tCharacterRefresh(char.Character, false);\n\t\t\t// Send announcement, if requested\n\t\t\tif (message.request === true) {\n\t\t\t\tannounceSelf(false);\n\t\t\t}\n\t\t});\n\n\t\thiddenMessageHandlers.set(\"goodbye\", (sender) => {\n\t\t\tconst char = getChatroomCharacter(sender);\n\t\t\tif (char) {\n\t\t\t\tchar.BCXVersion = null;\n\t\t\t\tchar.Effects = cloneDeep(defaultBCXEffects);\n\t\t\t\tCharacterRefresh(char.Character, false);\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"ChatRoomMessage\", 10, (args, next) => {\n\t\t\tconst data = args[0];\n\n\t\t\tif (data?.Type === \"Action\" && data.Content === \"ServerEnter\") {\n\t\t\t\tannounceSelf(false);\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\tconst NMod = isNModClient();\n\n\t\tif (NMod) {\n\t\t\thookFunction(\"ChatRoomDrawFriendList\", 0, (args, next) => {\n\t\t\t\tconst [C, Zoom, CharX, CharY] = args as [Character, number, number, number];\n\t\t\t\tconst Char = getChatroomCharacter(C.MemberNumber!);\n\t\t\t\tconst Friend = C.ID === 0 || (Player.FriendList ?? []).includes(C.MemberNumber!);\n\t\t\t\tif (Char?.BCXVersion && ChatRoomHideIconState === 0) {\n\t\t\t\t\tif (Friend) {\n\t\t\t\t\t\tdrawIcon(MainCanvas, icon_heart, CharX + 375 * Zoom, CharY, 50 * Zoom, 50 * Zoom, 50, 1, 4, \"#6e6eff\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdrawIcon(MainCanvas, icon_BCX_cross, CharX + 375 * Zoom, CharY, 50 * Zoom, 50 * Zoom, 50, 0.5, 3, \"#6e6eff\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tnext(args);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpatchFunction(\"ChatRoomDrawCharacterOverlay\", {\n\t\t\t\t'switch (C.Status)': 'switch (null)'\n\t\t\t});\n\t\t} else {\n\t\t\tpatchFunction(\"ChatRoomDrawCharacterOverlay\", {\n\t\t\t\t'DrawImageResize(\"Icons/Small/FriendList.png\", CharX + 375 * Zoom, CharY, 50 * Zoom, 50 * Zoom);': \"\"\n\t\t\t});\n\n\t\t\thookFunction(\"ChatRoomDrawCharacterOverlay\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\n\t\t\t\tconst [C, CharX, CharY, Zoom] = args as [Character, number, number, number];\n\t\t\t\tconst Char = getChatroomCharacter(C.MemberNumber!);\n\t\t\t\tconst Friend = C.ID === 0 || (Player.FriendList ?? []).includes(C.MemberNumber!);\n\t\t\t\tif (Char?.BCXVersion && ChatRoomHideIconState === 0) {\n\t\t\t\t\tif (Friend) {\n\t\t\t\t\t\tdrawIcon(MainCanvas, icon_heart, CharX + 375 * Zoom, CharY, 50 * Zoom, 50 * Zoom, 50, 1, 4, \"#6e6eff\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdrawIcon(MainCanvas, icon_BCX_cross, CharX + 375 * Zoom, CharY, 50 * Zoom, 50 * Zoom, 50, 0.7, 3, \"#6e6eff\");\n\t\t\t\t\t}\n\t\t\t\t} else if (Friend && ChatRoomHideIconState === 0) {\n\t\t\t\t\tDrawImageEx(\"Icons/Small/FriendList.png\", CharX + 375 * Zoom, CharY, {\n\t\t\t\t\t\tWidth: 50 * Zoom,\n\t\t\t\t\t\tHeight: 50 * Zoom\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\thookFunction(\"ChatRoomCreateElement\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tChatroomSM.SetInputElement(document.getElementById(\"InputChat\") as HTMLTextAreaElement);\n\t\t\t});\n\t\t}\n\n\t\thookFunction(\"ChatRoomDrawCharacterOverlay\", 0, (args, next) => {\n\t\t\tnext(args);\n\n\t\t\tconst [C, CharX, CharY, Zoom] = args as [Character, number, number, number];\n\t\t\tswitch (ChatroomSM.GetCharacterStatus(C)) {\n\t\t\t\tcase ChatRoomStatusManagerStatusType.Typing:\n\t\t\t\t\tdrawTypingIndicatorSpeechBubble(MainCanvas, CharX + 375 * Zoom, CharY + 54 * Zoom, 50 * Zoom, 48 * Zoom, 1);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatRoomStatusManagerStatusType.Whisper:\n\t\t\t\t\tdrawTypingIndicatorSpeechBubble(MainCanvas, CharX + 375 * Zoom, CharY + 54 * Zoom, 50 * Zoom, 48 * Zoom, 0.5);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatRoomStatusManagerStatusType.Emote:\n\t\t\t\t\tdrawTypingIndicatorSpeechBubble(MainCanvas, CharX + 375 * Zoom, CharY + 54 * Zoom, 50 * Zoom, 48 * Zoom, 1, true);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatRoomStatusManagerStatusType.DMS:\n\t\t\t\t\tDrawRect(CharX + 380 * Zoom, CharY + 53 * Zoom, 40 * Zoom, 40 * Zoom, \"White\");\n\t\t\t\t\tDrawImageEx(\"Icons/Import.png\", CharX + 375 * Zoom, CharY + 50 * Zoom, {\n\t\t\t\t\t\tWidth: 50 * Zoom,\n\t\t\t\t\t\tHeight: 50 * Zoom\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatRoomStatusManagerStatusType.Wardrobe:\n\t\t\t\t\tDrawImageEx(\"Assets/Female3DCG/Emoticon/Wardrobe/Icon.png\", CharX + 375 * Zoom, CharY + 50 * Zoom, {\n\t\t\t\t\t\tWidth: 50 * Zoom,\n\t\t\t\t\t\tHeight: 50 * Zoom\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase ChatRoomStatusManagerStatusType.Profile:\n\t\t\t\t\tDrawImageEx(\"Assets/Female3DCG/Emoticon/Read/Icon.png\", CharX + 375 * Zoom, CharY + 50 * Zoom, {\n\t\t\t\t\t\tWidth: 50 * Zoom,\n\t\t\t\t\t\tHeight: 50 * Zoom,\n\t\t\t\t\t\tSourcePos: [7, 9, 74, 74]\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener(\"keydown\", DMSKeydown);\n\t\twindow.addEventListener(\"keyup\", DMSKeyup);\n\n\t\thookFunction(\"ChatRoomSendChat\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tChatroomSM.InputEnd();\n\t\t});\n\n\t\thookFunction(\"ChatRoomClearAllElements\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tChatroomSM.SetInputElement(null);\n\t\t});\n\n\t\t// Screen indicator\n\t\thookFunction(\"CommonSetScreen\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tChatroomSM.UpdateStatus();\n\t\t});\n\t\t// Suppress BC wardrobe indicator if BCX one is active\n\t\thookFunction(\"ServerSend\", 5, (args, next) => {\n\t\t\tif (modStorage.screenIndicatorEnable &&\n\t\t\t\targs[0] === \"ChatRoomCharacterExpressionUpdate\" &&\n\t\t\t\tisObject(args[1]) &&\n\t\t\t\targs[1].Group === \"Emoticon\" &&\n\t\t\t\targs[1].Name === \"Wardrobe\"\n\t\t\t)\n\t\t\t\treturn;\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"ChatSearchLoad\", 5, (args, next) => {\n\t\t\tnext(args);\n\t\t\tconst field = document.getElementById(\"InputSearch\") as HTMLInputElement | undefined;\n\t\t\tif (field && modStorage.roomSearchAutoFill) {\n\t\t\t\tfield.value = modStorage.roomSearchAutoFill;\n\t\t\t}\n\t\t});\n\n\t\thiddenMessageHandlers.set(\"ChatRoomStatusEvent\", (src, data: any) => {\n\t\t\tfor (const char of ChatRoomCharacter) {\n\t\t\t\tif (char.MemberNumber === src) {\n\t\t\t\t\tchar.Status = data.Target == null || data.Target === Player.MemberNumber ? data.Type : \"None\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (NMod) {\n\t\t\tthis.o_ChatRoomSM = (window as any).ChatRoomSM;\n\t\t\t(window as any).ChatRoomSM = ChatroomSM;\n\t\t\tServerSocket.on(\"ChatRoomMessageSync\", queryAnnounce);\n\t\t}\n\t}\n\n\trun() {\n\t\tif (document.getElementById(\"InputChat\") != null) {\n\t\t\tChatroomSM.SetInputElement(document.getElementById(\"InputChat\") as HTMLTextAreaElement);\n\t\t}\n\t\tqueryAnnounce();\n\t}\n\n\tunload() {\n\t\tChatroomSM.unload();\n\t\tif (this.o_ChatRoomSM) {\n\t\t\t(window as any).ChatRoomSM = this.o_ChatRoomSM;\n\t\t}\n\t\tServerSocket.off(\"ChatRoomMessageSync\", queryAnnounce);\n\t\tsendHiddenMessage(\"goodbye\", undefined);\n\n\t\twindow.removeEventListener(\"keydown\", DMSKeydown);\n\t\twindow.removeEventListener(\"keyup\", DMSKeyup);\n\t}\n}\n\nexport function announceSelf(request: boolean = false) {\n\tconst player = getPlayerCharacter();\n\tsendHiddenMessage(\"hello\", {\n\t\tversion: VERSION,\n\t\trequest,\n\t\teffects: player.Effects\n\t});\n}\n","import { VERSION_CHECK_BOT } from \"../config\";\nimport { moduleInitPhase } from \"../moduleManager\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { isObject } from \"../utils\";\nimport { announceSelf } from \"./chatroom\";\nimport { sendHiddenBeep } from \"./messaging\";\nimport { ModuleInitPhase } from \"../constants\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nexport enum StorageLocations {\n\tOnlineSettings = 0,\n\tLocalStorage = 1\n}\n\nexport let modStorage: Partial<ModStorage> = {};\nlet deletionPending = false;\nexport let firstTimeInit: boolean = false;\nexport let modStorageLocation: StorageLocations = StorageLocations.OnlineSettings;\n\nexport function finalizeFirstTimeInit() {\n\tif (!firstTimeInit)\n\t\treturn;\n\tfirstTimeInit = false;\n\tmodStorage.chatShouldDisplayFirstTimeHelp = true;\n\tmodStorageSync();\n\tconsole.log(\"BCX: First time init finalized\");\n\tannounceSelf(true);\n}\n\nfunction getLocalStorageName(): string {\n\treturn `BCX_${Player.MemberNumber}`;\n}\n\nfunction storageClearData() {\n\tdelete (Player.OnlineSettings as any).BCX;\n\tlocalStorage.removeItem(getLocalStorageName());\n\n\tif (typeof ServerAccountUpdate !== \"undefined\") {\n\t\tServerAccountUpdate.QueueData({ OnlineSettings: Player.OnlineSettings }, true);\n\t} else {\n\t\tconsole.debug(\"BCX: Old sync method\");\n\t\tServerSend(\"AccountUpdate\", { OnlineSettings: Player.OnlineSettings });\n\t}\n}\n\nexport function switchStorageLocation(location: StorageLocations) {\n\tif (location !== StorageLocations.LocalStorage && location !== StorageLocations.OnlineSettings) {\n\t\tthrow new Error(`Unknown storage location`);\n\t}\n\tif (modStorageLocation === location)\n\t\treturn;\n\tconsole.info(`BCX: Switching storage location to: ${StorageLocations[location]}`);\n\tmodStorageLocation = location;\n\tstorageClearData();\n\tmodStorageSync();\n}\n\nexport function modStorageSync() {\n\tif (moduleInitPhase !== ModuleInitPhase.ready && moduleInitPhase !== ModuleInitPhase.destroy)\n\t\treturn;\n\tif (deletionPending || firstTimeInit)\n\t\treturn;\n\tif (!Player.OnlineSettings) {\n\t\tconsole.error(\"BCX: Player OnlineSettings not defined during storage sync!\");\n\t\treturn;\n\t}\n\n\tconst serializedData = LZString.compressToBase64(JSON.stringify(modStorage));\n\n\tif (modStorageLocation === StorageLocations.OnlineSettings) {\n\t\t(Player.OnlineSettings as any).BCX = serializedData;\n\t\tif (typeof ServerAccountUpdate !== \"undefined\") {\n\t\t\tServerAccountUpdate.QueueData({ OnlineSettings: Player.OnlineSettings });\n\t\t} else {\n\t\t\tconsole.debug(\"BCX: Old sync method\");\n\t\t\tServerSend(\"AccountUpdate\", { OnlineSettings: Player.OnlineSettings });\n\t\t}\n\t} else if (modStorageLocation === StorageLocations.LocalStorage) {\n\t\tlocalStorage.setItem(getLocalStorageName(), serializedData);\n\t} else {\n\t\tthrow new Error(`Unknown StorageLocation`);\n\t}\n}\n\nexport function clearAllData() {\n\tdeletionPending = true;\n\n\tstorageClearData();\n\n\tsendHiddenBeep(\"clearData\", true, VERSION_CHECK_BOT, true);\n\tBCX_setTimeout(() => {\n\t\twindow.location.reload();\n\t}, 2000);\n}\n\nexport class ModuleStorage extends BaseModule {\n\tinit() {\n\t\tlet saved: any = null;\n\n\t\tsaved = localStorage.getItem(getLocalStorageName());\n\t\tif (typeof saved === \"string\") {\n\t\t\tconsole.info(`BCX: Detected storage location: local storage`);\n\t\t\tmodStorageLocation = StorageLocations.LocalStorage;\n\t\t}\n\n\t\tif (!saved) {\n\t\t\tsaved = (Player.OnlineSettings as any)?.BCX;\n\t\t\tmodStorageLocation = StorageLocations.OnlineSettings;\n\t\t}\n\n\t\tif (typeof saved === \"string\") {\n\t\t\ttry {\n\t\t\t\tconst storage = JSON.parse(LZString.decompressFromBase64(saved)!);\n\t\t\t\tif (!isObject(storage)) {\n\t\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t\t}\n\t\t\t\tmodStorage = storage;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"BCX: Error while loading saved data, full reset.\", error);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(\"BCX: First time init\");\n\t\t\tfirstTimeInit = true;\n\t\t}\n\t}\n\n\trun() {\n\t\tmodStorageSync();\n\t}\n}\n","import { moduleInitPhase } from \"../moduleManager\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { capitalizeFirstLetter, isObject } from \"../utils\";\nimport { ChatroomCharacter, getAllCharactersInRoom, getPlayerCharacter } from \"../characters\";\nimport { modStorage, modStorageSync } from \"./storage\";\nimport { notifyOfChange, queryHandlers } from \"./messaging\";\nimport { LogEntryType, logMessage } from \"./log\";\nimport { ChatRoomActionMessage, ChatRoomSendLocal, getCharacterName } from \"../utilsClub\";\nimport { moduleIsEnabled } from \"./presets\";\nimport { RulesGetRuleState } from \"./rules\";\nimport { ModuleCategory, ModuleInitPhase, MODULE_NAMES, Preset } from \"../constants\";\nimport { Command_fixExclamationMark, COMMAND_GENERIC_ERROR, Command_selectCharacterAutocomplete, Command_selectCharacterMemberNumber, registerWhisperCommand } from \"./commands\";\n\nexport enum AccessLevel {\n\tself = 0,\n\tclubowner = 1,\n\towner = 2,\n\tlover = 3,\n\tmistress = 4,\n\twhitelist = 5,\n\tfriend = 6,\n\tpublic = 7\n}\n\nexport interface PermissionSetup {\n\treadonly name: string;\n\treadonly category: ModuleCategory;\n\treadonly defaults: {\n\t\treadonly [p in Preset]: readonly [boolean, AccessLevel];\n\t}\n}\n\nexport interface PermissionInfo extends PermissionSetup {\n\tself: boolean;\n\tmin: AccessLevel;\n}\n\nexport type PermissionData = Partial<Record<BCX_Permissions, PermissionInfo>>;\n\nconst permissions: Map<BCX_Permissions, PermissionInfo> = new Map();\n\nexport function registerPermission(name: BCX_Permissions, data: PermissionSetup) {\n\tif (moduleInitPhase !== ModuleInitPhase.init) {\n\t\tthrow new Error(\"Permissions can be registered only during init\");\n\t}\n\tif (permissions.has(name)) {\n\t\tthrow new Error(`Permission \"${name}\" already defined!`);\n\t}\n\tfor (const [k, v] of Object.entries(data.defaults)) {\n\t\tif (v[1] === AccessLevel.self && !v[0]) {\n\t\t\tconsole.error(`BCX: register permission \"${name}\": default for ${k} has invalid self value`);\n\t\t}\n\t}\n\tpermissions.set(name, {\n\t\t...data,\n\t\tself: data.defaults[Preset.switch][0],\n\t\tmin: data.defaults[Preset.switch][1]\n\t});\n}\n\nexport function getCharacterAccessLevel(character: ChatroomCharacter | number): AccessLevel {\n\tconst memberNumber = typeof character === \"number\" ? character : character.MemberNumber;\n\tif (Player.MemberNumber === memberNumber) return AccessLevel.self;\n\tif (memberNumber !== null) {\n\t\tif (Player.IsOwnedByMemberNumber(memberNumber)) return AccessLevel.clubowner;\n\t\tif (modStorage.owners?.includes(memberNumber)) return AccessLevel.owner;\n\t\tif (Player.IsLoverOfMemberNumber(memberNumber)) return AccessLevel.lover;\n\t\tif (modStorage.mistresses?.includes(memberNumber)) return AccessLevel.mistress;\n\t\tif (Player.WhiteList.includes(memberNumber)) return AccessLevel.whitelist;\n\t\tif (Player.FriendList?.includes(memberNumber)) return AccessLevel.friend;\n\t}\n\treturn AccessLevel.public;\n}\n\n/** Returns the highest role, that is currently in room (except self), `null` if not in room or alone */\nexport function getHighestRoleInRoom(): AccessLevel | null {\n\tlet res: AccessLevel | null = null;\n\tfor (const char of getAllCharactersInRoom()) {\n\t\tconst role = getCharacterAccessLevel(char);\n\t\tif (role !== AccessLevel.self && (!res || role < res)) {\n\t\t\tres = role;\n\t\t}\n\t}\n\treturn res;\n}\n\nexport function checkPermissionAccess(permission: BCX_Permissions, character: ChatroomCharacter): boolean {\n\tconst permData = permissions.get(permission);\n\tif (!permData) {\n\t\tconsole.error(new Error(`Check for unknown permission \"${permission}\"`));\n\t\treturn false;\n\t}\n\tif (!character.hasAccessToPlayer())\n\t\treturn false;\n\tif (!moduleIsEnabled(permData.category))\n\t\treturn false;\n\tif (character.isPlayer() && selfAccessBlockedByRule(permData)) {\n\t\treturn false;\n\t}\n\treturn checkPermissionAccessData(permData, getCharacterAccessLevel(character));\n}\n\nexport function checkPermissionAccessData(permData: PermissionInfo, accessLevel: AccessLevel): boolean {\n\tif (accessLevel === AccessLevel.self) {\n\t\treturn permData.self || permData.min === AccessLevel.self;\n\t}\n\treturn accessLevel <= permData.min;\n}\n\nfunction selfAccessBlockedByRule(permData: PermissionInfo): boolean {\n\tconst blockRule = RulesGetRuleState(\"block_BCX_permissions\");\n\tif (!blockRule.isEnforced || (permData.self && permData.min === AccessLevel.self)) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nfunction permissionsMakeBundle(): PermissionsBundle {\n\tconst res: PermissionsBundle = {};\n\tfor (const [k, v] of permissions.entries()) {\n\t\tif (!moduleIsEnabled(v.category))\n\t\t\tcontinue;\n\t\tres[k] = [v.self, v.min];\n\t}\n\treturn res;\n}\n\nexport function getPermissionDataFromBundle(bundle: PermissionsBundle): PermissionData {\n\tconst res: PermissionData = {};\n\tfor (const [k, v] of permissions.entries()) {\n\t\tif (bundle[k]) {\n\t\t\tres[k] = {\n\t\t\t\t...v,\n\t\t\t\tself: bundle[k][0],\n\t\t\t\tmin: bundle[k][1]\n\t\t\t};\n\t\t}\n\t}\n\n\treturn res;\n}\n\nexport function setPermissionSelfAccess(permission: BCX_Permissions, self: boolean, characterToCheck: ChatroomCharacter | null): boolean {\n\tconst permData = permissions.get(permission);\n\tif (!permData) {\n\t\tthrow new Error(`Attempt to edit unknown permission \"${permission}\"`);\n\t}\n\n\tif (!moduleIsEnabled(permData.category))\n\t\treturn false;\n\n\tself = self || permData.min === AccessLevel.self;\n\n\tif (permData.self === self) return true;\n\n\tif (characterToCheck) {\n\t\tif (!checkPermissionAccess(self ? \"authority_grant_self\" : \"authority_revoke_self\", characterToCheck) ||\n\t\t\t!characterToCheck.isPlayer() && !checkPermissionAccess(permission, characterToCheck)\n\t\t) {\n\t\t\tconsole.warn(`BCX: Unauthorized self permission edit attempt for \"${permission}\" by ${characterToCheck}`);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tif (characterToCheck) {\n\t\tconst msg = `${characterToCheck} ` +\n\t\t\t(self ? `gave ${characterToCheck.isPlayer() ? \"herself\" : Player.Name}` : `removed ${characterToCheck?.isPlayer() ? \"her\" : Player.Name + \"'s\"}`) +\n\t\t\t` control over permission \"${permData.name}\"`;\n\t\tlogMessage(\"permission_change\", LogEntryType.plaintext, msg);\n\t\tif (!characterToCheck.isPlayer()) {\n\t\t\tChatRoomSendLocal(msg, undefined, characterToCheck.MemberNumber);\n\t\t}\n\t}\n\n\tpermData.self = self;\n\tpermissionsSync();\n\tnotifyOfChange();\n\n\treturn true;\n}\n\nexport function setPermissionMinAccess(permission: BCX_Permissions, min: AccessLevel, characterToCheck: ChatroomCharacter | null): boolean {\n\tconst permData = permissions.get(permission);\n\tif (!permData) {\n\t\tthrow new Error(`Attempt to edit unknown permission \"${permission}\"`);\n\t}\n\n\tif (!moduleIsEnabled(permData.category))\n\t\treturn false;\n\n\tif (permData.min === min) return true;\n\n\tif (characterToCheck) {\n\t\tconst allowed =\n\t\t\t// Exception: Player can always lower permissions \"Self\"->\"Owner\"\n\t\t\t(characterToCheck.isPlayer() && permData.min < min && min <= AccessLevel.owner) ||\n\t\t\t(\n\t\t\t\t// Character must have access to \"allow lowest access modification\"\n\t\t\t\tcheckPermissionAccess(\"authority_edit_min\", characterToCheck) &&\n\t\t\t\t(\n\t\t\t\t\t// Character must have access to target rule\n\t\t\t\t\tcheckPermissionAccess(permission, characterToCheck) ||\n\t\t\t\t\t// Exception: Player bypasses this check when lowering \"lowest access\"\n\t\t\t\t\tcharacterToCheck.isPlayer() && min >= permData.min\n\t\t\t\t) &&\n\t\t\t\t(\n\t\t\t\t\t// Not player must have access to target level\n\t\t\t\t\t!characterToCheck.isPlayer() ||\n\t\t\t\t\tgetCharacterAccessLevel(characterToCheck) <= min\n\t\t\t\t)\n\t\t\t);\n\t\tif (!allowed) {\n\t\t\tconsole.warn(`BCX: Unauthorized min permission edit attempt for \"${permission}\" by ${characterToCheck}`);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tif (characterToCheck) {\n\t\tconst msg = `${characterToCheck} changed permission \"${permData.name}\" from ` +\n\t\t\t`\"${getPermissionMinDisplayText(permData.min, characterToCheck)}\" to \"${getPermissionMinDisplayText(min, characterToCheck)}\"`;\n\t\tlogMessage(\"permission_change\", LogEntryType.plaintext, msg);\n\t\tif (!characterToCheck.isPlayer()) {\n\t\t\tChatRoomSendLocal(msg, undefined, characterToCheck.MemberNumber);\n\t\t}\n\t}\n\n\tpermData.min = min;\n\tif (min === AccessLevel.self) {\n\t\tpermData.self = true;\n\t}\n\tpermissionsSync();\n\tnotifyOfChange();\n\n\treturn true;\n}\n\nfunction permissionsSync() {\n\tmodStorage.permissions = permissionsMakeBundle();\n\tmodStorageSync();\n}\n\nexport function getPlayerPermissionSettings(): PermissionData {\n\tconst res: PermissionData = {};\n\tfor (const [k, v] of permissions.entries()) {\n\t\tif (!moduleIsEnabled(v.category))\n\t\t\tcontinue;\n\t\tres[k] = { ...v };\n\t}\n\treturn res;\n}\n\nexport function getPermissionMinDisplayText(minAccess: AccessLevel, character?: ChatroomCharacter): string {\n\tif (minAccess === AccessLevel.self) {\n\t\treturn character ? character.Name : \"Self\";\n\t}\n\treturn capitalizeFirstLetter(AccessLevel[minAccess]);\n}\n\nexport function getPlayerRoleData(character: ChatroomCharacter): PermissionRoleBundle {\n\tconst loadNames = (memberNumber: number): [number, string] => [memberNumber, getCharacterName(memberNumber, \"\")];\n\tlet allowedMistressList: [number, string][] = [];\n\tlet allowedOwnerList: [number, string][] = [];\n\n\tif (checkPermissionAccess(\"authority_view_roles\", character) || checkPermissionAccess(\"authority_mistress_remove\", character)) {\n\t\tallowedMistressList = (modStorage.mistresses ?? []).map(loadNames);\n\t} else if (modStorage.mistresses?.includes(character.MemberNumber)) {\n\t\tallowedMistressList = [[character.MemberNumber, character.Name]];\n\t}\n\n\tif (checkPermissionAccess(\"authority_view_roles\", character) || checkPermissionAccess(\"authority_owner_remove\", character)) {\n\t\tallowedOwnerList = (modStorage.owners ?? []).map(loadNames);\n\t} else if (modStorage.owners?.includes(character.MemberNumber)) {\n\t\tallowedOwnerList = [[character.MemberNumber, character.Name]];\n\t}\n\n\treturn {\n\t\tmistresses: allowedMistressList,\n\t\towners: allowedOwnerList,\n\t\tallowAddMistress: checkPermissionAccess(\"authority_mistress_add\", character),\n\t\tallowRemoveMistress: checkPermissionAccess(\"authority_mistress_remove\", character),\n\t\tallowAddOwner: checkPermissionAccess(\"authority_owner_add\", character),\n\t\tallowRemoveOwner: checkPermissionAccess(\"authority_owner_remove\", character)\n\t};\n}\n\nexport function editRole(role: \"owner\" | \"mistress\", action: \"add\" | \"remove\", target: number, character: ChatroomCharacter | null): boolean {\n\tif (target === Player.MemberNumber)\n\t\treturn false;\n\n\tif (!modStorage.owners || !modStorage.mistresses) {\n\t\tthrow new Error(\"Not initialized\");\n\t}\n\n\tif (character) {\n\t\tlet permissionToCheck: BCX_Permissions = \"authority_mistress_add\";\n\t\tif (role === \"mistress\" && action === \"remove\")\n\t\t\tpermissionToCheck = \"authority_mistress_remove\";\n\t\telse if (role === \"owner\" && action === \"add\")\n\t\t\tpermissionToCheck = \"authority_owner_add\";\n\t\telse if (role === \"owner\" && action === \"remove\")\n\t\t\tpermissionToCheck = \"authority_owner_remove\";\n\n\t\tif (!checkPermissionAccess(permissionToCheck, character) && (action !== \"remove\" || target !== character.MemberNumber))\n\t\t\treturn false;\n\n\t\tif (\n\t\t\trole === \"mistress\" && action === \"add\" && modStorage.owners.includes(target) && !checkPermissionAccess(\"authority_owner_remove\", character)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tif (\n\t\trole === \"owner\" && action === \"remove\" && !modStorage.owners.includes(target) ||\n\t\trole === \"mistress\" && action === \"remove\" && !modStorage.mistresses.includes(target)\n\t) {\n\t\treturn true;\n\t}\n\n\tif (character) {\n\t\tconst targetDescriptor = character.MemberNumber === target ? \"herself\" : `${getCharacterName(target, \"[unknown name]\")} (${target})`;\n\t\tconst msg = action === \"add\" ?\n\t\t\t`${character} added ${targetDescriptor} as ${role}.` :\n\t\t\t`${character} removed ${targetDescriptor} from being ${role}.`;\n\t\tlogMessage(\"authority_roles_change\", LogEntryType.plaintext, msg);\n\t\tif (!character.isPlayer()) {\n\t\t\tChatRoomSendLocal(msg, undefined, character.MemberNumber);\n\t\t}\n\t\tif (action === \"add\" && character.MemberNumber !== target) {\n\t\t\tconst user = character.isPlayer() ? \"her\" : `${Player.Name}'s (${Player.MemberNumber})`;\n\t\t\tChatRoomActionMessage(`${character} added you as ${user} BCX ${role}.`, target);\n\t\t}\n\t}\n\n\tconst ownerIndex = modStorage.owners.indexOf(target);\n\tif (ownerIndex >= 0) {\n\t\tmodStorage.owners.splice(ownerIndex, 1);\n\t}\n\n\tconst mistressIndex = modStorage.mistresses.indexOf(target);\n\tif (mistressIndex >= 0) {\n\t\tmodStorage.mistresses.splice(mistressIndex, 1);\n\t}\n\n\tif (action === \"add\") {\n\t\tif (role === \"owner\") {\n\t\t\tmodStorage.owners.push(target);\n\t\t} else if (role === \"mistress\") {\n\t\t\tmodStorage.mistresses.push(target);\n\t\t}\n\t}\n\n\tmodStorageSync();\n\tnotifyOfChange();\n\treturn true;\n}\n\nexport class ModuleAuthority extends BaseModule {\n\tinit() {\n\t\tregisterPermission(\"authority_grant_self\", {\n\t\t\tname: \"Allow granting self access\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.owner],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_revoke_self\", {\n\t\t\tname: \"Allow forbidding self access\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.self],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_edit_min\", {\n\t\t\tname: \"Allow lowest access modification\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.self],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_mistress_add\", {\n\t\t\tname: \"Allow granting Mistress status\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.mistress]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_mistress_remove\", {\n\t\t\tname: \"Allow revoking Mistress status\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.lover],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.lover]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_owner_add\", {\n\t\t\tname: \"Allow granting Owner status\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.clubowner],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.owner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_owner_remove\", {\n\t\t\tname: \"Allow revoking Owner status\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.self],\n\t\t\t\t[Preset.submissive]: [false, AccessLevel.clubowner],\n\t\t\t\t[Preset.slave]: [false, AccessLevel.clubowner]\n\t\t\t}\n\t\t});\n\t\tregisterPermission(\"authority_view_roles\", {\n\t\t\tname: \"Allow viewing list of owners/mistresses\",\n\t\t\tcategory: ModuleCategory.Authority,\n\t\t\tdefaults: {\n\t\t\t\t[Preset.dominant]: [true, AccessLevel.self],\n\t\t\t\t[Preset.switch]: [true, AccessLevel.mistress],\n\t\t\t\t[Preset.submissive]: [true, AccessLevel.whitelist],\n\t\t\t\t[Preset.slave]: [true, AccessLevel.public]\n\t\t\t}\n\t\t});\n\n\t\tqueryHandlers.permissions = (sender, resolve) => {\n\t\t\tresolve(true, permissionsMakeBundle());\n\t\t};\n\t\tqueryHandlers.permissionAccess = (sender, resolve, data) => {\n\t\t\tif (typeof data === \"string\") {\n\t\t\t\tresolve(true, checkPermissionAccess(data, sender));\n\t\t\t} else {\n\t\t\t\tresolve(false);\n\t\t\t}\n\t\t};\n\t\tqueryHandlers.myAccessLevel = (sender, resolve) => {\n\t\t\tresolve(true, getCharacterAccessLevel(sender));\n\t\t};\n\t\tqueryHandlers.editPermission = (sender, resolve, data) => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\ttypeof data.permission !== \"string\" ||\n\t\t\t\t(data.edit !== \"min\" && data.edit !== \"self\") ||\n\t\t\t\t(data.edit === \"min\" && typeof data.target !== \"number\") ||\n\t\t\t\t(data.edit === \"self\" && typeof data.target !== \"boolean\")\n\t\t\t) {\n\t\t\t\tconsole.warn(`BCX: Bad editPermission query from ${sender}`, data);\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tif (!permissions.has(data.permission)) {\n\t\t\t\tconsole.warn(`BCX: editPermission query from ${sender}; unknown permission`, data);\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tif (data.edit === \"self\") {\n\t\t\t\tif (typeof data.target !== \"boolean\") {\n\t\t\t\t\tthrow new Error(\"Assertion failed\");\n\t\t\t\t}\n\t\t\t\treturn resolve(true, setPermissionSelfAccess(data.permission, data.target, sender));\n\t\t\t} else {\n\t\t\t\tif (typeof data.target !== \"number\") {\n\t\t\t\t\tthrow new Error(\"Assertion failed\");\n\t\t\t\t}\n\t\t\t\tif (AccessLevel[data.target] === undefined) {\n\t\t\t\t\tconsole.warn(`BCX: editPermission query from ${sender}; unknown access level`, data);\n\t\t\t\t\treturn resolve(true, false);\n\t\t\t\t}\n\t\t\t\treturn resolve(true, setPermissionMinAccess(data.permission, data.target, sender));\n\t\t\t}\n\t\t};\n\n\t\tqueryHandlers.rolesData = (sender, resolve) => {\n\t\t\tif (\n\t\t\t\t!checkPermissionAccess(\"authority_view_roles\", sender) &&\n\t\t\t\t!checkPermissionAccess(\"authority_mistress_add\", sender) &&\n\t\t\t\t!checkPermissionAccess(\"authority_mistress_remove\", sender) &&\n\t\t\t\t!checkPermissionAccess(\"authority_owner_add\", sender) &&\n\t\t\t\t!checkPermissionAccess(\"authority_owner_remove\", sender) &&\n\t\t\t\t!modStorage.mistresses?.includes(sender.MemberNumber) &&\n\t\t\t\t!modStorage.owners?.includes(sender.MemberNumber)\n\t\t\t) {\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tresolve(true, getPlayerRoleData(sender));\n\t\t};\n\n\t\tqueryHandlers.editRole = (sender, resolve, data) => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\tdata.type !== \"owner\" && data.type !== \"mistress\" ||\n\t\t\t\tdata.action !== \"add\" && data.action !== \"remove\" ||\n\t\t\t\ttypeof data.target !== \"number\"\n\t\t\t) {\n\t\t\t\tconsole.warn(`BCX: Bad editRole query from ${sender}`, data);\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\n\t\t\tresolve(true, editRole(data.type, data.action, data.target, sender));\n\t\t};\n\n\t\tregisterWhisperCommand(\"role\", \"- Manage Owner & Mistress roles\", (argv, sender, respond) => {\n\t\t\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase();\n\t\t\tif (subcommand === \"list\") {\n\t\t\t\tif (\n\t\t\t\t\t!checkPermissionAccess(\"authority_view_roles\", sender) &&\n\t\t\t\t\t!checkPermissionAccess(\"authority_mistress_add\", sender) &&\n\t\t\t\t\t!checkPermissionAccess(\"authority_mistress_remove\", sender) &&\n\t\t\t\t\t!checkPermissionAccess(\"authority_owner_add\", sender) &&\n\t\t\t\t\t!checkPermissionAccess(\"authority_owner_remove\", sender) &&\n\t\t\t\t\t!modStorage.mistresses?.includes(sender.MemberNumber) &&\n\t\t\t\t\t!modStorage.owners?.includes(sender.MemberNumber)\n\t\t\t\t) {\n\t\t\t\t\treturn respond(COMMAND_GENERIC_ERROR);\n\t\t\t\t}\n\t\t\t\tconst data = getPlayerRoleData(sender);\n\t\t\t\tlet res = \"Visible list:\";\n\t\t\t\tfor (const owner of data.owners) {\n\t\t\t\t\tres += `\\nOwner ${owner[1] || \"[unknown name]\"} (${owner[0]})`;\n\t\t\t\t}\n\t\t\t\tfor (const mistress of data.mistresses) {\n\t\t\t\t\tres += `\\nMistress ${mistress[1] || \"[unknown name]\"} (${mistress[0]})`;\n\t\t\t\t}\n\t\t\t\trespond(res);\n\t\t\t} else if (subcommand === \"owner\" || subcommand === \"mistress\") {\n\t\t\t\tconst subcommand2 = (argv[1] || \"\").toLocaleLowerCase();\n\t\t\t\tif (subcommand2 !== \"add\" && subcommand2 !== \"remove\") {\n\t\t\t\t\treturn respond(`Expected either 'add' or 'remove', got '${subcommand2}'`);\n\t\t\t\t}\n\t\t\t\tif (!argv[2]) {\n\t\t\t\t\treturn respond(`Missing required argument: target`);\n\t\t\t\t}\n\t\t\t\tconst target = Command_selectCharacterMemberNumber(argv[2], true);\n\t\t\t\tif (typeof target === \"string\") {\n\t\t\t\t\treturn respond(target);\n\t\t\t\t}\n\t\t\t\trespond(editRole(subcommand, subcommand2, target, sender) ? \"Ok!\" : COMMAND_GENERIC_ERROR);\n\t\t\t} else {\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!role usage:\\n` +\n\t\t\t\t\t`!role list - List all current owners/mistresses\\n` +\n\t\t\t\t\t`!role owner <add/remove> <target> - Add or remove target as owner\\n` +\n\t\t\t\t\t`!role mistress <add/remove> <target> - Add or remove target as mistress`\n\t\t\t\t));\n\t\t\t}\n\t\t}, (argv, sender) => {\n\t\t\tif (argv.length <= 1) {\n\t\t\t\tconst c = argv[0].toLocaleLowerCase();\n\t\t\t\treturn [\"list\", \"owner\", \"mistress\"].filter(i => i.startsWith(c));\n\t\t\t}\n\t\t\tconst subcommand = argv[0].toLocaleLowerCase();\n\t\t\tif (subcommand === \"owner\" || subcommand === \"mistress\") {\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\tconst c = argv[1].toLocaleLowerCase();\n\t\t\t\t\treturn [\"add\", \"remove\"].filter(i => i.startsWith(c));\n\t\t\t\t}\n\t\t\t\tconst subcommand2 = argv[1].toLocaleLowerCase();\n\t\t\t\tif (subcommand2 === \"add\" || subcommand2 === \"remove\") {\n\t\t\t\t\treturn Command_selectCharacterAutocomplete(argv[2]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\n\t\tregisterWhisperCommand(\"permission\", \"- Manage permissions\", (argv, sender, respond) => {\n\t\t\tconst subcommand = (argv[0] || \"\").toLocaleLowerCase();\n\t\t\tconst permissionsList = getPlayerPermissionSettings();\n\t\t\tif (subcommand === \"list\") {\n\t\t\t\tconst categories: Map<ModuleCategory, PermissionData> = new Map();\n\t\t\t\tlet hasAny = false;\n\t\t\t\tconst filter = argv.slice(1).map(v => v.toLocaleLowerCase());\n\t\t\t\tfor (const [k, v] of Object.entries(permissionsList)) {\n\t\t\t\t\tif (filter.some(i =>\n\t\t\t\t\t\t!MODULE_NAMES[v.category].toLocaleLowerCase().includes(i) &&\n\t\t\t\t\t\t!v.name.toLocaleLowerCase().includes(i) &&\n\t\t\t\t\t\t!k.toLocaleLowerCase().includes(i)\n\t\t\t\t\t)) continue;\n\t\t\t\t\tlet permdata = categories.get(v.category);\n\t\t\t\t\tif (!permdata) {\n\t\t\t\t\t\tcategories.set(v.category, permdata = {});\n\t\t\t\t\t}\n\t\t\t\t\thasAny = true;\n\t\t\t\t\tpermdata[k as BCX_Permissions] = v;\n\t\t\t\t}\n\t\t\t\tif (!hasAny) {\n\t\t\t\t\treturn respond(\"No permission matches the filter!\");\n\t\t\t\t}\n\t\t\t\tfor (const [category, data] of Array.from(categories.entries()).sort((a, b) => a[0] - b[0])) {\n\t\t\t\t\tlet result = `List of ${MODULE_NAMES[category]} module permissions:`;\n\t\t\t\t\tfor (const [k, v] of Object.entries(data).sort((a, b) => a[1].name.localeCompare(b[1].name))) {\n\t\t\t\t\t\tresult += `\\n${k}:\\n  ${v.name} - ${v.self ? \"self\" : \"not self\"}, ${getPermissionMinDisplayText(v.min, getPlayerCharacter())}`;\n\t\t\t\t\t}\n\t\t\t\t\trespond(result);\n\t\t\t\t\tresult = \"\";\n\t\t\t\t}\n\t\t\t} else if (permissionsList[subcommand as BCX_Permissions] !== undefined) {\n\t\t\t\tconst subcommand2 = (argv[1] || \"\").toLocaleLowerCase();\n\t\t\t\tlet subcommand3 = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\t\tif (subcommand2 === \"\") {\n\t\t\t\t\tconst v = permissionsList[subcommand as BCX_Permissions]!;\n\t\t\t\t\trespond(`${subcommand}:\\n  ${v.name} - ${v.self ? \"self\" : \"not self\"}, ${getPermissionMinDisplayText(v.min, getPlayerCharacter())}`);\n\t\t\t\t} else if (subcommand2 === \"selfaccess\") {\n\t\t\t\t\tif (subcommand3 === \"yes\" || subcommand3 === \"no\") {\n\t\t\t\t\t\trespond(setPermissionSelfAccess(subcommand as BCX_Permissions, subcommand3 === \"yes\", sender) ? \"Ok!\" : COMMAND_GENERIC_ERROR);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trespond(`Expected 'selfaccess yes' or 'selfaccess no'`);\n\t\t\t\t\t}\n\t\t\t\t} else if (subcommand2 === \"lowestaccess\") {\n\t\t\t\t\tif (subcommand3 === Player.Name.toLocaleLowerCase()) {\n\t\t\t\t\t\tsubcommand3 = \"self\";\n\t\t\t\t\t}\n\t\t\t\t\tconst level = (AccessLevel as any)[subcommand3] as AccessLevel;\n\t\t\t\t\tif (typeof level === \"number\") {\n\t\t\t\t\t\trespond(setPermissionMinAccess(subcommand as BCX_Permissions, level, sender) ? \"Ok!\" : COMMAND_GENERIC_ERROR);\n\t\t\t\t\t} else {\n\t\t\t\t\t\trespond(`Unknown AccessLevel '${subcommand3}';\\n` +\n\t\t\t\t\t\t\t`expected one of: ${Player.Name}, clubowner, owner, lover, mistress, whitelist, friend, public`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trespond(`Unknown setting '${subcommand2}'; expected 'selfaccess' or 'lowestaccess'`);\n\t\t\t\t}\n\t\t\t} else if (subcommand !== \"help\") {\n\t\t\t\trespond(`Unknown permission '${subcommand}'.\\n` +\n\t\t\t\t\t`To get list of permissions use '${sender.isPlayer() ? \".\" : \"!\"}permission list'`\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\trespond(Command_fixExclamationMark(sender, `!permission usage:\\n` +\n\t\t\t\t\t`!permission list [filter] - List all permissions and their current settings\\n` +\n\t\t\t\t\t`!permission <name> selfaccess <yes|no> - Gives or revokes ${Player.Name}'s access to permission <name>\\n` +\n\t\t\t\t\t`!permission <name> lowestaccess <${Player.Name}|clubowner|owner|lover|mistress|whitelist|friend|public> - Sets the lowest permitted role for the permission <name>`\n\t\t\t\t));\n\t\t\t}\n\t\t}, (argv, sender) => {\n\t\t\tconst permissionNames = Object.keys(getPlayerPermissionSettings());\n\t\t\tif (argv.length <= 1) {\n\t\t\t\tconst c = argv[0].toLocaleLowerCase();\n\t\t\t\treturn [\"list\", ...permissionNames].filter(i => i.startsWith(c));\n\t\t\t}\n\n\t\t\tconst subcommand = argv[0].toLocaleLowerCase();\n\n\t\t\tif (permissionNames.includes(subcommand)) {\n\t\t\t\tconst subcommand2 = argv[1].toLocaleLowerCase();\n\t\t\t\tconst subcommand3 = (argv[2] || \"\").toLocaleLowerCase();\n\t\t\t\tif (argv.length === 2) {\n\t\t\t\t\treturn [\"selfaccess\", \"lowestaccess\"].filter(i => i.startsWith(subcommand2));\n\t\t\t\t} else if (argv.length === 3) {\n\t\t\t\t\tif (subcommand2 === \"selfaccess\") {\n\t\t\t\t\t\treturn [\"yes\", \"no\"].filter(i => i.startsWith(subcommand3));\n\t\t\t\t\t} else if (subcommand2 === \"lowestaccess\") {\n\t\t\t\t\t\treturn [Player.Name.toLocaleLowerCase(), \"self\", \"clubowner\", \"owner\", \"lover\", \"mistress\", \"whitelist\", \"friend\", \"public\"]\n\t\t\t\t\t\t\t.filter(i => i.startsWith(subcommand3));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn [];\n\t\t});\n\t}\n\n\tprivate setDefultPermissionsForPreset(preset: Preset) {\n\t\tfor (const permission of permissions.values()) {\n\t\t\tpermission.self = permission.defaults[preset][0];\n\t\t\tpermission.min = permission.defaults[preset][1];\n\t\t}\n\t}\n\n\tapplyPreset(preset: Preset) {\n\t\tthis.setDefultPermissionsForPreset(preset);\n\t\tmodStorage.permissions = permissionsMakeBundle();\n\t}\n\n\tload(preset: Preset) {\n\t\tthis.setDefultPermissionsForPreset(preset);\n\n\t\tif (isObject(modStorage.permissions)) {\n\t\t\tconst transitionDictionary: Record<string, BCX_Permissions> = {\n\t\t\t\tlog_leaveMessage: \"log_add_note\"\n\t\t\t};\n\t\t\tfor (const [k, v] of Object.entries(modStorage.permissions)) {\n\t\t\t\tif (transitionDictionary[k] !== undefined) {\n\t\t\t\t\tconsole.info(`BCX: Updating permission name \"${k}\"->\"${transitionDictionary[k]}\"`);\n\t\t\t\t}\n\t\t\t\tconst perm = permissions.get((transitionDictionary[k] ?? k) as BCX_Permissions);\n\t\t\t\tif (!Array.isArray(v) || typeof v[0] !== \"boolean\" || typeof v[1] !== \"number\") {\n\t\t\t\t\tconsole.warn(`BCX: Storage: bad permission ${k}`);\n\t\t\t\t} else if (AccessLevel[v[1]] === undefined) {\n\t\t\t\t\tconsole.warn(`BCX: Storage: bad permission ${k} level ${v[1]}`);\n\t\t\t\t} else if (perm === undefined) {\n\t\t\t\t\tconsole.warn(`BCX: Storage: unknown permission ${k}`);\n\t\t\t\t} else {\n\t\t\t\t\tperm.self = v[0];\n\t\t\t\t\tperm.min = v[1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmodStorage.permissions = permissionsMakeBundle();\n\n\t\tconst seen = new Set<number>();\n\t\tconst test = (i: number): boolean => {\n\t\t\tif (typeof i !== \"number\" || i === Player.MemberNumber || seen.has(i))\n\t\t\t\treturn false;\n\t\t\tseen.add(i);\n\t\t\treturn true;\n\t\t};\n\t\tif (!Array.isArray(modStorage.owners)) {\n\t\t\tmodStorage.owners = [];\n\t\t} else {\n\t\t\tmodStorage.owners = modStorage.owners.filter(test);\n\t\t}\n\t\tif (!Array.isArray(modStorage.mistresses)) {\n\t\t\tmodStorage.mistresses = [];\n\t\t} else {\n\t\t\tmodStorage.mistresses = modStorage.mistresses.filter(test);\n\t\t}\n\t}\n\n\treload(preset: Preset) {\n\t\tthis.load(preset);\n\t}\n}\n","import { VERSION } from \"./config\";\nimport { ConditionsLimit, defaultBCXEffects, ModuleCategory, TOGGLEABLE_MODULES } from \"./constants\";\nimport { AccessLevel, checkPermissionAccess, editRole, getPermissionDataFromBundle, getPlayerPermissionSettings, getPlayerRoleData, PermissionData, setPermissionMinAccess, setPermissionSelfAccess } from \"./modules/authority\";\nimport { ConditionsCategoryUpdate, ConditionsGetCategoryEnabled, ConditionsGetCategoryPublicData, ConditionsSetLimit, ConditionsUpdate, guard_ConditionsCategoryPublicData } from \"./modules/conditions\";\nimport { curseItem, curseLift, curseBatch, curseLiftAll } from \"./modules/curses\";\nimport { getVisibleLogEntries, LogAccessLevel, logClear, LogConfig, logConfigSet, LogEntry, logGetAllowedActions, logGetConfig, logMessageDelete, logPraise } from \"./modules/log\";\nimport { sendQuery } from \"./modules/messaging\";\nimport { getDisabledModules } from \"./modules/presets\";\nimport { RulesCreate, RulesDelete } from \"./modules/rules\";\nimport { modStorage } from \"./modules/storage\";\nimport { isObject } from \"./utils\";\nimport { BaseModule } from \"./modules/_BaseModule\";\nimport { hookFunction } from \"./patching\";\nimport { announceSelf } from \"./modules/chatroom\";\nimport { BCX_setInterval } from \"./BCXContext\";\n\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport isEqual from \"lodash-es/isEqual\";\n\nexport const PLAYER_EFFECT_REBUILD_INTERVAL = 2_000;\n\nexport class ChatroomCharacter {\n\tisPlayer(): this is PlayerCharacter {\n\t\treturn false;\n\t}\n\n\tBCXVersion: string | null = null;\n\tCharacter: Character;\n\tEffects: BCX_effects;\n\n\tget MemberNumber(): number {\n\t\tif (typeof this.Character.MemberNumber !== \"number\") {\n\t\t\tthrow new Error(\"Character without MemberNumber\");\n\t\t}\n\t\treturn this.Character.MemberNumber;\n\t}\n\n\tget Name(): string {\n\t\treturn this.Character.Name;\n\t}\n\n\ttoString(): string {\n\t\treturn `${this.Name} (${this.MemberNumber})`;\n\t}\n\n\tconstructor(character: Character) {\n\t\tthis.Character = character;\n\t\tif (character.ID === 0) {\n\t\t\tthis.BCXVersion = VERSION;\n\t\t}\n\t\tthis.Effects = cloneDeep(defaultBCXEffects);\n\t\tconsole.debug(`BCX: Loaded character ${character.Name} (${character.MemberNumber})`);\n\t}\n\n\tgetDisabledModules(timeout?: number): Promise<ModuleCategory[]> {\n\t\treturn sendQuery(\"disabledModules\", undefined, this.MemberNumber, timeout).then(data => {\n\t\t\tif (!Array.isArray(data)) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'disabledModules' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\n\t\t\treturn data.filter(i => TOGGLEABLE_MODULES.includes(i));\n\t\t});\n\t}\n\n\tgetPermissions(): Promise<PermissionData> {\n\t\treturn sendQuery(\"permissions\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\tObject.values(data).some(v =>\n\t\t\t\t\t!Array.isArray(v) ||\n\t\t\t\t\ttypeof v[0] !== \"boolean\" ||\n\t\t\t\t\ttypeof v[1] !== \"number\" ||\n\t\t\t\t\tAccessLevel[v[1]] === undefined\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'permissions' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\n\t\t\treturn getPermissionDataFromBundle(data);\n\t\t});\n\t}\n\n\tgetPermissionAccess(permission: BCX_Permissions): Promise<boolean> {\n\t\treturn sendQuery(\"permissionAccess\", permission, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'permissionAccess' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t}).catch(err => {\n\t\t\tconsole.error(`BCX: Error while querying permission \"${permission}\" access for ${this}`, err);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tgetMyAccessLevel(): Promise<AccessLevel> {\n\t\treturn sendQuery(\"myAccessLevel\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"number\" || AccessLevel[data] === undefined) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'myAccessLevel' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tsetPermission(permission: BCX_Permissions, type: \"self\", target: boolean): Promise<boolean>\n\tsetPermission(permission: BCX_Permissions, type: \"min\", target: AccessLevel): Promise<boolean>\n\tsetPermission(permission: BCX_Permissions, type: \"self\" | \"min\", target: boolean | AccessLevel): Promise<boolean> {\n\t\treturn sendQuery(\"editPermission\", {\n\t\t\tpermission,\n\t\t\tedit: type,\n\t\t\ttarget\n\t\t}, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'editPermission' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tgetRolesData(): Promise<PermissionRoleBundle> {\n\t\treturn sendQuery(\"rolesData\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\t!Array.isArray(data.mistresses) ||\n\t\t\t\t!data.mistresses.every(i => Array.isArray(i) && i.length === 2 && typeof i[0] === \"number\" && typeof i[1] === \"string\") ||\n\t\t\t\t!Array.isArray(data.owners) ||\n\t\t\t\t!data.owners.every(i => Array.isArray(i) && i.length === 2 && typeof i[0] === \"number\" && typeof i[1] === \"string\") ||\n\t\t\t\ttypeof data.allowAddMistress !== \"boolean\" ||\n\t\t\t\ttypeof data.allowRemoveMistress !== \"boolean\" ||\n\t\t\t\ttypeof data.allowAddOwner !== \"boolean\" ||\n\t\t\t\ttypeof data.allowRemoveOwner !== \"boolean\"\n\t\t\t) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'rolesData' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\teditRole(role: \"owner\" | \"mistress\", action: \"add\" | \"remove\", target: number): Promise<boolean> {\n\t\treturn sendQuery(\"editRole\", {\n\t\t\ttype: role,\n\t\t\taction,\n\t\t\ttarget\n\t\t}, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'editRole' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tgetLogEntries(): Promise<LogEntry[]> {\n\t\treturn sendQuery(\"logData\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (\n\t\t\t\t!Array.isArray(data) ||\n\t\t\t\t!data.every(e =>\n\t\t\t\t\tArray.isArray(e) &&\n\t\t\t\t\te.length === 4 &&\n\t\t\t\t\ttypeof e[0] === \"number\" &&\n\t\t\t\t\ttypeof e[1] === \"number\" &&\n\t\t\t\t\ttypeof e[2] === \"number\"\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logData' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tlogMessageDelete(time: number): Promise<boolean> {\n\t\treturn sendQuery(\"logDelete\", time, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logDelete' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tgetLogConfig(): Promise<LogConfig> {\n\t\treturn sendQuery(\"logConfigGet\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\tObject.values(data).some(v => typeof v !== \"number\")\n\t\t\t) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logConfigGet' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\tfor (const k of Object.keys(data) as BCX_LogCategory[]) {\n\t\t\t\tif (data[k] == null || modStorage.logConfig?.[k] === undefined || LogAccessLevel[data[k]!] === undefined) {\n\t\t\t\t\tdelete data[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tsetLogConfig(category: BCX_LogCategory, target: LogAccessLevel): Promise<boolean> {\n\t\treturn sendQuery(\"logConfigEdit\", {\n\t\t\tcategory,\n\t\t\ttarget\n\t\t}, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logConfigEdit' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tlogClear(): Promise<boolean> {\n\t\treturn sendQuery(\"logClear\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logClear' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tlogPraise(value: -1 | 0 | 1, message: string | null): Promise<boolean> {\n\t\treturn sendQuery(\"logPraise\", {\n\t\t\tmessage,\n\t\t\tvalue\n\t\t}, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logPraise' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tlogGetAllowedActions(): Promise<BCX_logAllowedActions> {\n\t\treturn sendQuery(\"logGetAllowedActions\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (!isObject(data) ||\n\t\t\t\ttypeof data.delete !== \"boolean\" ||\n\t\t\t\ttypeof data.configure !== \"boolean\" ||\n\t\t\t\ttypeof data.praise !== \"boolean\" ||\n\t\t\t\ttypeof data.leaveMessage !== \"boolean\"\n\t\t\t) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'logGetAllowedActions' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tcurseItem(Group: string, curseProperties: boolean | null): Promise<boolean> {\n\t\treturn sendQuery(\"curseItem\", { Group, curseProperties }, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'curseItem' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tcurseLift(Group: string): Promise<boolean> {\n\t\treturn sendQuery(\"curseLift\", Group, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'curseLift' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tcurseBatch(mode: \"items\" | \"clothes\", includingEmpty: boolean): Promise<boolean> {\n\t\treturn sendQuery(\"curseBatch\", { mode, includingEmpty }, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'curseBatch' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tcurseLiftAll(): Promise<boolean> {\n\t\treturn sendQuery(\"curseLiftAll\", undefined, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'curseLiftAll' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tconditionsGetByCategory<C extends ConditionsCategories>(category: C): Promise<ConditionsCategoryPublicData<C>> {\n\t\treturn sendQuery(\"conditionsGet\", category, this.MemberNumber).then(data => {\n\t\t\tif (!guard_ConditionsCategoryPublicData(category, data, true)) {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'conditionsGet' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tconditionSetLimit<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], limit: ConditionsLimit): Promise<boolean> {\n\t\treturn sendQuery(\"conditionSetLimit\", { category, condition, limit }, this.MemberNumber).then(data => {\n\t\t\tif (typeof data !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'conditionSetLimit' query\\n\", data);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tconditionUpdate<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], data: ConditionsConditionPublicData<C>): Promise<boolean> {\n\t\treturn sendQuery(\"conditionUpdate\", { category, condition, data }, this.MemberNumber).then(res => {\n\t\t\tif (typeof res !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'conditionUpdate' query\\n\", res);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t}\n\n\tconditionCategoryUpdate<C extends ConditionsCategories>(category: C, data: ConditionsCategoryConfigurableData): Promise<boolean> {\n\t\treturn sendQuery(\"conditionCategoryUpdate\", { category, data }, this.MemberNumber).then(res => {\n\t\t\tif (typeof res !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'conditionCategoryUpdate' query\\n\", res);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t}\n\n\truleCreate(name: BCX_Rule): Promise<boolean> {\n\t\treturn sendQuery(\"ruleCreate\", name, this.MemberNumber).then(res => {\n\t\t\tif (typeof res !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'ruleCreate' query\\n\", res);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t}\n\n\truleDelete(name: BCX_Rule): Promise<boolean> {\n\t\treturn sendQuery(\"ruleDelete\", name, this.MemberNumber).then(res => {\n\t\t\tif (typeof res !== \"boolean\") {\n\t\t\t\tconsole.error(\"BCX: Bad data during 'ruleDelete' query\\n\", res);\n\t\t\t\tthrow new Error(\"Bad data\");\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t}\n\n\thasAccessToPlayer(): boolean {\n\t\treturn ServerChatRoomGetAllowItem(this.Character, Player);\n\t}\n\n\tplayerHasAccessToCharacter(): boolean {\n\t\treturn ServerChatRoomGetAllowItem(Player, this.Character);\n\t}\n}\n\nexport class PlayerCharacter extends ChatroomCharacter {\n\t/** HACK: Otherwise TS wrongly assumes PlayerCharacter to be identical to ChatroomCharacter */\n\tpublic readonly playerObject = true;\n\n\toverride isPlayer(): this is PlayerCharacter {\n\t\treturn true;\n\t}\n\n\toverride getDisabledModules(): Promise<ModuleCategory[]> {\n\t\treturn Promise.resolve(getDisabledModules());\n\t}\n\n\toverride getPermissions(): Promise<PermissionData> {\n\t\treturn Promise.resolve(getPlayerPermissionSettings());\n\t}\n\n\toverride getPermissionAccess(permission: BCX_Permissions): Promise<boolean> {\n\t\treturn Promise.resolve(checkPermissionAccess(permission, this));\n\t}\n\n\toverride getMyAccessLevel(): Promise<AccessLevel.self> {\n\t\treturn Promise.resolve(AccessLevel.self);\n\t}\n\n\toverride setPermission(permission: BCX_Permissions, type: \"self\", target: boolean): Promise<boolean>\n\toverride setPermission(permission: BCX_Permissions, type: \"min\", target: AccessLevel): Promise<boolean>\n\toverride setPermission(permission: BCX_Permissions, type: \"self\" | \"min\", target: boolean | AccessLevel): Promise<boolean> {\n\t\tif (type === \"self\") {\n\t\t\tif (typeof target !== \"boolean\") {\n\t\t\t\tthrow new Error(\"Invalid target value for self permission edit\");\n\t\t\t}\n\t\t\treturn Promise.resolve(setPermissionSelfAccess(permission, target, this));\n\t\t} else {\n\t\t\tif (typeof target !== \"number\") {\n\t\t\t\tthrow new Error(\"Invalid target value for min permission edit\");\n\t\t\t}\n\t\t\treturn Promise.resolve(setPermissionMinAccess(permission, target, this));\n\t\t}\n\t}\n\n\toverride getRolesData(): Promise<PermissionRoleBundle> {\n\t\treturn Promise.resolve(getPlayerRoleData(this));\n\t}\n\n\toverride editRole(role: \"owner\" | \"mistress\", action: \"add\" | \"remove\", target: number): Promise<boolean> {\n\t\treturn Promise.resolve(editRole(role, action, target, this));\n\t}\n\n\toverride getLogEntries(): Promise<LogEntry[]> {\n\t\treturn Promise.resolve(getVisibleLogEntries(this));\n\t}\n\n\toverride logMessageDelete(time: number): Promise<boolean> {\n\t\treturn Promise.resolve(logMessageDelete(time, this));\n\t}\n\n\toverride getLogConfig(): Promise<LogConfig> {\n\t\treturn Promise.resolve(logGetConfig());\n\t}\n\n\toverride setLogConfig(category: BCX_LogCategory, target: LogAccessLevel): Promise<boolean> {\n\t\treturn Promise.resolve(logConfigSet(category, target, this));\n\t}\n\n\toverride logClear(): Promise<boolean> {\n\t\treturn Promise.resolve(logClear(this));\n\t}\n\n\toverride logPraise(value: -1 | 0 | 1, message: string | null): Promise<boolean> {\n\t\treturn Promise.resolve(logPraise(value, message, this));\n\t}\n\n\toverride logGetAllowedActions(): Promise<BCX_logAllowedActions> {\n\t\treturn Promise.resolve(logGetAllowedActions(this));\n\t}\n\n\toverride curseItem(Group: string, curseProperties: boolean): Promise<boolean> {\n\t\treturn Promise.resolve(curseItem(Group, curseProperties, this));\n\t}\n\n\toverride curseLift(Group: string): Promise<boolean> {\n\t\treturn Promise.resolve(curseLift(Group, this));\n\t}\n\n\toverride curseBatch(mode: \"items\" | \"clothes\", includingEmpty: boolean): Promise<boolean> {\n\t\treturn Promise.resolve(curseBatch(mode, includingEmpty, this));\n\t}\n\n\toverride curseLiftAll(): Promise<boolean> {\n\t\treturn Promise.resolve(curseLiftAll(this));\n\t}\n\n\toverride conditionsGetByCategory<C extends ConditionsCategories>(category: C): Promise<ConditionsCategoryPublicData<C>> {\n\t\tif (!ConditionsGetCategoryEnabled(category))\n\t\t\treturn Promise.reject(\"Category is disabled\");\n\t\treturn Promise.resolve(ConditionsGetCategoryPublicData(category, this));\n\t}\n\n\toverride conditionSetLimit<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], limit: ConditionsLimit): Promise<boolean> {\n\t\treturn Promise.resolve(ConditionsSetLimit(category, condition, limit, this));\n\t}\n\n\toverride conditionUpdate<C extends ConditionsCategories>(category: C, condition: ConditionsCategoryKeys[C], data: ConditionsConditionPublicData<C>): Promise<boolean> {\n\t\treturn Promise.resolve(ConditionsUpdate(category, condition, data, this));\n\t}\n\n\toverride ruleCreate(name: BCX_Rule): Promise<boolean> {\n\t\treturn Promise.resolve(RulesCreate(name, this));\n\t}\n\n\toverride ruleDelete(name: BCX_Rule): Promise<boolean> {\n\t\treturn Promise.resolve(RulesDelete(name, this));\n\t}\n\n\tconditionCategoryUpdate<C extends ConditionsCategories>(category: C, data: ConditionsCategoryConfigurableData): Promise<boolean> {\n\t\treturn Promise.resolve(ConditionsCategoryUpdate(category, data, this));\n\t}\n}\n\nconst currentRoomCharacters: ChatroomCharacter[] = [];\n\nfunction cleanOldCharacters(): void {\n\tfor (let i = currentRoomCharacters.length - 1; i >= 0; i--) {\n\t\tif (!currentRoomCharacters[i].isPlayer() && !ChatRoomCharacter.includes(currentRoomCharacters[i].Character)) {\n\t\t\tcurrentRoomCharacters.splice(i, 1);\n\t\t}\n\t}\n}\n\nexport function getChatroomCharacter(memberNumber: number): ChatroomCharacter | null {\n\tif (typeof memberNumber !== \"number\")\n\t\treturn null;\n\tcleanOldCharacters();\n\tlet character = currentRoomCharacters.find(c => c.Character.MemberNumber === memberNumber);\n\tif (!character) {\n\t\tif (Player.MemberNumber === memberNumber) {\n\t\t\tcharacter = new PlayerCharacter(Player);\n\t\t} else {\n\t\t\tconst BCCharacter = ChatRoomCharacter.find(c => c.MemberNumber === memberNumber);\n\t\t\tif (!BCCharacter) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tcharacter = new ChatroomCharacter(BCCharacter);\n\t\t}\n\t\tcurrentRoomCharacters.push(character);\n\t}\n\treturn character;\n}\n\nexport function getAllCharactersInRoom(): ChatroomCharacter[] {\n\tif (!ServerPlayerIsInChatRoom()) {\n\t\treturn [getPlayerCharacter()];\n\t}\n\treturn ChatRoomCharacter.map(c => getChatroomCharacter(c.MemberNumber!)).filter(Boolean) as ChatroomCharacter[];\n}\n\nexport function getPlayerCharacter(): PlayerCharacter {\n\tlet character = currentRoomCharacters.find(c => c.Character === Player) as PlayerCharacter | undefined;\n\tif (!character) {\n\t\tcharacter = new PlayerCharacter(Player);\n\t\tcurrentRoomCharacters.push(character);\n\t}\n\treturn character;\n}\n\nconst effectBuilderFunctions: ((PlayerEffects: BCX_effects) => void)[] = [];\n\nexport function registerEffectBuilder(builder: (PlayerEffects: BCX_effects) => void): void {\n\teffectBuilderFunctions.push(builder);\n}\n\nexport function buildPlayerEffects(): void {\n\tconst effects = cloneDeep(defaultBCXEffects);\n\tfor (const builder of effectBuilderFunctions) {\n\t\tbuilder(effects);\n\t}\n\tconst player = getPlayerCharacter();\n\tif (isEqual(effects, player.Effects))\n\t\treturn;\n\n\tplayer.Effects = effects;\n\tCharacterRefresh(Player, false);\n\tannounceSelf(false);\n}\n\nexport class ModuleCharacter extends BaseModule {\n\tprivate timer: number | null = null;\n\n\tload() {\n\t\thookFunction(\"CharacterLoadEffect\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tconst C = args[0] as Character;\n\t\t\tconst character = typeof C.MemberNumber === \"number\" && getChatroomCharacter(C.MemberNumber);\n\t\t\tif (character) {\n\t\t\t\tfor (const effect of character.Effects.Effect) {\n\t\t\t\t\tif (!C.Effect.includes(effect)) {\n\t\t\t\t\t\tC.Effect.push(effect);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trun() {\n\t\tthis.timer = BCX_setInterval(buildPlayerEffects, PLAYER_EFFECT_REBUILD_INTERVAL);\n\t}\n\n\tunload() {\n\t\tif (this.timer !== null) {\n\t\t\tclearInterval(this.timer);\n\t\t\tthis.timer = null;\n\t\t}\n\t}\n}\n","import { ChatroomCharacter, getChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { moduleInitPhase } from \"../moduleManager\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction } from \"../patching\";\nimport { isObject, uuidv4 } from \"../utils\";\nimport { firstTimeInit } from \"./storage\";\nimport { ModuleInitPhase } from \"../constants\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nexport const hiddenMessageHandlers: Map<keyof BCX_messages, (sender: number, message: any) => void> = new Map();\nexport const hiddenBeepHandlers: Map<keyof BCX_beeps, (sender: number, message: any) => void> = new Map();\n\nexport type queryResolveFunction<T extends keyof BCX_queries> = {\n\t(ok: true, data: BCX_queries[T][1]): void;\n\t(ok: false, error?: any): void;\n};\n\nexport const queryHandlers: {\n\t[K in keyof BCX_queries]?: (sender: ChatroomCharacter, resolve: queryResolveFunction<K>, data: BCX_queries[K][0]) => void;\n} = {};\n\nexport const changeHandlers: ((source: number) => void)[] = [];\n\nexport function sendHiddenMessage<T extends keyof BCX_messages>(type: T, message: BCX_messages[T], Target: number | null = null) {\n\tif (!ServerPlayerIsInChatRoom() || firstTimeInit)\n\t\treturn;\n\tServerSend(\"ChatRoomChat\", {\n\t\tContent: \"BCXMsg\",\n\t\tType: \"Hidden\",\n\t\tTarget,\n\t\tDictionary: { type, message }\n\t});\n}\n\nexport function sendHiddenBeep<T extends keyof BCX_beeps>(type: T, message: BCX_beeps[T], target: number, asLeashBeep: boolean = false) {\n\tServerSend(\"AccountBeep\", {\n\t\tMemberNumber: target,\n\t\tBeepType: asLeashBeep ? \"Leash\" : \"BCX\",\n\t\tMessage: {\n\t\t\tBCX: { type, message }\n\t\t}\n\t});\n}\n\ninterface IPendingQuery {\n\ttarget: number;\n\tresolve: (data: any) => void;\n\treject: (data: any) => void;\n\ttimeout: number;\n}\n\nconst pendingQueries: Map<string, IPendingQuery> = new Map();\n\nexport function sendQuery<T extends keyof BCX_queries>(type: T, data: BCX_queries[T][0], target: number, timeout: number = 10_000): Promise<BCX_queries[T][1]> {\n\tif (firstTimeInit) {\n\t\treturn Promise.reject(\"Unavailable during init\");\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst id = uuidv4();\n\t\tconst info: IPendingQuery = {\n\t\t\ttarget,\n\t\t\tresolve,\n\t\t\treject,\n\t\t\ttimeout: BCX_setTimeout(() => {\n\t\t\t\tconsole.warn(\"BCX: Query timed out\", target, type);\n\t\t\t\tpendingQueries.delete(id);\n\t\t\t\treject(\"Timed out\");\n\t\t\t}, timeout)\n\t\t};\n\t\tpendingQueries.set(id, info);\n\n\t\tsendHiddenMessage(\"query\", {\n\t\t\tid,\n\t\t\tquery: type,\n\t\t\tdata\n\t\t}, target);\n\n\t});\n}\n\nhiddenMessageHandlers.set(\"query\", (sender, message: BCX_message_query) => {\n\tif (!isObject(message) ||\n\t\ttypeof message.id !== \"string\" ||\n\t\ttypeof message.query !== \"string\"\n\t) {\n\t\tconsole.warn(`BCX: Invalid query`, sender, message);\n\t\treturn;\n\t}\n\n\tconst character = getChatroomCharacter(sender);\n\tif (!character || !character.hasAccessToPlayer()) {\n\t\treturn sendHiddenMessage(\"queryAnswer\", {\n\t\t\tid: message.id,\n\t\t\tok: false\n\t\t});\n\t}\n\n\tconst handler = queryHandlers[message.query] as (sender: ChatroomCharacter, resolve: queryResolveFunction<keyof BCX_queries>, data: any) => void;\n\tif (!handler) {\n\t\tconsole.warn(\"BCX: Query no handler\", sender, message);\n\t\treturn sendHiddenMessage(\"queryAnswer\", {\n\t\t\tid: message.id,\n\t\t\tok: false\n\t\t});\n\t}\n\n\thandler(character, (ok, data) => {\n\t\tsendHiddenMessage(\"queryAnswer\", {\n\t\t\tid: message.id,\n\t\t\tok,\n\t\t\tdata\n\t\t}, sender);\n\t}, message.data);\n});\n\nhiddenMessageHandlers.set(\"queryAnswer\", (sender, message: BCX_message_queryAnswer) => {\n\tif (!isObject(message) ||\n\t\ttypeof message.id !== \"string\" ||\n\t\ttypeof message.ok !== \"boolean\"\n\t) {\n\t\tconsole.warn(`BCX: Invalid queryAnswer`, sender, message);\n\t\treturn;\n\t}\n\n\tconst info = pendingQueries.get(message.id);\n\tif (!info) {\n\t\tconsole.warn(`BCX: Response to unknown query`, sender, message);\n\t\treturn;\n\t}\n\n\tif (info.target !== info.target) {\n\t\tconsole.warn(`BCX: Response to query not from target`, sender, message, info);\n\t\treturn;\n\t}\n\n\tclearTimeout(info.timeout);\n\tpendingQueries.delete(message.id);\n\n\tif (message.ok) {\n\t\tinfo.resolve(message.data);\n\t} else {\n\t\tinfo.reject(message.data);\n\t}\n});\n\nhiddenMessageHandlers.set(\"somethingChanged\", (sender) => {\n\tchangeHandlers.forEach(h => h(sender));\n});\n\nexport function notifyOfChange(): void {\n\tif (moduleInitPhase !== ModuleInitPhase.ready)\n\t\treturn;\n\tsendHiddenMessage(\"somethingChanged\", undefined);\n\tconst player = getPlayerCharacter().MemberNumber;\n\tchangeHandlers.forEach(h => h(player));\n}\n\nexport class ModuleMessaging extends BaseModule {\n\tload() {\n\t\thookFunction(\"ChatRoomMessage\", 10, (args, next) => {\n\t\t\tconst data = args[0];\n\n\t\t\tif (data?.Type === \"Hidden\" && data.Content === \"BCXMsg\" && typeof data.Sender === \"number\") {\n\t\t\t\tif (data.Sender === Player.MemberNumber || firstTimeInit)\n\t\t\t\t\treturn;\n\t\t\t\tif (!isObject(data.Dictionary)) {\n\t\t\t\t\tconsole.warn(\"BCX: Hidden message no Dictionary\", data);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst { type, message } = data.Dictionary;\n\t\t\t\tif (typeof type === \"string\") {\n\t\t\t\t\tconst handler = hiddenMessageHandlers.get(type as keyof BCX_messages);\n\t\t\t\t\tif (handler === undefined) {\n\t\t\t\t\t\tconsole.warn(\"BCX: Hidden message no handler\", data.Sender, type, message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandler(data.Sender, message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"ServerAccountBeep\", 10, (args, next) => {\n\t\t\tconst data = args[0];\n\n\t\t\tif (typeof data?.BeepType === \"string\" && [\"Leash\", \"BCX\"].includes(data.BeepType) && isObject(data.Message?.BCX)) {\n\t\t\t\tconst { type, message } = data.Message.BCX;\n\t\t\t\tif (typeof type === \"string\") {\n\t\t\t\t\tconst handler = hiddenBeepHandlers.get(type as keyof BCX_beeps);\n\t\t\t\t\tif (handler === undefined) {\n\t\t\t\t\t\tconsole.warn(\"BCX: Hidden beep no handler\", data.MemberNumber, type, message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandler(data.MemberNumber, message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\treturn next(args);\n\t\t\t}\n\t\t});\n\t}\n\n\tunload() {\n\t\thiddenBeepHandlers.clear();\n\t\thiddenMessageHandlers.clear();\n\t}\n}\n","import { modules_applyPreset, reload_modules } from \"../moduleManager\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { arrayUnique } from \"../utils\";\nimport { InfoBeep } from \"../utilsClub\";\nimport { notifyOfChange, queryHandlers } from \"./messaging\";\nimport { finalizeFirstTimeInit, firstTimeInit, modStorage, modStorageSync } from \"./storage\";\nimport { ModuleCategory, Preset, TOGGLEABLE_MODULES } from \"../constants\";\nimport { getCurrentSubscreen } from \"./gui\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nconst PRESET_DISABLED_MODULES: Record<Preset, ModuleCategory[]> = {\n\t[Preset.dominant]: [ModuleCategory.Log, ModuleCategory.Curses, ModuleCategory.Rules],\n\t[Preset.switch]: [],\n\t[Preset.submissive]: [],\n\t[Preset.slave]: []\n};\n\nexport function getCurrentPreset(): Preset {\n\treturn modStorage.preset ?? Preset.switch;\n}\n\nexport function applyPreset(preset: Preset) {\n\tmodStorage.preset = preset;\n\tmodules_applyPreset(preset);\n\tsetDisabledModules(PRESET_DISABLED_MODULES[preset]);\n\n\tfinalizeFirstTimeInit();\n}\n\nexport function setDisabledModules(modules: ModuleCategory[]): boolean {\n\tif (!Array.isArray(modStorage.disabledModules)) {\n\t\tconsole.error(\"BCX: Attempt to set disabled modules before initializetion\");\n\t\treturn false;\n\t}\n\n\tmodules = arrayUnique(modules.filter(i => TOGGLEABLE_MODULES.includes(i)));\n\n\tif (CommonArraysEqual(modules, modStorage.disabledModules))\n\t\treturn true;\n\n\tmodStorage.disabledModules = modules;\n\n\tif (reload_modules()) {\n\t\tmodStorageSync();\n\t\tnotifyOfChange();\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nexport function getDisabledModules(): ModuleCategory[] {\n\treturn Array.isArray(modStorage.disabledModules) ? modStorage.disabledModules.slice() : [];\n}\n\nexport function moduleIsEnabled(module: ModuleCategory): boolean {\n\tif (!TOGGLEABLE_MODULES.includes(module))\n\t\treturn true;\n\n\treturn Array.isArray(modStorage.disabledModules) ? !modStorage.disabledModules.includes(module) : true;\n}\n\nexport class ModulePresets extends BaseModule {\n\tinit() {\n\t\tqueryHandlers.disabledModules = (sender, resolve) => {\n\t\t\treturn resolve(true, getDisabledModules());\n\t\t};\n\t}\n\n\tload() {\n\t\tif (typeof modStorage.preset !== \"number\" || Preset[modStorage.preset] === undefined) {\n\t\t\tmodStorage.preset = Preset.switch;\n\t\t}\n\n\t\tif (!Array.isArray(modStorage.disabledModules)) {\n\t\t\tmodStorage.disabledModules = [];\n\t\t} else {\n\t\t\tmodStorage.disabledModules = modStorage.disabledModules.filter(i => TOGGLEABLE_MODULES.includes(i));\n\t\t}\n\t}\n\n\trun() {\n\t\tif (firstTimeInit) {\n\t\t\tBCX_setTimeout(() => {\n\t\t\t\tif (firstTimeInit && getCurrentSubscreen() === null) {\n\t\t\t\t\tInfoBeep(`Please visit your profile to finish BCX setup`, Infinity);\n\t\t\t\t}\n\t\t\t}, 2000);\n\t\t}\n\t}\n}\n","import { firstTimeInit, modStorage } from \"./modules/storage\";\nimport { BCXVersionCompare, BCXVersionToString } from \"./utils\";\n\nexport function runMigration(originalVersion: BCXVersion, currentVersion: BCXVersion): boolean {\n\tif (BCXVersionCompare(originalVersion, currentVersion) === 0 || firstTimeInit)\n\t\treturn true;\n\n\tif (BCXVersionCompare(originalVersion, currentVersion) > 0) {\n\t\tif (!confirm(\"You are attempting to load older BCX version than you did previously. \" +\n\t\t\t\"This might result in loss of some data.\\nAre you sure you want to continue?\")\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tconsole.log(\"BCX: Version migration from\", BCXVersionToString(originalVersion), \"to\", BCXVersionToString(currentVersion));\n\n\tif (BCXVersionCompare(originalVersion, { major: 0, minor: 7, patch: 4 }) < 0) {\n\t\tmodStorage.menuShouldDisplayTutorialHelp = true;\n\t}\n\n\treturn true;\n}\n","import type { BaseModule } from \"./modules/_BaseModule\";\nimport { ModuleInitPhase, Preset } from \"./constants\";\nimport { getCurrentPreset } from \"./modules/presets\";\nimport { modStorage } from \"./modules/storage\";\nimport { BCX_VERSION_PARSED, parseBCXVersion } from \"./utils\";\nimport { runMigration } from \"./migration\";\n\nexport let moduleInitPhase: ModuleInitPhase = ModuleInitPhase.construct;\nconst modules: BaseModule[] = [];\n\nexport function registerModule<T extends BaseModule>(module: T): T {\n\tif (moduleInitPhase !== ModuleInitPhase.construct) {\n\t\tthrow new Error(\"Modules can be registered only before initialization\");\n\t}\n\tmodules.push(module);\n\treturn module;\n}\n\nexport function init_modules(): boolean {\n\tmoduleInitPhase = ModuleInitPhase.init;\n\tfor (const m of modules) {\n\t\tm.init();\n\t}\n\n\tconst oldVersion: BCXVersion | null = typeof modStorage.version === \"string\" ? parseBCXVersion(modStorage.version) : { major: 0, minor: 0, patch: 0 };\n\tif (!oldVersion) {\n\t\talert(\n\t\t\t\"Failed to parse BCX version in your saved data.\\n\" +\n\t\t\t\"Are you loading older version or is your data corrupted?\\n\" +\n\t\t\t\"Refusing to load.\"\n\t\t);\n\t\treturn false;\n\t}\n\tif (!runMigration(oldVersion, BCX_VERSION_PARSED))\n\t\treturn false;\n\tmodStorage.version = BCX_VERSION;\n\n\tmoduleInitPhase = ModuleInitPhase.load;\n\tfor (const m of modules) {\n\t\tm.load(getCurrentPreset());\n\t}\n\tmoduleInitPhase = ModuleInitPhase.ready;\n\tfor (const m of modules) {\n\t\tm.run();\n\t}\n\treturn true;\n}\n\nexport function unload_modules() {\n\tmoduleInitPhase = ModuleInitPhase.destroy;\n\tfor (const m of modules) {\n\t\tm.unload();\n\t}\n}\n\nexport function reload_modules(): boolean {\n\tif (moduleInitPhase !== ModuleInitPhase.ready) {\n\t\tconsole.error(\"BCX: Attempt to reload modules, while not ready\");\n\t\treturn false;\n\t}\n\tfor (const m of modules) {\n\t\tm.reload(getCurrentPreset());\n\t}\n\treturn true;\n}\n\nexport function modules_applyPreset(preset: Preset): boolean {\n\tif (moduleInitPhase !== ModuleInitPhase.ready) {\n\t\tconsole.error(\"BCX: Attempt to apply preset to modules, while not ready\");\n\t\treturn false;\n\t}\n\tfor (const m of modules) {\n\t\tm.applyPreset(preset);\n\t}\n\treturn true;\n}\n","import { contextInBCXArea, debugContextStart, debugMakeContextReport } from \"./BCXContext\";\nimport { VERSION } from \"./config\";\nimport { ModuleCategory, ModuleInitPhase } from \"./constants\";\nimport { moduleInitPhase } from \"./moduleManager\";\nimport { ConditionsGetCategoryData, ConditionsGetCategoryEnabled } from \"./modules/conditions\";\nimport { getDisabledModules } from \"./modules/presets\";\nimport { firstTimeInit } from \"./modules/storage\";\nimport { getPatchedFunctionsHashes, hookFunction } from \"./patching\";\nimport { detectOtherMods } from \"./utilsClub\";\n\nconst MAX_STACK_SIZE = 15;\n\nlet firstError = true;\n\nlet lastReceivedMessageType = \"\";\nlet lastSentMessageType = \"\";\n\nexport function debugGenerateReport(includeBCX: boolean = true): string {\n\tlet res = `----- Debug report -----\\n`;\n\tres += `Location: ${window.location.href.replace(/\\d{4,}/g, \"<numbers>\")}\\n`;\n\tres += `UA: ${window.navigator.userAgent}\\n`;\n\tres += `BC Version: ${GameVersion}\\n`;\n\tres += `BCX Version: ${VERSION}\\n`;\n\n\tconst otherMods = Object.entries(detectOtherMods()).filter(i => i[1]);\n\tif (otherMods.length > 0) {\n\t\tres += `Other detected mods:\\n` +\n\t\t\totherMods\n\t\t\t\t.map(i => `  - ${i[0]}` + (typeof i[1] !== \"boolean\" ? `: ${i[1]}` : \"\") + \"\\n\")\n\t\t\t\t.join(\"\");\n\t} else {\n\t\tres += `No other mods detected.\\n`;\n\t}\n\n\tres += `\\n----- BC state report -----\\n`;\n\tres += `Mouse position: ${MouseX} ${MouseY}\\n`;\n\tres += `Connected to server: ${ServerIsConnected}\\n`;\n\tres += `Screen: ${CurrentModule}/${CurrentScreen}\\n`;\n\tres += `In chatroom: ${ServerPlayerIsInChatRoom()}\\n`;\n\tres += `GLVersion: ${GLVersion}\\n`;\n\tres += `Last received message: ${lastReceivedMessageType}\\n`;\n\tres += `Last sent message: ${lastSentMessageType}\\n`;\n\n\tif (includeBCX) {\n\t\tres += `\\n----- BCX report -----\\n`;\n\t\tres += `Init state: ${ModuleInitPhase[moduleInitPhase]}\\n`;\n\t\tres += `First init: ${firstTimeInit}\\n`;\n\t\tres += `Disabled modules: ${getDisabledModules().map(i => ModuleCategory[i]).join(\", \") || \"[None]\"}\\n`;\n\t\tif (ConditionsGetCategoryEnabled(\"curses\")) {\n\t\t\tres += `Curses: ${Object.keys(ConditionsGetCategoryData(\"curses\").conditions).join(\", \") || \"[None]\"}\\n`;\n\t\t}\n\t\tif (ConditionsGetCategoryEnabled(\"rules\")) {\n\t\t\tres += `Rules: ${Object.keys(ConditionsGetCategoryData(\"rules\").conditions).join(\", \") || \"[None]\"}\\n`;\n\t\t}\n\t}\n\n\t// Patching report\n\n\tconst unexpectedHashes = getPatchedFunctionsHashes(false);\n\n\tif (unexpectedHashes.length > 0) {\n\t\tres += `\\n----- Patching report -----\\n`;\n\t\tif (unexpectedHashes.length > 0) {\n\t\t\tres += `Patched functions with unknown checksums:\\n` +\n\t\t\t\tunexpectedHashes.map(i => `${i[0]}: ${i[1]}\\n`).join(\"\");\n\t\t}\n\t} else if (includeBCX) {\n\t\tres += `\\n----- Patching report -----\\n`;\n\t\tres += `No warnings.\\n`;\n\t}\n\n\treturn res;\n}\n\nexport function cleanupErrorLocation(location: string): string {\n\treturn location\n\t\t.replaceAll(window.location.href.substring(0, window.location.href.lastIndexOf(\"/\")), \"<url>\")\n\t\t.replace(/https:\\/\\/[^?/]+\\/([^?]+)?bcx.js(?=$|\\?|:)/, \"<bcx>\")\n\t\t.replace(/\\/\\d{4,}\\.html/, \"/<numbers>.html\")\n\t\t.replace(/[?&]_=\\d+(?=$|&|:)/, \"\");\n}\n\nexport function debugPrettifyError(error: unknown): string {\n\tif (error instanceof Error) {\n\t\tlet stack = `${error.stack}`.split(\"\\n\");\n\t\tif (stack.length > MAX_STACK_SIZE) {\n\t\t\tstack = stack.slice(0, MAX_STACK_SIZE).concat(\"    ...\");\n\t\t}\n\t\treturn stack.map(cleanupErrorLocation).join(\"\\n\");\n\t}\n\treturn `${error}`;\n}\n\nexport function debugGenerateReportErrorEvent(event: ErrorEvent): string {\n\tconst inBCX = contextInBCXArea();\n\n\tlet res = `----- UNHANDLED ERROR (${inBCX ? \"IN BCX\" : \"OUTSIDE OF BCX\"}) -----\\n` +\n\t\t`Message: ${event.message}\\n` +\n\t\t`Source: ${cleanupErrorLocation(event.filename)}:${event.lineno}:${event.colno}\\n`;\n\n\tres += debugPrettifyError(event.error) + \"\\n\\n\";\n\n\tres += debugMakeContextReport();\n\n\tres += \"\\n\" + debugGenerateReport(inBCX);\n\n\treturn res;\n}\n\nexport function showErrorOverlay(title: string, description: string, contents: string, wrapCodeBlock: boolean = true): void {\n\tconsole.info(\"Error overlay displayed\\n\", contents);\n\n\tif (wrapCodeBlock) {\n\t\tcontents = '```\\n' + contents.trim() + '\\n```';\n\t}\n\n\tconst overlay = document.createElement(\"div\");\n\toverlay.style.position = \"fixed\";\n\toverlay.style.top = \"0px\";\n\toverlay.style.right = \"0px\";\n\toverlay.style.bottom = \"0px\";\n\toverlay.style.left = \"0px\";\n\toverlay.style.background = \"#00000090\";\n\n\t// Nice window\n\tconst win = document.createElement(\"div\");\n\toverlay.appendChild(win);\n\twin.style.position = \"absolute\";\n\twin.style.top = \"5%\";\n\twin.style.right = \"5%\";\n\twin.style.bottom = \"5%\";\n\twin.style.left = \"5%\";\n\twin.style.background = \"white\";\n\twin.style.display = \"flex\";\n\twin.style.flexDirection = \"column\";\n\twin.style.padding = \"1em\";\n\n\t// Title\n\tconst titleElem = document.createElement(\"h1\");\n\twin.appendChild(titleElem);\n\ttitleElem.innerText = title;\n\n\t// Description\n\tconst descriptionElement = document.createElement(\"p\");\n\twin.appendChild(descriptionElement);\n\tdescriptionElement.innerHTML = description;\n\n\t// Copy button\n\tconst copy = document.createElement(\"button\");\n\twin.appendChild(copy);\n\tcopy.innerText = \"Copy report\";\n\n\t// Content\n\tconst contentElem = document.createElement(\"textarea\");\n\twin.appendChild(contentElem);\n\tcontentElem.readOnly = true;\n\tcontentElem.value = contents;\n\tcontentElem.style.flex = \"1\";\n\tcontentElem.style.margin = \"0.5em 0\";\n\n\tcopy.onclick = () => {\n\t\tcontentElem.focus();\n\t\tcontentElem.select();\n\n\t\tif (navigator.clipboard) {\n\t\t\tnavigator.clipboard.writeText(contentElem.value);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tdocument.execCommand('copy');\n\t\t\t} catch (err) {\n\t\t\t\t/* Ignore */\n\t\t\t}\n\t\t}\n\t};\n\n\t// Close button\n\tconst close = document.createElement(\"button\");\n\twin.appendChild(close);\n\tclose.innerText = \"Close\";\n\tclose.onclick = () => {\n\t\toverlay.remove();\n\t};\n\n\t// Display it\n\t(document.activeElement as HTMLElement)?.blur?.();\n\twindow.document.body.appendChild(overlay);\n}\n\nexport function onUnhandledError(event: ErrorEvent) {\n\tif (!firstError)\n\t\treturn;\n\tfirstError = false;\n\tconst inBCX = contextInBCXArea();\n\t// Display error window\n\tshowErrorOverlay(\n\t\t\"Crash Handler (by BCX)\",\n\t\t\"The Crash Handler provided by BCX detected an uncaught error, which most likely crashed the Bondage Club.<br />\" +\n\t\t\"While reporting this error, please use the information below to help us find the source faster.<br />\" +\n\t\t\"You can use the 'Close' button at the bottom to continue, however BC may no longer work correctly until you reload the current tab.\" +\n\t\t(\n\t\t\tinBCX ?\n\t\t\t\t\"<p>Whoops... seems like BCX might be to blame this time. Could you please help us by submitting the report below to the <a href='https://discord.gg/SHJMjEh9VH' target='_blank'>BC Scripting Community Discord</a> server?<br />Thank you!</p>\" :\n\t\t\t\t\"<br /><h3>The error seems NOT to come from BCX!</h3> Please submit the report to <a href='https://discord.gg/dkWsEjf' target='_blank'>Bondage Club's Discord</a> server instead!\"),\n\t\tdebugGenerateReportErrorEvent(event)\n\t);\n}\n\n// Server message origin\nlet originalSocketEmit: undefined | ((...args: any[]) => any);\nfunction bcxSocketEmit(this: any, ...args: any[]) {\n\tconst message = Array.isArray(args[0]) && typeof args[0][0] === \"string\" ? args[0][0] : \"[unknown]\";\n\tlastReceivedMessageType = message;\n\n\tconst parameters = Array.isArray(args[0]) ? args[0].slice(1) : [];\n\t// console.log(\"\\u2B07 Receive\", message, ...parameters);\n\n\tconst ctx = debugContextStart(`Server message ${message}`, {\n\t\troot: true,\n\t\tbcxArea: false,\n\t\textraInfo() {\n\t\t\treturn `Event: ${message}\\n` + parameters.map(i => JSON.stringify(i, undefined, \"  \")).join(\"\\n\");\n\t\t}\n\t});\n\tconst res = originalSocketEmit?.apply(this, args);\n\tctx.end();\n\treturn res;\n}\n\n// Click origin\nlet originalClick: undefined | ((event: MouseEvent) => void);\nfunction bcxClick(this: any, event: MouseEvent) {\n\tconst ctx = debugContextStart(`Canvas click`, {\n\t\troot: true,\n\t\tbcxArea: false,\n\t\textraInfo() { return `X: ${MouseX}\\nY: ${MouseY}`; }\n\t});\n\tconst res = originalClick?.call(this, event);\n\tctx.end();\n\treturn res;\n}\n\nexport function InitErrorReporter() {\n\twindow.addEventListener(\"error\", onUnhandledError);\n\t// Server message origin\n\toriginalSocketEmit = (ServerSocket as any).__proto__.emitEvent;\n\tif (typeof originalSocketEmit === \"function\") {\n\t\t(ServerSocket as any).__proto__.emitEvent = bcxSocketEmit;\n\t}\n\n\tconst canvas = document.getElementById(\"MainCanvas\") as (HTMLCanvasElement | undefined);\n\tif (canvas) {\n\t\t// Click origin\n\t\tif (typeof canvas.onclick === \"function\") {\n\t\t\toriginalClick = canvas.onclick;\n\t\t\tcanvas.onclick = bcxClick;\n\t\t}\n\t}\n\n\thookFunction(\"ServerSend\", 0, (args, next) => {\n\t\tlastSentMessageType = args[0];\n\t\t// console.log(\"\\u2B06 Send\", args[0], ...args.slice(1));\n\t\treturn next(args);\n\t});\n}\n\nexport function UnloadErrorReporter() {\n\twindow.removeEventListener(\"error\", onUnhandledError);\n\t// Server message origin\n\tif ((ServerSocket as any).__proto__.emitEvent === bcxSocketEmit) {\n\t\t(ServerSocket as any).__proto__.emitEvent = originalSocketEmit;\n\t}\n\tconst canvas = document.getElementById(\"MainCanvas\") as (HTMLCanvasElement | undefined);\n\t// Click origin\n\tif (canvas && originalClick) {\n\t\tcanvas.onclick = originalClick;\n\t}\n}\n","import { detectOtherMods, InfoBeep } from \"./utilsClub\";\nimport { VERSION } from \"./config\";\nimport { init_modules, unload_modules } from \"./moduleManager\";\nimport { unload_patches } from \"./patching\";\nimport { isObject } from \"./utils\";\nimport { InitErrorReporter, UnloadErrorReporter } from \"./errorReporting\";\nimport { debugContextStart } from \"./BCXContext\";\n\nexport function loginInit(C: any) {\n\tif (window.BCX_Loaded) return;\n\tinit();\n}\n\nfunction clearCaches() {\n\tif (typeof DrawRunMap !== \"undefined\") {\n\t\tDrawRunMap.clear();\n\t\tDrawScreen = \"\";\n\t}\n\tif (typeof CurrentScreenFunctions !== \"undefined\") {\n\t\tconst w = window as any;\n\t\tCurrentScreenFunctions = {\n\t\t\tRun: w[`${CurrentScreen}Run`],\n\t\t\tClick: w[`${CurrentScreen}Click`],\n\t\t\tLoad: typeof w[`${CurrentScreen}Load`] === \"function\" ? w[`${CurrentScreen}Load`] : undefined,\n\t\t\tUnload: typeof w[`${CurrentScreen}Unload`] === \"function\" ? w[`${CurrentScreen}Unload`] : undefined,\n\t\t\tResize: typeof w[`${CurrentScreen}Resize`] === \"function\" ? w[`${CurrentScreen}Resize`] : undefined,\n\t\t\tKeyDown: typeof w[`${CurrentScreen}KeyDown`] === \"function\" ? w[`${CurrentScreen}KeyDown`] : undefined,\n\t\t\tExit: typeof w[`${CurrentScreen}Exit`] === \"function\" ? w[`${CurrentScreen}Exit`] : undefined\n\t\t};\n\t}\n}\n\nexport function init() {\n\n\tconst ctx = debugContextStart(\"BCX init\", { bcxArea: true });\n\n\tInitErrorReporter();\n\n\tif (!init_modules()) {\n\t\tctx.end();\n\t\tunload();\n\t\treturn;\n\t}\n\n\t// Loading into already loaded club - clear some caches\n\tclearCaches();\n\n\t//#region Other mod compatability\n\n\tconst { BondageClubTools } = detectOtherMods();\n\n\tif (BondageClubTools) {\n\t\tconsole.warn(\"BCX: Bondage Club Tools detected!\");\n\t\tif ((window as any).BCX_BondageClubToolsPatch === true) {\n\t\t\tconsole.info(\"BCX: Bondage Club Tools already patched, skip!\");\n\t\t} else {\n\t\t\t(window as any).BCX_BondageClubToolsPatch = true;\n\t\t\tconst ChatRoomMessageForwarder = ServerSocket.listeners(\"ChatRoomMessage\").find(i => i.toString().includes(\"window.postMessage\"));\n\t\t\tconst AccountBeepForwarder = ServerSocket.listeners(\"AccountBeep\").find(i => i.toString().includes(\"window.postMessage\"));\n\t\t\tif (!ChatRoomMessageForwarder || !AccountBeepForwarder) {\n\t\t\t\tthrow new Error(\"Failed to patch for Bondage Club Tools!\");\n\t\t\t}\n\t\t\tServerSocket.off(\"ChatRoomMessage\", ChatRoomMessageForwarder);\n\t\t\tServerSocket.on(\"ChatRoomMessage\", data => {\n\t\t\t\tif (data?.Type !== \"Hidden\" || data.Content !== \"BCXMsg\" || typeof data.Sender !== \"number\") {\n\t\t\t\t\tChatRoomMessageForwarder!(data);\n\t\t\t\t}\n\t\t\t});\n\t\t\tServerSocket.off(\"AccountBeep\", AccountBeepForwarder);\n\t\t\tServerSocket.on(\"AccountBeep\", data => {\n\t\t\t\tif (typeof data?.BeepType !== \"string\" || ![\"Leash\", \"BCX\"].includes(data.BeepType) || !isObject(data.Message?.BCX)) {\n\t\t\t\t\tAccountBeepForwarder!(data);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t//#endregion\n\n\twindow.BCX_Loaded = true;\n\tInfoBeep(`BCX loaded! Version: ${VERSION.replace(/-[0-f]+$/i, \"\")}`);\n\tconsole.log(`BCX loaded! Version: ${VERSION}`);\n\n\tctx.end();\n}\n\nexport function unload(): true {\n\tunload_patches();\n\tunload_modules();\n\n\tUnloadErrorReporter();\n\n\t// clear some caches\n\tclearCaches();\n\n\tdelete window.BCX_Loaded;\n\tconsole.log(\"BCX: Unloaded.\");\n\treturn true;\n}\n","import { isObject } from \"../utils\";\nimport { modStorage, modStorageSync } from \"./storage\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { icon_BCX } from \"../resources\";\nimport { hookFunction, patchFunction } from \"../patching\";\nimport { DrawImageEx } from \"../utilsClub\";\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport { RulesGetRuleState } from \"./rules\";\n\nconst ROOM_TEMPLATES_COUNT = 4;\n\nlet onSecondPage = false;\nlet overwriteMode: number | undefined;\n\n// Second page for the chat room settings screen that is used in both the room creation and room administration variants\nfunction ChatSettingsExtraRun() {\n\tDrawText(\"Back\", 169, 110, \"Black\", \"Gray\");\n\tDrawButton(124, 147, 90, 90, \"\", \"White\", \"Icons/West.png\");\n\n\tDrawText(\"Templates for storing / overwriting current room information & settings (press a name to toggle auto-apply)\", 1000, 650, \"Black\", \"Gray\");\n\n\tfor (let i = 0; i < ROOM_TEMPLATES_COUNT; i++) {\n\t\tconst X = 124 + i * 455;\n\t\tconst template = modStorage.roomTemplates?.[i];\n\t\tlet templateName: string = template ? (template.Name === \"\" ? \"- template without room name -\" : template.Name) : \"- empty template slot -\";\n\t\tconst tick = Date.now() % 6_000;\n\t\tif (template?.AutoApply && tick < 3_000) {\n\t\t\ttemplateName = \"- auto-applied default -\";\n\t\t}\n\n\t\tif (template) DrawImageEx(\"Backgrounds/\" + template.Background + \".jpg\", X, 700, { Alpha: MouseIn(X, 700, 400, 200) ? 0.3 : 1, Width: 400, Height: 200 });\n\t\tDrawButton(X, 700, 340, 64, \"\", template ? template.AutoApply ? \"rgba(136 , 136 , 204, 0.5)\" : \"rgba(255, 255, 255, 0.5)\" : \"#ddd\", \"\", !template ? undefined : \"Use as room creation dialog default\", !template);\n\t\tDrawTextFit(templateName, X + 170, 700 + 34, 325, \"Black\", \"Gray\");\n\t\tDrawButton(X + 340, 700, 60, 64, \"X\", template ? \"rgba(255, 255, 255, 0.3)\" : \"#ddd\", \"\", !template ? undefined : \"Delete template\", !template);\n\t\tif (overwriteMode === i) {\n\t\t\tDrawButton(X, 835, 150, 64, \"\", template ? \"rgba(255, 255, 255, 0.2)\" : \"#ddd\", \"\", undefined, !template);\n\t\t\tDrawText(\"Load\", X + 51, 835 + 32, \"Black\");\n\t\t\tDrawButton(X + 170, 835, 230, 64, \"Overwrite ?\", \"rgba(255, 242, 0, 0.2)\", \"\");\n\t\t} else {\n\t\t\tDrawButton(X, 835, 230, 64, \"\", template ? \"rgba(255, 255, 255, 0.2)\" : \"#ddd\", \"\", undefined, !template);\n\t\t\tDrawText(\"Load\", X + 51, 835 + 32, \"Black\");\n\t\t\tDrawButton(X + 250, 835, 150, 64, \"    Save\", \"rgba(255, 255, 255, 0.2)\", \"\");\n\t\t}\n\t}\n}\n// Click events for the second page of the chat room settings screen with a callback to transport data to the two patched click event functions\nfunction ChatSettingsExtraClick(create: boolean, apply: (data: RoomTemplate) => void) {\n\tif (MouseIn(124, 147, 90, 90)) {\n\t\toverwriteMode = undefined;\n\t\tonSecondPage = !onSecondPage;\n\t\treturn;\n\t}\n\tif (!modStorage.roomTemplates) {\n\t\treturn;\n\t}\n\tfor (let i = 0; i < ROOM_TEMPLATES_COUNT; i++) {\n\t\tconst X = 124 + i * 455;\n\t\tconst template = modStorage.roomTemplates[i];\n\n\t\tif (MouseIn(X, 700, 340, 64) && template) {\n\t\t\tif (template.AutoApply) {\n\t\t\t\tdelete template.AutoApply;\n\t\t\t} else {\n\t\t\t\tfor (const t of modStorage.roomTemplates) {\n\t\t\t\t\tif (t) {\n\t\t\t\t\t\tdelete t.AutoApply;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttemplate.AutoApply = true;\n\t\t\t}\n\t\t\tmodStorageSync();\n\t\t\toverwriteMode = undefined;\n\t\t\treturn;\n\t\t}\n\t\tif (MouseIn(X + 340, 700, 60, 64)) {\n\t\t\tmodStorage.roomTemplates[i] = null;\n\t\t\tmodStorageSync();\n\t\t\toverwriteMode = undefined;\n\t\t\treturn;\n\t\t}\n\t\tif ((overwriteMode === i && MouseIn(X, 835, 150, 64)) || MouseIn(X, 835, 230, 64)) {\n\t\t\tif (template) {\n\t\t\t\tconst rule = RulesGetRuleState(\"alt_room_admin_limit\");\n\t\t\t\tif (rule.isEnforced && ServerPlayerIsInChatRoom() && ChatRoomPlayerIsAdmin() && Player.IsRestrained()) {\n\t\t\t\t\trule.triggerAttempt();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tapply(template);\n\t\t\t\toverwriteMode = undefined;\n\t\t\t\tonSecondPage = !onSecondPage;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (((MouseIn(X + 250, 835, 150, 64) && !modStorage.roomTemplates[i]) || (overwriteMode === i && MouseIn(X + 170, 835, 230, 64)))) {\n\t\t\tmodStorage.roomTemplates[i] = {\n\t\t\t\tName: ElementValue(\"InputName\") ? ElementValue(\"InputName\")!.trim() : \"\",\n\t\t\t\tDescription: ElementValue(\"InputDescription\") ? ElementValue(\"InputDescription\")!.trim() : \"\",\n\t\t\t\tBackground: create ? ChatCreateBackgroundSelect : ChatAdminBackgroundSelect,\n\t\t\t\tPrivate: create ? (ChatCreatePrivate ? ChatCreatePrivate : false) : ChatAdminPrivate,\n\t\t\t\tLocked: create ? (ChatCreateLocked ? ChatCreateLocked : false) : ChatAdminLocked,\n\t\t\t\tGame: create ? ChatCreateGame : ChatAdminGame,\n\t\t\t\tAdmin: ElementValue(\"InputAdminList\") ? CommonConvertStringToArray(ElementValue(\"InputAdminList\")!.trim()) : [],\n\t\t\t\tLimit: ElementValue(\"InputSize\") ? ElementValue(\"InputSize\")!.trim() : \"\",\n\t\t\t\tBlockCategory: cloneDeep(create ? ChatBlockItemCategory : ChatAdminBlockCategory),\n\t\t\t\tAutoApply: modStorage.roomTemplates[i]?.AutoApply\n\t\t\t};\n\t\t\tmodStorageSync();\n\t\t\toverwriteMode = undefined;\n\t\t\treturn;\n\t\t} else if (MouseIn(X + 250, 835, 150, 64)) {\n\t\t\toverwriteMode = i;\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nexport class ModuleChatroomAdmin extends BaseModule {\n\tload() {\n\t\tif (!Array.isArray(modStorage.roomTemplates)) {\n\t\t\tmodStorage.roomTemplates = [];\n\t\t}\n\t\tif (modStorage.roomTemplates.length > ROOM_TEMPLATES_COUNT) {\n\t\t\tmodStorage.roomTemplates = modStorage.roomTemplates.filter(Boolean).slice(0, ROOM_TEMPLATES_COUNT - 1);\n\t\t}\n\t\twhile (modStorage.roomTemplates.length < ROOM_TEMPLATES_COUNT) {\n\t\t\tmodStorage.roomTemplates.push(null);\n\t\t}\n\t\tfor (let i = 0; i < modStorage.roomTemplates.length; i++) {\n\t\t\tif (modStorage.roomTemplates[i] !== null && !isObject(modStorage.roomTemplates[i])) {\n\t\t\t\tconsole.warn(`BCX: Resetting invalid room template slot ${i}`, modStorage.roomTemplates[i]);\n\t\t\t\tmodStorage.roomTemplates[i] = null;\n\t\t\t}\n\t\t}\n\n\t\t//#region Second page button (on room create screen)\n\t\tpatchFunction(\"ChatCreateRun\", {\n\t\t\t'DrawText(TextGet(\"RoomName\"), 535, 110,': 'DrawText(TextGet(\"RoomName\"), 675, 110,'\n\t\t});\n\t\tpatchFunction(\"ChatCreateRun\", {\n\t\t\t'ElementPosition(\"InputName\", 535, 170, 820);': 'ElementPosition(\"InputName\", 610, 170, 680);'\n\t\t});\n\t\thookFunction(\"ChatCreateRun\", 0, (args, next) => {\n\t\t\tif (onSecondPage) {\n\t\t\t\treturn ChatSettingsExtraRun();\n\t\t\t}\n\t\t\tnext(args);\n\t\t\tif (!ChatCreateShowBackgroundMode) {\n\t\t\t\tDrawText(\"More\", 169, 110, \"Black\", \"Gray\");\n\t\t\t\tDrawButton(124, 147, 90, 90, \"\", \"White\", icon_BCX);\n\t\t\t\tif (MouseIn(124, 147, 90, 90)) DrawButtonHover(34, 70, 64, 64, `More room setup options`);\n\t\t\t}\n\t\t});\n\t\thookFunction(\"ChatAdminExit\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\t// needed to auto apply a template correctly again\n\t\t\tChatBlockItemReturnData = {};\n\t\t});\n\t\thookFunction(\"ChatCreateLoad\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tconst template = modStorage.roomTemplates?.find(t => t?.AutoApply);\n\t\t\tif (template &&\n\t\t\t\tBackgroundSelectionPreviousScreen !== CurrentScreen &&\n\t\t\t\tObject.keys(ChatBlockItemReturnData).length === 0\n\t\t\t) {\n\t\t\t\tconst inputName = document.getElementById(\"InputName\") as HTMLInputElement | undefined;\n\t\t\t\tconst inputDescription = document.getElementById(\"InputDescription\") as HTMLInputElement | undefined;\n\t\t\t\tconst inputAdminList = document.getElementById(\"InputAdminList\") as HTMLTextAreaElement | undefined;\n\t\t\t\tconst inputSize = document.getElementById(\"InputSize\") as HTMLInputElement | undefined;\n\n\t\t\t\tif (inputName) inputName.value = template.Name;\n\t\t\t\tif (inputDescription) inputDescription.value = template.Description;\n\t\t\t\tChatCreateBackgroundSelect = template.Background;\n\t\t\t\tChatCreatePrivate = template.Private;\n\t\t\t\tChatCreateLocked = template.Locked;\n\t\t\t\tChatCreateGame = template.Game;\n\t\t\t\tif (inputAdminList) inputAdminList.value = template.Admin.toString();\n\t\t\t\tif (inputSize) inputSize.value = template.Limit;\n\t\t\t\tChatBlockItemCategory = template.BlockCategory;\n\t\t\t}\n\t\t\t// needed to auto apply a template correctly again\n\t\t\tBackgroundSelectionPreviousScreen = \"\";\n\t\t\tChatBlockItemReturnData = {};\n\t\t});\n\t\t//#endregion\n\t\thookFunction(\"ChatCreateClick\", 0, (args, next) => {\n\t\t\tif (onSecondPage) {\n\t\t\t\treturn ChatSettingsExtraClick(true, (data) => {\n\t\t\t\t\tconst inputName = document.getElementById(\"InputName\") as HTMLInputElement | undefined;\n\t\t\t\t\tconst inputDescription = document.getElementById(\"InputDescription\") as HTMLInputElement | undefined;\n\t\t\t\t\tconst inputAdminList = document.getElementById(\"InputAdminList\") as HTMLTextAreaElement | undefined;\n\t\t\t\t\tconst inputSize = document.getElementById(\"InputSize\") as HTMLInputElement | undefined;\n\n\t\t\t\t\tif (inputName) inputName.value = data.Name;\n\t\t\t\t\tif (inputDescription) inputDescription.value = data.Description;\n\t\t\t\t\tChatCreateBackgroundSelect = data.Background;\n\t\t\t\t\tChatCreatePrivate = data.Private;\n\t\t\t\t\tChatCreateLocked = data.Locked;\n\t\t\t\t\tChatCreateGame = data.Game;\n\t\t\t\t\tif (inputAdminList) inputAdminList.value = data.Admin.toString();\n\t\t\t\t\tif (inputSize) inputSize.value = data.Limit;\n\t\t\t\t\tChatBlockItemCategory = data.BlockCategory;\n\t\t\t\t});\n\t\t\t}\n\t\t\t// click event for second page button\n\t\t\tif (MouseIn(124, 147, 90, 90)) {\n\t\t\t\tonSecondPage = !onSecondPage;\n\t\t\t\tElementToggleGeneratedElements(\"ChatCreate\", false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\t\t//#region Second page button (on room admin screen)\n\t\tpatchFunction(\"ChatAdminRun\", {\n\t\t\t'DrawText(TextGet(\"RoomName\"), 535, 110,': 'DrawText(TextGet(\"RoomName\"), 675, 110,'\n\t\t});\n\t\tpatchFunction(\"ChatAdminRun\", {\n\t\t\t'ElementPosition(\"InputName\", 535, 170, 820);': 'ElementPosition(\"InputName\", 610, 170, 680);'\n\t\t});\n\t\thookFunction(\"ChatAdminRun\", 0, (args, next) => {\n\t\t\tif (onSecondPage) {\n\t\t\t\treturn ChatSettingsExtraRun();\n\t\t\t}\n\t\t\tnext(args);\n\t\t\tDrawText(\"More\", 169, 110, \"Black\", \"Gray\");\n\t\t\tDrawButton(124, 147, 90, 90, \"\", \"White\", icon_BCX);\n\t\t\tif (MouseIn(124, 147, 90, 90)) DrawButtonHover(34, 70, 64, 64, `More room setup options`);\n\t\t});\n\t\t//#endregion\n\t\thookFunction(\"ChatAdminClick\", 0, (args, next) => {\n\t\t\tif (onSecondPage) {\n\t\t\t\treturn ChatSettingsExtraClick(false, (data) => {\n\t\t\t\t\tconst inputName = document.getElementById(\"InputName\") as HTMLInputElement | undefined;\n\t\t\t\t\tconst inputDescription = document.getElementById(\"InputDescription\") as HTMLInputElement | undefined;\n\t\t\t\t\tconst inputAdminList = document.getElementById(\"InputAdminList\") as HTMLTextAreaElement | undefined;\n\t\t\t\t\tconst inputSize = document.getElementById(\"InputSize\") as HTMLInputElement | undefined;\n\n\t\t\t\t\tif (inputName) inputName.value = data.Name;\n\t\t\t\t\tif (inputDescription) inputDescription.value = data.Description;\n\t\t\t\t\tChatAdminBackgroundSelect = data.Background;\n\t\t\t\t\tChatAdminPrivate = data.Private;\n\t\t\t\t\tChatAdminLocked = data.Locked;\n\t\t\t\t\tChatAdminGame = data.Game;\n\t\t\t\t\tif (inputAdminList) inputAdminList.value = data.Admin.toString();\n\t\t\t\t\tif (inputSize) inputSize.value = data.Limit;\n\t\t\t\t\tChatAdminBlockCategory = data.BlockCategory;\n\t\t\t\t});\n\t\t\t}\n\t\t\t// click event for second page button\n\t\t\tif (MouseIn(124, 147, 90, 90)) {\n\t\t\t\tonSecondPage = !onSecondPage;\n\t\t\t\tElementToggleGeneratedElements(\"ChatAdmin\", false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\t}\n}","import Stack from './_Stack.js';\nimport baseIsEqual from './_baseIsEqual.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * The base implementation of `_.isMatch` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to inspect.\n * @param {Object} source The object of property values to match.\n * @param {Array} matchData The property names, values, and compare flags to match.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n */\nfunction baseIsMatch(object, source, matchData, customizer) {\n  var index = matchData.length,\n      length = index,\n      noCustomizer = !customizer;\n\n  if (object == null) {\n    return !length;\n  }\n  object = Object(object);\n  while (index--) {\n    var data = matchData[index];\n    if ((noCustomizer && data[2])\n          ? data[1] !== object[data[0]]\n          : !(data[0] in object)\n        ) {\n      return false;\n    }\n  }\n  while (++index < length) {\n    data = matchData[index];\n    var key = data[0],\n        objValue = object[key],\n        srcValue = data[1];\n\n    if (noCustomizer && data[2]) {\n      if (objValue === undefined && !(key in object)) {\n        return false;\n      }\n    } else {\n      var stack = new Stack;\n      if (customizer) {\n        var result = customizer(objValue, srcValue, key, object, source, stack);\n      }\n      if (!(result === undefined\n            ? baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG, customizer, stack)\n            : result\n          )) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nexport default baseIsMatch;\n","import isObject from './isObject.js';\n\n/**\n * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` if suitable for strict\n *  equality comparisons, else `false`.\n */\nfunction isStrictComparable(value) {\n  return value === value && !isObject(value);\n}\n\nexport default isStrictComparable;\n","import isStrictComparable from './_isStrictComparable.js';\nimport keys from './keys.js';\n\n/**\n * Gets the property names, values, and compare flags of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the match data of `object`.\n */\nfunction getMatchData(object) {\n  var result = keys(object),\n      length = result.length;\n\n  while (length--) {\n    var key = result[length],\n        value = object[key];\n\n    result[length] = [key, value, isStrictComparable(value)];\n  }\n  return result;\n}\n\nexport default getMatchData;\n","/**\n * A specialized version of `matchesProperty` for source values suitable\n * for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction matchesStrictComparable(key, srcValue) {\n  return function(object) {\n    if (object == null) {\n      return false;\n    }\n    return object[key] === srcValue &&\n      (srcValue !== undefined || (key in Object(object)));\n  };\n}\n\nexport default matchesStrictComparable;\n","import baseIsMatch from './_baseIsMatch.js';\nimport getMatchData from './_getMatchData.js';\nimport matchesStrictComparable from './_matchesStrictComparable.js';\n\n/**\n * The base implementation of `_.matches` which doesn't clone `source`.\n *\n * @private\n * @param {Object} source The object of property values to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatches(source) {\n  var matchData = getMatchData(source);\n  if (matchData.length == 1 && matchData[0][2]) {\n    return matchesStrictComparable(matchData[0][0], matchData[0][1]);\n  }\n  return function(object) {\n    return object === source || baseIsMatch(object, source, matchData);\n  };\n}\n\nexport default baseMatches;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/;\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\nexport default isKey;\n","import MapCache from './_MapCache.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `clear`, `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Expose `MapCache`.\nmemoize.Cache = MapCache;\n\nexport default memoize;\n","import memoize from './memoize.js';\n\n/** Used as the maximum memoize cache size. */\nvar MAX_MEMOIZE_SIZE = 500;\n\n/**\n * A specialized version of `_.memoize` which clears the memoized function's\n * cache when it exceeds `MAX_MEMOIZE_SIZE`.\n *\n * @private\n * @param {Function} func The function to have its output memoized.\n * @returns {Function} Returns the new memoized function.\n */\nfunction memoizeCapped(func) {\n  var result = memoize(func, function(key) {\n    if (cache.size === MAX_MEMOIZE_SIZE) {\n      cache.clear();\n    }\n    return key;\n  });\n\n  var cache = result.cache;\n  return result;\n}\n\nexport default memoizeCapped;\n","import memoizeCapped from './_memoizeCapped.js';\n\n/** Used to match property names within property paths. */\nvar rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoizeCapped(function(string) {\n  var result = [];\n  if (string.charCodeAt(0) === 46 /* . */) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, subString) {\n    result.push(quote ? subString.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\nexport default stringToPath;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","import isArray from './isArray.js';\nimport isKey from './_isKey.js';\nimport stringToPath from './_stringToPath.js';\nimport toString from './toString.js';\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @param {Object} [object] The object to query keys on.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value, object) {\n  if (isArray(value)) {\n    return value;\n  }\n  return isKey(value, object) ? [value] : stringToPath(toString(value));\n}\n\nexport default castPath;\n","import isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default toKey;\n","import castPath from './_castPath.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = castPath(path, object);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\nexport default baseGet;\n","import baseGet from './_baseGet.js';\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\nexport default get;\n","/**\n * The base implementation of `_.hasIn` without support for deep paths.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {Array|string} key The key to check.\n * @returns {boolean} Returns `true` if `key` exists, else `false`.\n */\nfunction baseHasIn(object, key) {\n  return object != null && key in Object(object);\n}\n\nexport default baseHasIn;\n","import castPath from './_castPath.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isIndex from './_isIndex.js';\nimport isLength from './isLength.js';\nimport toKey from './_toKey.js';\n\n/**\n * Checks if `path` exists on `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @param {Function} hasFunc The function to check properties.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n */\nfunction hasPath(object, path, hasFunc) {\n  path = castPath(path, object);\n\n  var index = -1,\n      length = path.length,\n      result = false;\n\n  while (++index < length) {\n    var key = toKey(path[index]);\n    if (!(result = object != null && hasFunc(object, key))) {\n      break;\n    }\n    object = object[key];\n  }\n  if (result || ++index != length) {\n    return result;\n  }\n  length = object == null ? 0 : object.length;\n  return !!length && isLength(length) && isIndex(key, length) &&\n    (isArray(object) || isArguments(object));\n}\n\nexport default hasPath;\n","import baseHasIn from './_baseHasIn.js';\nimport hasPath from './_hasPath.js';\n\n/**\n * Checks if `path` is a direct or inherited property of `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n * @example\n *\n * var object = _.create({ 'a': _.create({ 'b': 2 }) });\n *\n * _.hasIn(object, 'a');\n * // => true\n *\n * _.hasIn(object, 'a.b');\n * // => true\n *\n * _.hasIn(object, ['a', 'b']);\n * // => true\n *\n * _.hasIn(object, 'b');\n * // => false\n */\nfunction hasIn(object, path) {\n  return object != null && hasPath(object, path, baseHasIn);\n}\n\nexport default hasIn;\n","import baseIsEqual from './_baseIsEqual.js';\nimport get from './get.js';\nimport hasIn from './hasIn.js';\nimport isKey from './_isKey.js';\nimport isStrictComparable from './_isStrictComparable.js';\nimport matchesStrictComparable from './_matchesStrictComparable.js';\nimport toKey from './_toKey.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.\n *\n * @private\n * @param {string} path The path of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatchesProperty(path, srcValue) {\n  if (isKey(path) && isStrictComparable(srcValue)) {\n    return matchesStrictComparable(toKey(path), srcValue);\n  }\n  return function(object) {\n    var objValue = get(object, path);\n    return (objValue === undefined && objValue === srcValue)\n      ? hasIn(object, path)\n      : baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG);\n  };\n}\n\nexport default baseMatchesProperty;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nexport default identity;\n","/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nexport default baseProperty;\n","import baseGet from './_baseGet.js';\n\n/**\n * A specialized version of `baseProperty` which supports deep paths.\n *\n * @private\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyDeep(path) {\n  return function(object) {\n    return baseGet(object, path);\n  };\n}\n\nexport default basePropertyDeep;\n","import baseProperty from './_baseProperty.js';\nimport basePropertyDeep from './_basePropertyDeep.js';\nimport isKey from './_isKey.js';\nimport toKey from './_toKey.js';\n\n/**\n * Creates a function that returns the value at `path` of a given object.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n * @example\n *\n * var objects = [\n *   { 'a': { 'b': 2 } },\n *   { 'a': { 'b': 1 } }\n * ];\n *\n * _.map(objects, _.property('a.b'));\n * // => [2, 1]\n *\n * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');\n * // => [1, 2]\n */\nfunction property(path) {\n  return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);\n}\n\nexport default property;\n","import baseMatches from './_baseMatches.js';\nimport baseMatchesProperty from './_baseMatchesProperty.js';\nimport identity from './identity.js';\nimport isArray from './isArray.js';\nimport property from './property.js';\n\n/**\n * The base implementation of `_.iteratee`.\n *\n * @private\n * @param {*} [value=_.identity] The value to convert to an iteratee.\n * @returns {Function} Returns the iteratee.\n */\nfunction baseIteratee(value) {\n  // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.\n  // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.\n  if (typeof value == 'function') {\n    return value;\n  }\n  if (value == null) {\n    return identity;\n  }\n  if (typeof value == 'object') {\n    return isArray(value)\n      ? baseMatchesProperty(value[0], value[1])\n      : baseMatches(value);\n  }\n  return property(value);\n}\n\nexport default baseIteratee;\n","/**\n * Gets the last element of `array`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @returns {*} Returns the last element of `array`.\n * @example\n *\n * _.last([1, 2, 3]);\n * // => 3\n */\nfunction last(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? array[length - 1] : undefined;\n}\n\nexport default last;\n","/**\n * The base implementation of `_.slice` without an iteratee call guard.\n *\n * @private\n * @param {Array} array The array to slice.\n * @param {number} [start=0] The start position.\n * @param {number} [end=array.length] The end position.\n * @returns {Array} Returns the slice of `array`.\n */\nfunction baseSlice(array, start, end) {\n  var index = -1,\n      length = array.length;\n\n  if (start < 0) {\n    start = -start > length ? 0 : (length + start);\n  }\n  end = end > length ? length : end;\n  if (end < 0) {\n    end += length;\n  }\n  length = start > end ? 0 : ((end - start) >>> 0);\n  start >>>= 0;\n\n  var result = Array(length);\n  while (++index < length) {\n    result[index] = array[index + start];\n  }\n  return result;\n}\n\nexport default baseSlice;\n","import baseGet from './_baseGet.js';\nimport baseSlice from './_baseSlice.js';\n\n/**\n * Gets the parent value at `path` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array} path The path to get the parent value of.\n * @returns {*} Returns the parent value.\n */\nfunction parent(object, path) {\n  return path.length < 2 ? object : baseGet(object, baseSlice(path, 0, -1));\n}\n\nexport default parent;\n","import castPath from './_castPath.js';\nimport last from './last.js';\nimport parent from './_parent.js';\nimport toKey from './_toKey.js';\n\n/**\n * The base implementation of `_.unset`.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {Array|string} path The property path to unset.\n * @returns {boolean} Returns `true` if the property is deleted, else `false`.\n */\nfunction baseUnset(object, path) {\n  path = castPath(path, object);\n  object = parent(object, path);\n  return object == null || delete object[toKey(last(path))];\n}\n\nexport default baseUnset;\n","import baseUnset from './_baseUnset.js';\nimport isIndex from './_isIndex.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * The base implementation of `_.pullAt` without support for individual\n * indexes or capturing the removed elements.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {number[]} indexes The indexes of elements to remove.\n * @returns {Array} Returns `array`.\n */\nfunction basePullAt(array, indexes) {\n  var length = array ? indexes.length : 0,\n      lastIndex = length - 1;\n\n  while (length--) {\n    var index = indexes[length];\n    if (length == lastIndex || index !== previous) {\n      var previous = index;\n      if (isIndex(index)) {\n        splice.call(array, index, 1);\n      } else {\n        baseUnset(array, index);\n      }\n    }\n  }\n  return array;\n}\n\nexport default basePullAt;\n","import baseIteratee from './_baseIteratee.js';\nimport basePullAt from './_basePullAt.js';\n\n/**\n * Removes all elements from `array` that `predicate` returns truthy for\n * and returns an array of the removed elements. The predicate is invoked\n * with three arguments: (value, index, array).\n *\n * **Note:** Unlike `_.filter`, this method mutates `array`. Use `_.pull`\n * to pull elements from an array by value.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to modify.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @returns {Array} Returns the new array of removed elements.\n * @example\n *\n * var array = [1, 2, 3, 4];\n * var evens = _.remove(array, function(n) {\n *   return n % 2 == 0;\n * });\n *\n * console.log(array);\n * // => [1, 3]\n *\n * console.log(evens);\n * // => [2, 4]\n */\nfunction remove(array, predicate) {\n  var result = [];\n  if (!(array && array.length)) {\n    return result;\n  }\n  var index = -1,\n      indexes = [],\n      length = array.length;\n\n  predicate = baseIteratee(predicate, 3);\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result.push(value);\n      indexes.push(index);\n    }\n  }\n  basePullAt(array, indexes);\n  return result;\n}\n\nexport default remove;\n","import { Command_pickAutocomplete, Command_selectCharacter, Command_selectCharacterAutocomplete, Command_selectWornItem, Command_selectWornItemAutocomplete, registerCommandParsed } from \"./commands\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { ChatRoomSendLocal, updateChatroom } from \"../utilsClub\";\nimport { registerCommand } from \"./commands\";\nimport { hookFunction } from \"../patching\";\nimport { RulesGetRuleState } from \"./rules\";\nimport backgroundList from \"../generated/backgroundList.json\";\nimport { OverridePlayerDialog } from \"./miscPatches\";\nimport remove from \"lodash-es/remove\";\n\nconst BACKGROUNDS_BCX_NAME = \"[BCX] Hidden\";\n\nexport function InvisibilityEarbuds() {\n\tif (InventoryGet(Player, \"ItemEars\")?.Asset.Name === \"BluetoothEarbuds\") {\n\t\tInventoryRemove(Player, \"ItemEars\");\n\t} else {\n\t\tconst asset = Asset.find(A => A.Name === \"BluetoothEarbuds\");\n\t\tif (!asset) return;\n\t\tPlayer.Appearance = Player.Appearance.filter(A => A.Asset.Group.Name !== \"ItemEars\");\n\t\tPlayer.Appearance.push({\n\t\t\tAsset: asset,\n\t\t\tColor: \"Default\",\n\t\t\tDifficulty: -100,\n\t\t\tProperty: {\n\t\t\t\tType: \"Light\",\n\t\t\t\tEffect: [],\n\t\t\t\tHide: AssetGroup.map(A => A.Name).filter(A => A !== \"ItemEars\")\n\t\t\t}\n\t\t});\n\t\tCharacterRefresh(Player);\n\t}\n\tChatRoomCharacterUpdate(Player);\n}\n\n//#region Antiblind\nlet antiblind: boolean = false;\n\nfunction toggleAntiblind(): boolean {\n\tif (!antiblind) {\n\t\tconst blockRule = RulesGetRuleState(\"block_antiblind\");\n\t\tif (blockRule.isEnforced) {\n\t\t\tblockRule.triggerAttempt();\n\t\t\treturn false;\n\t\t} else if (blockRule.inEffect) {\n\t\t\tblockRule.trigger();\n\t\t}\n\t}\n\tantiblind = !antiblind;\n\treturn true;\n}\n//#endregion\n\nexport class ModuleClubUtils extends BaseModule {\n\tload() {\n\t\t//#region Antiblind\n\t\tregisterCommand(\"antiblind\", \"- Toggles ability to always see despite items\", () => {\n\t\t\tif (toggleAntiblind()) {\n\t\t\t\tChatRoomSendLocal(`Antiblind switched ${antiblind ? \"on\" : \"off\"}`);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\thookFunction(\"Player.GetBlindLevel\", 9, (args, next) => {\n\t\t\tif (antiblind) return 0;\n\t\t\treturn next(args);\n\t\t});\n\t\t//#endregion\n\t\t//#region Hidden room backgrounds\n\t\tregisterCommand(\"background\", \"<name> - Changes chat room background\", (arg) => {\n\t\t\tif (arg.trim() === \"\") {\n\t\t\t\tChatRoomSendLocal(`Try pressing the \"tab\"-key to show autocomplete options`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst Background = backgroundList.find(i => i.toLocaleLowerCase() === arg.toLocaleLowerCase());\n\t\t\tif (!Background) {\n\t\t\t\tChatRoomSendLocal(`Invalid/unknown background`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (!updateChatroom({ Background })) {\n\t\t\t\tChatRoomSendLocal(`Failed to update room. Are you admin?`);\n\t\t\t}\n\t\t\treturn true;\n\t\t}, (arg) => Command_pickAutocomplete(arg, backgroundList));\n\t\t// Add new backgrounds to the list\n\n\t\tif (!BackgroundsTagList.includes(BACKGROUNDS_BCX_NAME)) {\n\t\t\tBackgroundsTagList.push(BACKGROUNDS_BCX_NAME);\n\t\t}\n\n\t\tfor (const background of backgroundList) {\n\t\t\tif (BackgroundsList.some(i => i.Name === background))\n\t\t\t\tcontinue;\n\t\t\tBackgroundsList.push({ Name: background, Tag: [BACKGROUNDS_BCX_NAME] });\n\t\t\tOverridePlayerDialog(background, `[Hidden] ${background}`);\n\t\t}\n\n\t\thookFunction(\"BackgroundSelectionRun\", 0, (args, next) => {\n\t\t\tif (BackgroundSelectionOffset >= BackgroundSelectionView.length) BackgroundSelectionOffset = 0;\n\t\t\tnext(args);\n\t\t});\n\n\t\t//#endregion\n\t\tregisterCommandParsed(\"colour\", \"<source> <item> <target> - Copies color of certain item from source character to target character\",\n\t\t\t(argv) => {\n\t\t\t\tif (argv.length !== 3) {\n\t\t\t\t\tChatRoomSendLocal(`Expected three arguments: <source> <item> <target>`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst source = Command_selectCharacter(argv[0]);\n\t\t\t\tif (typeof source === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(source);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst target = Command_selectCharacter(argv[2]);\n\t\t\t\tif (typeof target === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(target);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst item = Command_selectWornItem(source, argv[1]);\n\t\t\t\tif (typeof item === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(item);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst targetItem = target.Character.Appearance.find(A => A.Asset === item.Asset);\n\t\t\t\tif (!targetItem) {\n\t\t\t\t\tChatRoomSendLocal(`Target must be wearing the same item`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\ttargetItem.Color = Array.isArray(item.Color) ? item.Color.slice() : item.Color;\n\t\t\t\tCharacterRefresh(target.Character);\n\t\t\t\tChatRoomCharacterUpdate(target.Character);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\t(argv) => {\n\t\t\t\tif (argv.length === 1) {\n\t\t\t\t\treturn Command_selectCharacterAutocomplete(argv[0]);\n\t\t\t\t} else if (argv.length === 2) {\n\t\t\t\t\tconst source = Command_selectCharacter(argv[0]);\n\t\t\t\t\tif (typeof source !== \"string\") {\n\t\t\t\t\t\treturn Command_selectWornItemAutocomplete(source, argv[1]);\n\t\t\t\t\t}\n\t\t\t\t} else if (argv.length === 3) {\n\t\t\t\t\treturn Command_selectCharacterAutocomplete(argv[2]);\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t}\n\t\t);\n\t\tregisterCommandParsed(\"allowactivities\", \"<character> <item> - Modifies item to not block activities\",\n\t\t\t(argv) => {\n\t\t\t\tif (argv.length !== 2) {\n\t\t\t\t\tChatRoomSendLocal(`Expected two arguments: <charcater> <item>`);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst char = Command_selectCharacter(argv[0]);\n\t\t\t\tif (typeof char === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(char);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst item = Command_selectWornItem(char, argv[1]);\n\t\t\t\tif (typeof item === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(item);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!item.Property) {\n\t\t\t\t\titem.Property = {};\n\t\t\t\t}\n\t\t\t\titem.Property.AllowActivityOn = AssetGroup.map(A => A.Name);\n\t\t\t\tCharacterRefresh(char.Character);\n\t\t\t\tChatRoomCharacterUpdate(char.Character);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\t(argv) => {\n\t\t\t\tif (argv.length === 1) {\n\t\t\t\t\treturn Command_selectCharacterAutocomplete(argv[0]);\n\t\t\t\t} else if (argv.length === 2) {\n\t\t\t\t\tconst source = Command_selectCharacter(argv[0]);\n\t\t\t\t\tif (typeof source !== \"string\") {\n\t\t\t\t\t\treturn Command_selectWornItemAutocomplete(source, argv[1]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t}\n\t\t);\n\t}\n\n\trun() {\n\t\t// Refresh current background list, if already built\n\t\tif (ChatCreateBackgroundList != null) {\n\t\t\tChatCreateBackgroundList = BackgroundsGenerateList(BackgroundSelectionTagList);\n\t\t}\n\t}\n\n\tunload() {\n\t\tremove(BackgroundsTagList, i => i === BACKGROUNDS_BCX_NAME);\n\t\tremove(BackgroundsList, i => i.Tag.includes(BACKGROUNDS_BCX_NAME));\n\t\t// Refresh current background list, if already built\n\t\tif (ChatCreateBackgroundList != null) {\n\t\t\tChatCreateBackgroundList = BackgroundsGenerateList(BackgroundSelectionTagList);\n\t\t}\n\t}\n}\n","import { allowMode, isNModClient, isBind, isCloth, DrawImageEx, itemColorsEquals } from \"../utilsClub\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { hookFunction } from \"../patching\";\nimport { arrayUnique, clipboardAvailable } from \"../utils\";\n\nimport isEqual from \"lodash-es/isEqual\";\nimport cloneDeep from \"lodash-es/cloneDeep\";\nimport { RedirectGetImage } from \"./miscPatches\";\nimport { curseMakeSavedProperty } from \"./curses\";\nimport { BCX_setTimeout } from \"../BCXContext\";\n\nexport function j_WardrobeExportSelectionClothes(includeBinds: boolean = false): string {\n\tif (!CharacterAppearanceSelection) return \"\";\n\tconst save = CharacterAppearanceSelection.Appearance\n\t\t.filter(a => isCloth(a, true) || (includeBinds && isBind(a)))\n\t\t.map(WardrobeAssetBundle);\n\treturn LZString.compressToBase64(JSON.stringify(save));\n}\n\nexport function j_WardrobeImportSelectionClothes(data: string | ItemBundle[], includeBinds: boolean, force: boolean = false): string {\n\tif (typeof data !== \"string\" || data.length < 1) return \"Import error: No data\";\n\ttry {\n\t\tif (data[0] !== \"[\") {\n\t\t\tconst decompressed = LZString.decompressFromBase64(data);\n\t\t\tif (!decompressed) return \"Import error: Bad data\";\n\t\t\tdata = decompressed;\n\t\t}\n\t\tdata = JSON.parse(data) as ItemBundle[];\n\t\tif (!Array.isArray(data)) return \"Import error: Bad data\";\n\t} catch (error) {\n\t\tconsole.warn(error);\n\t\treturn \"Import error: Bad data\";\n\t}\n\tconst C = CharacterAppearanceSelection;\n\tif (!C) {\n\t\treturn \"Import error: No character\";\n\t}\n\n\tconst Allow = (a: Item | Asset) => isCloth(a, CharacterAppearanceSelection!.ID === 0) || (includeBinds && isBind(a));\n\n\tif (includeBinds && !force && C.Appearance.some(a => isBind(a) && a.Property?.Effect?.includes(\"Lock\"))) {\n\t\t// Looks for all locked items and items blocked by locked items and checks, that none of those change by the import\n\t\t// First find which groups should match\n\t\tconst matchedGroups: Set<string> = new Set();\n\t\tconst test = (item: Item) => {\n\t\t\tif (isBind(item)) {\n\t\t\t\t// For each blocked group\n\t\t\t\tfor (const block of (item.Asset.Block || []).concat(Array.isArray(item.Property?.Block) ? item.Property!.Block : [])) {\n\t\t\t\t\tif (matchedGroups.has(block) || !AssetGroup.some(g => g.Name === block))\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\tmatchedGroups.add(block);\n\t\t\t\t\tconst item2 = C.Appearance.find(a => a.Asset.Group.Name === block);\n\t\t\t\t\tif (item2) {\n\t\t\t\t\t\ttest(item2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tfor (const a of C.Appearance) {\n\t\t\tif (a.Property?.Effect?.includes(\"Lock\") && !matchedGroups.has(a.Asset.Group.Name)) {\n\t\t\t\tmatchedGroups.add(a.Asset.Group.Name);\n\t\t\t\ttest(a);\n\t\t\t}\n\t\t}\n\t\t// Then test all required groups to match\n\t\tlet success = true;\n\t\tfor (const testedGroup of matchedGroups) {\n\t\t\tconst currentItem = C.Appearance.find(a => a.Asset.Group.Name === testedGroup);\n\t\t\tconst newItem = data.find(b => b.Group === testedGroup);\n\t\t\tif (!currentItem) {\n\t\t\t\tif (newItem) {\n\t\t\t\t\tsuccess = false;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!Allow(currentItem))\n\t\t\t\tcontinue;\n\t\t\tif (\n\t\t\t\t!newItem ||\n\t\t\t\tcurrentItem.Asset.Name !== newItem.Name ||\n\t\t\t\t!itemColorsEquals(currentItem.Color, newItem.Color) ||\n\t\t\t\t!isEqual(currentItem.Property, newItem.Property)\n\t\t\t) {\n\t\t\t\tsuccess = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!success)\n\t\t\treturn \"Refusing to change locked item!\";\n\t}\n\n\t// Check if everything (except ignored properties) matches\n\tlet fullMatch = includeBinds;\n\tconst matchingGroups = new Set<string>();\n\tif (includeBinds) {\n\t\tfor (const group of arrayUnique(C.Appearance.filter(Allow).map(item => item.Asset.Group.Name).concat(data.map(item => item.Group)))) {\n\t\t\tconst wornItem = C.Appearance.find(item => item.Asset.Group.Name === group);\n\t\t\tconst bundleItem = data.find(item => item.Group === group);\n\t\t\tif (\n\t\t\t\t!wornItem ||\n\t\t\t\t!bundleItem ||\n\t\t\t\twornItem.Asset.Name !== bundleItem.Name ||\n\t\t\t\t!itemColorsEquals(wornItem.Color, bundleItem.Color) ||\n\t\t\t\t!isEqual(curseMakeSavedProperty(wornItem.Property), curseMakeSavedProperty(bundleItem.Property))\n\t\t\t) {\n\t\t\t\tfullMatch = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tmatchingGroups.add(group);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!fullMatch) {\n\t\t// If there is item change we only apply items, not locks\n\t\tC.Appearance = C.Appearance.filter(a => !Allow(a) || matchingGroups.has(a.Asset.Group.Name));\n\t\tfor (const cloth of data) {\n\t\t\tif (C.Appearance.some(a => a.Asset.Group.Name === cloth.Group)) continue;\n\t\t\tconst A = Asset.find(a => a.Group.Name === cloth.Group && a.Name === cloth.Name && Allow(a));\n\t\t\tif (A != null) {\n\t\t\t\tCharacterAppearanceSetItem(C, cloth.Group, A, cloth.Color, 0, undefined, false);\n\t\t\t\tconst item = InventoryGet(C, cloth.Group);\n\t\t\t\tif (cloth.Property && item) {\n\t\t\t\t\titem.Property = cloneDeep(curseMakeSavedProperty(cloth.Property));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.warn(`Clothing not found: `, cloth);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// Import locks on top\n\t\tfor (const cloth of data) {\n\t\t\tconst item = InventoryGet(C, cloth.Group);\n\t\t\tif (cloth.Property && item) {\n\t\t\t\titem.Property = cloneDeep(cloth.Property);\n\t\t\t}\n\t\t}\n\t}\n\tCharacterRefresh(C);\n\treturn (!fullMatch &&\n\t\tincludeBinds &&\n\t\tdata.some(i => Array.isArray(i.Property?.Effect) && i.Property?.Effect.includes(\"Lock\"))\n\t) ? \"Imported! Repeat to also import locks.\" : \"Imported!\";\n}\n\nlet j_WardrobeIncludeBinds = false;\nlet j_ShowHelp = false;\n// FUTURE: \"Importing must not change any locked item or item blocked by locked item\"\nconst helpText = \"BCX's wardrobe export/import works by converting your current appearance into a long code word that is copied to your device's clipboard. \" +\n\t\"You can then paste it anywhere you like, for instance a text file with all your outfits. At any time, you can wear the look again by copying the outfit code word to \" +\n\t\"the clipboard and importing it with the according button. Functionality of this feature depends on the device you \" +\n\t\"are using and if the clipboard can be used on it. The button to the left of the 'Export'-button toggles whether items/restraints on your character should also \" +\n\t\"be exported/imported. Importing with items has two stages: First usage adds no locks, second one also imports locks from the exported items. \" +\n\t\"That said, importing an outfit with restraints will fail if it would change any item that is locked (or blocked by a locked item), \" +\n\t\"except collars, neck accessories and neck restraints. Those, as well as the body itself, are ignored.\";\n\nfunction PasteListener(ev: ClipboardEvent) {\n\tif (CurrentScreen === \"Appearance\" && CharacterAppearanceMode === \"Wardrobe\") {\n\t\tev.preventDefault();\n\t\tev.stopImmediatePropagation();\n\t\tconst data = (ev.clipboardData || (window as any).clipboardData).getData(\"text\");\n\t\tCharacterAppearanceWardrobeText = j_WardrobeImportSelectionClothes(data, j_WardrobeIncludeBinds, allowMode);\n\t}\n}\n\nlet searchBar: HTMLInputElement | null = null;\n\nfunction enterSearchMode(C: Character) {\n\tif (!searchBar) {\n\t\tsearchBar = ElementCreateInput(\"BCXSearch\", \"text\", \"\", \"40\");\n\t\tsearchBar.oninput = () => {\n\t\t\tDialogInventoryBuild(C);\n\t\t\tAppearanceMenuBuild(C);\n\t\t};\n\t\tsearchBar.focus();\n\t\tDialogInventoryBuild(C);\n\t\tAppearanceMenuBuild(C);\n\t}\n}\n\nfunction exitSearchMode(C: Character) {\n\tif (searchBar) {\n\t\tsearchBar.remove();\n\t\tsearchBar = null;\n\t\tDialogInventoryBuild(C);\n\t\tAppearanceMenuBuild(C);\n\t}\n}\n\nexport class ModuleWardrobe extends BaseModule {\n\n\tload() {\n\t\tconst NMod = isNModClient();\n\t\tconst NModWardrobe = NMod && typeof AppearanceMode !== \"undefined\";\n\n\t\thookFunction(\"AppearanceRun\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tif ((CharacterAppearanceMode === \"Wardrobe\" || NModWardrobe && AppearanceMode === \"Wardrobe\") && clipboardAvailable) {\n\t\t\t\tconst Y = NModWardrobe ? 265 : 125;\n\t\t\t\tDrawButton(1380, Y, 50, 50, \"\", \"White\", \"\", \"How does it work?\");\n\t\t\t\tDrawImageEx(\"Icons/Question.png\", 1380 + 3, Y + 3, { Width: 44, Height: 44 });\n\t\t\t\tDrawButton(1457, Y, 50, 50, \"\", \"White\", \"\", \"Include items/restraints\");\n\t\t\t\tDrawImageEx(\"../Icons/Bondage.png\", 1457 + 6, Y + 6, { Alpha: j_WardrobeIncludeBinds ? 1 : 0.2, Width: 38, Height: 38 });\n\t\t\t\tDrawButton(1534, Y, 207, 50, \"Export\", \"White\", \"\");\n\t\t\t\tDrawButton(1768, Y, 207, 50, \"Import\", \"White\", \"\");\n\t\t\t}\n\t\t\tif (j_ShowHelp && (CharacterAppearanceMode === \"Wardrobe\" || NModWardrobe && AppearanceMode === \"Wardrobe\")) {\n\t\t\t\tMainCanvas.fillStyle = \"#ffff88\";\n\t\t\t\tMainCanvas.fillRect(30, 190, 1240, 780);\n\t\t\t\tMainCanvas.strokeStyle = \"Black\";\n\t\t\t\tMainCanvas.strokeRect(30, 190, 1240, 780);\n\t\t\t\tMainCanvas.textAlign = \"left\";\n\t\t\t\tDrawTextWrap(helpText, 30 - 1160 / 2, 210, 1200, 740, \"black\");\n\t\t\t\tMainCanvas.textAlign = \"center\";\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"AppearanceClick\", 0, (args, next) => {\n\t\t\tif ((CharacterAppearanceMode === \"Wardrobe\" || NModWardrobe && AppearanceMode === \"Wardrobe\") && clipboardAvailable) {\n\t\t\t\tconst Y = NModWardrobe ? 265 : 125;\n\t\t\t\t// Help text toggle\n\t\t\t\tif (MouseIn(1380, Y, 50, 50) || (MouseIn(30, 190, 1240, 780) && j_ShowHelp)) {\n\t\t\t\t\tj_ShowHelp = !j_ShowHelp;\n\t\t\t\t}\n\t\t\t\t// Restraints toggle\n\t\t\t\tif (MouseIn(1457, Y, 50, 50)) {\n\t\t\t\t\tj_WardrobeIncludeBinds = !j_WardrobeIncludeBinds;\n\t\t\t\t}\n\t\t\t\t// Export\n\t\t\t\tif (MouseIn(1534, Y, 207, 50)) {\n\t\t\t\t\tBCX_setTimeout(async () => {\n\t\t\t\t\t\tawait navigator.clipboard.writeText(j_WardrobeExportSelectionClothes(j_WardrobeIncludeBinds));\n\t\t\t\t\t\tCharacterAppearanceWardrobeText = \"Copied to clipboard!\";\n\t\t\t\t\t}, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Import\n\t\t\t\tif (MouseIn(1768, Y, 207, 50)) {\n\t\t\t\t\tBCX_setTimeout(async () => {\n\t\t\t\t\t\tif (typeof navigator.clipboard.readText !== \"function\") {\n\t\t\t\t\t\t\tCharacterAppearanceWardrobeText = \"Please press Ctrl+V\";\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data = await navigator.clipboard.readText();\n\t\t\t\t\t\tCharacterAppearanceWardrobeText = j_WardrobeImportSelectionClothes(data, j_WardrobeIncludeBinds, allowMode);\n\t\t\t\t\t}, 0);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\tdocument.addEventListener(\"paste\", PasteListener);\n\n\t\t//#region Search bar\n\n\t\tRedirectGetImage(\"Icons/BCX_Search.png\", \"Icons/Search.png\");\n\t\tRedirectGetImage(\"Icons/BCX_SearchExit.png\", \"Icons/Remove.png\");\n\n\t\thookFunction(\"TextGet\", 0, (args, next) => {\n\t\t\tif (args[0] === \"BCX_Search\") {\n\t\t\t\treturn \"Filter items\";\n\t\t\t} else if (args[0] === \"BCX_SearchExit\") {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\thookFunction(\"AppearanceMenuBuild\", 5, (args, next) => {\n\t\t\tnext(args);\n\t\t\tconst C = args[0] as Character;\n\t\t\tif (CharacterAppearanceMode !== \"Cloth\") {\n\t\t\t\texitSearchMode(C);\n\t\t\t} else if (searchBar) {\n\t\t\t\tAppearanceMenu = [];\n\t\t\t\tif (DialogInventory.length > 9) AppearanceMenu.push(\"Next\");\n\t\t\t\tAppearanceMenu.push(\"BCX_SearchExit\");\n\t\t\t\tif (!DialogItemPermissionMode) AppearanceMenu.push(\"Cancel\");\n\t\t\t\tAppearanceMenu.push(\"Accept\");\n\t\t\t} else {\n\t\t\t\tAppearanceMenu.splice(AppearanceMenu.length - (AppearanceMenu.includes(\"Cancel\") ? 2 : 1), 0, \"BCX_Search\");\n\t\t\t}\n\t\t});\n\n\t\thookFunction(\"AppearanceMenuClick\", 4, (args, next) => {\n\t\t\tconst X = 2000 - AppearanceMenu.length * 117;\n\t\t\tconst C = args[0] as Character;\n\t\t\tfor (let B = 0; B < AppearanceMenu.length; B++) {\n\t\t\t\tif (MouseXIn(X + 117 * B, 90)) {\n\t\t\t\t\tconst Button = AppearanceMenu[B];\n\t\t\t\t\tif (Button === \"BCX_Search\") {\n\t\t\t\t\t\tenterSearchMode(C);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (Button === \"BCX_SearchExit\") {\n\t\t\t\t\t\texitSearchMode(C);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"DialogInventoryAdd\", 5, (args, next) => {\n\t\t\tif (searchBar) {\n\t\t\t\tconst item = args[1] as Item;\n\t\t\t\tif (!searchBar.value\n\t\t\t\t\t.trim()\n\t\t\t\t\t.toLocaleLowerCase()\n\t\t\t\t\t.split(\" \")\n\t\t\t\t\t.every(i =>\n\t\t\t\t\t\titem.Asset.Description.toLocaleLowerCase().includes(i) ||\n\t\t\t\t\t\titem.Asset.Name.toLocaleLowerCase().includes(i)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"AppearanceMenuDraw\", 0, (args, next) => {\n\t\t\tif (searchBar) {\n\t\t\t\tElementPositionFix(\"BCXSearch\", 40, 900, 35, 600, 60);\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\t//#endregion\n\t}\n\n\tunload() {\n\t\tdocument.removeEventListener(\"paste\", PasteListener);\n\t\texitSearchMode(CharacterAppearanceSelection ?? Player);\n\t\tAppearanceMenuBuild(CharacterAppearanceSelection ?? Player);\n\t}\n}\n","import { allowMode, isNModClient, developmentMode, setAllowMode, setDevelopmentMode } from \"../utilsClub\";\nimport { hookFunction, patchFunction } from \"../patching\";\nimport { j_WardrobeExportSelectionClothes, j_WardrobeImportSelectionClothes } from \"./wardrobe\";\nimport { InvisibilityEarbuds } from \"./clubUtils\";\nimport { BaseModule } from \"./_BaseModule\";\nimport { unload } from \"../main\";\nimport { modStorage, switchStorageLocation } from \"./storage\";\nimport { sendQuery } from \"./messaging\";\nimport { ChatroomCharacter, getChatroomCharacter, getPlayerCharacter } from \"../characters\";\nimport { debugGenerateReport, showErrorOverlay } from \"../errorReporting\";\nimport { VERSION } from \"../config\";\n\nclass ConsoleInterface {\n\tget version(): string {\n\t\treturn VERSION;\n\t}\n\n\tgetCharacterVersion(target?: number): string | null {\n\t\tif (target !== undefined && typeof target !== \"number\")\n\t\t\treturn null;\n\n\t\tconst char = target === undefined ? getPlayerCharacter() : getChatroomCharacter(target);\n\t\treturn char ? char.BCXVersion : null;\n\t}\n\n\tget isAllow(): boolean {\n\t\treturn allowMode;\n\t}\n\n\tAllowCheats(allow?: boolean) {\n\t\tif (typeof allow !== \"boolean\" && allow !== undefined) {\n\t\t\treturn false;\n\t\t}\n\t\tif (allowMode === allow)\n\t\t\treturn true;\n\t\tif (allow === undefined) {\n\t\t\tallow = !allowMode;\n\t\t}\n\t\treturn setAllowMode(allow);\n\t}\n\n\tget isDevel(): boolean {\n\t\treturn developmentMode;\n\t}\n\n\tDevel(devel?: boolean) {\n\t\tif (typeof devel !== \"boolean\" && devel !== undefined) {\n\t\t\treturn false;\n\t\t}\n\t\tif (developmentMode === devel)\n\t\t\treturn true;\n\t\tif (devel === undefined) {\n\t\t\tdevel = !developmentMode;\n\t\t}\n\t\treturn setDevelopmentMode(devel);\n\t}\n\n\tj_WardrobeExportSelectionClothes(includeBinds: boolean = false): string {\n\t\treturn j_WardrobeExportSelectionClothes(includeBinds);\n\t}\n\n\tj_WardrobeImportSelectionClothes(data: string | ItemBundle[], includeBinds: boolean, force: boolean = false): string | true {\n\t\treturn j_WardrobeImportSelectionClothes(data, includeBinds, force);\n\t}\n\n\tToggleInvisibilityEarbuds(): void {\n\t\treturn InvisibilityEarbuds();\n\t}\n\n\tUnload() {\n\t\treturn unload();\n\t}\n\n\tget storage(): any {\n\t\tif (!developmentMode) {\n\t\t\treturn \"Development mode required\";\n\t\t}\n\t\treturn modStorage;\n\t}\n\n\tdevGetCharacter(target?: number): ChatroomCharacter | null | false {\n\t\tif (!developmentMode || (target !== undefined && typeof target !== \"number\"))\n\t\t\treturn false;\n\n\t\tif (target === undefined) {\n\t\t\treturn getPlayerCharacter();\n\t\t}\n\t\treturn getChatroomCharacter(target);\n\t}\n\n\tdevSendQuery(target: number, query: string, data: any): boolean {\n\t\tif (!developmentMode || typeof target !== \"number\" || typeof query !== \"string\")\n\t\t\treturn false;\n\n\t\tsendQuery(query as keyof BCX_queries, data, target).then(\n\t\t\tresult => {\n\t\t\t\tconsole.info(`Query ${query} to ${target} resolved:`, result);\n\t\t\t},\n\t\t\terror => {\n\t\t\t\tconsole.warn(`Query ${query} to ${target} failed:`, error);\n\t\t\t}\n\t\t);\n\n\t\treturn true;\n\t}\n\n\tswitchStorageLocation(location: number): boolean {\n\t\tif (typeof location !== \"number\")\n\t\t\treturn false;\n\t\tswitchStorageLocation(location);\n\t\treturn true;\n\t}\n\n\tshowDebugReport(): void {\n\t\tshowErrorOverlay(\n\t\t\t\"BCX Debug Report\",\n\t\t\t\"This is manually created debug report.\\n\" +\n\t\t\t\"You can use the 'Close' button at the bottom to close this overlay.\",\n\t\t\tdebugGenerateReport()\n\t\t);\n\t}\n}\n\nexport const consoleInterface: ConsoleInterface = Object.freeze(new ConsoleInterface());\n\nexport class ModuleConsole extends BaseModule {\n\tload() {\n\t\t(window as any).bcx = consoleInterface;\n\n\t\tconst NMod = isNModClient();\n\n\t\tpatchFunction(\"ChatRoomMessage\", NMod ? {\n\t\t\t\"A.DynamicDescription(Source).toLowerCase()\": `( bcx.isDevel ? A.Description : A.DynamicDescription(Source).toLowerCase() )`,\n\t\t\t\"G.Description.toLowerCase()\": `( bcx.isDevel ? G.Description : G.Description.toLowerCase() )`\n\t\t} : {\n\t\t\t\"Asset[A].DynamicDescription(SourceCharacter || Player).toLowerCase()\": `( bcx.isDevel ? Asset[A].Description : Asset[A].DynamicDescription(SourceCharacter || Player).toLowerCase() )`,\n\t\t\t\"G.Description.toLowerCase()\": `( bcx.isDevel ? G.Description : G.Description.toLowerCase() )`\n\t\t});\n\n\t\tpatchFunction(\"ExtendedItemDraw\", {\n\t\t\t\"DialogFindPlayer(DialogPrefix + Option.Name)\": `( bcx.isDevel ? JSON.stringify(Option.Property.Type) : DialogFindPlayer(DialogPrefix + Option.Name) )`\n\t\t});\n\n\t\thookFunction(\"DialogDrawItemMenu\", 0, (args, next) => {\n\t\t\tif (developmentMode) {\n\t\t\t\tDialogTextDefault = (args[0] as Character).FocusGroup?.Description || \"\";\n\t\t\t}\n\t\t\treturn next(args);\n\t\t});\n\n\t\tpatchFunction(\"DialogDrawPoseMenu\", {\n\t\t\t'\"Icons/Poses/\" + PoseGroup[P].Name + \".png\"': `\"Icons/Poses/\" + PoseGroup[P].Name + \".png\", ( bcx.isDevel ? PoseGroup[P].Name : undefined )`\n\t\t});\n\n\t\thookFunction(\"DialogDrawExpressionMenu\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\tif (developmentMode) {\n\t\t\t\tfor (let I = 0; I < DialogFacialExpressions.length; I++) {\n\t\t\t\t\tconst FE = DialogFacialExpressions[I];\n\t\t\t\t\tconst OffsetY = 185 + 100 * I;\n\n\t\t\t\t\tif (MouseIn(20, OffsetY, 90, 90)) {\n\t\t\t\t\t\tDrawText(JSON.stringify(FE.Group), 300, 950, \"White\");\n\t\t\t\t\t}\n\n\t\t\t\t\tif (I === DialogFacialExpressionsSelected) {\n\t\t\t\t\t\tfor (let j = 0; j < FE.ExpressionList.length; j++) {\n\t\t\t\t\t\t\tconst EOffsetX = 155 + 100 * (j % 3);\n\t\t\t\t\t\t\tconst EOffsetY = 185 + 100 * Math.floor(j / 3);\n\t\t\t\t\t\t\tif (MouseIn(EOffsetX, EOffsetY, 90, 90)) {\n\t\t\t\t\t\t\t\tDrawText(JSON.stringify(FE.ExpressionList[j]), 300, 950, \"White\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tDialogSelfMenuOptions.forEach(opt => {\n\t\t\tif (opt.Name === \"Pose\") {\n\t\t\t\topt.IsAvailable = () => true;\n\t\t\t\topt.Draw = function () { return DialogDrawPoseMenu(); };\n\t\t\t} else if (opt.Name === \"Expression\") {\n\t\t\t\topt.Draw = function () { return DialogDrawExpressionMenu(); };\n\t\t\t}\n\t\t});\n\t}\n\n\trun() {\n\t\tif ((window as any).BCX_Devel) {\n\t\t\tsetDevelopmentMode(true);\n\t\t}\n\t}\n\n\tunload() {\n\t\tdelete (window as any).bcx;\n\t}\n}\n","import { ChatRoomSendLocal } from \"../utilsClub\";\nimport { CommandAutocompleterParsed, Command_pickAutocomplete, Command_selectCharacter, Command_selectCharacterAutocomplete, registerCommandParsed } from \"./commands\";\nimport { BaseModule } from \"./_BaseModule\";\nimport isEqual from \"lodash-es/isEqual\";\n\nfunction customIsEnabled(feature: string): boolean {\n\treturn !!((Player.OnlineSettings as any)?.BCX_Custom?.includes(feature));\n}\n\nexport class ModuleCustom extends BaseModule {\n\tload() {\n\t\tconst customSubcommands: Record<string, [(argv: string[]) => void, CommandAutocompleterParsed | null]> = {};\n\n\t\tif (customIsEnabled(\"c\")) {\n\t\t\tcustomSubcommands.ctoggle = [() => {\n\t\t\t\tconst c = InventoryGet(Player, \"ItemVulva\");\n\t\t\t\tconst a = AssetGet(Player.AssetFamily, \"ItemVulva\", \"DoubleEndDildo\");\n\t\t\t\tif (!c && a) {\n\t\t\t\t\tCharacterAppearanceSetItem(Player, \"ItemVulva\", a, \"#A7806F\");\n\t\t\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\t\t} else if (c && c.Asset === a) {\n\t\t\t\t\tInventoryRemove(Player, \"ItemVulva\");\n\t\t\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\t\t}\n\t\t\t}, null];\n\t\t\tcustomSubcommands.ccage = [(argv) => {\n\t\t\t\tconst C = Command_selectCharacter(argv[1] ?? \"\");\n\t\t\t\tif (typeof C === \"string\") {\n\t\t\t\t\tChatRoomSendLocal(C, 10_000);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst c = InventoryGet(C.Character, \"ItemVulva\");\n\t\t\t\tconst a = AssetGet(C.Character.AssetFamily, \"ItemVulva\", \"DoubleEndDildo\");\n\t\t\t\tconst f = AssetGet(C.Character.AssetFamily, \"ItemVulva\", \"FuturisticVibrator\");\n\t\t\t\tif (c && c.Asset === a && c.Color === \"#A7806F\" && f) {\n\t\t\t\t\tInventoryRemove(Player, \"ItemVulva\");\n\t\t\t\t\tC.Character.Appearance.push({\n\t\t\t\t\t\tAsset: f,\n\t\t\t\t\t\tDifficulty: 20,\n\t\t\t\t\t\tColor: ['#A7806F', 'Default', 'Default'],\n\t\t\t\t\t\tProperty: { Mode: \"Off\", Intensity: -1, Effect: [\"Egged\"], TriggerValues: \",\".repeat(7) + \"\", AccessMode: \"LockMember\" }\n\t\t\t\t\t});\n\t\t\t\t\tCharacterRefresh(C.Character, false);\n\t\t\t\t\tChatRoomCharacterUpdate(C.Character);\n\t\t\t\t} else if (c && c.Asset === f && isEqual(c.Color, ['#A7806F', 'Default', 'Default']) && a) {\n\t\t\t\t\tCharacterAppearanceSetItem(Player, \"ItemVulva\", a, \"#A7806F\");\n\t\t\t\t\tChatRoomCharacterUpdate(Player);\n\t\t\t\t}\n\t\t\t}, (argv) => (argv.length === 2 ? Command_selectCharacterAutocomplete(argv[1]) : [])];\n\t\t}\n\n\t\tif (Object.keys(customSubcommands).length > 0) {\n\t\t\tregisterCommandParsed(\"custom\", \"\", (argv) => {\n\t\t\t\tconst cmd = customSubcommands[argv[0] ?? \"\"];\n\t\t\t\tif (cmd) {\n\t\t\t\t\tcmd[0](argv);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}, (argv) => {\n\t\t\t\tif (argv.length === 1) {\n\t\t\t\t\treturn Command_pickAutocomplete(argv[0], Object.keys(customSubcommands));\n\t\t\t\t}\n\t\t\t\treturn customSubcommands[argv[0] ?? \"\"]?.[1]?.(argv) ?? [];\n\t\t\t});\n\t\t}\n\t}\n}\n","import { hookFunction } from \"../patching\";\nimport { HookDialogMenuButtonClick, OverridePlayerDialog, RedirectGetImage } from \"./miscPatches\";\nimport { BaseModule } from \"./_BaseModule\";\n\nlet searchBar: HTMLInputElement | null = null;\nlet searchBarAutoCloase = false;\nlet struggleCooldown: number = 0;\nconst STRUGGLE_COOLDOWN_TIME = 2_000;\n\nfunction allowSearchMode(): boolean {\n\treturn DialogColor == null && StruggleProgress < 0 &&\n\t\t!StruggleLockPickOrder && DialogFocusItem == null &&\n\t\t!DialogActivityMode && DialogItemToLock == null;\n}\n\nfunction enterSearchMode(C: Character) {\n\tif (!searchBar) {\n\t\tsearchBar = ElementCreateInput(\"BCXSearch\", \"text\", \"\", \"40\");\n\t\tsearchBar.oninput = () => {\n\t\t\tif (searchBar) {\n\t\t\t\tif (searchBarAutoCloase && !searchBar.value) {\n\t\t\t\t\texitSearchMode(C);\n\t\t\t\t\tMainCanvas.canvas.focus();\n\t\t\t\t} else {\n\t\t\t\t\tDialogInventoryBuild(C);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tsearchBar.focus();\n\t\tDialogInventoryBuild(C);\n\t}\n}\n\nfunction exitSearchMode(C: Character) {\n\tif (searchBar) {\n\t\tsearchBar.remove();\n\t\tsearchBar = null;\n\t\tsearchBarAutoCloase = false;\n\t\tDialogInventoryBuild(C);\n\t}\n}\n\nexport class ModuleDialog extends BaseModule {\n\tload() {\n\t\tOverridePlayerDialog(\"BCX_Search\", \"Filter items\");\n\t\tOverridePlayerDialog(\"BCX_SearchExit\", \"\");\n\t\tRedirectGetImage(\"Icons/BCX_Search.png\", \"Icons/Search.png\");\n\t\tRedirectGetImage(\"Icons/BCX_SearchExit.png\", \"Icons/Remove.png\");\n\t\thookFunction(\"DialogMenuButtonBuild\", 5, (args, next) => {\n\t\t\tnext(args);\n\t\t\tif (!allowSearchMode()) {\n\t\t\t\texitSearchMode(args[0]);\n\t\t\t} else if (searchBar) {\n\t\t\t\tDialogMenuButton = [\"Exit\", \"BCX_SearchExit\"];\n\t\t\t\tif (DialogInventory.length > 12) {\n\t\t\t\t\tDialogMenuButton.push(\"Next\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tDialogMenuButton.splice(1, 0, \"BCX_Search\");\n\t\t\t}\n\t\t});\n\n\t\tHookDialogMenuButtonClick(\"BCX_Search\", (C) => {\n\t\t\tenterSearchMode(C);\n\t\t\treturn true;\n\t\t});\n\n\t\tHookDialogMenuButtonClick(\"BCX_SearchExit\", (C) => {\n\t\t\texitSearchMode(C);\n\t\t\treturn true;\n\t\t});\n\n\t\thookFunction(\"CommonKeyDown\", 5, (args, next) => {\n\t\t\tconst ev = args[0] as KeyboardEvent;\n\t\t\tconst sb = searchBar;\n\t\t\tif (!sb &&\n\t\t\t\tCurrentCharacter &&\n\t\t\t\tallowSearchMode() &&\n\t\t\t\tev.key.length === 1 &&\n\t\t\t\t(struggleCooldown <= Date.now() || ![\"a\", \"s\"].includes(ev.key.toLowerCase()))\n\t\t\t) {\n\t\t\t\tenterSearchMode(CurrentCharacter);\n\t\t\t\tsearchBarAutoCloase = true;\n\t\t\t\tif (searchBar) {\n\t\t\t\t\tsearchBar.value = ev.key;\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"StruggleDrawStrengthProgress\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\t// Prevent A/S spamming from writing into search right after struggle finishes\n\t\t\tstruggleCooldown = Date.now() + STRUGGLE_COOLDOWN_TIME;\n\t\t});\n\n\t\thookFunction(\"DialogInventoryAdd\", 5, (args, next) => {\n\t\t\tif (searchBar) {\n\t\t\t\tconst item = args[1] as Item;\n\t\t\t\tif (!searchBar.value\n\t\t\t\t\t.trim()\n\t\t\t\t\t.toLocaleLowerCase()\n\t\t\t\t\t.split(\" \")\n\t\t\t\t\t.every(i =>\n\t\t\t\t\t\titem.Asset.Description.toLocaleLowerCase().includes(i) ||\n\t\t\t\t\t\titem.Asset.Name.toLocaleLowerCase().includes(i)\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"DialogDrawItemMenu\", 0, (args, next) => {\n\t\t\tif (searchBar) {\n\t\t\t\tElementPositionFix(\"BCXSearch\", 40, 1005, 25, 625, 60);\n\t\t\t}\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"DialogLeaveItemMenu\", 0, (args, next) => {\n\t\t\texitSearchMode(CharacterGetCurrent() ?? Player);\n\t\t\tnext(args);\n\t\t});\n\n\t\thookFunction(\"DialogItemClick\", 0, (args, next) => {\n\t\t\tnext(args);\n\t\t\texitSearchMode(CharacterGetCurrent() ?? Player);\n\t\t});\n\n\t\t// Remove some buttons, if there are too many\n\t\thookFunction(\"DialogMenuButtonBuild\", 10, (args, next) => {\n\t\t\tnext(args);\n\t\t\tfor (const toRemove of [\"ChangeLayersMouth\", \"Prev\"]) {\n\t\t\t\tif (DialogMenuButton.length <= 9)\n\t\t\t\t\tbreak;\n\t\t\t\tconst index = DialogMenuButton.indexOf(toRemove);\n\t\t\t\tif (index >= 0) {\n\t\t\t\t\tDialogMenuButton.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\trun() {\n\t\tconst C = CharacterGetCurrent();\n\t\tif (C) {\n\t\t\tDialogInventoryBuild(C);\n\t\t}\n\t}\n\n\tunload() {\n\t\texitSearchMode(CharacterGetCurrent() ?? Player);\n\t\tDialogInventoryBuild(CharacterGetCurrent() ?? Player);\n\t}\n}\n","import { hookFunction } from \"../patching\";\nimport { DrawImageEx, isNModClient } from \"../utilsClub\";\nimport { modStorage, modStorageSync } from \"./storage\";\nimport { BaseModule } from \"./_BaseModule\";\n\nconst AUTOREFRESH_INTERVAL = 10_000;\n\nexport class ModuleFriends extends BaseModule {\n\tload() {\n\t\t//#region Friendlist Auto-Refresh\n\t\tif (!isNModClient()) {\n\t\t\tlet friendListNextRefresh: number = 0;\n\t\t\tlet pendingRefresh: boolean = false;\n\n\t\t\thookFunction(\"FriendListRun\", 0, (args, next) => {\n\t\t\t\tnext(args);\n\t\t\t\tDrawButton(1755, 25, 40, 40, \"\", pendingRefresh ? \"#88c\" : \"White\", \"\", \"Toggle 10 sec auto-refresh\");\n\t\t\t\tDrawImageEx(\"Icons/Wait.png\", 1755 + 3, 25 + 3, { Alpha: modStorage.FLAutorefresh ? 1 : 0.2, Width: 34, Height: 34 });\n\t\t\t\tif (modStorage.FLAutorefresh && Date.now() >= friendListNextRefresh && ServerIsConnected) {\n\t\t\t\t\tfriendListNextRefresh = Date.now() + AUTOREFRESH_INTERVAL;\n\t\t\t\t\tpendingRefresh = true;\n\t\t\t\t\tServerSend(\"AccountQuery\", { Query: \"OnlineFriends\" });\n\t\t\t\t}\n\t\t\t});\n\t\t\thookFunction(\"FriendListLoadFriendList\", 0, (args, next) => {\n\t\t\t\tpendingRefresh = false;\n\t\t\t\tnext(args);\n\t\t\t});\n\t\t\thookFunction(\"FriendListClick\", 4, (args, next) => {\n\t\t\t\tif (MouseIn(1755, 25, 40, 40)) {\n\t\t\t\t\tif (modStorage.FLAutorefresh) {\n\t\t\t\t\t\tdelete modStorage.FLAutorefresh;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmodStorage.FLAutorefresh = true;\n\t\t\t\t\t\tfriendListNextRefresh = Date.now() + AUTOREFRESH_INTERVAL;\n\t\t\t\t\t\tpendingRefresh = true;\n\t\t\t\t\t\tElementContent(\"FriendList\", \"\");\n\t\t\t\t\t\tServerSend(\"AccountQuery\", { Query: \"OnlineFriends\" });\n\t\t\t\t\t}\n\t\t\t\t\tmodStorageSync();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tnext(args);\n\t\t\t});\n\t\t}\n\t\t//#endregion\n\t}\n}\n","import { InfoBeep, init_findBCXSource } from \"./utilsClub\";\nimport { hookFunction } from \"./patching\";\nimport { init, loginInit } from \"./main\";\nimport { isObject } from \"./utils\";\n\nimport \"./modules\";\n\nasync function initWait() {\n\tconsole.debug(\"BCX: Init wait\");\n\tif (CurrentScreen == null || CurrentScreen === \"Login\") {\n\t\thookFunction(\"LoginResponse\", 0, (args, next) => {\n\t\t\tconsole.debug(\"BCX: Init LoginResponse caught\", args);\n\t\t\tnext(args);\n\t\t\tconst response = args[0];\n\t\t\tif (isObject(response) && typeof response.Name === \"string\" && typeof response.AccountName === \"string\") {\n\t\t\t\tloginInit(args[0]);\n\t\t\t}\n\t\t});\n\t\tInfoBeep(`BCX Ready!`);\n\t\tconsole.log(`BCX Ready!`);\n\t} else {\n\t\tconsole.debug(\"BCX: Already logged in, init\");\n\t\tinit();\n\t}\n}\n\ninit_findBCXSource();\ninitWait();\n","import { registerModule } from \"./moduleManager\";\n\nimport { ModuleAuthority } from \"./modules/authority\";\nimport { ModuleCharacter } from \"./characters\";\nimport { ModuleChatroom } from \"./modules/chatroom\";\nimport { ModuleChatroomAdmin } from \"./modules/chatroomAdmin\";\nimport { ModuleClubUtils } from \"./modules/clubUtils\";\nimport { ModuleCommands } from \"./modules/commands\";\nimport { ModuleConditions } from \"./modules/conditions\";\nimport { ModuleConsole } from \"./modules/console\";\nimport { ModuleCurses } from \"./modules/curses\";\nimport { ModuleCustom } from \"./modules/custom\";\nimport { ModuleDialog } from \"./modules/dialog\";\nimport { ModuleFriends } from \"./modules/friends\";\nimport { ModuleGUI } from \"./modules/gui\";\nimport { ModuleLog } from \"./modules/log\";\nimport { ModuleMessaging } from \"./modules/messaging\";\nimport { ModuleMiscPatches } from \"./modules/miscPatches\";\nimport { ModulePresets } from \"./modules/presets\";\nimport { ModuleRules } from \"./modules/rules\";\nimport { ModuleSpeech } from \"./modules/speech\";\nimport { ModuleStorage } from \"./modules/storage\";\nimport { ModuleVersionCheck } from \"./modules/versionCheck\";\nimport { ModuleWardrobe } from \"./modules/wardrobe\";\n\nregisterModule(new ModuleAuthority());\nregisterModule(new ModuleCharacter());\nregisterModule(new ModuleChatroom());\nregisterModule(new ModuleChatroomAdmin());\nregisterModule(new ModuleClubUtils());\nregisterModule(new ModuleCommands());\nregisterModule(new ModuleConditions());\nregisterModule(new ModuleConsole());\nregisterModule(new ModuleCurses());\nregisterModule(new ModuleCustom());\nregisterModule(new ModuleDialog());\nregisterModule(new ModuleFriends());\nregisterModule(new ModuleGUI());\nregisterModule(new ModuleLog());\nregisterModule(new ModuleMessaging());\nregisterModule(new ModuleMiscPatches());\nregisterModule(new ModulePresets());\nregisterModule(new ModuleRules());\nregisterModule(new ModuleSpeech());\nregisterModule(new ModuleStorage());\nregisterModule(new ModuleVersionCheck());\nregisterModule(new ModuleWardrobe());\n"],"names":["icon_ExternalLink","replaceAll","icon_Typing_base","icon_Typing_dot","icon_Typing_star","icon_NewMessage","icon_star","icon_heart","icon_BCX_cross","icon_BCX","icon_OwnerList","icon_rules","icon_restrictions","BCX_setInterval","handler","timeout","setInterval","ctx","debugContextStart","root","bcxArea","end","BCX_setTimeout","setTimeout","contextStack","contextInBCXArea","length","name","extraInfo","context","handle","pop","index","indexOf","console","warn","Error","toRemove","removed","splice","push","debugMakeContextReport","res","i","extra","error","stack","trim","replace","m","GROUP_NAME_OVERRIDES","ItemNeckAccessories","ItemNeckRestraints","ItemNipplesPiercings","ItemHood","ItemMisc","ItemDevices","ItemHoodAddon","ItemAddon","ItemLegs","ItemFeet","ItemBoots","ItemMouth","ItemMouth2","ItemMouth3","allowMode","developmentMode","setAllowMode","allow","setDevelopmentMode","info","devel","window","BCX_Devel","AssetGroup","forEach","G","Description","Name","Asset","A","Group","BackgroundSelectionAll","B","Low","toLowerCase","AssetLoadDescription","DialogFindPlayer","BCXSource","BCXSourceExternal","init_findBCXSource","elem","Array","from","document","getElementsByTagName","match","exec","src","externalSrc","BCX_SOURCE","log","msg","alert","getVisibleGroupName","group","InfoBeep","timer","ServerBeep","Timer","CommonTime","Message","ChatRoomActionMessage","target","ServerSend","Content","Type","Target","Dictionary","Tag","Text","ChatRoomSendLocal","sender","div","createElement","setAttribute","ChatRoomCurrentTime","Player","MemberNumber","style","background","margin","innerText","appendChild","remove","Refocus","activeElement","id","ShouldScrollDown","ElementIsScrolledToEnd","ChatLog","getElementById","ElementScrollToEnd","ElementFocus","isNModClient","ChatRoomDrawFriendList","detectOtherMods","w","NMod","BondageClubTools","BCX_BondageClubToolsPatch","ServerSocket","listeners","some","toString","includes","BCFriendList","Curse","CursedStarter","currentManifestVersion","RPScript","RPSScriptstatus","Moaner","undefined","M_MOANER_scriptOn","BcUtil","StartBcUtil","QuickAccessMenu","OLDmenu","NEWmenu","ImprovedStruggle","OLDclick","NEWclick","BCE","BCE_VERSION","DrawImageEx","Source","X","Y","Canvas","MainCanvas","Alpha","SourcePos","Width","Height","Invert","Mirror","Zoom","DrawGetImage","complete","naturalWidth","sizeChanged","width","height","save","globalCompositeOperation","globalAlpha","translate","scale","transform","drawImage","restore","DrawImageBCX","options","smartGetAsset","item","asset","smartGetAssetGroup","isCloth","allowCosplay","Category","AllowNone","Clothing","BodyCosplay","isBind","getCharacterName","memberNumber","defaultText","char","ChatRoomCharacter","Ownership","isArray","Lovership","lover","friendName","FriendNames","get","itemColorsEquals","color1","color2","CommonArraysEqual","showHelp","helpText","fillStyle","fillRect","strokeStyle","strokeRect","textAlign","DrawTextWrap","getCurrentRoomData","ChatRoomData","Background","Limit","Admin","slice","Ban","BlockCategory","Game","ChatRoomGame","Private","Locked","updateChatroom","newData","data","ServerPlayerIsInChatRoom","ChatRoomPlayerIsAdmin","Room","ID","Action","drawTypingIndicatorSpeechBubble","x","y","alpha","emote","lineWidth","p","Path2D","fill","stroke","dx","drawIcon","icon","baseSize","fillColor","strokeColor","VERSION","BCX_VERSION","VERSION_CHECK_BOT","FUNCTION_HASHES","ActivityOrgasmPrepare","ActivityOrgasmStart","AppearanceClick","AppearanceGetPreviewImageColor","AppearanceMenuBuild","AppearanceMenuClick","AppearanceMenuDraw","AppearanceRun","AsylumEntranceCanWander","BackgroundSelectionRun","CharacterAppearanceLoadCharacter","CharacterCanChangeToPose","CharacterCanKneel","CharacterLoadEffect","ChatAdminClick","ChatAdminExit","ChatAdminLoad","ChatAdminRun","ChatCreateClick","ChatCreateLoad","ChatCreateRun","ChatRoomAddCharacterToChatRoom","ChatRoomAdminAction","ChatRoomCanAttemptKneel","ChatRoomCanAttemptStand","ChatRoomCanBeLeashedBy","ChatRoomCanChangeClothes","ChatRoomCanLeave","ChatRoomClearAllElements","ChatRoomClickCharacter","ChatRoomCreateElement","ChatRoomDrawCharacterOverlay","ChatRoomFirstTimeHelp","ChatRoomIsOwnedByPlayer","ChatRoomKeyDown","ChatRoomListUpdate","ChatRoomLovershipOptionIs","ChatRoomMenuClick","ChatRoomMessage","ChatRoomOwnershipOptionIs","ChatRoomSendChat","ChatRoomSendEmote","ChatRoomShouldBlockGaggedOOCMessage","ChatRoomSync","ChatRoomSyncMemberLeave","ChatRoomUpdateDisplay","ChatSearchJoin","ChatSearchLoad","ChatSearchNormalDraw","ChatSearchRun","CheatFactor","CheatImport","ColorPickerDraw","CommandParse","CommonKeyDown","CommonSetScreen","DialogCanUnlock","DialogClickExpressionMenu","DialogDrawExpressionMenu","DialogDrawItemMenu","DialogDrawPoseMenu","DialogInventoryAdd","DialogItemClick","DialogLeaveItemMenu","DialogMenuButtonBuild","DialogMenuButtonClick","DrawArousalMeter","DrawCharacter","ExtendedItemDraw","FriendListBeepMenuSend","FriendListClick","FriendListLoadFriendList","FriendListRun","InfiltrationStealItems","InformationSheetClick","InformationSheetExit","InformationSheetRun","InventoryItemNeckAccessoriesCollarAutoShockUnitDetectSpeech","LoginMistressItems","LoginResponse","LoginStableItems","LogValue","MainHallMaidsDisabledBegForMore","MainHallWalk","ManagementCanBeReleased","ManagementCanBeReleasedOnline","ManagementCanBreakDatingLoverOnline","ManagementCanBreakTrialOnline","ManagementCanBreakUpLoverOnline","ManagementCannotBeReleased","ManagementCannotBeReleasedExtreme","ManagementCannotBeReleasedOnline","PreferenceIsPlayerInSensDep","PreferenceSubscreenDifficultyClick","PreferenceSubscreenDifficultyRun","PrivateRansomStart","ServerAccountBeep","SpeechGarble","StruggleDrawStrengthProgress","TextGet","ValidationResolveModifyDiff","FUNCTION_HASHES_NMOD","encoder","TextEncoder","crc32","str","crc","b","encode","c","j","padStart","toUpperCase","addStyle","styleString","textContent","head","append","isObject","obj","longestCommonPrefix","strings","sort","substring","arrayUnique","arr","seen","Set","filter","has","add","capitalizeFirstLetter","charAt","toLocaleUpperCase","uuidv4","crypto","getRandomValues","Uint8Array","clipboardAvailable","Boolean","navigator","clipboard","clamp","value","min","max","Math","clampWrap","formatTimeInterval","time","mode","seconds","floor","minutes","hours","days","dictionaryProcess","text","dictionary","k","v","Object","entries","PLAYER_NAME","createInputElement","type","maxLength","input","addEventListener","KeyDown","className","positionElement","element","W","H","HRatio","canvas","clientHeight","WRatio","clientWidth","Font","Top","offsetTop","Left","offsetLeft","assign","fontSize","fontFamily","CommonGetFontName","position","left","top","display","parseBCXVersion","version","devMatch","major","Number","parseInt","minor","patch","dev","BCXVersionCompare","a","BCXVersionToString","ver","BCX_VERSION_PARSED","patchedFunctions","Map","unloaded","makePatchRouter","args","original","hooks","hookIndex","callNextHook","nextargs","hook","ctxExit","resExit","final","apply","isHashExpected","functionName","hash","expectedHashes","initPatchableFunction","result","targetPath","split","join","originalHash","debug","patches","set","applyPatches","keys","fn_str","N","eval","hookFunction","priority","module","h","removeHooksByModule","removeAllHooksByModule","values","patchFunction","unload_patches","clear","callOriginal","getPatchedFunctionsHashes","includeExpected","map","Preset","ModuleCategory","MODULE_NAMES","Global","Authority","Log","Curses","Rules","Misc","MODULE_ICONS","TOGGLEABLE_MODULES","ModuleInitPhase","MiscCheat","ConditionsLimit","defaultBCXEffects","Effect","BaseModule","init","load","preset","run","unload","reload","applyPreset","listCacheClear","this","__data__","size","eq","other","assocIndexOf","array","key","arrayProto","prototype","listCacheDelete","call","listCacheGet","listCacheHas","listCacheSet","ListCache","entry","stackClear","stackDelete","stackGet","stackHas","freeGlobal","global","freeSelf","self","Function","Symbol","objectProto","hasOwnProperty","nativeObjectToString","symToStringTag","toStringTag","getRawTag","isOwn","tag","unmasked","e","objectToString","nullTag","undefinedTag","baseGetTag","asyncTag","funcTag","genTag","proxyTag","isFunction","coreJsData","maskSrcKey","uid","IE_PROTO","isMasked","func","funcProto","funcToString","toSource","reRegExpChar","reIsHostCtor","reIsNative","RegExp","baseIsNative","test","getValue","object","getNative","nativeCreate","hashClear","hashDelete","HASH_UNDEFINED","hashGet","hashHas","hashSet","Hash","mapCacheClear","string","isKeyable","getMapData","mapCacheDelete","mapCacheGet","mapCacheHas","mapCacheSet","MapCache","LARGE_ARRAY_SIZE","stackSet","pairs","Stack","arrayEach","iteratee","defineProperty","baseAssignValue","configurable","enumerable","writable","assignValue","objValue","copyObject","source","props","customizer","isNew","newValue","baseTimes","n","isObjectLike","argsTag","baseIsArguments","propertyIsEnumerable","isArguments","arguments","stubFalse","freeExports","exports","nodeType","freeModule","moduleExports","Buffer","nativeIsBuffer","isBuffer","MAX_SAFE_INTEGER","reIsUint","isIndex","isLength","arrayTag","boolTag","dateTag","errorTag","mapTag","numberTag","objectTag","regexpTag","setTag","stringTag","weakMapTag","arrayBufferTag","dataViewTag","float32Tag","float64Tag","int8Tag","int16Tag","int32Tag","uint8Tag","uint8ClampedTag","uint16Tag","uint32Tag","typedArrayTags","baseIsTypedArray","baseUnary","freeProcess","process","nodeUtil","types","require","binding","nodeIsTypedArray","isTypedArray","arrayLikeKeys","inherited","isArr","isArg","isBuff","isType","skipIndexes","String","isPrototype","Ctor","constructor","overArg","arg","nativeKeys","baseKeys","isArrayLike","baseAssign","nativeKeysIn","baseKeysIn","isProto","keysIn","baseAssignIn","allocUnsafe","cloneBuffer","buffer","isDeep","copy","copyArray","arrayFilter","predicate","resIndex","stubArray","nativeGetSymbols","getOwnPropertySymbols","getSymbols","symbol","copySymbols","arrayPush","offset","getPrototype","getPrototypeOf","getSymbolsIn","copySymbolsIn","baseGetAllKeys","keysFunc","symbolsFunc","getAllKeys","getAllKeysIn","DataView","Promise","WeakMap","promiseTag","dataViewCtorString","mapCtorString","promiseCtorString","setCtorString","weakMapCtorString","getTag","ArrayBuffer","resolve","ctorString","initCloneArray","cloneArrayBuffer","arrayBuffer","byteLength","cloneDataView","dataView","byteOffset","reFlags","cloneRegExp","regexp","lastIndex","symbolProto","symbolValueOf","valueOf","cloneSymbol","cloneTypedArray","typedArray","symbolTag","initCloneByTag","objectCreate","create","baseCreate","proto","initCloneObject","baseIsMap","nodeIsMap","isMap","baseIsSet","nodeIsSet","isSet","CLONE_DEEP_FLAG","CLONE_FLAT_FLAG","CLONE_SYMBOLS_FLAG","cloneableTags","baseClone","bitmask","isFlat","isFull","isFunc","stacked","subValue","Views","cloneDeep","GuiSubscreen","active","getCurrentSubscreen","Load","Run","Click","Exit","setSubscreen","Unload","onChange","GuiAuthorityDialogMin","character","permission","myAccesLevel","noAccess","back","super","permissionData","myAccessLevel","selectedLevel","DrawTextFit","DrawText","AccessLevel","available","DrawButton","getPermissionMinDisplayText","current","owner","isPlayer","MouseIn","Confirm","setPermission","GuiAuthorityDialogSelf","HELP_TEXTS","AuthorityRoles","AuthorityPermissions","LogConfig","ConditionsViewCurses","ConditionsEditCurses","ConditionsGlobalCurses","CursesAdd","CursesAddPermissionMode","ConditionsViewRules","ConditionsEditRules","ConditionsGlobalRules","RulesAdd","RulesAddPermissionMode","PER_PAGE_COUNT","GuiAuthorityPermissions","public","filterInput","ev","rebuildList","requestData","all","getPermissions","getMyAccessLevel","then","err","failed","permList","parentElement","body","toLocaleLowerCase","access_grantSelf","authority_grant_self","checkPermissionAccessData","access_revokeSelf","authority_revoke_self","access_editMin","authority_edit_min","categories","permdata","category","separator","localeCompare","access","permissionInfo","editSelf","editMin","totalPages","ceil","page","beginPath","moveTo","lineTo","off","rect","DrawBackNextButton","GuiAuthorityRoles","checkPermissionAccess","getPlayerCharacter","GuiMainMenu","GuiMemberSelect","callback","ignoredCharacters","roleData","refreshScreen","getRolesData","roleList","nameFilter","ElementCreateInput","Character","r","owners","L","mistress","mistresses","GetBlindLevel","GameplaySettings","BlindDisableExamine","ChatRoomCharacterList","getAllCharactersInRoom","ImmersionSettings","BlindAdjacent","playerIndex","findIndex","abs","every","f","ElementPosition","ElementRemove","hoveringTextList","Input","showInput","allowAddMistress","allowAddOwner","roleAddInputAutofill","allowRemoveOwner","allowRemoveMistress","Back","editRole","inputText","inputNumber","GuiGlobalDialogClearData","allowedConfirmTime","Date","now","clearAllData","GuiGlobalModuleToggling","enabledModules","moduleIsEnabled","changed","PX","PY","DrawCheckbox","delete","setDisabledModules","GuiGlobal","getCurrentPreset","setCacheAdd","setCacheHas","SetCache","arraySome","cacheHas","cache","COMPARE_PARTIAL_FLAG","COMPARE_UNORDERED_FLAG","equalArrays","equalFunc","isPartial","arrLength","othLength","arrStacked","othStacked","arrValue","othValue","compared","othIndex","mapToArray","setToArray","equalByTag","message","convert","equalObjects","objProps","objLength","objStacked","skipCtor","objCtor","othCtor","baseIsEqualDeep","objIsArr","othIsArr","objTag","othTag","objIsObj","othIsObj","isSameTag","objIsWrapped","othIsWrapped","objUnwrapped","othUnwrapped","baseIsEqual","isEqual","initRules_bc_alter","registerRule","loggable","shortDescription","longDescription","defaultLimit","normal","dataDefinition","deafeningStrength","default","description","state","strengthMap","light","medium","heavy","next","isEnforced","customData","whitelistedMembers","pageSize","ignoreGaggedMembersToggle","ignoreDeaf","C","CanTalk","Sender","blindnessStrength","SensDepChatLog","noBlind","getChatroomCharacter","ChatRoomCharacterCount","ChatRoomCharacterDrawlist","ChatRoomSenseDepBypass","tick","DialogFacialExpressionsSelectedBlindnessLevel","registerEffectBuilder","PlayerEffects","limited","orgasmHandling","startsWith","ArousalSettings","Progress","backup","concat","ActivityOrgasmGameResistCount","CharX","CharY","ArousalZoom","blocked","minimumRole","removeAdminToggle","hasAdmin","getCharacterAccessLevel","UpdatedRoom","triggerTexts","attempt_infoBeep","IsRestrained","ChatAdminBackgroundSelect","ChatAdminBackgroundIndex","ChatCreateBackgroundList","ChatAdminGame","ChatAdminPrivate","ChatAdminLocked","ChatBlockItemEditable","ActionType","DialogLeave","playersProfileDescription","CompressedDescription","LZString","compressToUTF16","ServerAccountUpdate","QueueData","trigger","misc","InventoryGet","ReputationGet","KidnapLeagueOnlineBountyStart","sourceMemberNumber","allowedMembers","allowList","friend","MemberName","infoBeep","summoningText","summonTime","beep","BeepType","ChatRoomName","DialogLentLockpicks","ChatRoomSetLastChatRoom","ChatRoomLeashPlayer","CharacterDeleteAllOnline","ChatRoomPlayerCanJoin","triggerAttempt","SUMMONER","cheatChangeHooks","cheatIsEnabled","cheat","modStorage","cheats","cheatSetEnabled","enabled","modStorageSync","cheatToggle","MISTRESS_CHEAT_ONLY_ITEMS","PANDORA_CHEAT_ONLY_ITEMS","PlayerDialogOverrides","OverridePlayerDialog","keyword","GetImageRedirects","RedirectGetImage","redirect","DialogMenuButtonClickHooks","HookDialogMenuButtonClick","button","fn","ModuleMiscPatches","override","CharacterGetCurrent","I","DialogMenuButton","MouseX","scrollHeight","scrollTop","CheatName","Factor","CantLoseMistress","BlockRandomEvents","MainHallRandomEventOdds","GiveMistressKey","LogQuery","InventoryDelete","ServerPlayerInventorySync","GivePandoraKey","InventoryAdd","CurrentScreen","initRules_bc_blocks","attempt_log","hookDialogMenuButtonClick","inEffect","TARGET_PLAYER","allowOwnerLocks","allowLoverLocks","ignore","Item","lock","InventoryGetLock","OwnerOnly","IsOwnedByPlayer","LoverOnly","IsLoverOfPlayer","poseButtons","bypassPoseChange","IsKneeling","announce","attempt_announce","roomList","ChatSearchResultOffset","ChatSearchResult","Friends","ChatSearchMuffle","Creator","MemberCount","MemberLimit","Space","ChatRoomMenuButtons","MouseXIn","index_remove","index_struggle","index_dismount","index_escape","attempt","onlyMoreDominantsToggle","toggleOn","FocusGroup","CurrentCharacter","ReputationCharacterGet","CN","BlackList","GhostList","TARGET_CHARACTER","LastChange","Difficulty","Creation","PreferenceDifficultyLevel","GetDifficulty","CurrentTime","PreferenceDifficultyAccept","initRules_bc_settings","preferenceSync","OnlineSettings","OnlineSharedSettings","GraphicsSettings","ItemPermission","settingHelper","setting","toggleSettingHelper","defaultValue","internalDataValidate","internalDataDefault","stateChange","newState","internalData","old","wanted","everyone","everyoneBlacklist","dominants","whitelist","DisablePickingLocksOnSelf","OfflineLockedRestrained","EnableSafeword","visible","change","Active","Visible","DisableAdvancedVibes","AffectStutter","EnableAfkTimer","EnableWardrobeIcon","AllowFullWardrobeAccess","BlockBodyCosplay","disableExamine","hideMessages","bdeForceOff","bdeForceOn","bdeTarget","hideMessagesTarget","SenseDepMessages","ChatRoomMuffle","DisableAutoRemoveLogin","AllowPlayerLeashing","remakeRooms","ReturnToChatRoom","remakeRoomTarget","ReturnToChatRoomAdmin","StimulationEvents","InvertRoom","initRules_bc_relation_control","Option","fun","speechHooks","registerSpeechHook","moduleInitPhase","falteringSpeech","soundList","oocMsg","firstWord","alreadyStudderedWord","seed","messageIndex","studderFactor","sin","random","parseMsg","rawMessage","substr","originalMessage","hasOOC","ChatSettings","MuStylePoses","ChatRoomTargetMemberNumber","noOOCMessage","processMsg","find","allowSend","hookResult","modify","onSend","antigarble","setAntigarble","blockRule","RulesGetRuleState","ModuleSpeech","lastMessage","lastMessageOriginal","chat","msg2","orig","ANTIGARBLE_LEVELS","both","ungarbled","ANTIGARBLE_LEVEL_NAMES","registerCommand","val","ChatRoomLastMessage","initRules_bc_speech_control","soundWhitelist","validate","check","sounds","sound","ok","maxWordLength","maxNumberOfWords","words","matchAll","word","bannedWords","transgression","USED_WORD","maxNumberOfMsg","currentCount","maxNumberOfEmotes","minimumPermittedRole","autoreplyText","whitelistedMemberNumbers","onlyWhenBound","FriendListBeepTarget","CanInteract","IsSecret","toGreetMemberNumbers","number","alreadyGreeted","lastRoomName","greetingSentence","nextGreet","R","SourceMemberNumber","mandatoryWords","initRules_other","lastAction","afkDidTrigger","afk_reset","enforceable","minutesBeforeAfk","AfkTimerEventsList","removeEventListener","lastReminder","reminderText","reminderFrequency","CONDITIONS_CHECK_INTERVAL","guard_ConditionsConditionRequirements","orLogic","room","inverted","roomName","role","player","guard_ConditionsConditionPublicData","condition","d","conditionHandlers","loadValidateConditionKey","favorite","timerRemove","requirements","addedBy","isInteger","validatePublicData","guard_ConditionsCategoryPublicData","allowInvalidConditionRemoval","access_normal","access_limited","access_configure","access_changeLimits","highestRoleInRoom","conditions","conditionData","validateCategorySpecificGlobalData","limits","limit","ConditionsRegisterCategory","ConditionsGetCategoryHandler","ConditionsGetCategoryEnabled","ConditionsGetCategoryData","ConditionsMakeConditionPublicData","requester","makePublicData","permission_viewOriginator","ConditionsGetCategoryPublicData","permission_normal","permission_limited","permission_configure","permission_changeLimits","getHighestRoleInRoom","getDefaultLimits","ConditionsGetCondition","ConditionsIsConditionInEffect","categoryData","ConditionsEvaluateRequirements","ConditionsSetCondition","existing","lastActive","notifyOfChange","ConditionsGetConditionLimit","ConditionsCheckAccess","ConditionsRemoveCondition","stateChangeHandler","ConditionsSetLimit","oldLimit","logLimitChange","ConditionsUpdate","oldData","updateCondition","hasAnyRequirement","logConditionUpdate","ConditionsCategoryUpdate","logCategoryUpdate","inChatroom","chatroomPrivate","results","ConditionsSubcommands","ConditionsCommandTriggersKeywords","ConditionsCommandProcessTriggers","triggers","argv","respond","level","Command_selectCharacterMemberNumber","ConditionsCommandTriggersAutocomplete","Command_pickAutocomplete","Command_selectCharacterAutocomplete","ConditionsRunSubcommand","subcommand","categorySingular","CSHelp","commandConditionSelectorHelp","parseConditionName","COMMAND_GENERIC_ERROR","clubowner","logic","configData","Command_parseTime","autoremove","ConditionsAutocompleteSubcommand","autocompleteConditionName","ModuleConditions","cursedItems","curses","itemRemove","limitValue","loadCategorySpecificGlobalData","conditiondata","loadValidateCondition","queryHandlers","conditionsGet","conditionSetLimit","conditionUpdate","conditionCategoryUpdate","conditionsTick","clearInterval","ServerIsConnected","dataChanged","conditionName","resolvedActive","copyChange","tickHandler","afterTickHandler","RULES_ANTILOOP_RESET_INTERVAL","RULES_ANTILOOP_THRESHOLD","RULES_ANTILOOP_SUSPEND_TIME","STRING_LIST_MAX_LENGTH","guard_BCX_Rule","rules","guard_RuleCustomData","rule","descriptor","def","ruleCustomDataHandlers","rulesList","validateOptions","RuleState","RulesGetDisplayDefinition","ruleCustomDataHandlerPage","memberNumberListAutoFill","listSelect","prev","click","memberNumberList","onDataChange","inputMode","pattern","disabled","PAGE_SIZE","ElementPositionFix","DrawHoverElements","screen","num","onInput","oninput","processInput","poseSelect","DialogActivePoses","DialogActivePoseMenuBuild","OffsetY","PoseGroup","P","OffsetX","IsDisabled","roleSelector","roleSelectionNext","roleSelectionPrev","lastValue","createdInput","stringList","last","newInput","textArea","toggle","parseRuleName","selector","ruleName","autocompleteRuleName","RulesGetList","RulesCreate","definition","ruleData","logMessage","LogEntryType","plaintext","RulesDelete","ruleDefinition","enforce","isLogged","texts","ruleTrigger","ruleTriggerAttempt","ModuleRules","registerPermission","defaults","dominant","switch","submissive","slave","ruleCreate","ruleDelete","registerWhisperCommand","rulesInfo","timerText","resultItem","Command_fixExclamationMark","ruleStateChange","bind","ruleTick","updateData","onlyExisting","newLimit","visibleName","didActiveChange","didTimerChange","didTriggerChange","didEnforcementChange","didLoggingChange","changeEvents","descr","lastIndexOf","resetTimer","triggerCounts","suspendedUntil","counter","commands","whisperCommands","firstTimeHelp","CommandsShowFirstTimeHelp","chatShouldDisplayFirstTimeHelp","CommandsCompleteFirstTimeHelp","autocomplete","parse","aliasCommand","originalName","alias","registerCommandParsed","registerNormal","trimStart","commandMatch","CommandParseArguments","CommandHasEmptyArgument","endsWith","CommandArgumentNeedsQuotes","CommandQuoteArgument","force","autocompleteMessage","autocompleteLastQuery","autocompleteLastResult","autocompleteNextIndex","autocompleteClear","autocompleteShow","header","highlight","option","RunCommand","command","commandInfo","RunWhisperCommand","CommandAutocomplete","prefixes","lastOptions","fin","needsQuotes","possibleArgs","CommandAutocompleteCycle","best","WhisperCommandAutocomplete","opts","o","Command_selectCharacter","characters","targets","allowNotPresent","Command_selectWornItem","items","Appearance","Command_selectWornItemAutocomplete","possible","Command_selectGroup","Command_selectGroupAutocomplete","unit","ModuleCommands","firstTimeInit","ChatRoomLastMessageIndex","KeyPress","event","preventDefault","stopImmediatePropagation","currentValue","currentTarget","sendQuery","hasAccessToPlayer","commandHint","CURSES_TRIGGER_TEXTS","swap","update","color","CURSES_TRIGGER_TEXTS_BATCH","CURSES_TRIGGER_LOGS","CURSES_TRIGGER_LOGS_BATCH","LOG_ENTRIES_LIMIT","LogAccessLevel","logConfig","none","logMessageAdd","unshift","logMessageDelete","log_deleted","deleted","logConfigSet","accessLevel","protected","LOG_CONFIG_NAMES","LOG_LEVEL_NAMES","logClear","getVisibleLogEntries","logMessageRender","curseTrigger","ASSET_NAME","curseTriggerBatch","alreadyPraisedBy","logGetAllowedActions","configure","leaveMessage","user_note","praise","logGetConfig","logPraise","allowed","logConfigDefaults","log_config_change","entered_public_room","entered_private_room","had_orgasm","permission_change","curse_change","curse_trigger","rule_change","rule_trigger","authority_roles_change","ModuleLog","logData","logDelete","logConfigGet","logConfigEdit","logEntries","toUTCString","timestamp","logentry","config","transitionDictionary","permissionChange","logConfigChange","logDeleted","userNote","curseChange","hadOrgasm","enteredPublicRoom","enteredPrivateRoom","ownershipChangesBCX","ActivityOrgasmRuined","GuiLogConfig","getLogConfig","getPermissionAccess","allowDelete","allowConfigure","configList","setLogConfig","GuiLog","getLogEntries","allowDeletion","allowConfiguration","allowPraise","allowLeaveMessage","NoteField","showMore","msgSmall","toLocaleString","DrawButtonHover","field","didPraise","GuiMisc","roomSearchAutoFill","typingIndicatorEnable","screenIndicatorEnable","CURSES_ANTILOOP_RESET_INTERVAL","CURSES_ANTILOOP_THRESHOLD","CURSES_ANTILOOP_SUSPEND_TIME","CURSE_IGNORED_PROPERTIES","ValidationModifiableProperties","CURSE_IGNORED_EFFECTS","curseMakeSavedProperty","properties","effect","curseCreateCurseItemInfo","curseProperty","Color","Property","curseAllowItemCurseProperty","Extended","AllowEffect","curseDefaultItemCurseProperty","Archetype","curseItem","g","currentItem","newCurse","curseBatch","includingEmpty","assetGroups","curseLift","curse","itemName","AssetGet","AssetFamily","curseLiftAll","ModuleCurses","curseProperties","cursesInfo","listgroup","AssetGroupItems","itemIsCursed","AssetGroupClothings","clothingIsCursed","curseStateChange","curseTick","afterCurseTick","rawData","assetGroup","didItemRemoveChange","didItemConfigCurseChange","params","Callback","ItemColorOnPickerChange","ItemColorCharacter","ItemColorItem","newColors","ItemColorState","colors","ItemColorPickerIndices","CharacterLoadCanvas","AssetGroupGet","InventoryRemove","CharacterRefresh","ChatRoomCharacterUpdate","pendingMessages","changeType","itemProperty","itemIgnoredEffects","itemEffects","curseEffects","list","GuiConditionEdit","conditionCategory","makeChangesData","changes","conditionCategoryData","conditionsGetByCategory","checkAccess","setUseGlobal","useGlobal","inputRoomName","inputMemberNumber","useGlobalCategorySetting","processInputs","headerText","font","CommonGetFont","statusText","roleSelection","ellipse","GuiConditionEditCurses","allowSettingsCurse","GuiConditionGlobal","GuiConditionGlobalCurses","PER_COLUMN_COUNT","GuiConditionView","conditionCategorySingular","conditionEntries","loadCondition","displayName","showDetailedDescriptionBackground","showDetailedDescriptionText","drawCategoryImage","timeLeftText","drawEntryExtra","removeLabel","onDescriptionTextClick","openEditSubscreen","removeCondition","openGlobalConfig","GuiCursesAdd","curseData","permissionMode","row","column","allowCurse","GuiConditionViewCurses","propertiesCursedShow","propertiesCursed","GuiConditionEditRules","GuiConditionGlobalRules","GuiRulesViewDescription","allowAdd","showFailedMsg","GuiConditionViewRules","catch","GuiRulesAdd","rulesData","ruleList","ruleIsCreated","allowAccess","backgroundY","GuiWelcomeSelection","images","descriptions","DrawRect","DrawEmptyRect","selectedPreset","border","texty","line","GuiTutorial","TUTORIAL_PAGES","image","afterDraw","TUTORIAL_BASIC_END","firstRun","currentPage","nextCheckTimer","versionCheckNewAvailable","versionCheckDidNotify","sendVersionCheckBeep","clearTimeout","sendHiddenBeep","BCX_DEVEL","GameVersion","UA","userAgent","ModuleVersionCheck","hiddenBeepHandlers","status","overlay","right","bottom","alignItems","justifyContent","win","flexDirection","padding","titleElem","descriptionElement","close","onclick","blur","MAIN_MENU_ITEMS","getDisabledModules","disabledModules","menuShouldDisplayTutorialHelp","isDisabled","BCXVersion","open","ModuleGUI","instance","currentSubscreen","subscreen","_currentSubscreen","ChatroomSM","UpdateStatus","getInformationSheetCharacter","InformationSheetSelection","changeHandlers","MouseY","playerHasAccessToCharacter","ChatRoomStatusManagerStatusType","ChatRoomStatusManager","None","GetCharacterStatus","Status","SetInputElement","InputElement","InputEnd","InputChange","GetStatus","DMS","Wardrobe","Profile","TypingStatus","newStatus","WhisperTarget","Whisper","SendUpdate","sendHiddenMessage","Typing","Emote","InputTimeout","InputTimeoutMs","DMSKeydown","altKey","code","HTMLElement","DMSKeyup","queryAnnounce","announceSelf","ModuleChatroom","hiddenMessageHandlers","effects","Effects","request","Char","Friend","FriendList","ChatRoomHideIconState","o_ChatRoomSM","ChatRoomSM","on","StorageLocations","deletionPending","modStorageLocation","finalizeFirstTimeInit","getLocalStorageName","storageClearData","BCX","localStorage","removeItem","switchStorageLocation","location","LocalStorage","ready","destroy","serializedData","compressToBase64","JSON","stringify","setItem","ModuleStorage","saved","getItem","storage","decompressFromBase64","permissions","IsOwnedByMemberNumber","IsLoverOfMemberNumber","WhiteList","permData","selfAccessBlockedByRule","permissionsMakeBundle","getPermissionDataFromBundle","bundle","setPermissionSelfAccess","characterToCheck","permissionsSync","setPermissionMinAccess","getPlayerPermissionSettings","minAccess","getPlayerRoleData","loadNames","allowedMistressList","allowedOwnerList","action","permissionToCheck","targetDescriptor","user","ownerIndex","mistressIndex","ModuleAuthority","permissionAccess","editPermission","edit","rolesData","subcommand2","permissionsList","hasAny","subcommand3","permissionNames","setDefultPermissionsForPreset","log_leaveMessage","perm","PLAYER_EFFECT_REBUILD_INTERVAL","ChatroomCharacter","ServerChatRoomGetAllowItem","PlayerCharacter","reject","currentRoomCharacters","cleanOldCharacters","BCCharacter","effectBuilderFunctions","builder","buildPlayerEffects","ModuleCharacter","asLeashBeep","pendingQueries","query","ModuleMessaging","PRESET_DISABLED_MODULES","modules_applyPreset","modules","reload_modules","ModulePresets","Infinity","runMigration","originalVersion","currentVersion","confirm","construct","registerModule","init_modules","oldVersion","unload_modules","MAX_STACK_SIZE","firstError","lastReceivedMessageType","lastSentMessageType","originalSocketEmit","originalClick","debugGenerateReport","includeBCX","href","otherMods","CurrentModule","GLVersion","unexpectedHashes","cleanupErrorLocation","debugPrettifyError","debugGenerateReportErrorEvent","inBCX","filename","lineno","colno","showErrorOverlay","title","contents","wrapCodeBlock","innerHTML","contentElem","readOnly","flex","focus","select","writeText","execCommand","onUnhandledError","bcxSocketEmit","parameters","bcxClick","InitErrorReporter","__proto__","emitEvent","UnloadErrorReporter","loginInit","BCX_Loaded","clearCaches","DrawRunMap","DrawScreen","CurrentScreenFunctions","Resize","ChatRoomMessageForwarder","AccountBeepForwarder","ROOM_TEMPLATES_COUNT","onSecondPage","overwriteMode","ChatSettingsExtraRun","template","roomTemplates","templateName","AutoApply","ChatSettingsExtraClick","t","ElementValue","ChatCreateBackgroundSelect","ChatCreatePrivate","ChatCreateLocked","ChatCreateGame","CommonConvertStringToArray","ChatBlockItemCategory","ChatAdminBlockCategory","ModuleChatroomAdmin","ChatCreateShowBackgroundMode","ChatBlockItemReturnData","BackgroundSelectionPreviousScreen","inputName","inputDescription","inputAdminList","inputSize","ElementToggleGeneratedElements","baseIsMatch","matchData","noCustomizer","srcValue","isStrictComparable","getMatchData","matchesStrictComparable","baseMatches","isSymbol","reIsDeepProp","reIsPlainProp","isKey","FUNC_ERROR_TEXT","memoize","resolver","TypeError","memoized","Cache","MAX_MEMOIZE_SIZE","memoizeCapped","rePropName","reEscapeChar","stringToPath","charCodeAt","quote","subString","arrayMap","INFINITY","symbolToString","baseToString","castPath","toKey","baseGet","path","baseHasIn","hasPath","hasFunc","hasIn","baseMatchesProperty","identity","baseProperty","basePropertyDeep","property","baseIteratee","baseSlice","start","parent","baseUnset","basePullAt","indexes","previous","BACKGROUNDS_BCX_NAME","InvisibilityEarbuds","Hide","antiblind","toggleAntiblind","ModuleClubUtils","backgroundList","BackgroundsTagList","BackgroundsList","BackgroundSelectionOffset","BackgroundSelectionView","targetItem","AllowActivityOn","BackgroundsGenerateList","BackgroundSelectionTagList","j_WardrobeExportSelectionClothes","includeBinds","CharacterAppearanceSelection","WardrobeAssetBundle","j_WardrobeImportSelectionClothes","decompressed","Allow","matchedGroups","block","Block","item2","success","testedGroup","newItem","fullMatch","matchingGroups","wornItem","bundleItem","cloth","CharacterAppearanceSetItem","j_WardrobeIncludeBinds","j_ShowHelp","PasteListener","CharacterAppearanceMode","clipboardData","getData","CharacterAppearanceWardrobeText","searchBar","enterSearchMode","DialogInventoryBuild","exitSearchMode","ModuleWardrobe","NModWardrobe","AppearanceMode","async","readText","AppearanceMenu","DialogInventory","DialogItemPermissionMode","Button","ConsoleInterface","getCharacterVersion","isAllow","AllowCheats","isDevel","Devel","ToggleInvisibilityEarbuds","devGetCharacter","devSendQuery","showDebugReport","consoleInterface","freeze","ModuleConsole","bcx","DialogTextDefault","DialogFacialExpressions","FE","DialogFacialExpressionsSelected","ExpressionList","EOffsetX","EOffsetY","DialogSelfMenuOptions","opt","IsAvailable","Draw","customIsEnabled","feature","BCX_Custom","ModuleCustom","customSubcommands","ctoggle","ccage","Mode","Intensity","TriggerValues","repeat","AccessMode","cmd","searchBarAutoCloase","struggleCooldown","STRUGGLE_COOLDOWN_TIME","allowSearchMode","DialogColor","StruggleProgress","StruggleLockPickOrder","DialogFocusItem","DialogActivityMode","DialogItemToLock","ModuleDialog","AUTOREFRESH_INTERVAL","ModuleFriends","friendListNextRefresh","pendingRefresh","FLAutorefresh","Query","ElementContent","initWait","response","AccountName"],"mappings":"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"}